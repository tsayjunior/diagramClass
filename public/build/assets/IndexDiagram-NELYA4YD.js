var so=Object.defineProperty;var no=(Z,b,me)=>b in Z?so(Z,b,{enumerable:!0,configurable:!0,writable:!0,value:me}):Z[b]=me;var f=(Z,b,me)=>no(Z,typeof b!="symbol"?b+"":b,me);import{_ as oo}from"./AuthenticatedLayout-eJJQ5i3q.js";import{k as Ie,l as ro,c as Pe,a as Dn,u as se,w as Fn,F as ao,o as Se,Z as ho,b as lo,d as It,g as De,m as uo}from"./app-CIufcYXz.js";import{_ as co}from"./_plugin-vue_export-helper-DlAUqK2U.js";(function(){const Z=typeof globalThis=="object"&&globalThis||typeof global=="object"&&global.global===global&&global||typeof self=="object"&&self.self===self&&self||{};Z.requestAnimationFrame===void 0&&(Z.setImmediate===void 0?Z.requestAnimationFrame=v=>Z.setTimeout(v,0):Z.requestAnimationFrame=Z.setImmediate);const le=class le{static Nk(e,t,i){let s=-1;return function(){const n=this,o=arguments;s!==-1&&le.Og(s),s=le.Oh(()=>{s=-1,i||e.apply(n,o)},t),i&&!s&&e.apply(n,o)}}static Oh(e,t){return Z.setTimeout(e,t)}static Og(e){Z.clearTimeout(e)}static en(e){return Z.document.createElement(e)}static o(e){throw new Error(e)}static T(e,t){let i="The object is frozen, so its properties cannot be set: "+e.toString();t!==void 0&&(i+="  to value: "+t),le.o(i)}static qI(e,t,i,s){}static i(e,t,i,s){}static WI(e,t,i){}static JI(e,t,i){}static we(e,t,i,s){}static _(e,t,i,s){let n=le.ND(i);s!==void 0&&(n+="."+s),le.o(n+" is not in the range "+t+": "+e)}static ve(e){}static lr(e,t){}static ii(e){Z.console&&Z.console.log(e)}static wt(e){return typeof e=="object"&&e!==null}static $I(e,t,i){}static eu(e,t,i){Array.isArray(e)?t>=e.length?e.push(i):e.splice(t,0,i):le.o("Cannot insert an object into an HTMLCollection or NodeList: "+i+" at "+t)}static tc(e,t){Array.isArray(e)?t>=e.length?e.pop():e.splice(t,1):le.o("Cannot remove an object from an HTMLCollection or NodeList at "+t)}static nt(){const e=le.Ck.pop();return e===void 0?[]:e}static tt(e){e.length=0,le.Ck.push(e)}static ND(e){return e===null?"*":typeof e=="string"?e:typeof e=="function"?e.name:""}static sn(e){return typeof e=="function"?e.className?e.className:e.name:le.wt(e)&&e.constructor?le.sn(e.constructor):typeof e}static Ih(e,t){return t==null||t===""?null:le.wt(e)&&t in e||e[t]?e[t]:null}static toString(e){let t=e;return le.wt(e)&&(e.text?t=e.text:e.name?t=e.name:e.key!==void 0?t=e.key:e.id!==void 0?t=e.id:e.constructor===Object&&(e.Text?t=e.Text:e.Name?t=e.Name:e.Key!==void 0?t=e.Key:e.Id!==void 0?t=e.Id:e.ID!==void 0&&(t=e.ID))),t===void 0?"undefined":t===null?"null":t.toString()}static fw(e,t){if(e.hasOwnProperty(t))return!0;let i=Object.getPrototypeOf(e);for(;i&&i!==Function;){if(i.hasOwnProperty(t))return!0;const s=i.QI;if(s&&s[t])return!0;i=Object.getPrototypeOf(i)}return!1}static CD(e){const t=[];let i=0;for(i=0;i<256;i++)t[i]=i;let s=0,n=0;for(i=0;i<256;i++)s=(s+t[i]+119)%256,n=t[i],t[i]=t[s],t[s]=n;i=0,s=0;let o="";for(let r=0;r<e.length;r++)i=(i+1)%256,s=(s+t[i])%256,n=t[i],t[i]=t[s],t[s]=n,o+=String.fromCharCode(e.charCodeAt(r)^t[(t[i]+t[s])%256]);return o}static LD(e){const t="0123456789abcdef",i=[];for(let r=0;r<256;r++)i[t.charAt(r>>4)+t.charAt(r&15)]=String.fromCharCode(r);e.length%2&&(e="0"+e);const s=[];let n=0;for(let r=0;r<e.length;r+=2)s[n++]=i[e.substring(r,r+2)];const o=s.join("");return o===""?"0":o}static Cs(e){return le.CD(le.LD(e))}};f(le,"rr",Z.navigator!==void 0&&Z.navigator.platform!==void 0&&Z.navigator.platform.match(/(iPhone|iPod|iPad|Mac)/i)!==null),f(le,"Ck",[]),f(le,"ZI",Object.freeze([])),f(le,"color1","@COLOR1"),f(le,"color2","@COLOR2"),f(le,"uw","32ab5ff3b26f42dc0ed90f21402913b5");let b=le;b.vfo="29e646fdb264";class me{constructor(){f(this,"Lk");this.Lk=[]}toString(){return this.Lk.join("")}add(e){e!==""&&this.Lk.push(e)}}class fe{}const ws=class ws{constructor(){f(this,"w");f(this,"key");f(this,"value");this.w=[]}[Symbol.iterator](){return this.w.values()}get iterator(){return this}reset(){}next(){return!1}hasNext(){return!1}first(){return null}any(){return!1}all(){return!0}each(){return this}map(e){return this}filter(){return this}get count(){return 0}gl(){}toString(){return"EmptyIterator"}};f(ws,"instance",new ws);let Ht=ws;class Xt{constructor(e){f(this,"key");f(this,"value");this.key=-1,this.value=e}[Symbol.iterator](){return[this.value].values()}get iterator(){return this}reset(){this.key=-1}next(){return this.key===-1?(this.key=0,!0):!1}hasNext(){return this.next()}first(){return this.key=0,this.value}any(e){return this.key=-1,e(this.value)}all(e){return this.key=-1,e(this.value)}each(e){return this.key=-1,e(this.value),this}map(e){return new Xt(e(this.value))}filter(e){return e(this.value)?new Xt(this.value):Ht.instance}get count(){return 1}gl(){this.value=null}toString(){return"SingletonIterator("+this.value+")"}}class li{constructor(e){f(this,"qt");f(this,"Ls");f(this,"Yt");f(this,"Dt");f(this,"key");f(this,"value");this.qt=e,this.Ls=null,e.hr=null,this.Yt=e.ht,this.Dt=-1}[Symbol.iterator](){return this.Ls===null?this.qt.r.values():this.qt.r.filter(this.Ls).values()}get iterator(){return this}get predicate(){return this.Ls}set predicate(e){this.Ls=e}reset(){const e=this.qt;e.hr=null,this.Yt=e.ht,this.Dt=-1}next(){const e=this.qt;if(e.ht!==this.Yt&&this.key<0)return!1;const t=e.r,i=t.length;let s=++this.Dt;const n=this.Ls;if(n!==null)for(;s<i;){const o=t[s];if(n(o))return this.Dt=s,this.key=s,this.value=o,!0;s++}else{if(s<i)return this.key=s,this.value=t[s],!0;this.gl()}return!1}hasNext(){return this.next()}first(){const e=this.qt;this.Yt=e.ht,this.Dt=0;const t=e.r,i=t.length,s=this.Ls;if(s!==null){let n=0;for(;n<i;){const o=t[n];if(s(o))return this.Dt=n,this.key=n,this.value=o,o;n++}return null}else if(i>0){const n=t[0];return this.key=0,this.value=n,n}else return null}any(e){const t=this.qt;t.hr=null;const i=t.ht;this.Dt=-1;const s=t.r,n=s.length,o=this.Ls;for(let r=0;r<n;r++){const a=s[r];if(!(o!==null&&!o(a))){if(e(a))return!0;t.ht!==i&&b.ve(t)}}return!1}all(e){const t=this.qt;t.hr=null;const i=t.ht;this.Dt=-1;const s=t.r,n=s.length,o=this.Ls;for(let r=0;r<n;r++){const a=s[r];if(!(o!==null&&!o(a))){if(!e(a))return!1;t.ht!==i&&b.ve(t)}}return!0}each(e){const t=this.qt;t.hr=null;const i=t.ht;this.Dt=-1;const s=t.r,n=s.length,o=this.Ls;for(let r=0;r<n;r++){const a=s[r];o!==null&&!o(a)||(e(a),t.ht!==i&&b.ve(t))}return this}map(e){const t=this.qt;t.hr=null;const i=t.ht;this.Dt=-1;const s=[],n=t.r,o=n.length,r=this.Ls;for(let h=0;h<o;h++){const l=n[h];r!==null&&!r(l)||(s.push(e(l)),t.ht!==i&&b.ve(t))}const a=new J;return a.r=s,a.Oe(),a.iterator}filter(e){const t=this.qt;t.hr=null;const i=t.ht;this.Dt=-1;const s=[],n=t.r,o=n.length,r=this.Ls;for(let h=0;h<o;h++){const l=n[h];r!==null&&!r(l)||(e(l)&&s.push(l),t.ht!==i&&b.ve(t))}const a=new J;return a.r=s,a.Oe(),a.iterator}get count(){const e=this.Ls;if(e!==null){let t=0;const i=this.qt.r,s=i.length;for(let n=0;n<s;n++)e(i[n])&&t++;return t}else return this.qt.r.length}gl(){this.key=-1,this.value=null,this.Yt=-1,this.Ls=null,this.qt.hr=this}toString(){return"ListIterator@"+this.Dt+"/"+this.qt.count}}class Fe{constructor(e){f(this,"qt");f(this,"Yt");f(this,"Dt");f(this,"key");f(this,"value");this.qt=e,e.ar=null,this.Yt=e.ht,this.Dt=e.r.length}[Symbol.iterator](){return this.qt.r.reverse().values()}get iterator(){return this}reset(){const e=this.qt;e.ar=null,this.Yt=e.ht,this.Dt=e.r.length}next(){const e=this.qt;if(e.ht!==this.Yt&&this.key<0)return!1;const t=--this.Dt;return t>=0?(this.key=t,this.value=e.r[t],!0):(this.gl(),!1)}hasNext(){return this.next()}first(){const e=this.qt;this.Yt=e.ht;const t=e.r,i=t.length-1;if(this.Dt=i,i>=0){const s=t[i];return this.key=i,this.value=s,s}else return null}any(e){const t=this.qt;t.ar=null;const i=t.ht,s=t.r,n=s.length;this.Dt=n;for(let o=n-1;o>=0;o--){const r=s[o];if(e(r))return!0;t.ht!==i&&b.ve(t)}return!1}all(e){const t=this.qt;t.ar=null;const i=t.ht,s=t.r,n=s.length;this.Dt=n;for(let o=n-1;o>=0;o--){const r=s[o];if(!e(r))return!1;t.ht!==i&&b.ve(t)}return!0}each(e){const t=this.qt;t.ar=null;const i=t.ht,s=t.r,n=s.length;this.Dt=n;for(let o=n-1;o>=0;o--){const r=s[o];e(r),t.ht!==i&&b.ve(t)}return this}map(e){const t=this.qt;t.ar=null;const i=t.ht,s=[],n=t.r,o=n.length;this.Dt=o;for(let a=o-1;a>=0;a--){const h=n[a];s.push(e(h)),t.ht!==i&&b.ve(t)}const r=new J;return r.r=s,r.Oe(),r.iterator}filter(e){const t=this.qt;t.ar=null;const i=t.ht,s=[],n=t.r,o=n.length;this.Dt=o;for(let a=o-1;a>=0;a--){const h=n[a];e(h)&&s.push(h),t.ht!==i&&b.ve(t)}const r=new J;return r.r=s,r.Oe(),r.iterator}get count(){return this.qt.r.length}gl(){this.key=-1,this.value=null,this.Yt=-1,this.qt.ar=this}toString(){return"ListIteratorBackwards("+this.Dt+"/"+this.qt.count+")"}}class J{constructor(e){f(this,"h");f(this,"r");f(this,"ht");f(this,"hr");f(this,"ar");K.Yi(this),this.h=!1,this.r=[],this.ht=0,this.hr=null,this.ar=null,e!==void 0&&this.addAll(e)}[Symbol.iterator](){return this.r.values()}Oe(){let e=this.ht;e++,e>999999999&&(e=0),this.ht=e}g(){return this.h=!0,this}ot(){return this.h=!1,this}toString(){return"List()#"+K.as(this)}add(e){return this.h&&b.T(this,e),this.r.push(e),this.Oe(),this}push(e){this.add(e)}addAll(e){if(e===null)return this;this.h&&b.T(this);const t=this.r;if(Array.isArray(e)){const i=e.length;for(let s=0;s<i;s++){const n=e[s];t.push(n)}}else{const i=e.iterator;for(;i.next();){const s=i.value;t.push(s)}}return this.Oe(),this}clear(){this.h&&b.T(this),this.r.length=0,this.Oe()}contains(e){return this.has(e)}has(e){return e===null?!1:this.r.indexOf(e)!==-1}indexOf(e){return e===null?-1:this.r.indexOf(e)}elt(e){const t=this.r;return(e<0||e>=t.length)&&b._(e,"0 <= i < length",J,"elt:i"),t[e]}get(e){return this.elt(e)}setElt(e,t){const i=this.r;(e<0||e>=i.length)&&b._(e,"0 <= i < length",J,"setElt:i"),this.h&&b.T(this,e),i[e]=t}set(e,t){this.setElt(e,t)}first(){const e=this.r;return e.length===0?null:e[0]}last(){const e=this.r,t=e.length;return t>0?e[t-1]:null}pop(){this.h&&b.T(this);const e=this.r;return e.length>0?e.pop():null}any(e){const t=this.r,i=this.ht,s=t.length;for(let n=0;n<s;n++){if(e(t[n]))return!0;this.ht!==i&&b.ve(this)}return!1}all(e){const t=this.r,i=this.ht,s=t.length;for(let n=0;n<s;n++){if(!e(t[n]))return!1;this.ht!==i&&b.ve(this)}return!0}each(e){const t=this.r,i=this.ht,s=t.length;for(let n=0;n<s;n++)e(t[n]),this.ht!==i&&b.ve(this);return this}map(e){const t=new J,i=[],s=this.r,n=this.ht,o=s.length;for(let r=0;r<o;r++)i.push(e(s[r])),this.ht!==n&&b.ve(this);return t.r=i,t.Oe(),t}filter(e){const t=new J,i=[],s=this.r,n=this.ht,o=s.length;for(let r=0;r<o;r++){const a=s[r];e(a)&&i.push(a),this.ht!==n&&b.ve(this)}return t.r=i,t.Oe(),t}insertAt(e,t){e<0&&b._(e,">= 0",J,"insertAt:i"),this.h&&b.T(this,e);const i=this.r;e>=i.length?i.push(t):i.splice(e,0,t),this.Oe()}remove(e){return this.delete(e)}delete(e){if(e===null)return!1;this.h&&b.T(this,e);const t=this.r,i=t.indexOf(e);return i===-1?!1:(i===t.length-1?t.pop():t.splice(i,1),this.Oe(),!0)}removeAt(e){const t=this.r;(e<0||e>=t.length)&&b._(e,"0 <= i < length",J,"removeAt:i"),this.h&&b.T(this,e),e===t.length-1?t.pop():t.splice(e,1),this.Oe()}removeRange(e,t){const i=this.r,s=i.length;if(e<0)e=0;else if(e>=s)return this;if(t<0)return this;if(t>=s&&(t=s-1),e>t)return this;this.h&&b.T(this);let n=e,o=t+1;for(;o<s;)i[n++]=i[o++];return i.length=s-(t-e+1),this.Oe(),this}copy(){const e=new J,t=this.r;return t.length>0&&(e.r=Array.prototype.slice.call(t)),e}toArray(){const e=this.r,t=this.count,i=new Array(t);for(let s=0;s<t;s++)i[s]=e[s];return i}get WN(){return this.r}toSet(){const e=new K,t=this.r,i=this.count;for(let s=0;s<i;s++)e.add(t[s]);return e}sort(e){return this.h&&b.T(this),this.r.sort(e),this.Oe(),this}sortRange(e,t,i){const s=this.r,n=s.length;t===void 0&&(t=0),i===void 0&&(i=n),this.h&&b.T(this);const o=i-t;if(o<=1)return this;if((t<0||t>=n-1)&&b._(t,"0 <= from < length",J,"sortRange:from"),o===2){const r=s[t],a=s[t+1];return e(r,a)>0&&(s[t]=a,s[t+1]=r,this.Oe()),this}if(t===0)if(i>=n)s.sort(e);else{const r=s.slice(0,i);r.sort(e);for(let a=0;a<i;a++)s[a]=r[a]}else if(i>=n){const r=s.slice(t);r.sort(e);for(let a=t;a<n;a++)s[a]=r[a-t]}else{const r=s.slice(t,i);r.sort(e);for(let a=t;a<i;a++)s[a]=r[a-t]}return this.Oe(),this}reverse(){return this.h&&b.T(this),this.r.reverse(),this.Oe(),this}get count(){return this.r.length}get size(){return this.r.length}get length(){return this.r.length}get iterator(){if(this.r.length<=0)return Ht.instance;const e=this.hr;return e!==null?(e.reset(),e):new li(this)}get iteratorBackwards(){if(this.r.length<=0)return Ht.instance;const e=this.ar;return e!==null?(e.reset(),e):new Fe(this)}}class zi{constructor(e){f(this,"ko");f(this,"ei");f(this,"key");f(this,"value");this.ko=e,this.ei=e.w.values()}[Symbol.iterator](){return this.ko.w.values()}get iterator(){return this}reset(){const e=this.ko;this.ei=e.w.values()}next(){const e=this.ei.next();return this.value=e.value,this.key=e.value,!e.done}hasNext(){return this.next()}first(){return this.ko.w.size===0?null:(this.ei=this.ko.w.values(),this.ei.next().value)}any(e){return this.ko.any(e)}all(e){return this.ko.all(e)}each(e){return this.ko.each(e),this}map(e){const t=new J;return this.ko.w.forEach(i=>t.add(e(i))),t.iterator}filter(e){const t=new J;return this.ko.w.forEach(i=>{e(i)&&t.add(i)}),t.iterator}get count(){return this.ko.count}gl(){this.key=null,this.value=null,this.ei=null}toString(){return"SetIterator"}}const vi=class vi{constructor(e){f(this,"h");f(this,"w");this.h=!1,this.w=new Set,e!==void 0&&this.addAll(e)}[Symbol.iterator](){return this.w.values()}values(){return this.w.values()}g(){return this.h=!0,this}ot(){return this.h=!1,this}toString(){return"Set()#"+vi.as(this)}add(e){return e===null?this:(this.w.add(e),this)}addAll(e){if(e===null)return this;if(Array.isArray(e)){const t=e.length;for(let i=0;i<t;i++){const s=e[i];s!==null&&this.w.add(s)}}else{const t=e.iterator;for(;t.next();){const i=t.value;i!==null&&this.w.add(i)}}return this}has(e){return this.w.has(e)}contains(e){return this.has(e)}containsAll(e){if(e===null)return!0;const t=e.iterator;for(;t.next();)if(!this.has(t.value))return!1;return!0}containsAny(e){if(e===null)return!0;const t=e.iterator;for(;t.next();)if(this.has(t.value))return!0;return!1}first(){return this.w.size===0?null:this.w.values().next().value}any(e){for(const t of this.w)if(e(t))return!0;return!1}all(e){for(const t of this.w)if(!e(t))return!1;return!0}each(e){for(const t of this.w)e(t);return this}map(e){const t=new vi;for(const i of this.w)t.add(e(i));return t}filter(e){const t=new vi;for(const i of this.w)e(i)&&t.add(i);return t}delete(e){return this.h&&b.T(this),this.w.delete(e)}remove(e){return this.delete(e)}removeAll(e){if(e===null)return this;if(this.h&&b.T(this),Array.isArray(e)){const t=e.length;for(let i=0;i<t;i++)this.delete(e[i])}else{const t=e.iterator;for(;t.next();)this.delete(t.value)}return this}retainAll(e){if(e===null)return this;if(this.count===0)return this;this.h&&b.T(this);const t=new vi;t.addAll(e);const i=[],s=this.iterator;for(;s.next();){const n=s.value;t.has(n)||i.push(n)}return this.removeAll(i),this}clear(){this.h&&b.T(this),this.w.clear()}copy(){const e=new vi;return this.w.forEach(t=>e.add(t)),e}toArray(){return Array.from(this.w)}toList(){const e=new J;return this.w.forEach(t=>e.add(t)),e}get count(){return this.w.size}get size(){return this.w.size}get iterator(){return this.w.size<=0?Ht.instance:new zi(this)}entries(){return this.w.entries()}keys(){return this.w.keys()}forEach(e,t){return this.w.forEach(e,t)}static Yi(e){e.__gohashid=vi.su++}static as(e){return e.__gohashid}};f(vi,"su",1);let K=vi;class ki{constructor(e){f(this,"Z");f(this,"ei");f(this,"key");f(this,"value");this.Z=e,this.ei=e.w.keys()}[Symbol.iterator](){return this.Z.w.keys()}get iterator(){return this}reset(){const e=this.Z;this.ei=e.w.keys()}next(){const e=this.ei.next();return this.value=e.value,this.key=e.value,!e.done}hasNext(){return this.next()}first(){return this.Z.w.size===0?null:(this.ei=this.Z.w.keys(),this.ei.next().value)}any(e){for(const t of this.Z.w)if(e(t[0]))return!0;return!1}all(e){for(const t of this.Z.w)if(!e(t[0]))return!1;return!0}each(e){for(const t of this.Z.w)e(t[0]);return this}map(e){const t=this.Z,i=new J;for(const s of t.w)i.add(e(s[0]));return i.iterator}filter(e){const t=this.Z,i=new J;for(const s of t.w){const n=s[0];e(n)&&i.add(n)}return i.iterator}get count(){return this.Z.size}gl(){this.key=null,this.value=null,this.ei=null}toString(){return"MapKeySetIterator"}}class mi extends K{constructor(t){super();f(this,"Z");K.Yi(this),this.h=!0,this.Z=t}[Symbol.iterator](){return this.w.keys()}values(){return this.w.keys()}g(){return this}ot(){return this}toString(){return"MapKeySet("+this.Z.toString()+")"}add(t){b.o("This Set is read-only: "+this.toString())}has(t){return this.Z.has(t)}contains(t){return this.has(t)}delete(t){b.o("This Set is read-only: "+this.toString())}remove(t){return this.delete(t)}clear(){b.o("This Set is read-only: "+this.toString())}first(){return this.Z.w.size===0?null:this.Z.w.keys().next().value}any(t){for(const i of this.Z.w)if(t(i[0]))return!0;return!1}all(t){for(const i of this.Z.w)if(!t(i[0]))return!1;return!0}each(t){for(const i of this.Z.w)t(i[0]);return this}map(t){const i=new K;for(const s of this.Z.w)i.add(t(s[0]));return i}filter(t){const i=new K;for(const s of this.Z.w){const n=s[0];t(n)&&i.add(n)}return i}copy(){return new mi(this.Z)}toSet(){const t=new K,i=this.Z.w;for(const s of i)t.add(s[0]);return t}toArray(){const t=this.Z.w,i=new Array(t.size);let s=0;for(const n of t)i[s]=n[0],s++;return i}toList(){const t=new J,i=this.Z.w;for(const s of i)t.add(s[0]);return t}get count(){return this.Z.size}get size(){return this.Z.size}get iterator(){return this.Z.size<=0?Ht.instance:new ki(this.Z)}}class Ti{constructor(e){f(this,"Z");f(this,"ei");f(this,"key");f(this,"value");this.Z=e,this.ei=e.w.values()}[Symbol.iterator](){return this.Z.w.values()}get iterator(){return this}reset(){const e=this.Z;this.ei=e.w.values()}next(){const e=this.ei.next();return this.value=e.value,this.key=e.value,!e.done}hasNext(){return this.next()}first(){return this.Z.w.size===0?null:(this.ei=this.Z.w.values(),this.ei.next().value)}any(e){for(const t of this.Z.w)if(e(t[1]))return!0;return!1}all(e){for(const t of this.Z.w)if(!e(t[1]))return!1;return!0}each(e){for(const t of this.Z.w)e(t[1]);return this}map(e){const t=this.Z,i=new J;for(const s of t.w)i.add(e(s[1]));return i.iterator}filter(e){const t=this.Z,i=new J;for(const s of t.w){const n=s[1];e(n)&&i.add(n)}return i.iterator}get count(){return this.Z.size}gl(){this.key=null,this.value=null,this.ei=null}toString(){return"MapValueSetIterator"}}class Oe{constructor(e,t){f(this,"key");f(this,"value");this.key=e,this.value=t}toString(){return"{"+this.key+":"+this.value+"}"}}class Me{constructor(e){f(this,"Z");f(this,"ei");f(this,"key");f(this,"value");this.Z=e,this.ei=e.w.entries()}[Symbol.iterator](){return this.Z.w.entries()}get iterator(){return this}reset(){const e=this.Z;this.ei=e.w.entries()}next(){const e=this.ei.next();return e.done?(this.key=null,this.value=null,!1):(this.key=e.value[0],this.value=e.value[1],!0)}hasNext(){return this.next()}first(){if(this.Z.w.size===0)return null;this.ei=this.Z.w.entries();const e=this.ei.next().value;return this.key=e[0],this.value=e[1],new Oe(e[0],e[1])}any(e){return this.Z.any(e)}all(e){return this.Z.all(e)}each(e){return this.Z.each(e),this}map(e){const t=new J;let i=null;return this.Z.w.forEach((s,n)=>{i===null?i=new Oe(n,s):(i.key=n,i.value=s),t.add(e(i))}),t.iterator}filter(e){const t=new J;let i=null;return this.Z.w.forEach((s,n)=>{i===null?i=new Oe(n,s):(i.key=n,i.value=s),e(i)&&(t.add(i),i=null)}),t.iterator}get count(){return this.Z.size}gl(){this.key=null,this.value=null,this.ei=null}toString(){return"MapIterator"}}class St{constructor(e){f(this,"h");f(this,"w");K.Yi(this),this.h=!1,this.w=new Map,e!==void 0&&this.addAll(e)}[Symbol.iterator](){return this.w.entries()}entries(){return this.w.entries()}g(){return this.h=!0,this}ot(){return this.h=!1,this}toString(){return"Map()#"+K.as(this)}set(e,t){return this.h&&b.T(this,e),this.w.set(e,t),this}add(e,t){return this.set(e,t)}addAll(e){if(e===null)return this;if(this.h&&b.T(this),Array.isArray(e)){const t=e.length;for(let i=0;i<t;i++){const s=e[i];this.set(s.key,s.value)}}else if(e instanceof St){const t=e.iterator;for(;t.next();)this.set(t.key,t.value)}else{const t=e.iterator;for(;t.next();){const i=t.value;this.set(i.key,i.value)}}return this}first(){if(this.w.size===0)return null;const e=this.w.entries().next().value;return new Oe(e[0],e[1])}any(e){let t=null;for(const[i,s]of this.w)if(t===null?t=new Oe(i,s):(t.key=i,t.value=s),e(t))return!0;return!1}all(e){let t=null;for(const[i,s]of this.w)if(t===null?t=new Oe(i,s):(t.key=i,t.value=s),!e(t))return!1;return!0}each(e){let t=null;for(const[i,s]of this.w)t===null?t=new Oe(i,s):(t.key=i,t.value=s),e(t);return this}map(e){const t=new St;let i=null;for(const[s,n]of this.w)i===null?i=new Oe(s,n):(i.key=s,i.value=n),t.set(s,e(i));return t}filter(e){const t=new St;let i=null;for(const[s,n]of this.w)i===null?i=new Oe(s,n):(i.key=s,i.value=n),e(i)&&t.set(s,n);return t}has(e){return this.w.has(e)}contains(e){return this.has(e)}get(e){const t=this.w.get(e);return t===void 0?null:t}getValue(e){return this.get(e)}delete(e){return e===null?!1:(this.h&&b.T(this,e),this.w.delete(e))}remove(e){return this.delete(e)}clear(){this.h&&b.T(this),this.w.clear()}copy(){const e=new St;return e.w=new Map(this.w),e}toArray(){const e=this.w,t=new Array(e.size);let i=0;for(const s of e)t[i]=new Oe(s[0],s[1]),i++;return t}toKeySet(){return new mi(this)}get count(){return this.w.size}get size(){return this.w.size}get iterator(){return this.w.size<=0?Ht.instance:new Me(this)}get iteratorKeys(){return this.count<=0?Ht.instance:new ki(this)}keys(){return this.w.keys()}get iteratorValues(){return this.count<=0?Ht.instance:new Ti(this)}values(){return this.w.values()}forEach(e,t){return this.w.forEach(e,t)}}const ce=class ce{constructor(e,t){f(this,"b");f(this,"k");f(this,"h");e===void 0?(this.b=0,this.k=0):typeof e=="number"&&typeof t=="number"?(this.b=e,this.k=t):b.o("Invalid arguments to Point constructor: "+e+", "+t),this.h=!1}a(e){return this.b=e.b,this.k=e.k,this}e(e,t){return this.b=e,this.k=t,this}setTo(e,t){return this.b=e,this.k=t,this}set(e){return this.b=e.b,this.k=e.k,this}copy(){const e=new ce;return e.b=this.b,e.k=this.k,e}it(){return this.h=!0,Object.freeze(this),this}N(){return this.h||Object.isFrozen(this)?this:this.copy().g()}g(){return this.h=!0,this}ot(){return Object.isFrozen(this)&&b.o("cannot thaw constant: "+this),this.h=!1,this}dw(e){}static parse(e){if(typeof e=="string"){const t=e.split(" ");let i=0,s=0;for(;t[i]==="";)i++;let n=t[i++];n&&(s=parseFloat(n));let o=0;for(;t[i]==="";)i++;return n=t[i++],n&&(o=parseFloat(n)),new ce(s,o)}else return new ce}static stringify(e){return e.x.toString()+" "+e.y.toString()}static stringifyFixed(e){return t=>t.x.toFixed(e)+" "+t.y.toFixed(e)}toString(){return"Point("+this.x+","+this.y+")"}equals(e){return e instanceof ce?this.b===e.x&&this.k===e.y:!1}equalTo(e,t){return this.b===e&&this.k===t}equalsApprox(e){return A.u(this.b,e.x)&&A.u(this.k,e.y)}add(e){return this.b+=e.x,this.k+=e.y,this}subtract(e){return this.b-=e.x,this.k-=e.y,this}offset(e,t){return this.b+=e,this.k+=t,this}rotate(e){if(e===0)return this;const t=this.b,i=this.k;if(t===0&&i===0)return this;let s=0,n=0;if(e>=360?e-=360:e<0&&(e+=360),e===90)s=0,n=1;else if(e===180)s=-1,n=0;else if(e===270)s=0,n=-1;else{const o=e*Math.PI/180;s=Math.cos(o),n=Math.sin(o)}return this.b=s*t-n*i,this.k=n*t+s*i,this}scale(e,t){return this.b*=e,this.k*=t,this}distanceSquaredPoint(e){const t=e.x-this.b,i=e.y-this.k;return t*t+i*i}distanceSquared(e,t){const i=e-this.b,s=t-this.k;return i*i+s*s}normalize(){const e=this.b,t=this.k,i=Math.sqrt(e*e+t*t);return i>0&&(this.b=e/i,this.k=t/i),this}directionPoint(e){return this.JN(e.x-this.b,e.y-this.k)}direction(e,t){return this.JN(e-this.b,t-this.k)}JN(e,t){if(e===0)return t>0?90:t<0?270:0;if(t===0)return e>0?0:180;{if(isNaN(e)||isNaN(t))return 0;let i=Math.atan(Math.abs(t/e))*180/Math.PI;return e<0?t<0?i+=180:i=180-i:t<0&&(i=360-i),i}}static compareWithLineSegment(e,t,i,s,n,o){return A.nu(e,t,i,s,n,o)}compareWithLineSegmentPoint(e,t){return A.nu(e.x,e.y,t.x,t.y,this.x,this.y)}static intersectingLineSegments(e,t,i,s,n,o,r,a){return A.ou(e,t,i,s,n,o,r,a)}projectOntoLineSegment(e,t,i,s){return A.ml(e,t,i,s,this.b,this.k,this),this}projectOntoLineSegmentPoint(e,t){return A.ml(e.x,e.y,t.x,t.y,this.b,this.k,this),this}snapToGrid(e,t,i,s){return A.Ig(this.b,this.k,e,t,i,s,this),this}snapToGridPoint(e,t){return A.Ig(this.b,this.k,e.x,e.y,t.width,t.height,this),this}setRectSpot(e,t){return this.b=e.x+t.x*e.width+t.offsetX,this.k=e.y+t.y*e.height+t.offsetY,this}setSpot(e,t,i,s,n){return this.b=e+n.x*i+n.offsetX,this.k=t+n.y*s+n.offsetY,this}D(e){return e.xt(this),this}Ie(e){return e._e(this),this}static distanceLineSegmentSquared(e,t,i,s,n,o){let r=n-i,a=o-s;const h=r*r+a*a,l=i-e,u=s-t,c=-l*r-u*a;if(c<=0||c>=h)return r=n-e,a=o-t,Math.min(l*l+u*u,r*r+a*a);{const d=r*u-a*l;return d*d/h}}static distanceSquared(e,t,i,s){const n=i-e,o=s-t;return n*n+o*o}static direction(e,t,i,s){const n=i-e,o=s-t;if(n===0)return o>0?90:o<0?270:0;if(o===0)return n>0?0:180;{if(isNaN(n)||isNaN(o))return 0;let r=Math.atan(Math.abs(o/n))*180/Math.PI;return n<0?o<0?r+=180:r=180-r:o<0&&(r=360-r),r}}get x(){return this.b}set x(e){this.b=e}get y(){return this.k}set y(e){this.k=e}isReal(){return isFinite(this.x)&&isFinite(this.y)}static l(){const e=ce.Tk.pop();return e===void 0?new ce:e}static X(e,t){const i=ce.Tk.pop();return i===void 0?new ce(e,t):(i.x=e,i.y=t,i)}static s(e){ce.Tk.push(e)}};f(ce,"Po",new ce(0,0).it()),f(ce,"$N",new ce(-1/0,-1/0).it()),f(ce,"ZN",new ce(1/0,1/0).it()),f(ce,"QN",new ce(6,6).it()),f(ce,"Ak",new ce(NaN,NaN).it()),f(ce,"Tk",[]);let S=ce;const te=class te{constructor(e,t){f(this,"j");f(this,"H");f(this,"h");e===void 0?(this.j=0,this.H=0):typeof e=="number"&&(e>=0||isNaN(e))&&typeof t=="number"&&(t>=0||isNaN(t))?(this.j=e,this.H=t):b.o("Invalid arguments to Size constructor: "+e+", "+t),this.h=!1}a(e){return this.j=e.j,this.H=e.H,this}e(e,t){return this.j=e,this.H=t,this}setTo(e,t){return this.j=e,this.H=t,this}set(e){return this.j=e.j,this.H=e.H,this}copy(){const e=new te;return e.j=this.j,e.H=this.H,e}it(){return this.h=!0,Object.freeze(this),this}N(){return this.h||Object.isFrozen(this)?this:this.copy().g()}g(){return this.h=!0,this}ot(){return Object.isFrozen(this)&&b.o("cannot thaw constant: "+this),this.h=!1,this}dw(e){}static parse(e){if(typeof e=="string"){const t=e.split(" ");let i=0,s=0;for(;t[i]==="";)i++;let n=t[i++];n&&(s=parseFloat(n));let o=0;for(;t[i]==="";)i++;return n=t[i++],n&&(o=parseFloat(n)),new te(s,o)}else return new te}static stringify(e){return e.width.toString()+" "+e.height.toString()}static stringifyFixed(e){return t=>t.width.toFixed(e)+" "+t.height.toFixed(e)}toString(){return"Size("+this.width+","+this.height+")"}equals(e){return e instanceof te?this.j===e.width&&this.H===e.height:!1}equalTo(e,t){return this.j===e&&this.H===t}equalsApprox(e){return A.u(this.j,e.width)&&A.u(this.H,e.height)}inflate(e,t){const i=this.width+e;this.j=i>=0?i:0;const s=this.height+t;return this.H=s>=0?s:0,this}get width(){return this.j}set width(e){e<0&&b._(e,">= 0",te,"width"),this.j=e}get height(){return this.H}set height(e){e<0&&b._(e,">= 0",te,"height"),this.H=e}isReal(){return isFinite(this.width)&&isFinite(this.height)}static l(){const e=te.eC.pop();return e===void 0?new te:e}static s(e){te.eC.push(e)}};f(te,"ru",new te(0,0).it()),f(te,"Dk",new te(1,1).it()),f(te,"_N",new te(6,6).it()),f(te,"lu",new te(8,8).it()),f(te,"tC",new te(10,10).it()),f(te,"iC",new te(1/0,1/0).it()),f(te,"gw",new te(NaN,NaN).it()),f(te,"eC",[]);let ut=te;const ve=class ve{constructor(e,t,i,s){f(this,"b");f(this,"k");f(this,"j");f(this,"H");f(this,"h");if(e===void 0)this.b=0,this.k=0,this.j=0,this.H=0;else if(typeof e=="number"&&typeof t=="number"&&typeof i=="number"&&(i>=0||isNaN(i))&&typeof s=="number"&&(s>=0||isNaN(s)))this.b=e,this.k=t,this.j=i,this.H=s;else if(e instanceof S){const n=e.x,o=e.y;if(t instanceof S){const r=t.x,a=t.y;this.b=Math.min(n,r),this.k=Math.min(o,a),this.j=Math.abs(n-r),this.H=Math.abs(o-a)}else t instanceof ut?(this.b=n,this.k=o,this.j=t.width,this.H=t.height):b.o("Incorrect second argument supplied to Rect constructor "+t)}else b.o("Invalid arguments to Rect constructor: "+e+", "+t+", "+i+", "+s);this.h=!1}a(e){return this.b=e.b,this.k=e.k,this.j=e.j,this.H=e.H,this}e(e,t,i,s){return this.b=e,this.k=t,this.j=i,this.H=s,this}En(e,t){return this.j=e,this.H=t,this}setTo(e,t,i,s){return this.b=e,this.k=t,this.j=i,this.H=s,this}set(e){return this.b=e.b,this.k=e.k,this.j=e.j,this.H=e.H,this}setPoint(e){return this.b=e.x,this.k=e.y,this}setSize(e){return this.j=e.width,this.H=e.height,this}copy(){const e=new ve;return e.b=this.b,e.k=this.k,e.j=this.j,e.H=this.H,e}it(){return this.h=!0,Object.freeze(this),this}N(){return this.h||Object.isFrozen(this)?this:this.copy().g()}g(){return this.h=!0,this}ot(){return Object.isFrozen(this)&&b.o("cannot thaw constant: "+this),this.h=!1,this}dw(e){}static parse(e){if(typeof e=="string"){const t=e.split(" ");let i=0,s=0;for(;t[i]==="";)i++;let n=t[i++];n&&(s=parseFloat(n));let o=0;for(;t[i]==="";)i++;n=t[i++],n&&(o=parseFloat(n));let r=0;for(;t[i]==="";)i++;n=t[i++],n&&(r=parseFloat(n));let a=0;for(;t[i]==="";)i++;return n=t[i++],n&&(a=parseFloat(n)),new ve(s,o,r,a)}else return new ve}static stringify(e){return e.x.toString()+" "+e.y.toString()+" "+e.width.toString()+" "+e.height.toString()}static stringifyFixed(e){return t=>t.x.toFixed(e)+" "+t.y.toFixed(e)+" "+t.width.toFixed(e)+" "+t.height.toFixed(e)}toString(){return"Rect("+this.x+","+this.y+","+this.width+","+this.height+")"}equals(e){return e instanceof ve?this.b===e.x&&this.k===e.y&&this.j===e.width&&this.H===e.height:!1}equalTo(e,t,i,s){return this.b===e&&this.k===t&&this.j===i&&this.H===s}equalsApprox(e){return A.u(this.b,e.x)&&A.u(this.k,e.y)&&A.u(this.j,e.width)&&A.u(this.H,e.height)}equalsApproxTo(e,t,i,s){return A.u(this.b,e)&&A.u(this.k,t)&&A.u(this.j,i)&&A.u(this.H,s)}equalsApproxClose(e){return A.K(this.b,e.x)&&A.K(this.k,e.y)&&A.K(this.j,e.width)&&A.K(this.H,e.height)}containsPoint(e){return this.b<=e.x&&this.b+this.j>=e.x&&this.k<=e.y&&this.k+this.H>=e.y}containsRect(e){return this.b<=e.x&&e.x+e.width<=this.b+this.j&&this.k<=e.y&&e.y+e.height<=this.k+this.H}contains(e,t,i,s){return i===void 0&&(i=0),s===void 0&&(s=0),this.b<=e&&e+i<=this.b+this.j&&this.k<=t&&t+s<=this.k+this.H}offset(e,t){return this.b+=e,this.k+=t,this}inflate(e,t){return this.mw(t,e,t,e)}addMargin(e){return this.mw(e.top,e.right,e.bottom,e.left)}subtractMargin(e){return this.mw(-e.top,-e.right,-e.bottom,-e.left)}grow(e,t,i,s){return this.mw(e,t,i,s)}mw(e,t,i,s){const n=this.j;t+s<=-n?(this.b+=n/2,this.j=0):(this.b-=s,this.j+=t+s);const o=this.H;return e+i<=-o?(this.k+=o/2,this.H=0):(this.k-=e,this.H+=e+i),this}intersectRect(e){return this.sC(e.x,e.y,e.width,e.height)}intersect(e,t,i,s){return this.sC(e,t,i,s)}sC(e,t,i,s){const n=Math.max(this.b,e),o=Math.max(this.k,t),r=Math.min(this.b+this.j,e+i),a=Math.min(this.k+this.H,t+s);return this.b=n,this.k=o,this.j=Math.max(0,r-n),this.H=Math.max(0,a-o),this}intersectsRect(e){return this.intersects(e.x,e.y,e.width,e.height)}intersects(e,t,i,s){let n=this.j;const o=this.b;if(n!==1/0&&i!==1/0&&(n+=o,i+=e,isNaN(i)||isNaN(n)||o>i||e>n))return!1;let r=this.H;const a=this.k;return!(r!==1/0&&s!==1/0&&(r+=a,s+=t,isNaN(s)||isNaN(r)||a>s||t>r))}intersectsRectPlus(e,t){let i=this.j,s=e.width+t+t;const n=this.b,o=e.x-t;if(i+=n,s+=o,n>s||o>i)return!1;let r=this.H,a=e.height+t+t;const h=this.k,l=e.y-t;return r+=h,a+=l,!(h>a||l>r)}unionPoint(e){return this.unionNoCheck(e.x,e.y,0,0)}unionRect(e){return this.unionNoCheck(e.b,e.k,e.j,e.H)}union(e,t,i,s){return i===void 0&&(i=0),s===void 0&&(s=0),this.unionNoCheck(e,t,i,s)}unionNoCheck(e,t,i,s){const n=Math.min(this.b,e),o=Math.min(this.k,t),r=Math.max(this.b+this.j,e+i),a=Math.max(this.k+this.H,t+s);return this.b=n,this.k=o,this.j=r-n,this.H=a-o,this}setSpot(e,t,i){return this.b=e-i.offsetX-i.x*this.j,this.k=t-i.offsetY-i.y*this.H,this}static contains(e,t,i,s,n,o,r,a){return r===void 0&&(r=0),a===void 0&&(a=0),e<=n&&n+r<=e+i&&t<=o&&o+a<=t+s}static intersects(e,t,i,s,n,o,r,a){let h=i,l=r;const u=e,c=n;if(h+=u,l+=c,u>l||c>h)return!1;let d=s,m=a;const g=t,p=o;return d+=g,m+=p,!(g>m||p>d)}static intersectsLineSegment(e,t,i,s,n,o,r,a){return A.nC(e,t,i,s,n,o,r,a)}get x(){return this.b}set x(e){this.b=e}get y(){return this.k}set y(e){this.k=e}get width(){return this.j}set width(e){e<0&&b._(e,">= 0",ve,"width"),this.j=e}get height(){return this.H}set height(e){e<0&&b._(e,">= 0",ve,"height"),this.H=e}get left(){return this.b}set left(e){this.b=e}get top(){return this.k}set top(e){this.k=e}get right(){return this.b+this.j}set right(e){this.b+=e-(this.b+this.j)}get bottom(){return this.k+this.H}set bottom(e){this.k+=e-(this.k+this.H)}get position(){return new S(this.b,this.k)}set position(e){this.b=e.x,this.k=e.y}get size(){return new ut(this.j,this.H)}set size(e){this.j=e.width,this.H=e.height}get center(){return new S(this.b+this.j/2,this.k+this.H/2)}set center(e){this.b=e.x-this.j/2,this.k=e.y-this.H/2}get centerX(){return this.b+this.j/2}set centerX(e){this.b=e-this.j/2}get centerY(){return this.k+this.H/2}set centerY(e){this.k=e-this.H/2}isReal(){return isFinite(this.x)&&isFinite(this.y)&&isFinite(this.width)&&isFinite(this.height)}isEmpty(){return this.width===0&&this.height===0}static l(){const e=ve.Fk.pop();return e===void 0?new ve:e}static X(e,t,i,s){const n=ve.Fk.pop();return n===void 0?new ve(e,t,i,s):n.e(e,t,i,s)}static s(e){ve.Fk.push(e)}};f(ve,"pw",new ve(0,0,0,0).it()),f(ve,"AD",new ve(NaN,NaN,NaN,NaN).it()),f(ve,"Fk",[]);let z=ve;const we=class we{constructor(e,t,i,s){f(this,"nn");f(this,"on");f(this,"rn");f(this,"ln");f(this,"h");e===void 0?(this.nn=0,this.on=0,this.rn=0,this.ln=0):t===void 0?(t=e,i=e,s=e,this.top=e,this.right=t,this.bottom=i,this.left=s):i===void 0?(i=e,s=t,this.top=e,this.right=t,this.bottom=i,this.left=s):s!==void 0?(this.top=e,this.right=t,this.bottom=i,this.left=s):b.o("Invalid arguments to Margin constructor: "+e+", "+t+", "+i+", "+s),this.h=!1}a(e){return this.nn=e.nn,this.on=e.on,this.rn=e.rn,this.ln=e.ln,this}setTo(e,t,i,s){return this.nn=e,this.on=t,this.rn=i,this.ln=s,this}set(e){return this.nn=e.nn,this.on=e.on,this.rn=e.rn,this.ln=e.ln,this}copy(){const e=new we;return e.nn=this.nn,e.on=this.on,e.rn=this.rn,e.ln=this.ln,e}it(){return this.h=!0,Object.freeze(this),this}N(){return this.h||Object.isFrozen(this)?this:this.copy().g()}g(){return this.h=!0,this}ot(){return Object.isFrozen(this)&&b.o("cannot thaw constant: "+this),this.h=!1,this}dw(e){}static parse(e){if(typeof e=="string"){const t=e.split(" ");let i=0,s=NaN;for(;t[i]==="";)i++;let n=t[i++];if(n&&(s=parseFloat(n)),isNaN(s))return new we;let o=NaN;for(;t[i]==="";)i++;if(n=t[i++],n&&(o=parseFloat(n)),isNaN(o))return new we(s);let r=NaN;for(;t[i]==="";)i++;if(n=t[i++],n&&(r=parseFloat(n)),isNaN(r))return new we(s,o);let a=NaN;for(;t[i]==="";)i++;return n=t[i++],n&&(a=parseFloat(n)),isNaN(a)?new we(s,o):new we(s,o,r,a)}else return new we}static stringify(e){return e.top.toString()+" "+e.right.toString()+" "+e.bottom.toString()+" "+e.left.toString()}static stringifyFixed(e){return t=>t.top.toFixed(e)+" "+t.right.toFixed(e)+" "+t.bottom.toFixed(e)+" "+t.left.toFixed(e)}toString(){return"Margin("+this.top+","+this.right+","+this.bottom+","+this.left+")"}equals(e){return e instanceof we?this.nn===e.top&&this.on===e.right&&this.rn===e.bottom&&this.ln===e.left:!1}equalTo(e,t,i,s){return this.nn===e&&this.on===t&&this.rn===i&&this.ln===s}equalsApprox(e){return A.u(this.nn,e.top)&&A.u(this.on,e.right)&&A.u(this.rn,e.bottom)&&A.u(this.ln,e.left)}get top(){return this.nn}set top(e){this.nn=e}get right(){return this.on}set right(e){this.on=e}get bottom(){return this.rn}set bottom(e){this.rn=e}get left(){return this.ln}set left(e){this.ln=e}isReal(){return isFinite(this.top)&&isFinite(this.right)&&isFinite(this.bottom)&&isFinite(this.left)}static l(){const e=we.rC.pop();return e===void 0?new we:e}static s(e){we.rC.push(e)}};f(we,"Eg",new we(0,0,0,0).it()),f(we,"oC",new we(2,2,2,2).it()),f(we,"rC",[]);let Kt=we;const U=class U{constructor(e,t,i,s){f(this,"b");f(this,"k");f(this,"As");f(this,"Ts");f(this,"h");e===void 0?(this.b=0,this.k=0,this.As=0,this.Ts=0):(t===void 0&&(t=0),i===void 0&&(i=0),s===void 0&&(s=0),this.x=e,this.y=t,this.offsetX=i,this.offsetY=s),this.h=!1}a(e){return this.b=e.b,this.k=e.k,this.As=e.As,this.Ts=e.Ts,this}setTo(e,t,i,s){return this.b=e,this.k=t,this.As=i,this.Ts=s,this}set(e){return this.b=e.b,this.k=e.k,this.As=e.As,this.Ts=e.Ts,this}copy(){const e=new U;return e.b=this.b,e.k=this.k,e.As=this.As,e.Ts=this.Ts,e}it(){return this.h=!0,Object.freeze(this),this}N(){return this.h||Object.isFrozen(this)?this:this.copy().g()}g(){return this.h=!0,this}ot(){return Object.isFrozen(this)&&b.o("cannot thaw constant: "+this),this.h=!1,this}dw(e){}Ee(e){return this.b=NaN,this.k=NaN,this.As=e,this}_I(e,t){(isNaN(e)||e>1||e<0)&&b._(e,"0 <= "+t+" <= 1",U,t)}tE(e,t){(isNaN(e)||e===1/0||e===-1/0)&&b._(e,"real number, not NaN or Infinity",U,t)}static parse(e){if(typeof e=="string"){if(e=e.trim(),e==="None")return U.None;if(e==="TopLeft")return U.TopLeft;if(e==="Top"||e==="TopCenter"||e==="MiddleTop")return U.TopCenter;if(e==="TopRight")return U.TopRight;if(e==="Left"||e==="LeftCenter"||e==="MiddleLeft")return U.LeftCenter;if(e==="Center")return U.Center;if(e==="Right"||e==="RightCenter"||e==="MiddleRight")return U.RightCenter;if(e==="BottomLeft")return U.BottomLeft;if(e==="Bottom"||e==="BottomCenter"||e==="MiddleBottom")return U.BottomCenter;if(e==="BottomRight")return U.BottomRight;if(e==="TopSide")return U.TopSide;if(e==="LeftSide")return U.LeftSide;if(e==="RightSide")return U.RightSide;if(e==="BottomSide")return U.BottomSide;if(e==="TopBottomSides")return U.TopBottomSides;if(e==="LeftRightSides")return U.LeftRightSides;if(e==="TopLeftSides")return U.TopLeftSides;if(e==="TopRightSides")return U.TopRightSides;if(e==="BottomLeftSides")return U.BottomLeftSides;if(e==="BottomRightSides")return U.BottomRightSides;if(e==="NotTopSide")return U.NotTopSide;if(e==="NotLeftSide")return U.NotLeftSide;if(e==="NotRightSide")return U.NotRightSide;if(e==="NotBottomSide")return U.NotBottomSide;if(e==="AllSides")return U.AllSides;if(e==="Default")return U.Default;const t=e.split(" ");let i=0,s=0;for(;t[i]==="";)i++;let n=t[i++];n!==void 0&&n.length>0&&(s=parseFloat(n));let o=0;for(;t[i]==="";)i++;n=t[i++],n!==void 0&&n.length>0&&(o=parseFloat(n));let r=0;for(;t[i]==="";)i++;n=t[i++],n!==void 0&&n.length>0&&(r=parseFloat(n));let a=0;for(;t[i]==="";)i++;return n=t[i++],n!==void 0&&n.length>0&&(a=parseFloat(n)),new U(s,o,r,a)}else return new U}static stringify(e){return e.isSpot()?e.x.toString()+" "+e.y.toString()+" "+e.offsetX.toString()+" "+e.offsetY.toString():e.toString()}static stringifyFixed(e){return t=>t.x.toFixed(e)+" "+t.y.toFixed(e)+" "+t.offsetX.toFixed(e)+" "+t.offsetY.toFixed(e)}toString(){return this.isSpot()?this.As===0&&this.Ts===0?"Spot("+this.x+","+this.y+")":"Spot("+this.x+","+this.y+","+this.offsetX+","+this.offsetY+")":this.equals(U.None)?"None":this.equals(U.TopLeft)?"TopLeft":this.equals(U.TopCenter)?"Top":this.equals(U.TopRight)?"TopRight":this.equals(U.LeftCenter)?"Left":this.equals(U.Center)?"Center":this.equals(U.RightCenter)?"Right":this.equals(U.BottomLeft)?"BottomLeft":this.equals(U.BottomCenter)?"Bottom":this.equals(U.BottomRight)?"BottomRight":this.equals(U.TopSide)?"TopSide":this.equals(U.LeftSide)?"LeftSide":this.equals(U.RightSide)?"RightSide":this.equals(U.BottomSide)?"BottomSide":this.equals(U.TopBottomSides)?"TopBottomSides":this.equals(U.LeftRightSides)?"LeftRightSides":this.equals(U.TopLeftSides)?"TopLeftSides":this.equals(U.TopRightSides)?"TopRightSides":this.equals(U.BottomLeftSides)?"BottomLeftSides":this.equals(U.BottomRightSides)?"BottomRightSides":this.equals(U.NotTopSide)?"NotTopSide":this.equals(U.NotLeftSide)?"NotLeftSide":this.equals(U.NotRightSide)?"NotRightSide":this.equals(U.NotBottomSide)?"NotBottomSide":this.equals(U.AllSides)?"AllSides":this.equals(U.Default)?"Default":"None"}equals(e){return e instanceof U?(this.b===e.x||isNaN(this.b)&&isNaN(e.x))&&(this.k===e.y||isNaN(this.k)&&isNaN(e.y))&&this.As===e.offsetX&&this.Ts===e.offsetY:!1}opposite(){return new U(.5-(this.b-.5),.5-(this.k-.5),-this.As,-this.Ts)}includesSide(e){if(!this.isSide())return!1;if(!e.isSide())if(e.equals(U.Left))e=U.LeftSide;else if(e.equals(U.Right))e=U.RightSide;else if(e.equals(U.Top))e=U.TopSide;else if(e.equals(U.Bottom))e=U.BottomSide;else return!1;const t=this.Ts,i=e.offsetY;return(t&i)===i}get x(){return this.b}set x(e){this.b=e}get y(){return this.k}set y(e){this.k=e}get offsetX(){return this.As}set offsetX(e){this.As=e}get offsetY(){return this.Ts}set offsetY(e){this.Ts=e}isSpot(){return!isNaN(this.x)&&!isNaN(this.y)}isNoSpot(){return isNaN(this.x)||isNaN(this.y)}isSide(){return isNaN(this.x)&&isNaN(this.y)&&this.offsetX===1&&this.offsetY!==0}isNone(){return isNaN(this.x)&&isNaN(this.y)&&this.offsetX===0&&this.offsetY===0}isDefault(){return isNaN(this.x)&&isNaN(this.y)&&this.offsetX===-1&&this.offsetY===0}static l(){const e=U.lC.pop();return e===void 0?new U:e}static s(e){U.lC.push(e)}};f(U,"None",new U(0,0,0,0).Ee(0).it()),f(U,"Default",new U(0,0,-1,0).Ee(-1).it()),f(U,"TopLeft",new U(0,0,0,0).it()),f(U,"TopCenter",new U(.5,0,0,0).it()),f(U,"TopRight",new U(1,0,0,0).it()),f(U,"LeftCenter",new U(0,.5,0,0).it()),f(U,"Center",new U(.5,.5,0,0).it()),f(U,"RightCenter",new U(1,.5,0,0).it()),f(U,"BottomLeft",new U(0,1,0,0).it()),f(U,"BottomCenter",new U(.5,1,0,0).it()),f(U,"BottomRight",new U(1,1,0,0).it()),f(U,"MiddleTop",U.TopCenter),f(U,"MiddleLeft",U.LeftCenter),f(U,"MiddleRight",U.RightCenter),f(U,"MiddleBottom",U.BottomCenter),f(U,"Top",U.TopCenter),f(U,"Left",U.LeftCenter),f(U,"Right",U.RightCenter),f(U,"Bottom",U.BottomCenter),f(U,"TopSide",new U(0,0,1,1).Ee(1).it()),f(U,"LeftSide",new U(0,0,1,2).Ee(1).it()),f(U,"RightSide",new U(0,0,1,4).Ee(1).it()),f(U,"BottomSide",new U(0,0,1,8).Ee(1).it()),f(U,"TopBottomSides",new U(0,0,1,9).Ee(1).it()),f(U,"LeftRightSides",new U(0,0,1,6).Ee(1).it()),f(U,"TopLeftSides",new U(0,0,1,3).Ee(1).it()),f(U,"TopRightSides",new U(0,0,1,5).Ee(1).it()),f(U,"BottomLeftSides",new U(0,0,1,10).Ee(1).it()),f(U,"BottomRightSides",new U(0,0,1,12).Ee(1).it()),f(U,"NotTopSide",new U(0,0,1,14).Ee(1).it()),f(U,"NotLeftSide",new U(0,0,1,13).Ee(1).it()),f(U,"NotRightSide",new U(0,0,1,11).Ee(1).it()),f(U,"NotBottomSide",new U(0,0,1,7).Ee(1).it()),f(U,"AllSides",new U(0,0,1,15).Ee(1).it()),f(U,"Rk",new U(.156,.156).it()),f(U,"vk",new U(.844,.844).it()),f(U,"lC",[]);let B=U;const Ci=class Ci{constructor(){f(this,"m11");f(this,"m12");f(this,"m21");f(this,"m22");f(this,"dx");f(this,"dy");this.m11=1,this.m12=0,this.m21=0,this.m22=1,this.dx=0,this.dy=0}set(e){return this.m11=e.m11,this.m12=e.m12,this.m21=e.m21,this.m22=e.m22,this.dx=e.dx,this.dy=e.dy,this}setTo(e,t,i,s,n,o){return this.m11=e,this.m12=t,this.m21=i,this.m22=s,this.dx=n,this.dy=o,this}copy(){const e=new Ci;return e.m11=this.m11,e.m12=this.m12,e.m21=this.m21,e.m22=this.m22,e.dx=this.dx,e.dy=this.dy,e}toString(){return"Transform("+this.m11+","+this.m12+","+this.m21+","+this.m22+","+this.dx+","+this.dy+")"}equals(e){return this.m11===e.m11&&this.m12===e.m12&&this.m21===e.m21&&this.m22===e.m22&&this.dx===e.dx&&this.dy===e.dy}Ok(){return this.dx===0&&this.dy===0&&this.m11===1&&this.m12===0&&this.m21===0&&this.m22===1}Ri(){return this.m11=1,this.m12=0,this.m21=0,this.m22=1,this.dx=0,this.dy=0,this}ic(e){const t=this.m11*e.m11+this.m21*e.m12,i=this.m12*e.m11+this.m22*e.m12,s=this.m11*e.m21+this.m21*e.m22,n=this.m12*e.m21+this.m22*e.m22;return this.dx=this.m11*e.dx+this.m21*e.dy+this.dx,this.dy=this.m12*e.dx+this.m22*e.dy+this.dy,this.m11=t,this.m12=i,this.m21=s,this.m22=n,this}hC(e){const t=1/(e.m11*e.m22-e.m12*e.m21),i=e.m22*t,s=-e.m12*t,n=-e.m21*t,o=e.m11*t,r=t*(e.m21*e.dy-e.m22*e.dx),a=t*(e.m12*e.dx-e.m11*e.dy),h=this.m11*i+this.m21*s,l=this.m12*i+this.m22*s,u=this.m11*n+this.m21*o,c=this.m12*n+this.m22*o;return this.dx=this.m11*r+this.m21*a+this.dx,this.dy=this.m12*r+this.m22*a+this.dy,this.m11=h,this.m12=l,this.m21=u,this.m22=c,this}yw(){const e=1/(this.m11*this.m22-this.m12*this.m21),t=this.m22*e,i=-this.m12*e,s=-this.m21*e,n=this.m11*e,o=e*(this.m21*this.dy-this.m22*this.dx),r=e*(this.m12*this.dx-this.m11*this.dy);return this.m11=t,this.m12=i,this.m21=s,this.m22=n,this.dx=o,this.dy=r,this}cs(e,t,i){if(e>=360?e-=360:e<0&&(e+=360),e===0)return this;this.Ds(t,i);let s=0,n=0;if(e===90)s=0,n=1;else if(e===180)s=-1,n=0;else if(e===270)s=0,n=-1;else{const l=e*Math.PI/180;s=Math.cos(l),n=Math.sin(l)}const o=this.m11*s+this.m21*n,r=this.m12*s+this.m22*n,a=this.m11*-n+this.m21*s,h=this.m12*-n+this.m22*s;return this.m11=o,this.m12=r,this.m21=a,this.m22=h,this.Ds(-t,-i),this}Ds(e,t){return this.dx+=this.m11*e+this.m21*t,this.dy+=this.m12*e+this.m22*t,this}et(e,t){return t===void 0&&(t=e),this.m11*=e,this.m12*=e,this.m21*=t,this.m22*=t,this}TD(){if(this.m11===1&&this.m12===0)return 0;let e=Math.atan2(this.m12,this.m11)*180/Math.PI;return e<0&&(e+=360),e}xt(e){const t=e.x,i=e.y;return e.e(t*this.m11+i*this.m21+this.dx,t*this.m12+i*this.m22+this.dy)}_e(e){const t=1/(this.m11*this.m22-this.m12*this.m21),i=this.m22*t,s=-this.m12*t,n=-this.m21*t,o=this.m11*t,r=e.x-this.dx,a=e.y-this.dy;return e.e(r*i+a*n,r*s+a*o)}ww(e){const t=1/(this.m11*this.m22-this.m12*this.m21),i=this.m22*t,s=-this.m12*t,n=-this.m21*t,o=this.m11*t,r=t*(this.m21*this.dy-this.m22*this.dx),a=t*(this.m12*this.dx-this.m11*this.dy),h=e.x*1.25,l=e.y*1.2;return e.e(h*i+l*n+r,h*s+l*o+a)}xw(e){const t=e.x,i=e.y,s=t+e.width,n=i+e.height,o=this.m11,r=this.m12,a=this.m21,h=this.m22,l=this.dx,u=this.dy,c=t*o+i*a+l,d=t*r+i*h+u,m=s*o+i*a+l,g=s*r+i*h+u,p=t*o+n*a+l,y=t*r+n*h+u,x=s*o+n*a+l,P=s*r+n*h+u;let k=c,w=c,N=d,M=d;return k=Math.min(k,m),w=Math.max(w,m),N=Math.min(N,g),M=Math.max(M,g),k=Math.min(k,p),w=Math.max(w,p),N=Math.min(N,y),M=Math.max(M,y),k=Math.min(k,x),w=Math.max(w,x),N=Math.min(N,P),M=Math.max(M,P),e.e(k,N,w-k,M-N),e}static l(){const e=Ci.aC.pop();return e===void 0?new Ci:e}static s(e){Ci.aC.push(e)}};f(Ci,"aC",[]),f(Ci,"Ik","54a702f3e53909c447824c6706603faf4c");let Tt=Ci;const A={DD:"7da71ca0ad381e90",Bn:4*((Math.sqrt(2)-1)/3),cC:null,bw:v=>{if(v<=0)return 0;let e=A.cC;if(e===null){e=[];for(let t=0;t<=2e3;t++)e[t]=Math.sqrt(t);A.cC=e}if(v<1){const t=1/v;return t<=2e3?1/e[t|0]:Math.sqrt(v)}else return v<=2e3?e[v|0]:Math.sqrt(v)},u:(v,e)=>{const t=v-e;return t<.5&&t>-.5},K:(v,e)=>{const t=v-e;return t<5e-8&&t>-5e-8},vi:(v,e,t,i,s,n,o)=>{s<=0&&(s=1e-6);let r=0,a=0,h=0,l=0;if(v<t?(a=v,r=t):(a=t,r=v),e<i?(l=e,h=i):(l=i,h=e),v===t)return l<=o&&o<=h&&v-s<=n&&n<=v+s;if(e===i)return a<=n&&n<=r&&e-s<=o&&o<=e+s;const u=r+s,c=a-s;if(c<=n&&n<=u){const d=h+s,m=l-s;if(m<=o&&o<=d)if(u-c>d-m)if(v-t>s||t-v>s){const g=(i-e)/(t-v)*(n-v)+e;if(g-s<=o&&o<=g+s)return!0}else return!0;else if(e-i>s||i-e>s){const g=(t-v)/(i-e)*(o-e)+v;if(g-s<=n&&n<=g+s)return!0}else return!0}return!1},kw:(v,e,t,i,s,n,o,r,a,h,l,u)=>{if(!A.vi(v,e,o,r,u,t,i)||!A.vi(v,e,o,r,u,s,n)){const c=(v+t)/2,d=(e+i)/2,m=(t+s)/2,g=(i+n)/2,p=(s+o)/2,y=(n+r)/2,x=(c+m)/2,P=(d+g)/2,k=(m+p)/2,w=(g+y)/2,N=(x+k)/2,M=(P+w)/2;return A.kw(v,e,c,d,x,P,N,M,a,h,l,u)||A.kw(N,M,k,w,p,y,o,r,a,h,l,u)}else return A.vi(v,e,o,r,u,h,l)},fC:(v,e,t,i,s,n,o,r,a)=>{const h=(v+t)/2,l=(e+i)/2,u=(t+s)/2,c=(i+n)/2,d=(s+o)/2,m=(n+r)/2,g=(h+u)/2,p=(l+c)/2,y=(u+d)/2,x=(c+m)/2;return a.e((g+y)/2,(p+x)/2),a},FD:(v,e,t,i,s,n,o,r)=>{const a=(v+t)/2,h=(e+i)/2,l=(t+s)/2,u=(i+n)/2,c=(s+o)/2,d=(n+r)/2,m=(a+l)/2,g=(h+u)/2,p=(l+c)/2,y=(u+d)/2;return S.direction(m,g,p,y)},hu:(v,e,t,i,s,n,o,r,a,h)=>{if(!A.vi(v,e,o,r,a,t,i)||!A.vi(v,e,o,r,a,s,n)){const l=(v+t)/2,u=(e+i)/2,c=(t+s)/2,d=(i+n)/2,m=(s+o)/2,g=(n+r)/2,p=(l+c)/2,y=(u+d)/2,x=(c+m)/2,P=(d+g)/2,k=(p+x)/2,w=(y+P)/2;A.hu(v,e,l,u,p,y,k,w,a,h),A.hu(k,w,x,P,m,g,o,r,a,h)}else h.unionNoCheck(v,e,0,0),h.unionNoCheck(o,r,0,0);return h},Un:(v,e,t,i,s,n,o,r,a,h)=>{if(!A.vi(v,e,o,r,a,t,i)||!A.vi(v,e,o,r,a,s,n)){const l=(v+t)/2,u=(e+i)/2,c=(t+s)/2,d=(i+n)/2,m=(s+o)/2,g=(n+r)/2,p=(l+c)/2,y=(u+d)/2,x=(c+m)/2,P=(d+g)/2,k=(p+x)/2,w=(y+P)/2;A.Un(v,e,l,u,p,y,k,w,a,h),A.Un(k,w,x,P,m,g,o,r,a,h)}else h.length===0&&(h.push(v),h.push(e)),h.push(o),h.push(r);return h},Ek:(v,e,t,i,s,n,o,r,a,h)=>{if(A.vi(v,e,s,n,h,t,i))return A.vi(v,e,s,n,h,r,a);{const l=(v+t)/2,u=(e+i)/2,c=(t+s)/2,d=(i+n)/2,m=(l+c)/2,g=(u+d)/2;return A.Ek(v,e,l,u,m,g,o,r,a,h)||A.Ek(m,g,c,d,s,n,o,r,a,h)}},iE:(v,e,t,i,s,n,o)=>{const r=(v+t)/2,a=(e+i)/2,h=(t+s)/2,l=(i+n)/2;return o.e((r+h)/2,(a+l)/2),o},Bk:(v,e,t,i,s,n,o,r)=>{if(A.vi(v,e,s,n,o,t,i))r.unionNoCheck(v,e,0,0),r.unionNoCheck(s,n,0,0);else{const a=(v+t)/2,h=(e+i)/2,l=(t+s)/2,u=(i+n)/2,c=(a+l)/2,d=(h+u)/2;A.Bk(v,e,a,h,c,d,o,r),A.Bk(c,d,l,u,s,n,o,r)}return r},Bg:(v,e,t,i,s,n,o,r)=>{if(A.vi(v,e,s,n,o,t,i))r.length===0&&(r.push(v),r.push(e)),r.push(s),r.push(n);else{const a=(v+t)/2,h=(e+i)/2,l=(t+s)/2,u=(i+n)/2,c=(a+l)/2,d=(h+u)/2;A.Bg(v,e,a,h,c,d,o,r),A.Bg(c,d,l,u,s,n,o,r)}return r},Ug:(v,e,t,i,s,n,o,r,a,h,l,u,c,d)=>{if(!A.vi(v,e,o,r,c,t,i)||!A.vi(v,e,o,r,c,s,n)){const m=(v+t)/2,g=(e+i)/2,p=(t+s)/2,y=(i+n)/2,x=(s+o)/2,P=(n+r)/2,k=(m+p)/2,w=(g+y)/2,N=(p+x)/2,M=(y+P)/2,C=(k+N)/2,O=(w+M)/2;let T=1/0,L=!1,F=0,D=0;if(A.Ug(v,e,m,g,k,w,C,O,a,h,l,u,c,d)){const R=(d.x-a)*(d.x-a)+(d.y-h)*(d.y-h);R<T&&(T=R,L=!0,F=d.x,D=d.y)}if(A.Ug(C,O,N,M,x,P,o,r,a,h,l,u,c,d)){const R=(d.x-a)*(d.x-a)+(d.y-h)*(d.y-h);R<T&&(T=R,L=!0,F=d.x,D=d.y)}return L&&(d.x=F,d.y=D),L}else{if(!A.ou(v,e,o,r,a,h,l,u))return!1;const m=(v-o)*(h-u)-(e-r)*(a-l);if(m===0)return!1;const g=((v*r-e*o)*(a-l)-(v-o)*(a*u-h*l))/m,p=((v*r-e*o)*(h-u)-(e-r)*(a*u-h*l))/m;return d.e(g,p),!0}},Vg:(v,e,t,i,s,n,o,r,a,h,l,u,c)=>{let d=0;if(!A.vi(v,e,o,r,c,t,i)||!A.vi(v,e,o,r,c,s,n)){const m=(v+t)/2,g=(e+i)/2,p=(t+s)/2,y=(i+n)/2,x=(s+o)/2,P=(n+r)/2,k=(m+p)/2,w=(g+y)/2,N=(p+x)/2,M=(y+P)/2,C=(k+N)/2,O=(w+M)/2;d+=A.Vg(v,e,m,g,k,w,C,O,a,h,l,u,c),d+=A.Vg(C,O,N,M,x,P,o,r,a,h,l,u,c)}else{const m=(v-o)*(h-u)-(e-r)*(a-l);if(m===0)return d;const g=((v*r-e*o)*(a-l)-(v-o)*(a*u-h*l))/m,p=((v*r-e*o)*(h-u)-(e-r)*(a*u-h*l))/m;if(g>=l)return d;let y=0,x=0;if((a>l?a-l:l-a)<(h>u?h-u:u-h)){if(e<r?(y=e,x=r):(y=r,x=e),p<y||p>x)return d}else if(v<o?(y=v,x=o):(y=o,x=v),g<y||g>x)return d;m>0?d++:m<0&&d--}return d},ml:(v,e,t,i,s,n,o)=>{if(A.K(v,t)){let r=0,a=0;e<i?(r=e,a=i):(r=i,a=e);const h=n;return h<r?(o.e(v,r),!1):h>a?(o.e(v,a),!1):(o.e(v,h),!0)}else if(A.K(e,i)){let r=0,a=0;v<t?(r=v,a=t):(r=t,a=v);const h=s;return h<r?(o.e(r,e),!1):h>a?(o.e(a,e),!1):(o.e(h,e),!0)}else{const r=(t-v)*(t-v)+(i-e)*(i-e),a=((v-s)*(v-t)+(e-n)*(e-i))/r;if(a<-5e-6)return o.e(v,e),!1;if(a>1.000005)return o.e(t,i),!1;{const h=v+a*(t-v),l=e+a*(i-e);return o.e(h,l),!0}}},Vn:(v,e,t,i,s,n,o,r,a)=>{if(A.u(v,t)&&A.u(e,i))return a.e(v,e),!1;if(A.K(s,o)){if(A.K(v,t))return A.ml(v,e,t,i,s,n,a),!1;{const h=(i-e)/(t-v)*(s-v)+e;return A.ml(v,e,t,i,s,h,a)}}else{const h=(r-n)/(o-s);if(A.K(v,t)){const l=h*(v-s)+n;let u=0,c=0;return e<i?(u=e,c=i):(u=i,c=e),l<u?(a.e(v,u),!1):l>c?(a.e(v,c),!1):(a.e(v,l),!0)}else{const l=(i-e)/(t-v);if(A.K(h,l))return A.ml(v,e,t,i,s,n,a),!1;{const u=(l*v-h*s+n-e)/(l-h);if(A.K(l,0)){let c=0,d=0;return v<t?(c=v,d=t):(c=t,d=v),u<c?(a.e(c,e),!1):u>d?(a.e(d,e),!1):(a.e(u,e),!0)}else{const c=l*(u-v)+e;return A.ml(v,e,t,i,u,c,a)}}}}},eE:(v,e,t,i,s)=>A.Vn(t.x,t.y,i.x,i.y,v.x,v.y,e.x,e.y,s),sE:(v,e,t,i,s,n,o,r,a,h)=>{let l=1/0;function u(N,M){const C=(N-v)*(N-v)+(M-e)*(M-e);C<l&&(l=C,a.e(N,M))}u(a.x,a.y);let c=0,d=0,m=0,g=0;s<o?(c=s,d=o):(c=o,d=s),n<r?(m=s,g=o):(m=o,g=s);const p=d-c,y=g-m,x=p/2+h,P=y/2+h,k=(s+o)/2,w=(n+r)/2;if(x===0||P===0)return a;if((t>v?t-v:v-t)<.5){const N=1-(t-k)*(t-k)/(x*x);if(N<0)return a;const M=Math.sqrt(N),C=P*M+w,O=-P*M+w;u(t,C),u(t,O)}else{const N=(i-e)/(t-v),M=1/(x*x)+N*N/(P*P),C=2*N*(e-N*v)/(P*P)-2*N*w/(P*P)-2*k/(x*x),O=2*N*v*w/(P*P)-2*e*w/(P*P)+w*w/(P*P)+k*k/(x*x)-1+(e-N*v)*(e-N*v)/(P*P),T=C*C-4*M*O;if(T<0)return a;const L=Math.sqrt(T),F=(-C+L)/(2*M);u(F,N*F-N*v+e);const D=(-C-L)/(2*M);u(D,N*D-N*v+e)}return a},pl:(v,e,t,i,s,n,o,r,a)=>{let h=1e21,l=v,u=e;if(A.Vn(v,e,v,i,s,n,o,r,a)){const c=(a.x-s)*(a.x-s)+(a.y-n)*(a.y-n);c<h&&(h=c,l=a.x,u=a.y)}if(A.Vn(t,e,t,i,s,n,o,r,a)){const c=(a.x-s)*(a.x-s)+(a.y-n)*(a.y-n);c<h&&(h=c,l=a.x,u=a.y)}if(A.Vn(v,e,t,e,s,n,o,r,a)){const c=(a.x-s)*(a.x-s)+(a.y-n)*(a.y-n);c<h&&(h=c,l=a.x,u=a.y)}if(A.Vn(v,i,t,i,s,n,o,r,a)){const c=(a.x-s)*(a.x-s)+(a.y-n)*(a.y-n);c<h&&(h=c,l=a.x,u=a.y)}return a.e(l,u),h<1e21},Pw:(v,e,t)=>A.nC(v.x,v.y,v.width,v.height,e.x,e.y,t.x,t.y),nC:(v,e,t,i,s,n,o,r)=>{const a=v,h=v+t,l=e,u=e+i;if(s===o){let c=0,d=0;return n<r?(c=n,d=r):(c=r,d=n),a<=s&&s<=h&&c<=u&&d>=l}if(n===r){let c=0,d=0;return s<o?(c=s,d=o):(c=o,d=s),l<=n&&n<=u&&c<=h&&d>=a}return!!(z.contains(v,e,t,i,s,n)||z.contains(v,e,t,i,o,r)||A.ou(a,l,h,l,s,n,o,r)||A.ou(h,l,h,u,s,n,o,r)||A.ou(h,u,a,u,s,n,o,r)||A.ou(a,u,a,l,s,n,o,r))},ou:(v,e,t,i,s,n,o,r)=>v===t&&e===i&&s===o&&n===r?v===s&&e===n:A.nu(v,e,t,i,s,n)*A.nu(v,e,t,i,o,r)<=0&&A.nu(s,n,o,r,v,e)*A.nu(s,n,o,r,t,i)<=0,nu:(v,e,t,i,s,n)=>{const o=t-v,r=i-e;let a=s-v,h=n-e,l=a*r-h*o;return l===0&&(l=a*o+h*r,l>0&&(a-=o,h-=r,l=a*o+h*r,l<0&&(l=0))),l},zg:v=>(v<0&&(v+=360),v>=360&&(v-=360),v),uC:(v,e,t,i,s,n)=>{const o=Math.PI;n||(i=i*(o/180),s=s*(o/180));const r=i>s?-1:1,a=1e-5,h=o*2,l=[],u=o/2;let c=i,d=Math.min(h,Math.abs(s-i));if(d<a){const m=c+r*Math.min(d,u),g=v+t*Math.cos(c),p=e+t*Math.sin(c),y=v+t*Math.cos(m),x=e+t*Math.sin(m),P=(g+y)/2,k=(p+x)/2;return l.push([g,p,P,k,P,k,y,x]),l}for(;d>a;){const m=c+r*Math.min(d,u);l.push(A.RD(t,c,m,v,e)),d-=Math.abs(m-c),c=m}return l},RD:(v,e,t,i,s)=>{const n=(t-e)/2,o=v*Math.cos(n),r=v*Math.sin(n),a=o,h=-r,l=a*a+h*h,u=l+a*o+h*r,c=4/3*(Math.sqrt(2*l*u)-u)/(a*r-h*o),d=a-c*h,m=h+c*a,g=d,p=-m,y=n+e,x=Math.cos(y),P=Math.sin(y);return[i+v*Math.cos(e),s+v*Math.sin(e),i+d*x-m*P,s+d*P+m*x,i+g*x-p*P,s+g*P+p*x,i+v*Math.cos(t),s+v*Math.sin(t)]},Ig:(v,e,t,i,s,n,o)=>{const r=s,a=n,h=Math.floor((v-t)/r)*r+t,l=Math.floor((e-i)/a)*a+i;let u=h;h+r-v<r/2&&(u=h+r);let c=l;return l+a-e<a/2&&(c=l+a),o.e(u,c),o},dC:(v,e)=>{let t=Math.max(v,e),i=Math.min(v,e),s=1,n=1;do s=t%i,n=i,t=i,i=s;while(s>0);return n},vD:(v,e,t,i)=>{const s=t<0,n=i<0;let o=0,r=0,a=0;v<e?(r=1,a=0):(r=0,a=1);let h=0,l=0,u=0,c=0;return o=r,h=o===0?v:e,u=o===0?t:i,(o===0?s:n)&&(u=-u),o=a,l=o===0?v:e,c=o===0?t:i,(o===0?s:n)&&(c=-c),A.OD(h,l,u,c,0,0)},OD:(v,e,t,i,s,n)=>{let o=0;if(i>0)if(t>0){const r=v*v,a=e*e,h=v*t,l=e*i;let u=-a+l,c=-a+Math.sqrt(h*h+l*l),d=u;const m=9999999999;for(let y=0;y<m&&(d=.5*(u+c),!(d===u||d===c));++y){const x=h/(d+r),P=l/(d+a),k=x*x+P*P-1;if(k>0)u=d;else if(k<0)c=d;else break}s=r*t/(d+r),n=a*i/(d+a);const g=s-t,p=n-i;o=Math.sqrt(g*g+p*p)}else s=0,n=e,o=Math.abs(i-e);else{const r=v*v-e*e,a=v*t;if(a<r){const h=a/r,l=h*h;s=v*h,n=e*Math.sqrt(Math.abs(1-l));const u=s-t;o=Math.sqrt(u*u+n*n)}else s=v,n=0,o=Math.abs(t-v)}return o},So:new fe,Xg:new fe,cr:new fe,fr:0,Kg:100};A.za=A.DD;var pi=(v=>(v[v.Line=1]="Line",v[v.Rectangle=2]="Rectangle",v[v.Ellipse=3]="Ellipse",v[v.Path=4]="Path",v))(pi||{}),ji=(v=>(v[v.None=0]="None",v[v.Default=1]="Default",v[v.Fill=2]="Fill",v[v.Uniform=6]="Uniform",v))(ji||{});const ye=class ye{constructor(e){f(this,"n");f(this,"Yg");f(this,"Gg");f(this,"ec");f(this,"au");f(this,"cu");f(this,"zn");f(this,"Xn");f(this,"Kn");f(this,"$");f(this,"xe");f(this,"be");f(this,"Qi");f(this,"_i");f(this,"Fs");f(this,"sc");f(this,"nc");K.Yi(this),this.n=2,e===void 0&&(e=4),this.$=e,this.xe=0,this.be=0,this.Qi=0,this._i=0,e===4?this.Fs=new J:this.Fs=ye.Sw,this.Yg=this.Fs.ht,this.Gg=new z().g(),this.ec=null,this.au=null,this.cu=NaN,this.zn=B.TopLeft,this.Xn=B.BottomRight,this.sc=NaN,this.nc=NaN,this.Kn=2}copy(){const e=new ye;if(e.n=this.n&-2,e.$=this.$,e.xe=this.xe,e.be=this.be,e.Qi=this.Qi,e._i=this._i,this.$===4){const t=this.Fs.r,i=e.Fs;for(let s=0;s<t.length;s++){const n=t[s];i.add(n.copy())}e.Fs=i}else e.Fs=this.Fs;return e.Yg=this.Yg,e.Gg.a(this.Gg),e.ec=this.ec,e.au=this.au,e.cu=this.cu,e.zn=this.zn.N(),e.Xn=this.Xn.N(),e.sc=this.sc,e.nc=this.nc,e.Kn=this.Kn,e}get h(){return(this.n&1)!==0}set h(e){e?this.n|=1:this.n&=-2}get bt(){return(this.n&2)!==0}set bt(e){e?this.n|=2:this.n&=-3}it(){return this.g(),Object.freeze(this),this}g(){if(this.h=!0,this.type!==4)return this;const e=this.figures;e.g();for(const t of e)t.g();return this}ot(){if(Object.isFrozen(this)&&b.o("cannot thaw constant: "+this),this.h=!1,this.type!==4)return this;const e=this.figures;e.ot();for(const t of e)t.ot();return this}equalsApprox(e){if(!(e instanceof ye))return!1;if(this.type!==e.type)return this.type===1&&e.type===4?this.gC(e):e.type===1&&this.type===4?e.gC(this):!1;if(this.type===4){const t=this.figures.r,i=e.figures.r,s=t.length;if(s!==i.length)return!1;for(let n=0;n<s;n++){const o=t[n],r=i[n];if(!o.equalsApprox(r))return!1}return!0}else return A.u(this.startX,e.startX)&&A.u(this.startY,e.startY)&&A.u(this.endX,e.endX)&&A.u(this.endY,e.endY)}gC(e){if(this.type!==1||e.type!==4)return!1;if(e.figures.count===1){const t=e.figures.elt(0);if(t.segments.count===1&&A.u(this.startX,t.startX)&&A.u(this.startY,t.startY)){const i=t.segments.elt(0);if(i.type===2&&A.u(this.endX,i.endX)&&A.u(this.endY,i.endY))return!0}}return!1}static stringify(e){return e.toString()}static stringifyFixed(e){return t=>t.toString(e)}ri(e){e in pi?this.type=e:b.lr(this,e)}toString(e){e===void 0&&(e=-1);const t=s=>s===0?"0":s.toFixed(e);let i;switch(this.type){case 1:return e<0?"M"+this.startX.toString()+" "+this.startY.toString()+"L"+this.endX.toString()+" "+this.endY.toString():"M"+t(this.startX)+" "+t(this.startY)+"L"+t(this.endX)+" "+t(this.endY);case 2:return i=new z(this.startX,this.startY,0,0),i.union(this.endX,this.endY,0,0),e<0?"M"+i.x.toString()+" "+i.y.toString()+"H"+i.right.toString()+"V"+i.bottom.toString()+"H"+i.left.toString()+"z":"M"+t(i.x)+" "+t(i.y)+"H"+t(i.right)+"V"+t(i.bottom)+"H"+t(i.left)+"z";case 3:if(i=new z(this.startX,this.startY,0,0),i.union(this.endX,this.endY,0,0),e<0){const r=i.left.toString()+" "+(i.y+i.height/2).toString(),a=i.right.toString()+" "+(i.y+i.height/2).toString();return"M"+r+"A"+(i.width/2).toString()+" "+(i.height/2).toString()+" 0 0 1 "+a+"A"+(i.width/2).toString()+" "+(i.height/2).toString()+" 0 0 1 "+r}else{const r=t(i.left)+" "+t(i.y+i.height/2),a=t(i.right)+" "+t(i.y+i.height/2);return"M"+r+"A"+t(i.width/2)+" "+t(i.height/2)+" 0 0 1 "+a+"A"+t(i.width/2)+" "+t(i.height/2)+" 0 0 1 "+r}case 4:let s="";const n=this.figures.r,o=n.length;for(let r=0;r<o;r++){const a=n[r];r>0&&(s+=" x "),a.isFilled&&(s+="F "),s+=a.toString(e)}return s;default:return pi[this.type]}}static fillPath(e){const t=e.split(/[Xx]/),i=t.length;let s="";for(let n=0;n<i;n++){const o=t[n];if(o.match(/[Ff]/)!==null){n===0?s+=o:s+="X"+(o[0]===" "?"":" ")+o;continue}s+=(n===0?"":"X ")+"F"+(o[0]===" "?"":" ")+o}return s}static parse(e,t){t===void 0&&(t=!1);const i=new RegExp("(["+ye.jg+"])(["+ye.jg+"])","gm"),s=new RegExp("(["+ye.jg+"])([^s])","gm"),n=new RegExp("([^s])(["+ye.jg+"])","gm");e=e.replace(/,/gm," "),e=e.replace(i,"$1 $2"),e=e.replace(i,"$1 $2"),e=e.replace(s,"$1 $2"),e=e.replace(n,"$1 $2"),e=e.replace(/([0-9])([+\-])/gm,"$1 $2"),e=e.replace(/[\s\r\t\n]+/gm," "),e=e.replace(/^\s+|\s+$/g,"");const o=e.split(" ");for(let D=0;D<o.length;D++){const R=o[D];if(R.match(/(\.[0-9]*)(\.)/gm)!==null){const I=b.nt();let j="",X=!1;for(let V=0;V<R.length;V++){const G=R[V];G==="."&&!X?(X=!0,j+=G):G==="."?(I.push(j),j="."):j+=G}I.push(j),o.splice(D,1);for(let V=0;V<I.length;V++)o.splice(D+V,0,I[V]);D+=I.length-1,b.tt(I)}}let r=-1,a="",h="";const l=new S(0,0),u=new S(0,0),c=new S(0,0);let d=!0;function m(){return r>=k-1||o[r+1].match(L)!==null?!0:(d=!1,!1)}function g(){return r++,o[r]}function p(D){let R=parseFloat(g()),I=parseFloat(g());a===a.toLowerCase()&&(R=c.x+R,I=c.y+I),D.e(R,I)}function y(){return p(c),c}function x(){return p(u),u}function P(){const D=h.toLowerCase();return D==="c"||D==="s"||D==="q"||D==="t"?new S(2*c.x-u.x,2*c.y-u.y):new S(c.x,c.y)}const k=o.length,w=Ui.mC(null);let N=!1,M=!1,C=!1,O=!0,T=null;const L=new RegExp("["+ye.jg+"]");for(;!(r>=k-1);){if(h=a,a=g(),a==="")continue;d=!0;let D=!1;switch(a.toUpperCase()){case"X":O=!0,N=!1,M=!1;break;case"M":for(T=y(),w.Pi===null||O===!0?(w.fu(T.x,T.y,N,!1,!M,C),O=!1):w.ID(T.x,T.y),l.a(c);!m();)T=y(),w.ur(T.x,T.y);break;case"L":for(;!m();)T=y(),w.ur(T.x,T.y);d&&(D=!0);break;case"H":for(;!m();)c.e((a===a.toLowerCase()?c.x:0)+parseFloat(g()),c.y),w.ur(c.x,c.y);break;case"V":for(;!m();)c.e(c.x,(a===a.toLowerCase()?c.y:0)+parseFloat(g())),w.ur(c.x,c.y);d&&(D=!0);break;case"C":for(;!m();){const R=new S;p(R);const I=x(),j=y();w.dr(R.x,R.y,I.x,I.y,j.x,j.y)}d&&(D=!0);break;case"S":for(;!m();){const R=P(),I=x(),j=y();w.dr(R.x,R.y,I.x,I.y,j.x,j.y)}d&&(D=!0);break;case"Q":for(;!m();){const R=x(),I=y();w.Mw(R.x,R.y,I.x,I.y)}d&&(D=!0);break;case"T":for(;!m();){const R=P();u.a(R);const I=y();w.Mw(R.x,R.y,I.x,I.y),u.a(I)}d&&(D=!0);break;case"B":for(;!m();){const R=parseFloat(g()),I=parseFloat(g());let j=parseFloat(g()),X=parseFloat(g());const V=parseFloat(g());let G=V,$=!1;m()||(G=parseFloat(g()),m()||($=parseFloat(g())!==0)),a===a.toLowerCase()&&(j+=c.x,X+=c.y),w.ED(R,I,j,X,V,G,$)}d&&(D=!0);break;case"A":for(;!m();){const R=Math.abs(parseFloat(g())),I=Math.abs(parseFloat(g())),j=parseFloat(g());let X=!1,V=!1,G=0,$=0;const pt=g();pt.length===1?(X=!!parseFloat(pt),V=!!parseFloat(g()),G=parseFloat(g()),$=parseFloat(g())):pt.length===2?(X=!!parseFloat(pt[0]),V=!!parseFloat(pt[1]),G=parseFloat(g()),$=parseFloat(g())):(X=!!parseFloat(pt[0]),V=!!parseFloat(pt[1]),G=parseFloat(pt.slice(2)),$=parseFloat(g())),a===a.toLowerCase()&&(G=c.x+G,$=c.y+$),c.e(G,$),w.BD(R,I,j,X,V,G,$)}d&&(D=!0);break;case"Z":w.UD(),c.a(l);break;case"F":{let R="",I=1;for(;o[r+I];){if(o[r+I]==="0"){C=!0,I++;continue}if(o[r+I].match(/[Uu]/)!==null){I++;continue}if(o[r+I].match(L)===null){I++;continue}R=o[r+I];break}R.match(/[Mm]/)?N=!0:w.VD();break}case"U":{let R="",I=1;for(;o[r+I];){if(o[r+I].match(/[Ff]/)!==null){I++;continue}if(o[r+I].match(L)===null){I++;continue}R=o[r+I];break}R.match(/[Mm]/)?M=!0:w.zD(!1);break}default:if(a==="0"||a==="1")break;b.ii("Unknown geometry command: "+a);break}if(D){b.ii(`Bad geometry command: ${a}, next token: ${g()},
string: ${e}`);break}}const F=w.Hg;if(Ui.pC(w),t){const D=F.figures.iterator;for(;D.next();){const R=D.value;R.isFilled=!0}}return F}static yC(e,t){const i=e.length,s=S.l();for(let n=0;n<i;n++){const o=e[n];s.x=o[0],s.y=o[1],t.xt(s),o[0]=s.x,o[1]=s.y,s.x=o[2],s.y=o[3],t.xt(s),o[2]=s.x,o[3]=s.y,s.x=o[4],s.y=o[5],t.xt(s),o[4]=s.x,o[5]=s.y,s.x=o[6],s.y=o[7],t.xt(s),o[6]=s.x,o[7]=s.y}S.s(s)}Uk(){if(this.bt)return!0;if(this.type===4){const e=this.figures;if(this.Yg!==e.ht)return!0;const t=this.figures.r,i=t.length;for(let s=0;s<i;s++)if(t[s].Uk())return!0}return!1}Nw(){if(this.bt=!1,this.ec=null,this.au=null,this.cu=NaN,this.type===4){const t=this.figures;this.Yg=t.ht;const i=this.figures.r,s=i.length;for(let n=0;n<s;n++)i[n].XD()}const e=this.Gg;e.ot(),isNaN(this.sc)||isNaN(this.nc)?e.e(0,0,0,0):e.e(0,0,this.sc,this.nc),this.wC(e,!1),e.unionNoCheck(0,0,0,0),e.g()}computeBoundsWithoutOrigin(){const e=new z;return this.wC(e,!0),e}wC(e,t){switch(this.type){case 1:case 2:case 3:t?e.e(this.xe,this.be,0,0):e.unionNoCheck(this.xe,this.be,0,0),e.unionNoCheck(this.Qi,this._i,0,0);break;case 4:const i=this.figures,s=i.r,n=i.length;for(let o=0;o<n;o++){const r=s[o];t&&o===0?e.e(r.startX,r.startY,0,0):e.unionNoCheck(r.startX,r.startY,0,0);const a=r.segments.r,h=a.length;let l=r.startX,u=r.startY;for(let c=0;c<h;c++){const d=a[c];switch(d.type){case 2:case 1:l=d.endX,u=d.endY,e.unionNoCheck(l,u,0,0);break;case 3:A.hu(l,u,d.point1X,d.point1Y,d.point2X,d.point2Y,d.endX,d.endY,.5,e),l=d.endX,u=d.endY;break;case 4:A.Bk(l,u,d.point1X,d.point1Y,d.endX,d.endY,.5,e),l=d.endX,u=d.endY;break;case 5:case 6:const m=d.type===5?d.Mo(r):d.Eh(r,l,u),g=m.length;if(g===0){l=d.type===5?d.centerX:d.endX,u=d.type===5?d.centerY:d.endY,e.unionNoCheck(l,u,0,0);break}let p=null;for(let y=0;y<g;y++)p=m[y],A.hu(p[0],p[1],p[2],p[3],p[4],p[5],p[6],p[7],.5,e);p!==null&&(l=p[6],u=p[7]);break;default:b.o("Unknown Segment type: "+d.type)}}}break;default:b.o("Unknown Geometry type: "+this.type)}}KD(e,t){const i=this.bounds;let s=e/i.width,n=t/i.height;return isFinite(s)||(s=1),isFinite(n)||(n=1),s===1&&n===1?this:this.copy().scale(s,n)}normalize(){this.h&&b.T(this);const e=this.computeBoundsWithoutOrigin();return this.offset(-e.x,-e.y),new S(-e.x,-e.y)}offset(e,t){return this.h&&b.T(this),this.D(1,0,0,1,e,t),this}scale(e,t){return this.h&&b.T(this),this.D(e,0,0,t,0,0),this}rotate(e,t,i){this.h&&b.T(this),t===void 0&&(t=0),i===void 0&&(i=0);const s=Tt.l();return s.Ri(),s.cs(e,t,i),this.D(s.m11,s.m12,s.m21,s.m22,s.dx,s.dy),Tt.s(s),this}D(e,t,i,s,n,o){let r=0,a=0;switch(this.type){case 1:case 2:case 3:r=this.xe,a=this.be,this.xe=r*e+a*i+n,this.be=r*t+a*s+o,r=this.Qi,a=this._i,this.Qi=r*e+a*i+n,this._i=r*t+a*s+o;break;case 4:const h=this.figures.r,l=h.length;for(let u=0;u<l;u++){const c=h[u];r=c.startX,a=c.startY,c.startX=r*e+a*i+n,c.startY=r*t+a*s+o;const d=c.segments.r,m=d.length;for(let g=0;g<m;g++){const p=d[g];switch(p.type){case 2:case 1:r=p.endX,a=p.endY,p.endX=r*e+a*i+n,p.endY=r*t+a*s+o;break;case 3:r=p.point1X,a=p.point1Y,p.point1X=r*e+a*i+n,p.point1Y=r*t+a*s+o,r=p.point2X,a=p.point2Y,p.point2X=r*e+a*i+n,p.point2Y=r*t+a*s+o,r=p.endX,a=p.endY,p.endX=r*e+a*i+n,p.endY=r*t+a*s+o;break;case 4:r=p.point1X,a=p.point1Y,p.point1X=r*e+a*i+n,p.point1Y=r*t+a*s+o,r=p.endX,a=p.endY,p.endX=r*e+a*i+n,p.endY=r*t+a*s+o;break;case 5:if(r=p.centerX,a=p.centerY,p.centerX=r*e+a*i+n,p.centerY=r*t+a*s+o,t!==0){let y=Math.atan2(t,e)*180/Math.PI;y<0&&(y+=360),p.startAngle+=y}e<0&&(p.startAngle=180-p.startAngle,p.sweepAngle=-p.sweepAngle),s<0&&(p.startAngle=-p.startAngle,p.sweepAngle=-p.sweepAngle),p.radiusX*=Math.sqrt(e*e+i*i),p.radiusY!==void 0&&(p.radiusY*=Math.sqrt(t*t+s*s));break;case 6:if(r=p.endX,a=p.endY,p.endX=r*e+a*i+n,p.endY=r*t+a*s+o,p.radiusX===0||p.radiusY===0)break;if(t!==0){let y=Math.atan2(t,e)*180/Math.PI;y<0&&(y+=360),p.xAxisRotation+=y}e<0&&(p.xAxisRotation=180-p.xAxisRotation,p.isClockwiseArc=!p.isClockwiseArc),s<0&&(p.xAxisRotation=-p.xAxisRotation,p.isClockwiseArc=!p.isClockwiseArc),p.radiusX*=Math.sqrt(e*e+i*i),p.radiusY*=Math.sqrt(t*t+s*s);break;default:b.o("Unknown Segment type: "+p.type)}}}break}return this.bt=!0,this}containsPoint(e,t){t===void 0&&(t=0);const i=this.xe,s=this.be,n=this.Qi,o=this._i;switch(this.type){case 1:return A.vi(i,s,n,o,t,e.x,e.y);case 2:{const r=Math.min(i,n)-t,a=Math.min(s,o)-t,h=Math.abs(n-i)+t*2,l=Math.abs(o-s)+t*2,u=z.X(r,a,h,l),c=u.containsPoint(e);return z.s(u),c}case 3:{let r=Math.min(i,n)-t,a=Math.min(s,o)-t;const h=Math.abs(n-i)+t*2,l=Math.abs(o-s)+t*2,u=h/2,c=l/2;return u<=0||c<=0?!1:(r=e.x-(r+u),a=e.y-(a+c),r*r/(u*u)+a*a/(c*c)<=1)}case 4:return this.Vk(e,t,!0,!1);default:return!1}}Vk(e,t,i,s){const n=e.x,o=e.y,r=this.bounds.x-20,a=o;let h=0,l=0,u=0,c=0,d=0,m=0;const g=this.figures.r,p=g.length;for(let y=0;y<p;y++){const x=g[y],P=!x.isEvenOdd;if(x.isFilled){if(i&&x.zk(n,o,t))return!0}else{if(x.zk(n,o,s?t:t+2))return!0;continue}const k=x.segments;l=x.startX,u=x.startY;let w=l,N=u;const M=k.r;for(let C=0;C<=k.length;C++){let O,T;switch(C!==k.length?(O=M[C],T=O.type,d=O.endX,m=O.endY):(T=2,d=w,m=N),T){case 1:{const L=this.Cw(n,o,r,a,l,u,w,N);if(isNaN(L))return!0;h+=L,w=d,N=m;break}case 2:{const L=this.Cw(n,o,r,a,l,u,d,m);if(isNaN(L))return!0;h+=L;break}case 3:c=A.Vg(l,u,O.point1X,O.point1Y,O.point2X,O.point2Y,d,m,r,a,n,o,.5),h+=c;break;case 4:{const L=(l+2*O.point1X)/3,F=(u+2*O.point1Y)/3,D=(O.point1X*2+d)/3,R=(O.point1Y*2+m)/3;c=A.Vg(l,u,L,F,D,R,d,m,r,a,n,o,.5),h+=c;break}case 5:case 6:{const L=O.type===5?O.Mo(x):O.Eh(x,l,u),F=L.length;if(F===0){const R=this.Cw(n,o,r,a,l,u,O.type===5?O.centerX:O.endX,O.type===5?O.centerY:O.endY);if(isNaN(R))return!0;h+=R;break}let D=null;for(let R=0;R<F;R++){if(D=L[R],R===0){const I=this.Cw(n,o,r,a,l,u,D[0],D[1]);if(isNaN(I))return!0;h+=I}c=A.Vg(D[0],D[1],D[2],D[3],D[4],D[5],D[6],D[7],r,a,n,o,.5),h+=c}D!==null&&(d=D[6],m=D[7]);break}default:b.o("Unknown Segment type: "+O.type)}l=d,u=m}if(P){if(h!==0)return!0}else if(h%2!==0)return!0;h=0}return!1}Cw(e,t,i,s,n,o,r,a){if(A.vi(n,o,r,a,.05,e,t))return NaN;const h=(e-i)*(o-a);if(h===0)return 0;const l=((e*s-t*i)*(n-r)-(e-i)*(n*a-o*r))/h,u=(e*s-t*i)*(o-a)/h;if(l>=e)return 0;if((n>r?n-r:r-n)<(o>a?o-a:a-o)){if(o<a){if(u<o||u>a)return 0}else if(u<a||u>o)return 0}else if(n<r){if(l<n||l>r)return 0}else if(l<r||l>n)return 0;return h>0?1:-1}xC(e,t,i){const s=this.figures.r,n=s.length;for(let o=0;o<n;o++)if(s[o].zk(e,t,i))return!0;return!1}getPointAlongPath(e,t){if(e<0?e=0:e>1&&(e=1),t===void 0&&(t=new S),this.type===1)return t.e(this.startX+e*(this.endX-this.startX),this.startY+e*(this.endY-this.startY)),t;const i=this.flattenedSegments,s=this.flattenedLengths,n=this.flattenedTotalLength,o=i.length,r=n*e;let a=0;for(let h=0;h<o;h++){const l=s[h],u=l.length;for(let c=0;c<u;c++){const d=l[c];if(a+d>=r){const m=r-a,g=d===0?0:m/d,p=i[h],y=p[c*2],x=p[c*2+1],P=p[c*2+2],k=p[c*2+3];return t.e(y+(P-y)*g,x+(k-x)*g),t}a+=d}}return t}getAngleAlongPath(e){if(e<0?e=0:e>1&&(e=1),this.type===1)return Math.atan2(this.endY-this.startY,this.endX-this.startX)*180/Math.PI;const t=this.flattenedSegments,i=this.flattenedLengths,s=this.flattenedTotalLength,n=t.length,o=s*e;let r=0;for(let a=0;a<n;a++){const h=i[a],l=h.length;for(let u=0;u<l;u++){const c=h[u];if(r+c>=o){const d=t[a],m=d[u*2],g=d[u*2+1],p=d[u*2+2],y=d[u*2+3];return Math.abs(p-m)<1&&Math.abs(y-g)<1?0:Math.abs(p-m)<1?y-g>=0?90:270:Math.abs(y-g)<1?p-m>=0?0:180:Math.atan2(y-g,p-m)*180/Math.PI}r+=c}}return NaN}getPointAndAngleAlongPath(e,t){if(e<0?e=0:e>1&&(e=1),t===void 0&&(t=[]),t.length=3,this.type===1)return t[0]=this.startX+e*(this.endX-this.startX),t[1]=this.startY+e*(this.endY-this.startY),t[2]=Math.atan2(this.endY-this.startY,this.endX-this.startX)*180/Math.PI,t;const i=this.flattenedSegments,s=this.flattenedLengths,n=this.flattenedTotalLength,o=i.length,r=n*e;let a=0;for(let h=0;h<o;h++){const l=s[h],u=l.length;for(let c=0;c<u;c++){const d=l[c];if(a+d>=r){const m=r-a,g=d===0?0:m/d,p=i[h],y=p[c*2],x=p[c*2+1],P=p[c*2+2],k=p[c*2+3];t[0]=y+(P-y)*g,t[1]=x+(k-x)*g;let w;return Math.abs(P-y)<1&&Math.abs(k-x)<1?w=0:Math.abs(P-y)<1?w=k-x>=0?90:270:Math.abs(k-x)<1?w=P-y>=0?0:180:w=Math.atan2(k-x,P-y)*180/Math.PI,t[2]=w,t}a+=d}}return t}getFractionForPoint(e){if(this.type===1){const t=this.startX,i=this.startY,s=this.endX,n=this.endY;if(t===s&&i===n)return 0;{const o=e.x,r=e.y;let a=0,h=0;if(t===s)return i<n?(a=i,h=n):(a=n,h=i),r<=a?a===i?0:1:r>=h?h===i?0:1:Math.abs(r-i)/(h-a);if(i===n)return t<s?(a=t,h=s):(a=s,h=t),o<=a?a===t?0:1:o>=h?h===t?0:1:Math.abs(o-t)/(h-a);{const l=(s-t)*(s-t)+(n-i)*(n-i),u=S.l();A.ml(t,i,s,n,o,r,u);const c=u.x,d=u.y;return S.s(u),Math.sqrt(((c-t)*(c-t)+(d-i)*(d-i))/l)}}}else if(this.type===2){const t=this.startX,i=this.startY,s=this.endX,n=this.endY;if(t===s&&i===n)return 0;{const o=s-t,r=n-i,a=o*2+r*2;let h=e.x,l=e.y;h=Math.min(Math.max(h,t),s),l=Math.min(Math.max(l,i),n);const u=Math.abs(h-t),c=Math.abs(h-s),d=Math.abs(l-i),m=Math.abs(l-n),g=Math.min(u,c,d,m);if(g===d)return h/a;if(g===c)return(o+l)/a;if(g===m)return(o*2+r-h)/a;if(g===u)return(o*2+r*2-l)/a}}else{const t=this.flattenedSegments,i=this.flattenedLengths,s=this.flattenedTotalLength,n=S.l();let o=1/0,r=0,a=0;const h=t.length;let l=0,u=0;for(let d=0;d<h;d++){const m=t[d],g=i[d],p=m.length;for(let y=0;y<p;y+=2){const x=m[y],P=m[y+1];if(y===0){l=x,u=P;continue}A.ml(l,u,x,P,e.x,e.y,n);const k=(n.x-e.x)*(n.x-e.x)+(n.y-e.y)*(n.y-e.y);k<o&&(o=k,r=a,r+=Math.sqrt((n.x-l)*(n.x-l)+(n.y-u)*(n.y-u))),a+=g[(y-2)/2],l=x,u=P}}S.s(n);const c=r/s;return c<0?0:c>1?1:c}return 0}get flattenedSegments(){return this.bC(),this.ec}bC(){if(this.ec===null){const e=this.ec=[],t=this.au=[];this.YD(e,t)}}get flattenedLengths(){return this.bC(),this.au}get flattenedTotalLength(){let e=this.cu;if(isNaN(e)){if(this.type===1){const t=Math.abs(this.endX-this.startX),i=Math.abs(this.endY-this.startY);e=Math.sqrt(t*t+i*i)}else if(this.type===2){const t=Math.abs(this.endX-this.startX),i=Math.abs(this.endY-this.startY);e=t*2+i*2}else{const t=this.flattenedLengths,i=t.length;e=0;for(let s=0;s<i;s++){const n=t[s],o=n.length;for(let r=0;r<o;r++)e+=n[r]}}this.cu=e}return e}Xk(e){const t=[];let i=0,s=0;const n=e.length;for(let o=0;o<n;o+=2){const r=e[o],a=e[o+1];if(o===0){i=r,s=a;continue}const h=Math.sqrt(S.distanceSquared(i,s,r,a));t.push(h),i=r,s=a}return t}YD(e,t){let i=[];const s=[];if(this.type===1)i.push(this.startX),i.push(this.startY),i.push(this.endX),i.push(this.endY),e.push(i),s.push(Math.sqrt((this.startX-this.endX)*(this.startX-this.endX)+(this.startY-this.endY)*(this.startY-this.endY))),t.push(s);else if(this.type===2)i.push(this.startX),i.push(this.startY),i.push(this.endX),i.push(this.startY),i.push(this.endX),i.push(this.endY),i.push(this.startX),i.push(this.endY),i.push(this.startX),i.push(this.startY),e.push(i),s.push(Math.abs(this.startX-this.endX)),s.push(Math.abs(this.startY-this.endY)),s.push(Math.abs(this.startX-this.endX)),s.push(Math.abs(this.startY-this.endY)),t.push(s);else if(this.type===3){const n=new _t;n.startX=this.endX,n.startY=(this.startY+this.endY)/2;const o=new kt(5);o.startAngle=0,o.sweepAngle=360,o.centerX=(this.startX+this.endX)/2,o.centerY=(this.startY+this.endY)/2,o.radiusX=Math.abs(this.startX-this.endX)/2,o.radiusY=Math.abs(this.startY-this.endY)/2,n.add(o);const r=o.Mo(n),a=r.length;if(a===0)i.push(o.centerX),i.push(o.centerY);else{let h=n.startX,l=n.startY;for(let u=0;u<a;u++){const c=r[u];A.Un(h,l,c[2],c[3],c[4],c[5],c[6],c[7],.5,i),h=c[6],l=c[7]}}e.push(i),t.push(this.Xk(i))}else{const n=this.figures.iterator;for(;n.next();){const o=n.value;i=[],i.push(o.startX),i.push(o.startY);let r=o.startX,a=o.startY,h=r,l=a;const u=o.segments.r,c=u.length;for(let d=0;d<c;d++){const m=u[d];switch(m.type){case 1:i.length>=4&&(e.push(i),t.push(this.Xk(i))),i=[],i.push(m.endX),i.push(m.endY),r=m.endX,a=m.endY,h=r,l=a;break;case 2:i.push(m.endX),i.push(m.endY),r=m.endX,a=m.endY;break;case 3:A.Un(r,a,m.point1X,m.point1Y,m.point2X,m.point2Y,m.endX,m.endY,.5,i),r=m.endX,a=m.endY;break;case 4:A.Bg(r,a,m.point1X,m.point1Y,m.endX,m.endY,.5,i),r=m.endX,a=m.endY;break;case 5:{const g=m.Mo(o),p=g.length;if(p===0){i.push(m.centerX),i.push(m.centerY),r=m.centerX,a=m.centerY;break}for(let y=0;y<p;y++){const x=g[y];A.Un(r,a,x[2],x[3],x[4],x[5],x[6],x[7],.5,i),r=x[6],a=x[7]}break}case 6:{const g=m.Eh(o,r,a),p=g.length,y=m.endX,x=m.endY;if(p===0){i.push(y),i.push(x),r=y,a=x;break}for(let P=0;P<p;P++){const k=g[P];A.Un(r,a,k[2],k[3],k[4],k[5],k[6],k[7],.5,i),r=k[6],a=k[7]}break}default:b.o("Segment not of valid type: "+m.type)}m.isClosed&&(i.push(h),i.push(l))}i.length>=4&&(e.push(i),t.push(this.Xk(i)))}}}get type(){return this.$}set type(e){this.$!==e&&(this.h&&b.T(this,e),this.$=e,e===4?this.Fs=new J:(ye.Sw===null&&(ye.Sw=new J().g()),this.Fs=ye.Sw),this.bt=!0)}get startX(){return this.xe}set startX(e){this.xe!==e&&(this.h&&b.T(this,e),this.xe=e,this.bt=!0)}get startY(){return this.be}set startY(e){this.be!==e&&(this.h&&b.T(this,e),this.be=e,this.bt=!0)}get endX(){return this.Qi}set endX(e){this.Qi!==e&&(this.h&&b.T(this,e),this.Qi=e,this.bt=!0)}get endY(){return this._i}set endY(e){this._i!==e&&(this.h&&b.T(this,e),this._i=e,this.bt=!0)}get figures(){return this.Fs}set figures(e){this.Fs!==e&&(this.h&&b.T(this,e),this.Fs=e,this.bt=!0)}add(e){return this.Fs.add(e),this}setSpots(e,t,i,s,n,o,r,a){return this.h&&b.T(this),this.zn=new B(e,t,n,o).g(),this.Xn=new B(i,s,r,a).g(),this}get spot1(){return this.zn}set spot1(e){this.h&&b.T(this,e),this.zn=e.N()}get spot2(){return this.Xn}set spot2(e){this.h&&b.T(this,e),this.Xn=e.N()}get defaultStretch(){return this.Kn}set defaultStretch(e){this.Kn=e}get bounds(){return this.Uk()&&this.Nw(),this.Gg}};f(ye,"Line",1),f(ye,"Rectangle",2),f(ye,"Ellipse",3),f(ye,"Path",4),f(ye,"Sw",new J().g()),f(ye,"jg","UuBbMmZzLlHhVvCcSsQqTtAaFfXx");let Ft=ye;Ft.stringify=Ft.stringify,Ft.stringifyFixed=Ft.stringifyFixed,Ft.fillPath=Ft.fillPath,Ft.parse=Ft.parse;class _t{constructor(e,t,i,s,n){f(this,"n");f(this,"xe");f(this,"be");f(this,"oc");f(this,"qg");f(this,"Be");i===void 0&&(i=!0),s===void 0&&(s=!0),n===void 0&&(n=!1),this.n=2|(i?4:0)|(s?8:0)|(n?16:0),e!==void 0?this.xe=e:this.xe=0,t!==void 0?this.be=t:this.be=0,this.oc=new J,this.qg=this.oc.ht,this.Be=null}copy(){const e=new _t;e.n=this.n&-2,e.xe=this.xe,e.be=this.be;const t=this.oc.r,i=t.length,s=e.oc;for(let n=0;n<i;n++){const o=t[n].copy();s.add(o)}return e.qg=this.qg,e.Be=this.Be,e}equalsApprox(e){if(!(e instanceof _t)||!A.u(this.startX,e.startX)||!A.u(this.startY,e.startY))return!1;const t=this.segments.r,i=e.segments.r,s=t.length;if(s!==i.length)return!1;for(let n=0;n<s;n++){const o=t[n],r=i[n];if(!o.equalsApprox(r))return!1}return!0}toString(e){e===void 0&&(e=-1);let t="";if(e<0)t="M"+this.startX.toString()+" "+this.startY.toString();else{const n=o=>o===0?"0":o.toFixed(e);t="M"+n(this.startX)+" "+n(this.startY)}const i=this.segments.r,s=i.length;for(let n=0;n<s;n++){const o=i[n];t+=" "+o.toString(e)}return t}get h(){return(this.n&1)!==0}set h(e){e?this.n|=1:this.n&=-2}get bt(){return(this.n&2)!==0}set bt(e){e?this.n|=2:this.n&=-3}g(){this.h=!0;const e=this.segments;e.g();const t=e.r,i=e.length;for(let s=0;s<i;s++)t[s].g();return this}ot(){this.h=!1;const e=this.segments;e.ot();const t=e.r,i=t.length;for(let s=0;s<i;s++)t[s].ot();return this}Uk(){if(this.bt)return!0;const e=this.segments;if(this.qg!==e.ht)return!0;for(const t of e)if(t.bt)return!0;return!1}XD(){this.bt=!1,this.Be=null;const e=this.segments;this.qg=e.ht;for(const t of e)t.bt=!1,t.Rs=null}get isFilled(){return(this.n&4)!==0}set isFilled(e){this.h&&b.T(this,e),e?this.n|=4:this.n&=-5}get isShadowed(){return(this.n&8)!==0}set isShadowed(e){this.h&&b.T(this,e),e?this.n|=8:this.n&=-9}get isEvenOdd(){return(this.n&16)!==0}set isEvenOdd(e){this.h&&b.T(this,e),e?this.n|=16:this.n&=-17}get startX(){return this.xe}set startX(e){this.h&&b.T(this,e),this.xe=e,this.Be=null,this.bt=!0}get startY(){return this.be}set startY(e){this.h&&b.T(this,e),this.be=e,this.Be=null,this.bt=!0}get segments(){return this.oc}set segments(e){this.h&&b.T(this,e),this.oc=e,this.Be=null,this.bt=!0}add(e){return this.oc.add(e),this.Be=null,this}zk(e,t,i){const s=this;let n=s.startX,o=s.startY,r=n,a=o;const h=s.segments.r,l=h.length;for(let u=0;u<l;u++){const c=h[u];switch(c.type){case 1:r=c.endX,a=c.endY,n=c.endX,o=c.endY;break;case 2:if(A.vi(n,o,c.endX,c.endY,i,e,t))return!0;n=c.endX,o=c.endY;break;case 3:if(A.kw(n,o,c.point1X,c.point1Y,c.point2X,c.point2Y,c.endX,c.endY,.5,e,t,i))return!0;n=c.endX,o=c.endY;break;case 4:if(A.Ek(n,o,c.point1X,c.point1Y,c.endX,c.endY,.5,e,t,i))return!0;n=c.endX,o=c.endY;break;case 5:case 6:const d=c.type===5?c.Mo(s):c.Eh(s,n,o),m=d.length,g=c.type===5?c.centerX:c.endX,p=c.type===5?c.centerY:c.endY;if(m===0){if(A.vi(n,o,g,p,i,e,t))return!0;n=g,o=p;break}let y=null;for(let x=0;x<m;x++)if(y=d[x],x===0&&A.vi(n,o,y[0],y[1],i,e,t)||A.kw(y[0],y[1],y[2],y[3],y[4],y[5],y[6],y[7],.5,e,t,i))return!0;y!==null&&(n=y[6],o=y[7]);break;default:b.o("Unknown Segment type: "+c.type)}if(c.isClosed&&(n!==r||o!==a)&&A.vi(n,o,r,a,i,e,t))return!0}return!1}}var _e=(v=>(v[v.Move=1]="Move",v[v.Line=2]="Line",v[v.Bezier=3]="Bezier",v[v.QuadraticBezier=4]="QuadraticBezier",v[v.Arc=5]="Arc",v[v.SvgArc=6]="SvgArc",v))(_e||{});const $e=class $e{constructor(e,t,i,s,n,o,r,a){f(this,"$");f(this,"n");f(this,"Qi");f(this,"_i");f(this,"hn");f(this,"yl");f(this,"wl");f(this,"gr");f(this,"Rs");if(K.Yi(this),e===void 0&&(e=2),this.$=e,this.n=2,t!==void 0?this.Qi=t:this.Qi=0,i!==void 0?this._i=i:this._i=0,s===void 0&&(s=0),n===void 0&&(n=0),o===void 0&&(o=0),r===void 0&&(r=0),e===6){let h=o;h=h%360,h<0&&(h+=360),this.hn=h,this.yl=0,this.wl=Math.max(s,0),this.gr=Math.max(n,0),typeof r=="boolean"?r&&(this.isLargeArc=!0):typeof r=="number"&&r&&(this.isLargeArc=!0),a&&(this.isClockwiseArc=!0)}else this.hn=s,this.yl=n,e===5&&(o=Math.max(o,0)),this.wl=o,typeof r=="number"?(e===5&&(r=Math.max(r,0)),this.gr=r):this.gr=0;this.Rs=null}copy(){const e=new $e;return e.$=this.$,e.n=this.n&-2,e.Qi=this.Qi,e._i=this._i,e.hn=this.hn,e.yl=this.yl,e.wl=this.wl,e.gr=this.gr,e}equalsApprox(e){if(!(e instanceof $e)||this.type!==e.type||this.isClosed!==e.isClosed)return!1;switch(this.type){case 1:case 2:return A.u(this.endX,e.endX)&&A.u(this.endY,e.endY);case 3:return A.u(this.endX,e.endX)&&A.u(this.endY,e.endY)&&A.u(this.point1X,e.point1X)&&A.u(this.point1Y,e.point1Y)&&A.u(this.point2X,e.point2X)&&A.u(this.point2Y,e.point2Y);case 4:return A.u(this.endX,e.endX)&&A.u(this.endY,e.endY)&&A.u(this.point1X,e.point1X)&&A.u(this.point1Y,e.point1Y);case 5:return A.u(this.startAngle,e.startAngle)&&A.u(this.sweepAngle,e.sweepAngle)&&A.u(this.centerX,e.centerX)&&A.u(this.centerY,e.centerY)&&A.u(this.radiusX,e.radiusX)&&A.u(this.radiusY,e.radiusY);case 6:return this.isClockwiseArc===e.isClockwiseArc&&this.isLargeArc===e.isLargeArc&&A.u(this.xAxisRotation,e.xAxisRotation)&&A.u(this.endX,e.endX)&&A.u(this.endY,e.endY)&&A.u(this.radiusX,e.radiusX)&&A.u(this.radiusY,e.radiusY);default:return!1}}ri(e){e in _e?this.type=e:b.lr(this,e)}toString(e){e===void 0&&(e=-1);const t=s=>s===0?"0":s.toFixed(e);let i="";switch(this.type){case 1:e<0?i="M"+this.endX.toString()+" "+this.endY.toString():i="M"+t(this.endX)+" "+t(this.endY);break;case 2:e<0?i="L"+this.endX.toString()+" "+this.endY.toString():i="L"+t(this.endX)+" "+t(this.endY);break;case 3:e<0?i="C"+this.point1X.toString()+" "+this.point1Y.toString()+" "+this.point2X.toString()+" "+this.point2Y.toString()+" "+this.endX.toString()+" "+this.endY.toString():i="C"+t(this.point1X)+" "+t(this.point1Y)+" "+t(this.point2X)+" "+t(this.point2Y)+" "+t(this.endX)+" "+t(this.endY);break;case 4:e<0?i="Q"+this.point1X.toString()+" "+this.point1Y.toString()+" "+this.endX.toString()+" "+this.endY.toString():i="Q"+t(this.point1X)+" "+t(this.point1Y)+" "+t(this.endX)+" "+t(this.endY);break;case 5:e<0?i="B"+this.startAngle.toString()+" "+this.sweepAngle.toString()+" "+this.centerX.toString()+" "+this.centerY.toString()+" "+this.radiusX.toString()+" "+this.radiusY.toString():i="B"+t(this.startAngle)+" "+t(this.sweepAngle)+" "+t(this.centerX)+" "+t(this.centerY)+" "+t(this.radiusX)+" "+t(this.radiusY);break;case 6:e<0?i="A"+this.radiusX.toString()+" "+this.radiusY.toString()+" "+this.xAxisRotation.toString()+" "+(this.isLargeArc?1:0)+" "+(this.isClockwiseArc?1:0)+" "+this.endX.toString()+" "+this.endY.toString():i="A"+t(this.radiusX)+" "+t(this.radiusY)+" "+t(this.xAxisRotation)+" "+(this.isLargeArc?1:0)+" "+(this.isClockwiseArc?1:0)+" "+t(this.endX)+" "+t(this.endY);break;default:i=_e[this.type]}return i+(this.isClosed?"z":"")}get h(){return(this.n&1)!==0}set h(e){e?this.n|=1:this.n&=-2}get bt(){return(this.n&2)!==0}set bt(e){e?this.n|=2:this.n&=-3}g(){return this.h=!0,this}ot(){return this.h=!1,this}close(){return this.isClosed=!0,this}Mo(e){if(this.Rs!==null&&e.bt===!1)return this.Rs;const t=this.radiusX;let i=this.radiusY;if(i===void 0&&(i=t),t===0||i===0)return this.Rs=[],this.Rs;const s=this.hn,n=this.yl,o=A.uC(0,0,t<i?t:i,this.startAngle,this.startAngle+this.sweepAngle,!1);if(t!==i){const a=Tt.l();a.Ri(),t<i?a.et(1,i/t):a.et(t/i,1),Ft.yC(o,a),Tt.s(a)}const r=o.length;for(let a=0;a<r;a++){const h=o[a];h[0]+=s,h[1]+=n,h[2]+=s,h[3]+=n,h[4]+=s,h[5]+=n,h[6]+=s,h[7]+=n}return this.Rs=o,this.Rs}Eh(e,t,i){if(this.Rs!==null&&e.bt===!1)return this.Rs;if(this.radiusX===0||this.radiusY===0)return this.Rs=[],this.Rs;const s=t,n=i;let o=this.wl,r=this.gr;o===0&&(o=1e-4),r===0&&(r=1e-4);const a=this.hn*(Math.PI/180),h=this.isLargeArc,l=this.isClockwiseArc,u=this.Qi,c=this._i,d=Math.cos(a),m=Math.sin(a),g=d*(s-u)/2+m*(n-c)/2,p=-m*(s-u)/2+d*(n-c)/2,y=g*g/(o*o)+p*p/(r*r);y>1&&(o*=Math.sqrt(y),r*=Math.sqrt(y));let x=(h===l?-1:1)*Math.sqrt((o*o*r*r-o*o*p*p-r*r*g*g)/(o*o*p*p+r*r*g*g));isNaN(x)&&(x=0);let P=x*o*p/r,k=x*-r*g/o;isNaN(P)&&(P=0),isNaN(k)&&(k=0);const w=(s+u)/2+d*P-m*k,N=(n+c)/2+m*P+d*k,M=(Q,it)=>Math.sqrt(Q*Q+it*it),C=(Q,it,et,st)=>(Q*et+it*st)/(M(Q,it)*M(et,st)),O=(Q,it,et,st)=>(Q*st<it*et?-1:1)*Math.acos(C(Q,it,et,st)),T=O(1,0,(g-P)/o,(p-k)/r),L=(g-P)/o,F=(p-k)/r,D=(-g-P)/o,R=(-p-k)/r;let I=O(L,F,D,R);const j=C(L,F,D,R);j<=-1?I=Math.PI:j>=1&&(I=0),!l&&I>0&&(I=I-2*Math.PI),l&&I<0&&(I=I+2*Math.PI);const X=o>r?o:r,V=o>r?1:o/r,G=o>r?r/o:1,$=A.uC(0,0,X,T,T+I,!0),pt=Tt.l();return pt.Ri(),pt.Ds(w,N),pt.cs(this.hn,0,0),pt.et(V,G),Ft.yC($,pt),Tt.s(pt),this.Rs=$,this.Rs}get isClosed(){return(this.n&8)!==0}set isClosed(e){this.isClosed!==e&&(e?this.n|=8:this.n&=-9,this.bt=!0)}get type(){return this.$}set type(e){this.h&&b.T(this,e),this.$=e,this.bt=!0}get endX(){return this.Qi}set endX(e){this.h&&b.T(this,e),this.Qi=e,this.bt=!0}get endY(){return this._i}set endY(e){this.h&&b.T(this,e),this._i=e,this.bt=!0}get point1X(){return this.hn}set point1X(e){this.h&&b.T(this,e),this.hn=e,this.bt=!0}get point1Y(){return this.yl}set point1Y(e){this.h&&b.T(this,e),this.yl=e,this.bt=!0}get point2X(){return this.wl}set point2X(e){this.h&&b.T(this,e),this.wl=e,this.bt=!0}get point2Y(){return this.gr}set point2Y(e){this.h&&b.T(this,e),this.gr=e,this.bt=!0}get centerX(){return this.hn}set centerX(e){this.h&&b.T(this,e),this.hn=e,this.bt=!0}get centerY(){return this.yl}set centerY(e){this.h&&b.T(this,e),this.yl=e,this.bt=!0}get radiusX(){return this.wl}set radiusX(e){e<0&&b._(e,">= zero",$e,"radiusX"),this.h&&b.T(this,e),this.wl=e,this.bt=!0}get radiusY(){return this.gr}set radiusY(e){e<0&&b._(e,">= zero",$e,"radiusY"),this.h&&b.T(this,e),this.gr=e,this.bt=!0}get startAngle(){return this.Qi}set startAngle(e){this.h&&b.T(this,e),e=e%360,e<0&&(e+=360),this.Qi=e,this.bt=!0}get sweepAngle(){return this._i}set sweepAngle(e){this.h&&b.T(this,e),e>360&&(e=360),e<-360&&(e=-360),this._i=e,this.bt=!0}get isClockwiseArc(){return(this.n&4)!==0}set isClockwiseArc(e){this.h&&b.T(this,e),e?this.n|=4:this.n&=-5,this.bt=!0}get isLargeArc(){return(this.n&16)!==0}set isLargeArc(e){this.h&&b.T(this,e),e?this.n|=16:this.n&=-17,this.bt=!0}get xAxisRotation(){return this.hn}set xAxisRotation(e){this.h&&b.T(this,e),e=e%360,e<0&&(e+=360),this.hn=e,this.bt=!0}};f($e,"Move",1),f($e,"Line",2),f($e,"Bezier",3),f($e,"QuadraticBezier",4),f($e,"Arc",5),f($e,"SvgArc",6);let kt=$e;class ui{constructor(){f(this,"p");f(this,"Lw");f(this,"Aw");f(this,"Wg");f(this,"Jg");f(this,"$g");f(this,"Zg");f(this,"Qg");f(this,"_g");f(this,"tm");f(this,"im");f(this,"em");f(this,"sm");f(this,"nm");f(this,"No");f(this,"om");f(this,"rm");f(this,"lm");f(this,"ke");this.p=null,this.Lw=new S(0,0).g(),this.Aw=new S(0,0).g(),this.Wg=0,this.Jg=0,this.$g=1,this.Zg="",this.Qg="",this._g=!1,this.tm=!1,this.im=0,this.em=0,this.sm=!1,this.nm=!1,this.No=!1,this.om=null,this.rm=0,this.lm=null,this.ke=null}copy(){const e=new ui;return this.clone(e)}clone(e){return e.p=this.p,e.Lw.a(this.viewPoint),e.Aw.a(this.documentPoint),e.Wg=this.Wg,e.Jg=this.Jg,e.$g=this.$g,e.Zg=this.Zg,e.Qg=this.Qg,e._g=this._g,e.tm=this.tm,e.im=this.im,e.em=this.em,e.sm=this.sm,e.nm=this.nm,e.No=this.No,e.om=this.om,e.rm=this.rm,e.lm=this.lm,e.ke=this.ke,e}toString(){let e="^";return this.modifiers!==0&&(e+="M:"+this.modifiers),this.button!==0&&(e+="B:"+this.button),this.key!==""&&(e+="K:"+this.key),this.clickCount!==0&&(e+="C:"+this.clickCount),this.delta!==0&&(e+="D:"+this.delta),this.handled&&(e+="h"),this.bubbles&&(e+="b"),this.documentPoint!==null&&(e+="@"+this.documentPoint.toString()),e}get diagram(){return this.p}set diagram(e){this.p=e}get viewPoint(){return this.Lw}set viewPoint(e){this.Lw.a(e)}get documentPoint(){return this.Aw}set documentPoint(e){this.Aw.a(e)}getMultiTouchViewPoint(e,t){const i=this.diagram;return i===null||i.kC(this.event,e,t),t}getMultiTouchDocumentPoint(e,t){const i=this.diagram;return i===null||(i.kC(this.event,e,t),t.a(i.transformViewToDoc(t))),t}get modifiers(){return this.Wg}set modifiers(e){this.Wg=e}get button(){return this.Jg}set button(e){if(this.Jg=e,this.event===null)switch(e){case 0:this.buttons=1;return;case 1:this.buttons=4;return;case 2:this.buttons=2;return}}get buttons(){return this.$g}set buttons(e){this.$g=e}get key(){return this.Zg}set key(e){this.Zg=e}get code(){return this.Qg}set code(e){this.Qg=e}get down(){return this._g}set down(e){this._g=e}get up(){return this.tm}set up(e){this.tm=e}get clickCount(){return this.im}set clickCount(e){this.im=e}get delta(){return this.em}set delta(e){this.em=e}get isMultiTouch(){return this.sm}set isMultiTouch(e){this.sm=e}get handled(){return this.nm}set handled(e){this.nm=e}get bubbles(){return this.No}set bubbles(e){this.No=e}get event(){return this.om}set event(e){this.om=e}get isTouchEvent(){const e=this.event;return e===null?!1:e.pointerType==="touch"||e.pointerType==="pen"}get timestamp(){return this.rm}set timestamp(e){this.rm=e}get targetDiagram(){return this.lm}set targetDiagram(e){this.lm=e}get targetObject(){return this.ke}set targetObject(e){this.ke=e}get control(){return(this.modifiers&1)!==0}set control(e){this.modifiers=e?this.modifiers|1:this.modifiers&-2}get shift(){return(this.modifiers&4)!==0}set shift(e){this.modifiers=e?this.modifiers|4:this.modifiers&-5}get alt(){return(this.modifiers&2)!==0}set alt(e){this.modifiers=e?this.modifiers|2:this.modifiers&-3}get meta(){return(this.modifiers&8)!==0}set meta(e){this.modifiers=e?this.modifiers|8:this.modifiers&-9}get left(){const e=this.event;return e!==null&&(e.type==="mousedown"||e.type==="mouseup"||e.type==="pointerdown"||e.type==="pointerup")?this.button===0:(this.buttons&1)!==0}set left(e){e?this.buttons|=1:this.buttons&=-2}get right(){const e=this.event;return e!==null&&(e.type==="mousedown"||e.type==="mouseup"||e.type==="pointerdown"||e.type==="pointerup")?this.button===2:(this.buttons&2)!==0}set right(e){e?this.buttons|=2:this.buttons&=-3}get middle(){const e=this.event;return e!==null&&(e.type==="mousedown"||e.type==="mouseup"||e.type==="pointerdown"||e.type==="pointerup")?this.button===1:(this.buttons&4)!==0}set middle(e){e?this.buttons|=4:this.buttons&=-5}get commandKey(){const e=this.code,t=this.key;return"cxvyzagCXVYZAG".includes(t)?t.toLowerCase():e==="KeyC"?"c":e==="KeyX"?"x":e==="KeyV"?"v":e==="KeyY"?"y":e==="KeyZ"?"z":e==="KeyA"?"a":e==="KeyG"?"g":e!==""?e:t}}class Ki{constructor(){f(this,"p");f(this,"Mt");f(this,"hm");f(this,"am");this.p=null,this.Mt="",this.hm=null,this.am=null}copy(){const e=new Ki;return e.p=this.p,e.Mt=this.Mt,e.hm=this.hm,e.am=this.am,e}toString(){let e="*"+this.name;return this.subject!==null&&(e+=":"+this.subject.toString()),this.parameter!==null&&(e+="("+this.parameter.toString()+")"),e}get diagram(){return this.p}set diagram(e){this.p=e}get name(){return this.Mt}set name(e){this.Mt=e}get subject(){return this.hm}set subject(e){this.hm=e}get parameter(){return this.am}set parameter(e){this.am=e}}var Qi=(v=>(v[v.Transaction=1]="Transaction",v[v.Property=2]="Property",v[v.Insert=3]="Insert",v[v.Remove=4]="Remove",v))(Qi||{});const Ii=class Ii{constructor(){f(this,"uu");f(this,"cm");f(this,"an");f(this,"Si");f(this,"p");f(this,"du");f(this,"rc");f(this,"lc");f(this,"hc");f(this,"ac");this.uu=2,this.cm="",this.an="",this.Si=null,this.p=null,this.du=null,this.rc=null,this.lc=null,this.hc=null,this.ac=null}clear(){this.Si=null,this.p=null,this.du=null,this.rc=null,this.lc=null,this.hc=null,this.ac=null}copy(){const e=new Ii;e.uu=this.uu,e.cm=this.cm,e.an=this.an,e.Si=this.Si,e.p=this.p,e.du=this.du;let t=this.rc;return b.wt(t)&&typeof t.copyFrozen=="function"?e.rc=t.copyFrozen():e.rc=t,t=this.lc,b.wt(t)&&typeof t.copyFrozen=="function"?e.lc=t.copyFrozen():e.lc=t,t=this.hc,b.wt(t)&&typeof t.copyFrozen=="function"?e.hc=t.copyFrozen():e.hc=t,t=this.ac,b.wt(t)&&typeof t.copyFrozen=="function"?e.ac=t.copyFrozen():e.ac=t,e}ri(e){e in Qi?this.change=e:b.lr(this,e)}toString(){let e="";return this.change===1?e+="* ":this.change===2?e+=this.model!==null?"!m":"!d":e+=(this.model!==null?"!m":"!d")+this.change,this.propertyName&&typeof this.propertyName=="string"&&(e+=" "+this.propertyName),this.modelChange&&this.modelChange!==this.propertyName&&(e+=" "+this.modelChange),e+=": ",this.change===1?this.oldValue!==null&&(e+=" "+this.oldValue):(this.object!==null&&(e+=b.toString(this.object)),this.oldValue!==null&&(e+="  old: "+b.toString(this.oldValue)),this.oldParam!==null&&(e+=" "+this.oldParam),this.newValue!==null&&(e+="  new: "+b.toString(this.newValue)),this.newParam!==null&&(e+=" "+this.newParam)),e}getValue(e){return e?this.oldValue:this.newValue}getParam(e){return e?this.oldParam:this.newParam}canUndo(){return this.model!==null||this.diagram!==null}undo(){this.canUndo()&&(this.model!==null?this.model.changeState(this,!0):this.diagram!==null&&this.diagram.PC(this,!0))}canRedo(){return this.model!==null||this.diagram!==null}redo(){this.canRedo()&&(this.model!==null?this.model.changeState(this,!1):this.diagram!==null&&this.diagram.PC(this,!1))}get model(){return this.Si}set model(e){this.Si=e}get diagram(){return this.p}set diagram(e){this.p=e}get change(){return this.uu}set change(e){this.uu=e}get modelChange(){return this.cm}set modelChange(e){this.cm=e}get propertyName(){return this.an}set propertyName(e){this.an=e}get isTransactionFinished(){return this.uu===1&&(this.an==="CommittedTransaction"||this.an==="FinishedUndo"||this.an==="FinishedRedo")}get object(){return this.du}set object(e){this.du=e}get oldValue(){return this.rc}set oldValue(e){this.rc=e}get oldParam(){return this.lc}set oldParam(e){this.lc=e}get newValue(){return this.hc}set newValue(e){this.hc=e}get newParam(){return this.ac}set newParam(e){this.ac=e}};f(Ii,"Transaction",1),f(Ii,"Property",2),f(Ii,"Insert",3),f(Ii,"Remove",4);let ci=Ii;class pe{constructor(){f(this,"SC");f(this,"Mt");f(this,"Kk");this.SC=new J().g(),this.Mt="",this.Kk=!1}toString(e){let t="Transaction: "+this.name+" "+this.changes.count.toString()+(this.isComplete?"":", incomplete");if(e!==void 0&&e>0){const i=this.changes.count;for(let s=0;s<i;s++){const n=this.changes.elt(s);n!==null&&(t+=`
  `+n.toString())}}return t}clear(){const e=this.changes;e.ot();for(let t=e.count-1;t>=0;t--){const i=e.elt(t);i!==null&&i.clear()}e.clear(),e.g()}canUndo(){return this.isComplete}undo(){if(this.canUndo())for(let e=this.changes.count-1;e>=0;e--){const t=this.changes.elt(e);t!==null&&t.undo()}}canRedo(){return this.isComplete}redo(){if(!this.canRedo())return;const e=this.changes.count;for(let t=0;t<e;t++){const i=this.changes.elt(t);i!==null&&i.redo()}}GD(e){const t=this.changes;for(let i=t.count-1;i>=e;i--){const s=t.elt(i);s!==null&&s.undo(),t.ot(),t.removeAt(i)}t.g()}optimize(){if(!this.isComplete)return;const e=this.changes;e.ot();const t=new St;for(let s=0;s<e.count;s++){const n=e.elt(s);if(n===null||n.change!==2||!n.object)continue;let o=t.get(n.object);o||(o=new St,t.set(n.object,o));const r=o.get(n.propertyName);r===null?o.set(n.propertyName,-1):(r>0&&e.setElt(r,null),o.set(n.propertyName,s))}let i=0;for(let s=0;s<e.count;s++){const n=e.elt(s);n!==null&&(s>i&&e.setElt(i,n),i++)}for(;e.length>i;)e.pop();e.g()}get changes(){return this.SC}get name(){return this.Mt}set name(e){this.Mt=e}get isComplete(){return this.Kk}set isComplete(e){this.Kk=e}}class Li{constructor(e){f(this,"Tw");f(this,"Oi");f(this,"MC");f(this,"vs");f(this,"Yk");f(this,"fm");f(this,"Yn");f(this,"Gk");f(this,"jk");f(this,"cn");f(this,"cc");f(this,"Dw");f(this,"Os");f(this,"Fw");f(this,"Rw");f(this,"um");f(this,"vw");this.Tw=new K,this.Oi=!1,this.MC=new J().g(),this.vs=-1,this.Yk=999,this.Os=!1,this.fm=null,this.Yn=0,this.Gk=!1,this.jk=23,this.cn=new J().g(),this.cc=new J,this.Dw=!0,this.Fw=!1,this.Rw=!1,this.um=!1,this.vw=!1,e&&Object.assign(this,e)}toString(e){let t="UndoManager "+this.historyIndex+"<"+this.history.count+"<="+this.maxHistoryLength;t+="[";let i=this.nestedTransactionNames.count;for(let s=0;s<i;s++)s>0&&(t+=" "),t+=this.nestedTransactionNames.elt(s);if(t+="]",e!==void 0&&e>0){i=this.history.count;for(let s=0;s<i;s++)t+=`
 `+this.history.elt(s).toString(e-1)}return t}clear(){const e=this.history;e.ot();for(let t=e.count-1;t>=0;t--){const i=e.elt(t);i!==null&&i.clear()}e.clear(),this.vs=-1,e.g(),this.Os=!1,this.fm=null,this.Yn=0,this.cn.ot(),this.cn.clear(),this.cn.g(),this.cc.clear(),this.Fw=!1,this.Rw=!1,this.um=!1,this.vw=!1}copyProperties(e){this.isEnabled=e.isEnabled,this.maxHistoryLength=e.maxHistoryLength,this.dm=e.dm}addModel(e){this.Tw.add(e)}removeModel(e){this.Tw.delete(e)}startTransaction(e){if(e===void 0&&(e=""),e===null&&(e=""),this.isUndoingRedoing)return!1;this.Dw===!0&&(this.Dw=!1,this.Yn++,this.xl||this.t("StartingFirstTransaction",e,this.currentTransaction),this.Yn>0&&this.Yn--),this.isEnabled&&(this.cn.ot(),this.cn.add(e),this.cn.g(),this.currentTransaction===null?this.cc.add(0):this.cc.add(this.currentTransaction.changes.count)),this.Yn++;const t=this.transactionLevel===1;return t&&(this.xl||this.t("StartedTransaction",e,this.currentTransaction)),t}commitTransaction(e){return e===void 0&&(e=""),this.NC(!0,e)}rollbackTransaction(){return this.NC(!1,"")}NC(e,t){if(this.isUndoingRedoing)return!1;this.dm&&this.transactionLevel<1&&b.ii("Ending transaction without having started a transaction: "+t);const i=this.transactionLevel===1;let s=this.currentTransaction;i&&e&&(this.xl||this.t("CommittingTransaction",t,s));let n=0;if(this.transactionLevel>0&&(this.Yn--,this.isEnabled)){const o=this.cn.count;o>0&&(t===""&&(t=this.cn.elt(0)),this.cn.ot(),this.cn.removeAt(o-1),this.cn.g());const r=this.cc.count;r>0&&(n=this.cc.elt(r-1),this.cc.removeAt(r-1))}if(i){if(e){if(this.um=!1,s===null&&t!==""&&(s=this.currentTransaction),this.isEnabled&&s!==null){const o=s;o.isComplete||(o.isComplete=!0,o.name=t),this.discardHistoryAfterIndex();const r=this.history;r.ot();const a=this.maxHistoryLength;if(a>=0){if(a===0)r.clear();else if(r.count>=a){const h=r.elt(0);h!==null&&h.clear(),r.removeAt(0),this.vs--}}a!==0&&(r.count===0||r.get(r.count-1)!==o)&&(r.add(o),this.vs++),r.g(),s=o}this.xl||this.t("CommittedTransaction",t,s)}else{this.Os=!0;try{this.isEnabled&&s!==null&&(s.isComplete=!0,s.undo())}finally{this.xl||this.t("RolledBackTransaction",t,s),this.Os=!1}s!==null&&s.clear()}return this.fm=null,this.Ow&&this.clear(),this.Ow=!1,this.Iw=!1,!0}else return this.isEnabled&&!e&&s!==null&&s.GD(n),!1}discardHistoryAfterIndex(){if(this.isUndoingRedoing||!this.canRedo())return;const e=this.history;e.ot();for(let t=e.count-1;t>this.historyIndex;t--){const i=e.elt(t);i!==null&&i.clear(),e.removeAt(t),this.um=!0}e.g()}nE(e){this.Yn+=e,this.Yn<0&&(this.Yn=0)}canUndo(){if(!this.isEnabled||this.transactionLevel>0)return!1;const e=this.transactionToUndo;return!!(e!==null&&e.canUndo())}undo(){if(!this.canUndo())return;const e=this.transactionToUndo;try{this.Os=!0,this.t("StartingUndo","Undo",e),this.vs--,e.undo()}catch(t){b.ii("undo error: "+t.toString())}finally{this.t("FinishedUndo","Undo",e),this.Os=!1}}canRedo(){if(!this.isEnabled||this.transactionLevel>0)return!1;const e=this.transactionToRedo;return!!(e!==null&&e.canRedo())}redo(){if(!this.canRedo())return;const e=this.transactionToRedo;try{this.Os=!0,this.t("StartingRedo","Redo",e),this.vs++,e.redo()}catch(t){b.ii("redo error: "+t.toString())}finally{this.t("FinishedRedo","Redo",e),this.Os=!1}}t(e,t,i){i===void 0&&(i=null);const s=new ci;s.change=1,s.propertyName=e,s.object=i,s.oldValue=t;const n=this.models;for(;n.next();){const o=n.value;s.model=o,o.Ew(s)}}handleChanged(e){if(this.isEnabled&&!this.isUndoingRedoing&&!this.skipsEvent(e)){let t=this.currentTransaction;t===null&&(t=new pe,this.fm=t);const i=e.copy(),s=t.changes;if(s.ot(),s.add(i),s.g(),this.dm&&this.jk>0&&this.transactionLevel<=0&&!this.Dw){const n=e.diagram;if(n!==null&&n.Bh===!1)return;b.ii("Change not within a transaction: "+i.toString()),this.jk--}}}skipsEvent(e){if(e===null||e.change===1)return!0;const t=e.object;if(t===null)return!1;if(t.layer!==void 0){const i=t.layer;if(i!==null&&i.isTemporary)return!0}else if(t.isTemporary)return!0;return!1}get models(){return this.Tw.iterator}get isEnabled(){return this.Oi}set isEnabled(e){this.Oi=e}get transactionToUndo(){return this.historyIndex>=0&&this.historyIndex<=this.history.count-1?this.history.elt(this.historyIndex):null}get transactionToRedo(){return this.historyIndex<this.history.count-1?this.history.elt(this.historyIndex+1):null}get isUndoingRedoing(){return this.Os}get history(){return this.MC}get maxHistoryLength(){return this.Yk}set maxHistoryLength(e){this.Yk=e}get historyIndex(){return this.vs}get currentTransaction(){return this.fm}get transactionLevel(){return this.Yn}get isInTransaction(){return this.Yn>0}get dm(){return this.Gk}set dm(e){this.Gk=e}get nestedTransactionNames(){return this.cn}get Ow(){return this.Fw}set Ow(e){this.Fw=e}get Iw(){return this.Rw}set Iw(e){this.Rw=e}get xl(){return this.vw}set xl(e){this.vw=e}get isJustDiscarded(){return this.um}}class ke{constructor(){f(this,"p");f(this,"Mt");f(this,"Oi");f(this,"Hk");f(this,"qk");f(this,"gm");f(this,"CC");K.Yi(this),this.p=At.mm(),this.Mt="",this.Oi=!0,this.Hk=!1,this.qk=null,this.CC=new ui,this.gm=-1}get diagram(){return this.p}set diagram(e){e instanceof At&&(this.p=e)}toString(){return this.name!==""?this.name+" Tool":b.sn(this.constructor)}updateAdornments(e){}canStart(){return this.isEnabled}doStart(){}doActivate(){this.isActive=!0}doDeactivate(){this.isActive=!1}doStop(){}doCancel(){this.transactionResult=null,this.stopTool()}stopTool(){const e=this.diagram;e.currentTool===this&&(e.currentTool=null,e.currentCursor="")}doMouseDown(){!this.isActive&&this.canStart()&&this.doActivate()}doMouseMove(){}doMouseUp(){this.stopTool()}doMouseWheel(){}canStartMultiTouch(){return!0}standardPinchZoomStart(){const e=this.diagram,t=e.lastInput,i=t.getMultiTouchViewPoint(0,S.X(NaN,NaN)),s=t.getMultiTouchViewPoint(1,S.X(NaN,NaN));if(!i.isReal()||!s.isReal()){S.s(i),S.s(s);return}if(this.doCancel(),e.getInputOption("hasGestureZoom")){e.Wk=e.scale;const n=s.x-i.x,o=s.y-i.y,r=Math.sqrt(n*n+o*o);e.Jk=r,t.bubbles=!1}S.s(i),S.s(s)}standardPinchZoomMove(){const e=this.diagram,t=e.lastInput,i=t.getMultiTouchViewPoint(0,S.X(NaN,NaN)),s=t.getMultiTouchViewPoint(1,S.X(NaN,NaN));if(!i.isReal()||!s.isReal()){S.s(i),S.s(s);return}if(this.doCancel(),e.getInputOption("hasGestureZoom")){const n=s.x-i.x,o=s.y-i.y,r=Math.sqrt(n*n+o*o)/e.Jk,a=new S((Math.min(s.x,i.x)+Math.max(s.x,i.x))/2,(Math.min(s.y,i.y)+Math.max(s.y,i.y))/2),h=e.Wk*r,l=e.commandHandler;if(h!==e.scale&&l.canResetZoom(h)){const u=e.zoomPoint;e.zoomPoint=a,l.resetZoom(h),e.zoomPoint=u}t.bubbles=!1}S.s(i),S.s(s)}doKeyDown(){this.diagram.lastInput.code==="Escape"&&this.doCancel()}doKeyUp(){}startTransaction(e){return e===void 0&&(e=this.name),this.transactionResult=null,this.diagram.startTransaction(e)}stopTransaction(){const e=this.diagram;return this.transactionResult===null?e.rollbackTransaction():e.commitTransaction(this.transactionResult)}standardMouseSelect(){const e=this.diagram;if(!e.allowSelect)return;const t=e.lastInput,i=e.findPartAt(t.documentPoint,!1);if(i!==null){if(b.rr?t.meta:t.control){e.v("ChangingSelection",e.selection);let s=i;for(;s!==null&&!s.canSelect();)s=s.containingGroup;s!==null&&(s.isSelected=!s.isSelected),e.v("ChangedSelection",e.selection)}else if(t.shift){if(!i.isSelected){e.v("ChangingSelection",e.selection);let s=i;for(;s!==null&&!s.canSelect();)s=s.containingGroup;s!==null&&(s.isSelected=!0),e.v("ChangedSelection",e.selection)}}else if(!i.isSelected){let s=i;for(;s!==null&&!s.canSelect();)s=s.containingGroup;s!==null&&e.select(s)}}else t.left&&!(b.rr?t.meta:t.control)&&!t.shift&&e.clearSelection()}standardMouseClick(e,t){e===void 0&&(e=null),t===void 0&&(t=o=>!o.layer.isTemporary);const i=this.diagram,s=i.lastInput,n=i.findObjectAt(s.documentPoint,e,t);return s.targetObject=n,this.jD(n,s,i),s.handled}jD(e,t,i){if(t.handled=!1,e!==null&&!e.isEnabledObject())return;let s=0;t.left?t.clickCount===1?s=1:t.clickCount===2?s=2:s=1:t.right&&t.clickCount===1&&(s=3);let n="ObjectSingleClicked";if(e!==null){switch(s){case 1:n="ObjectSingleClicked";break;case 2:n="ObjectDoubleClicked";break;case 3:n="ObjectContextClicked";break}s!==0&&i.v(n,e)}else{switch(s){case 1:n="BackgroundSingleClicked";break;case 2:n="BackgroundDoubleClicked";break;case 3:n="BackgroundContextClicked";break}s!==0&&i.v(n)}if(e!==null)for(;e!==null;){let o=null;switch(s){case 1:o=e.click;break;case 2:o=e.doubleClick?e.doubleClick:e.click;break;case 3:o=e.contextClick;break}if(o!==null&&(o(t,e),t.handled))break;e=e.panel}else{let o=null;switch(s){case 1:o=i.click;break;case 2:o=i.doubleClick?i.doubleClick:i.click;break;case 3:o=i.contextClick;break}o!==null&&o(t)}}standardMouseOver(){const e=this.diagram,t=e.lastInput;if(e.animationManager.wi===!0)return;const i=e.skipsUndoManager;e.skipsUndoManager=!0;let s=e.viewportBounds.containsPoint(t.documentPoint)?e.findObjectAt(t.documentPoint,null,null):null;t.event&&(t.event.type==="pointercancel"||t.event.type==="pointerout")&&(s=null),t.targetObject=s;let n=!1;if(s!==e.fc){let o=e.fc;const r=o;for(e.fc=s,this.doCurrentObjectChanged(o,s),t.handled=!1;o!==null;){const a=o.mouseLeave;if(a!==null&&(s===o||s!==null&&s.isContainedBy(o)||(a(t,o,s),n=!0,t.handled)))break;o=o.panel}for(o=r,t.handled=!1;s!==null;){const a=s.mouseEnter;if(a!==null&&(o===s||o!==null&&o.isContainedBy(s)||(a(t,s,o),n=!0,t.handled)))break;s=s.panel}s=e.fc}if(s!==null){let o=s,r="";for(;o!==null&&(r=o.cursor,r==="");)o=o.panel;for(e.currentCursor=r,t.handled=!1,o=s;o!==null;){const a=o.mouseOver;if(a!==null&&(a(t,o),n=!0,t.handled))break;o=o.panel}}else{this.doUpdateCursor(null);const o=e.mouseOver;o!==null&&(o(t),n=!0)}n&&e.requestUpdate(),e.skipsUndoManager=i}doUpdateCursor(e){const t=this.diagram;t&&(t.currentCursor="")}doCurrentObjectChanged(e,t){}standardMouseWheel(){const e=this.diagram,t=e.lastInput;let i=t.delta;if(i===0||!e.documentBounds.isReal())return;const s=e.commandHandler,n=e.toolManager.mouseWheelBehavior;if(s!==null&&(n===2&&!t.shift||n===1&&t.control)){if(i>0?s.canIncreaseZoom():s.canDecreaseZoom()){const o=e.zoomPoint;e.zoomPoint=t.viewPoint,i>0?s.increaseZoom():s.decreaseZoom(),e.zoomPoint=o}t.bubbles=!1}else if(n===2&&t.shift||n===1&&!t.control){const o=e.position.copy(),r=t.event,a=r.deltaMode;let h=r.deltaX,l=r.deltaY,u="pixel";if((h!==0||l!==0)&&!t.shift){switch(a){case 0:u="pixel";break;case 1:u="line";break;case 2:u="page";break}if(h!==0&&e.allowHorizontalScroll){const c=e.scrollHorizontalLineChange;h=h*(c/16),e.scroll(u,h>0?"right":"left",Math.abs(h))}if(l!==0&&e.allowVerticalScroll){const c=e.scrollVerticalLineChange;l=l*(c/16),e.scroll(u,l>0?"down":"up",Math.abs(l))}}else!t.shift&&e.allowVerticalScroll?(i=i*3*e.scrollVerticalLineChange,e.scroll(u,i>0?"up":"down",Math.abs(i))):t.shift&&e.allowHorizontalScroll&&(i=i*3*e.scrollHorizontalLineChange,e.scroll(u,i>0?"left":"right",Math.abs(i)));this.doWheelChange(e,o,t)}}doWheelChange(e,t,i){(!e.position.equals(t)||i.event.wheelDeltaX!==0)&&(i.bubbles=!1)}standardWaitAfter(e,t){t===void 0&&(t=this.diagram.lastInput),this.cancelWaitAfter();const i=this,s=t.clone(this.CC);this.gm=b.Oh(()=>i.doWaitAfter(s),e)}cancelWaitAfter(){this.gm!==-1&&b.Og(this.gm),this.gm=-1}doWaitAfter(e){}findToolHandleAt(e,t){const i=this.diagram.findObjectAt(e,s=>{for(;s!==null&&!(s.panel instanceof Mt);)s=s.panel;return s});return i===null?null:i.part.category===t?i:null}isBeyondDragSize(e,t){const i=this.diagram;e===void 0&&(e=i.firstInput.viewPoint),t===void 0&&(t=i.lastInput.viewPoint);const s=i.toolManager.dragSize;let n=s.width,o=s.height;return i.firstInput.isTouchEvent&&(n+=6,o+=6),Math.abs(t.x-e.x)>n||Math.abs(t.y-e.y)>o}get name(){return this.Mt}set name(e){this.Mt=e}get isEnabled(){return this.Oi}set isEnabled(e){this.Oi=e}get isActive(){return this.Hk}set isActive(e){this.Hk=e}get transactionResult(){return this.qk}set transactionResult(e){this.qk=e}}var fs=(v=>(v[v.Scroll=1]="Scroll",v[v.Zoom=2]="Zoom",v[v.None=3]="None",v))(fs||{}),_i=(v=>(v[v.Zoom=1]="Zoom",v[v.Cancel=2]="Cancel",v[v.None=3]="None",v))(_i||{});class Ve extends ke{constructor(t){super();f(this,"LC");f(this,"AC");f(this,"TC");f(this,"$k");f(this,"Zk");f(this,"Qk");f(this,"_k");f(this,"tP");f(this,"iP");f(this,"eP");f(this,"pm");f(this,"Uh");this.name="ToolManager",this.LC=new J,this.AC=new J,this.TC=new J,this.$k=850,this.Zk=850,this.Qk=new ut(2,2).it(),this._k=5e3,this.tP=1,this.iP=1,this.eP=null,this.pm=null,this.Uh=-1,t&&Object.assign(this,t)}get mouseWheelBehavior(){return this.tP}set mouseWheelBehavior(t){this.tP=t}get gestureBehavior(){return this.iP}set gestureBehavior(t){this.iP=t}initializeStandardTools(){}updateAdornments(t){const i=this.currentToolTip;if(i instanceof Mt&&this.pm===t){const s=i.adornedObject;(t!==null?s.part===t:s===null)?this.showToolTip(i,s):this.hideToolTip()}}doMouseDown(){const t=this.diagram,i=t.lastInput;if(i.isTouchEvent&&this.gestureBehavior===2&&(i.bubbles=!1),i.isMultiTouch){if(this.cancelWaitAfter(),this.gestureBehavior===3){i.bubbles=!0;return}if(this.gestureBehavior===2)return;if(t.currentTool.canStartMultiTouch()){t.currentTool.standardPinchZoomStart();return}}t.undoManager;const s=this.mouseDownTools.length;for(let n=0;n<s;n++){const o=this.mouseDownTools.elt(n);if(o.diagram=this.diagram,o.canStart()){t.doFocus(),t.currentTool=o,t.currentTool===o&&(o.isActive||o.doActivate(),o.doMouseDown());return}}t.lastInput.button===1&&(this.mouseWheelBehavior===1?this.mouseWheelBehavior=2:this.mouseWheelBehavior===2&&(this.mouseWheelBehavior=1)),this.doActivate(),this.standardWaitAfter(this.holdDelay,i)}doMouseMove(){const t=this.diagram,i=t.lastInput;if(i.isMultiTouch){if(this.gestureBehavior===3){i.bubbles=!0;return}if(this.gestureBehavior===2)return;if(t.currentTool.canStartMultiTouch()){t.currentTool.standardPinchZoomMove();return}}if(this.isActive){const n=this.mouseMoveTools.length;for(let o=0;o<n;o++){const r=this.mouseMoveTools.elt(o);if(r.diagram=this.diagram,r.canStart()){t.doFocus(),t.currentTool=r,t.currentTool===r&&(r.isActive||r.doActivate(),r.doMouseMove());return}}}this.standardMouseActivity(t);const s=i.event;s!==null&&(s.type==="pointermove"||!s.cancelable)&&(i.bubbles=!0)}standardMouseActivity(t){this.standardMouseOver(),this.isBeyondDragSize()&&this.standardWaitAfter(this.isActive?this.holdDelay:this.hoverDelay,t.lastInput)}doCurrentObjectChanged(t,i){const s=this.currentToolTip;s!==null&&(i!==null&&s instanceof Mt&&(i===s||i.isContainedBy(s))||this.hideToolTip())}doWaitAfter(t){const i=this.diagram;if(i.HD()&&(this.doMouseHover(),this.isActive||this.doToolTip(),t.isTouchEvent&&!i.lastInput.handled)){const s=t.copy();s.button=2,i.lastInput=s,i.Bw=!0,i.doMouseUp();return}}doMouseHover(){const t=this.diagram,i=t.lastInput;i.targetObject===null&&(i.targetObject=t.findObjectAt(i.documentPoint,null,null));let s=i.targetObject;if(s!==null)for(i.handled=!1;s!==null;){const n=this.isActive?s.mouseHold:s.mouseHover;if(n!==null&&(n(i,s),i.handled))break;s=s.panel}else{const n=this.isActive?t.mouseHold:t.mouseHover;n!==null&&n(i)}}doToolTip(){const t=this.diagram,i=t.lastInput;i.targetObject===null&&(i.targetObject=t.findObjectAt(i.documentPoint,null,null));let s=i.targetObject;if(s!==null){const n=this.currentToolTip;if(n instanceof Mt&&(s===n||s.isContainedBy(n)))return;for(;s!==null;){const o=s.toolTip;if(o!==null){this.showToolTip(o,s);return}s=s.panel}this.hideToolTip()}else{const n=t.toolTip;n!==null?this.showToolTip(n,null):this.hideToolTip()}}showToolTip(t,i){const s=this.diagram;if(t!==this.currentToolTip&&this.hideToolTip(),t instanceof Mt){t.layerName="Tool",t.selectable=!1,t.scale=1/s.scale,t.category="ToolTip",t.hasPlaceholder()&&(t.placeholder.scale=s.scale);const o=t.diagram;o!==null&&o!==s&&o.remove(t),s.add(t),i!==null?t.adornedObject=i:t.data=s.model,t.ensureBounds(),this.positionToolTip(t,i)}else t instanceof ti&&t!==this.currentToolTip&&t.show(i,s,this);this.currentToolTip=t,this.Uh!==-1&&(b.Og(this.Uh),this.Uh=-1);const n=this.toolTipDuration;if(n>0&&n!==1/0){const o=this;this.Uh=b.Oh(()=>o.hideToolTip(),n)}}positionToolTip(t,i){if(t.hasPlaceholder())return;const s=t,n=this.diagram,o=n.lastInput.documentPoint.copy(),r=s.measuredBounds,a=n.viewportBounds;n.lastInput.isTouchEvent&&(o.x-=r.width),o.x+r.width>a.right&&(o.x-=r.width+5/n.scale),o.x<a.x&&(o.x=a.x),o.y+20/n.scale+r.height>a.bottom?o.y-=r.height+5/n.scale:o.y+=20/n.scale,o.y<a.y&&(o.y=a.y),s.position=o}hideToolTip(){this.Uh!==-1&&(b.Og(this.Uh),this.Uh=-1);const t=this.diagram,i=this.currentToolTip;i!==null&&(i instanceof Mt?(t.remove(i),this.pm!==null&&this.pm.removeAdornment(i.category),i.data=null,i.adornedObject=null):i instanceof ti&&i.hide!==null&&i.hide(t,this),this.currentToolTip=null)}get currentToolTip(){return this.eP}set currentToolTip(t){this.eP=t,this.pm=t!==null&&t instanceof Mt?t.adornedPart:null}doMouseUp(){this.cancelWaitAfter();const t=this.diagram;if(this.isActive){const i=this.mouseUpTools.length;for(let s=0;s<i;s++){const n=this.mouseUpTools.elt(s);if(n.diagram=this.diagram,n.canStart()){t.doFocus(),t.currentTool=n,t.currentTool===n&&(n.isActive||n.doActivate(),n.doMouseUp());return}}}t.doFocus(),this.doDeactivate()}doMouseWheel(){this.standardMouseWheel()}doKeyDown(){const t=this.diagram;t.commandHandler!==null&&t.commandHandler.doKeyDown()}doKeyUp(){const t=this.diagram;t.commandHandler!==null&&t.commandHandler.doKeyUp()}findTool(t){let i=this.mouseDownTools.length;for(let s=0;s<i;s++){const n=this.mouseDownTools.elt(s);if(n.name===t)return n}i=this.mouseMoveTools.length;for(let s=0;s<i;s++){const n=this.mouseMoveTools.elt(s);if(n.name===t)return n}i=this.mouseUpTools.length;for(let s=0;s<i;s++){const n=this.mouseUpTools.elt(s);if(n.name===t)return n}return null}replaceTool(t,i){i!==null&&(i.diagram=this.diagram);let s=this.mouseDownTools.length;for(let n=0;n<s;n++){const o=this.mouseDownTools.elt(n);if(o.name===t)return i!==null?this.mouseDownTools.setElt(n,i):this.mouseDownTools.removeAt(n),o}s=this.mouseMoveTools.length;for(let n=0;n<s;n++){const o=this.mouseMoveTools.elt(n);if(o.name===t)return i!==null?this.mouseMoveTools.setElt(n,i):this.mouseMoveTools.removeAt(n),o}s=this.mouseUpTools.length;for(let n=0;n<s;n++){const o=this.mouseUpTools.elt(n);if(o.name===t)return i!==null?this.mouseUpTools.setElt(n,i):this.mouseUpTools.removeAt(n),o}return null}replaceStandardTool(t,i,s){this.Jt(t,i,s)}Jt(t,i,s){i!==null&&(i.name=t,i.diagram=this.diagram),this.findTool(t)?this.replaceTool(t,i):i!==null&&s.add(i)}get mouseDownTools(){return this.LC}get mouseMoveTools(){return this.AC}get mouseUpTools(){return this.TC}get hoverDelay(){return this.$k}set hoverDelay(t){this.$k=t}get holdDelay(){return this.Zk}set holdDelay(t){this.Zk=t}get dragSize(){return this.Qk}set dragSize(t){this.Qk=t.N()}get toolTipDuration(){return this._k}set toolTipDuration(t){this._k=t}get actionTool(){return this.findTool("Action")}set actionTool(t){this.Jt("Action",t,this.mouseDownTools)}get relinkingTool(){return this.findTool("Relinking")}set relinkingTool(t){this.Jt("Relinking",t,this.mouseDownTools)}get linkReshapingTool(){return this.findTool("LinkReshaping")}set linkReshapingTool(t){this.Jt("LinkReshaping",t,this.mouseDownTools)}get resizingTool(){return this.findTool("Resizing")}set resizingTool(t){this.Jt("Resizing",t,this.mouseDownTools)}get rotatingTool(){return this.findTool("Rotating")}set rotatingTool(t){this.Jt("Rotating",t,this.mouseDownTools)}get linkingTool(){return this.findTool("Linking")}set linkingTool(t){this.Jt("Linking",t,this.mouseMoveTools)}get draggingTool(){return this.findTool("Dragging")}set draggingTool(t){this.Jt("Dragging",t,this.mouseMoveTools)}get dragSelectingTool(){return this.findTool("DragSelecting")}set dragSelectingTool(t){this.Jt("DragSelecting",t,this.mouseMoveTools)}get panningTool(){return this.findTool("Panning")}set panningTool(t){this.Jt("Panning",t,this.mouseMoveTools)}get contextMenuTool(){return this.findTool("ContextMenu")}set contextMenuTool(t){this.Jt("ContextMenu",t,this.mouseUpTools)}get textEditingTool(){return this.findTool("TextEditing")}set textEditingTool(t){this.Jt("TextEditing",t,this.mouseUpTools)}get clickCreatingTool(){return this.findTool("ClickCreating")}set clickCreatingTool(t){this.Jt("ClickCreating",t,this.mouseUpTools)}get clickSelectingTool(){return this.findTool("ClickSelecting")}set clickSelectingTool(t){this.Jt("ClickSelecting",t,this.mouseUpTools)}}f(Ve,"WheelScroll",1),f(Ve,"WheelZoom",2),f(Ve,"WheelNone",3),f(Ve,"GestureZoom",1),f(Ve,"GestureCancel",2),f(Ve,"GestureNone",3);const Et=class Et extends ke{constructor(t){super();f(this,"sP");f(this,"nP");f(this,"fn");f(this,"oP");f(this,"rP");f(this,"lP");f(this,"hP");f(this,"uc");f(this,"ym");f(this,"aP");f(this,"Vh");f(this,"mr");f(this,"DC");f(this,"cP");f(this,"gu");f(this,"mu");f(this,"fP");f(this,"uP");f(this,"dP");f(this,"gP");this.name="Dragging",this.sP=!0,this.gP=!0,this.nP=!0,this.fn=null,this.oP=null,this.rP=null,this.lP=null,this.hP=!1,this.gu=!1,this.uc=new S(NaN,NaN),this.ym=new S,this.aP=!0,this.Vh=100,this.mr=[],this.DC=new K().g(),this.cP=new gs,this.mu=null,this.fP="copy",this.uP="",this.dP="no-drop",t&&Object.assign(this,t)}get isCopyEnabled(){return this.sP}set isCopyEnabled(t){this.sP=t}get copiesEffectiveCollection(){return this.nP}set copiesEffectiveCollection(t){this.nP=t}get dragOptions(){return this.cP}set dragOptions(t){this.cP=t}get isGridSnapEnabled(){return this.dragOptions.isGridSnapEnabled}set isGridSnapEnabled(t){this.dragOptions.isGridSnapEnabled=t}get isComplexRoutingRealtime(){return this.aP}set isComplexRoutingRealtime(t){this.aP=t;const i=this.diagram.findRouter("AvoidsLinks");i!==null&&(i.isRealtime=t)}get isGridSnapRealtime(){return this.dragOptions.isGridSnapRealtime}set isGridSnapRealtime(t){this.dragOptions.isGridSnapRealtime=t}get gridSnapCellSize(){return this.dragOptions.gridSnapCellSize}set gridSnapCellSize(t){this.dragOptions.gridSnapCellSize.equals(t)||(t=t.N(),this.dragOptions.gridSnapCellSize=t)}get gridSnapCellSpot(){return this.dragOptions.gridSnapCellSpot}set gridSnapCellSpot(t){this.dragOptions.gridSnapCellSpot.equals(t)||(t=t.N(),this.dragOptions.gridSnapCellSpot=t)}get gridSnapOrigin(){return this.dragOptions.gridSnapOrigin}set gridSnapOrigin(t){this.dragOptions.gridSnapOrigin.equals(t)||(t=t.N(),this.dragOptions.gridSnapOrigin=t)}get dragsLink(){return this.dragOptions.dragsLink}set dragsLink(t){this.dragOptions.dragsLink=t}get dragsTree(){return this.dragOptions.dragsTree}set dragsTree(t){this.dragOptions.dragsTree=t}get copyCursor(){return this.fP}set copyCursor(t){this.fP=t}get moveCursor(){return this.uP}set moveCursor(t){this.uP=t}get nodropCursor(){return this.dP}set nodropCursor(t){this.dP=t}get currentPart(){return this.oP}set currentPart(t){this.oP=t}get copiedParts(){return this.lP}set copiedParts(t){this.lP=t}get draggedParts(){return this.rP}set draggedParts(t){this.rP=t}get draggingParts(){return this.copiedParts!==null?this.copiedParts.toKeySet():this.draggedParts!==null?this.draggedParts.toKeySet():this.DC}get draggedLink(){return this.diagram.draggedLink}set draggedLink(t){this.diagram.draggedLink=t}get isDragOutStarted(){return this.hP}set isDragOutStarted(t){this.hP=t}get startPoint(){return this.ym}set startPoint(t){this.ym.equals(t)||this.ym.a(t)}get delay(){return this.Vh}set delay(t){this.Vh=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;if(t===null||t.isReadOnly&&!t.allowDragOut||!t.allowMove&&!t.allowCopy&&!t.allowDragOut||!t.allowSelect)return!1;const i=t.lastInput;return!i.left||t.currentTool!==this&&(!this.isBeyondDragSize()||i.isTouchEvent&&i.timestamp-t.firstInput.timestamp<this.Vh)?!1:this.findDraggablePart()!==null}findDraggablePart(){const t=this.diagram;let i=t.findPartAt(t.firstInput.documentPoint,!1);if(i===null)return null;for(;i!==null&&!i.canSelect();)i=i.containingGroup;return i!==null&&(i.canMove()||i.canCopy())?i:null}standardMouseSelect(){const t=this.diagram;if(!t.allowSelect)return;let i=t.findPartAt(t.firstInput.documentPoint,!1);if(i!==null){for(;i!==null&&!i.canSelect();)i=i.containingGroup;if(this.currentPart=i,this.currentPart!==null&&!this.currentPart.isSelected){t.v("ChangingSelection",t.selection);const s=t.lastInput;!(b.rr?s.meta:s.control)&&!s.shift&&t.clearSelection(!0),this.currentPart.isSelected=!0,t.v("ChangedSelection",t.selection)}}}doActivate(){const t=this.diagram;this.mu=null,this.currentPart===null&&this.standardMouseSelect();const i=this.currentPart;if(i===null||!i.canMove()&&!i.canCopy())return;t.cacheGroupExternalLinks(!0),Et.yt=null,this.isActive=!0,this.uc.set(t.position),this.mP(t.selection),this.mr.length=0,t.animationManager.stopAnimation();const s=this.computeEffectiveCollection(t.selection,this.dragOptions);this.draggedParts=s,this.gP=this.diagram.layout.isRealtime,this.diagram.layout.isRealtime=!1,t.dc=!0,t.getRenderingHint("temporaryPixelRatio")===!0&&t.avgSpf>30&&t.Uw(),t.Vw(this.draggedParts),t.pu=!0,this.startTransaction("Drag"),this.startPoint=t.firstInput.documentPoint,t.isMouseCaptured=!0,t.allowDragOut&&this.qD()}mP(t){if(this.dragsLink){const i=this.diagram;if(!i.allowRelink)return;i.model.gc()&&t.count===1&&t.first()instanceof dt?(this.draggedLink=t.first(),this.draggedLink.canRelinkFrom()&&this.draggedLink.canRelinkTo()&&this.draggedLink.clearAdornments(),this.fn=i.toolManager.findTool("Relinking"),this.fn===null&&(this.fn=new H,this.fn.diagram=i),this.fn.originalLink=this.draggedLink):(this.draggedLink=null,this.fn=null)}}computeEffectiveCollection(t,i){return this.diagram.commandHandler.computeEffectiveCollection(t,i)}Is(t){return t===void 0?new Oi(S.Po):this.isGridSnapEnabled?new Oi(new S(Math.round(t.x*1e3)/1e3,Math.round(t.y*1e3)/1e3)):new Oi(t.copy())}doDeactivate(){this.isActive=!1;const t=this.diagram;this.diagram.layout.isRealtime=this.gP,t.pu=!1,t.bl=!0,t.cacheGroupExternalLinks(!1),t.stopAutoScroll(),this.pP(),t.wm(this.draggedParts),this.mu=null,this.currentPart=null,this.draggedParts=null,this.isDragOutStarted=!1,this.gu=!1,Et.WD(),this.FC(),this.uc.e(NaN,NaN),Et.zh!==null&&(Et.zh.currentCursor=""),Et.zh=null,Et.yt=null,this.kl(),t.isMouseCaptured=!1,t.currentCursor="",t.dc=!1,this.stopTransaction(),t.yP(!0)}stopTransaction(){const t=this.diagram,i=super.stopTransaction();return i&&t.undoManager.transactionToUndo!==null&&t.undoManager.transactionToUndo.optimize(),i}pP(){const t=this.diagram,i=t.skipsUndoManager;t.skipsUndoManager=!0;const s=t.lastInput;this.RC(s,null),t.skipsUndoManager=i,this.mr.length=0}vC(){this.kl(),this.wP();const t=this.diagram;this.uc.isReal()&&(t.position=this.uc),t.stopAutoScroll()}doCancel(){this.kl(),this.wP();const t=this.diagram;this.uc.isReal()&&(t.position=this.uc),this.stopTool()}doKeyDown(){const t=this.diagram,i=t.lastInput;this.isActive&&(i.code==="Escape"?this.doCancel():i.code!==t.previousInput.code&&this.doMouseMove())}doKeyUp(){this.isActive&&this.doMouseMove()}JD(t,i){let s=1/0,n=1/0,o=-1/0,r=-1/0;const a=t.iterator;for(;a.next();){const h=a.value;if(!h.isVisible())continue;const l=h.location,u=l.x,c=l.y;isNaN(u)||isNaN(c)||(u<s&&(s=u),c<n&&(n=c),u>o&&(o=u),c>r&&(r=c))}return s===1/0?i.e(0,0,0,0):i.e(s,n,o-s,r-n),i}xP(t){if(this.copiedParts!==null)return;const i=this.diagram;if(t&&(i.isReadOnly||i.isModelReadOnly)||this.draggedParts===null)return;const s=i.undoManager;s.isEnabled&&s.isInTransaction?s.currentTransaction!==null&&s.currentTransaction.changes.count>0&&(i.undoManager.rollbackTransaction(),i.startTransaction("Drag")):this.wP(),i.skipsUndoManager=!t,i.partManager.addsToTemporaryLayer=!t,this.startPoint=i.firstInput.documentPoint;const n=this.copiesEffectiveCollection?this.draggedParts.toKeySet():i.selection,o=i.copyParts(n,i,!0),r=new St,a=this.draggedParts.iterator;for(;a.next();){const l=a.key;if(l.Pe()&&l.canCopy()){const u=o.get(l);if(u===null)continue;u.location=l.location,u.ensureBounds(),r.set(u,this.Is(u.location))}}const h=o.iterator;for(;h.next();){const l=h.value;l instanceof dt&&l.canCopy()&&r.set(l,this.Is())}if(this.copiedParts=r,this.mP(r.toKeySet()),this.draggedLink!==null){const l=this.draggedLink,u=l.routeBounds;l.pr(this.startPoint.x-(u.x+u.width/2),this.startPoint.y-(u.y+u.height/2))}this.doUpdateCursor(null)}kl(){const t=this.diagram;if(this.copiedParts!==null){if(t.removeParts(this.copiedParts.toKeySet(),!1),this.copiedParts=null,this.draggedParts!==null){const i=this.draggedParts.iterator;for(;i.next();)if(i.key instanceof dt){const s=i.value;s.point=new S(0,0)}}this.doUpdateCursor(null)}t.skipsUndoManager=!1,t.partManager.addsToTemporaryLayer=!1,this.startPoint=t.firstInput.documentPoint}FC(){this.draggedLink!==null&&(this.dragsLink&&this.fn!==null&&(this.fn.stopDraggingMouseMove(),this.fn.originalLink=null),this.draggedLink=null,this.fn=null)}mc(t,i){const s=this.diagram,n=this.startPoint,o=S.l();o.a(s.lastInput.documentPoint),this.moveParts(t,o.subtract(n),i),S.s(o),s.getRenderingHint("temporaryPixelRatio")===!0&&s.Pl===null&&s.avgSpf>30&&(s.Uw(),s.yu())}moveParts(t,i,s){s===void 0&&(s=!1);const n=this.diagram;n!==null&&n.bP(t,i,this.dragOptions,s)}wP(){if(this.draggedParts===null)return;const t=this.diagram;let i=this.draggedParts.iterator;for(;i.next();){const s=i.key;s.Pe()&&(s.location=i.value.point)}for(i=this.draggedParts.iterator;i.next();){const s=i.key;if(s instanceof dt&&s.suspendsRouting){const n=i.value.point;this.draggedParts.set(s,this.Is()),s.pr(-n.x,-n.y)}}t.maybeUpdate()}$D(t){if(t===null)return!0;const i=t.part;return!!(i===null||i instanceof Mt||i.layer.isTemporary||this.draggedParts&&this.draggedParts.has(i)||this.copiedParts&&this.copiedParts.has(i))}kP(t){const i=this.diagram;this.dragsLink&&(this.draggedLink!==null&&(this.draggedLink.fromNode=null,this.draggedLink.toNode=null),this.OC(!1));const s=this.findDragOverObject(t),n=i.lastInput;n.targetObject=s,this.doUpdateCursor(s);const o=i.skipsUndoManager;let r=!1;try{if(i.skipsUndoManager=!0,r=this.RC(n,s),!this.isActive&&Et.yt===null)return;const a=s!==null?s.part:null;if(a===null||i.handlesDragDropForTopLevelParts&&a.isTopLevel&&!(a instanceof at)){const h=i.mouseDragOver;h!==null&&(h(n),r=!0)}if(!this.isActive&&Et.yt===null||(this.doDragOver(t,s),!this.isActive&&Et.yt===null))return}finally{i.skipsUndoManager=o,r&&i.maybeUpdate()}this.mu=s,!i.isReadOnly&&(i.allowMove||i.allowCopy)&&(i.allowHorizontalScroll||i.allowVerticalScroll)&&i.doAutoScroll(n.viewPoint)}findDragOverObject(t){return this.diagram.PP(t,null,i=>!this.$D(i))}doUpdateCursor(t){const i=this.diagram;(t===null||this.mu!==t)&&(!this.diagram.currentTool.isActive||this.mayCopy()?i.currentCursor=this.copyCursor:this.mayMove()?i.currentCursor=this.moveCursor:this.mayDragOut()&&(i.currentCursor=this.nodropCursor))}RC(t,i){let s=!1,n=this.mr.length;const o=n>0?this.mr[0]:null;if(i===o)return!1;t.handled=!1;for(let a=0;a<n;a++){const h=this.mr[a],l=h.mouseDragLeave;if(l!==null&&(l(t,h,i),s=!0,t.handled))break}if(this.mr.length=0,!this.isActive&&Et.yt===null||i===null)return s;t.handled=!1;let r=i;for(;r!==null;)this.mr.push(r),r=this.IC(r);n=this.mr.length;for(let a=0;a<n;a++){const h=this.mr[a],l=h.mouseDragEnter;if(l!==null&&(l(t,h,o),s=!0,t.handled))break}return s}oE(t,i){return t===null?!1:!!(t===i||t.isContainedBy(i)||i instanceof at&&!(t instanceof at)&&i.handlesDragDropForMembers&&t.part.isMemberOf(i))}IC(t){const i=t.panel;if(i!==null)return i;if(t instanceof Bt&&!(t instanceof at)){const s=t.containingGroup;if(s!==null&&s.handlesDragDropForMembers)return s}return null}EC(t,i){const s=this.diagram,n=this.fn;if(n===null)return null;const o=n.portGravity,r=s.findObjectsNear(t,o,u=>n.findValidLinkablePort(u,i)),a=S.l();let h=1/0,l=null;for(const u=r.iterator;u.next();){const c=u.value;if(c.part===null)continue;const d=c.getDocumentPoint(B.Center,a),m=t.distanceSquaredPoint(d);m<h&&(l=c,h=m)}return S.s(a),l}OC(t){const i=this.draggedLink;if(i!==null){if(i.pointsCount<2)return;const s=this.diagram;if(s.isReadOnly)return;const n=this.fn;if(n===null)return;let o=null,r=null;i.fromNode===null&&(o=this.EC(i.getPoint(0),!1),o!==null&&(r=o.part));let a=null,h=null;i.toNode===null&&(a=this.EC(i.getPoint(i.pointsCount-1),!0),a!==null&&(h=a.part)),n.isValidLink(r,o,h,a)?t?(i.defaultFromPoint=i.getPoint(0),i.defaultToPoint=i.getPoint(i.pointsCount-1),i.suspendsRouting=!1,i.fromNode=r,o!==null&&(i.fromPortId=o.portId),i.toNode=h,a!==null&&(i.toPortId=a.portId),i.fromPort!==s.SP&&s.v("LinkRelinked",i,s.SP),i.toPort!==s.MP&&s.v("LinkRelinked",i,s.MP)):n.doDraggingMouseMove(r,o,h,a):n.doDraggingMouseMove(null,null,null,null)}}doDragOver(t,i){}BC(t){const i=this.diagram;this.dragsLink&&this.OC(!0),this.pP();const s=this.findDragOverObject(t),n=i.lastInput;if(n.targetObject=s,s!==null){n.handled=!1;let h=s;for(;h!==null;){const l=h.mouseDrop;if(l!==null&&(l(n,h),n.handled))break;this.ZD(n,h),h=this.IC(h)}}else{const h=i.mouseDrop;h!==null&&h(n)}if(!this.isActive&&Et.yt===null)return;const o=(this.copiedParts||this.draggedParts).iterator;for(;o.next();){const h=o.key;h instanceof nt&&h.linksConnected.each(l=>l.suspendsRouting=!1)}if(this.doDropOnto(t,s),!this.isActive&&Et.yt===null)return;const r=z.l(),a=i.selection.iterator;for(;a.next();){const h=a.value;h instanceof nt&&this.QD(i,h,r)}z.s(r)}ZD(t,i){const s=this.diagram,n=i.part;if(s.handlesDragDropForTopLevelParts&&n.isTopLevel&&!(n instanceof at)){const o=s.mouseDrop;o!==null&&o(t)}}QD(t,i,s){if(!i.canAvoid())return;let n=!1;s=i.getAvoidableRect(s),t.viewportBounds.containsRect(s)&&(n=!0);const o=this.copiedParts||this.draggedParts,r=t.NP(s,h=>h.part,h=>h instanceof dt,!0,h=>h instanceof dt,n);if(r.count===0)return;const a=r.iterator;for(;a.next();){const h=a.value;o.has(h)&&o.has(i)||!h.isMemberOf(i)&&h.isAvoiding&&h.invalidateRoute()}}doDropOnto(t,i){}doMouseMove(){if(!this.isActive)return;const t=this.diagram,i=t.lastInput;this.simulatedMouseMove(i.event,i.documentPoint,i.targetDiagram)||this.currentPart!==null&&this.draggedParts!==null&&(this.mayCopy()?(this.xP(!1),t.Vw(this.copiedParts),this.mc(this.copiedParts,!1),t.wm(this.copiedParts)):this.mayMove()?(this.kl(),this.mc(this.draggedParts,!0)):this.mayDragOut()?(this.xP(!1),this.mc(this.copiedParts,!1)):this.kl(),this.kP(t.lastInput.documentPoint))}doMouseUp(){if(!this.isActive)return;const t=this.diagram,i=t.lastInput;if(this.simulatedMouseUp(i.event,i.documentPoint,i.targetDiagram))return;let s=!1;const n=this.mayCopy();if(n&&this.copiedParts!==null?(this.kl(),this.xP(!0),t.Vw(this.copiedParts),this.mc(this.copiedParts,!1),t.wm(this.copiedParts),this.copiedParts!==null&&(t.v("ChangingSelection",t.selection),t.clearSelection(!0),this.copiedParts.iteratorKeys.each(o=>{o.isSelected=!0}))):(s=!0,this.kl(),this.mayMove()&&(this.mc(this.draggedParts,!0),this.kP(t.lastInput.documentPoint))),this.gu=!0,this.BC(t.lastInput.documentPoint),this.isActive){const o=n?this.copiedParts.toKeySet():this.draggedParts.toKeySet();this.copiedParts=null,s&&this._D(),t.invalidateDocumentBounds(),t.wm(this.draggedParts),this.transactionResult=n?"Copy":"Move",t.v(n?"SelectionCopied":"SelectionMoved",o)}this.stopTool(),n&&t.v("ChangedSelection",t.selection)}simulatedMouseMove(t,i,s){if(Et.yt===null)return!1;const n=Et.yt.diagram;s instanceof At||(s=null);const o=Et.zh;if(s!==o){if(o!==null&&o!==n){o.stopAutoScroll(),Et.yt.isDragOutStarted=!1;const a=o.toolManager.findTool("Dragging");a!==null&&a.doSimulatedDragLeave()}if(Et.zh=s,s!==null&&s!==n){Et.yt.vC();const a=s.toolManager.findTool("Dragging");a!==null&&(a.UC(),a.doSimulatedDragEnter())}this.doUpdateCursor(null)}if(s===null||s===n||!s.allowDrop||s.isReadOnly||!s.allowInsert)return!1;const r=s.toolManager.findTool("Dragging");if(r!==null){let a=i;t!==null&&(t.targetTouches!==void 0&&(t.targetTouches.length>0?t=t.targetTouches[0]:t.changedTouches.length>0&&(t=t.changedTouches[0])),a=s.getMouse(t)),s.lastInput.documentPoint=a,s.lastInput.viewPoint=s.transformDocToView(a),s.lastInput.down=!1,s.lastInput.up=!1,r.doSimulatedDragOver()}return!0}simulatedMouseUp(t,i,s){if(Et.yt===null)return!1;const n=Et.zh,o=Et.yt.diagram;if(s===null)return Et.yt.doCancel(),!0;if(s!==n){const r=n.toolManager.findTool("Dragging");if(n!==null&&n!==o&&r!==null)return n.stopAutoScroll(),Et.yt.isDragOutStarted=!1,r.doSimulatedDragLeave(),!1;Et.zh=s;const a=s.toolManager.findTool("Dragging");a!==null&&(Et.yt.vC(),a.UC(),a.doSimulatedDragEnter())}if(s!==this.diagram){let r=i;t!==null?(t.targetTouches!==void 0&&(t.targetTouches.length>0?t=t.targetTouches[0]:t.changedTouches.length>0&&(t=t.changedTouches[0])),r=s.getMouse(t)):r===null&&(r=new S),s.lastInput.documentPoint=r,s.lastInput.viewPoint=s.transformDocToView(r),s.lastInput.down=!1,s.lastInput.up=!0;const a=s.toolManager.findTool("Dragging");a!==null&&a.doSimulatedDrop();const h=Et.yt;if(h!==null){const l=h.mayCopy();h.transactionResult=l?"Copy":"Move",h.stopTool()}return!0}return!1}_D(){if(this.draggedParts===null)return;const t=this.draggedParts.iterator;for(;t.next();){const i=t.key;if(i instanceof nt){const s=i.containingGroup;s!==null&&s.hasPlaceholder()&&!this.draggedParts.has(s)&&s.placeholder.c()}}}mayCopy(){if(!this.isCopyEnabled)return!1;const t=this.diagram;if(t.isReadOnly||t.isModelReadOnly||!t.allowInsert||!t.allowCopy||!(b.rr?t.lastInput.alt:t.lastInput.control))return!1;const i=t.selection.iterator;for(;i.next();)if(i.value.canCopy())return!0;return!!(this.draggedLink!==null&&this.dragsLink&&this.draggedLink.canCopy())}mayDragOut(){if(!this.isCopyEnabled)return!1;const t=this.diagram;if(!t.allowDragOut||!t.allowCopy||t.allowMove)return!1;const i=t.selection.iterator;for(;i.next();)if(i.value.canCopy())return!0;return!!(this.draggedLink!==null&&this.dragsLink&&this.draggedLink.canCopy())}mayMove(){const t=this.diagram;if(t.isReadOnly||!t.allowMove)return!1;const i=t.selection.iterator;for(;i.next();)if(i.value.canMove())return!0;return!!(this.draggedLink!==null&&this.dragsLink&&this.draggedLink.canMove())}UC(){Et.zw.has(this)||Et.zw.add(this)}static WD(){if(Et.zw.count>0){const t=Et.zw,i=t.length;for(let s=0;s<i;s++){const n=t.elt(s);n.FC(),n.kl(),n.pP(),n.diagram.stopAutoScroll()}t.clear()}}computeBorder(t,i,s){return!this.gu&&this.draggedParts!==null&&!this.draggedParts.has(t)?s.a(i):null}getDraggingSource(){return Et.yt}mayDragIn(){const t=this.diagram;if(!t.allowDrop||t.isReadOnly||t.isModelReadOnly||!t.allowInsert)return!1;const i=Et.yt;return!(i===null||i.diagram.model.dataFormat!==t.model.dataFormat)}doSimulatedDragEnter(){if(!this.mayDragIn())return;const t=this.diagram;t.animationManager.stopAnimation(),t.yr(),t.animationManager.stopAnimation();const i=Et.yt;i!==null&&(this.diagram.dc=!0,t.lastInput.event===null&&(t.lastInput.event=i.diagram.lastInput.event)),this.doUpdateCursor(null)}doSimulatedDragLeave(){const t=Et.yt;t!==null&&t.doSimulatedDragOut(),this.diagram.dc=!1,this.doCancel()}doSimulatedDragOver(){const t=this.diagram;t.animationManager.wu=!0;const i=Et.yt;if(i!==null&&i.draggedParts!==null){if(!this.mayDragIn())return;this.VC(i.draggedParts.toKeySet(),!1,t.firstInput),this.mc(this.copiedParts,!1),this.kP(t.lastInput.documentPoint)}t.animationManager.wu=!1}doSimulatedDrop(){const t=this.diagram,i=Et.yt;if(i!==null){const s=i.diagram;if(i.gu=!0,this.kl(),!this.mayDragIn())return;t.animationManager.wu=!0,t.v("ChangingSelection",t.selection),this.startTransaction("Drop"),this.VC(i.draggedParts.toKeySet(),!0,t.lastInput),this.mc(this.copiedParts,!1);const n=new K;this.copiedParts!==null&&(t.clearSelection(!0),this.copiedParts.iteratorKeys.each(o=>{o.isSelected=!0,n.add(o)})),this.BC(t.lastInput.documentPoint),t.invalidateDocumentBounds(),this.copiedParts!==null&&(this.transactionResult="ExternalCopy"),this.copiedParts=null,t.doFocus(),t.dc=!1,t.v("ExternalObjectsDropped",n,s),this.stopTransaction(),t.v("ChangedSelection",t.selection)}t.animationManager.wu=!1}VC(t,i,s){if(this.copiedParts!==null)return;const n=this.diagram;if(n.isReadOnly||n.isModelReadOnly)return;n.skipsUndoManager=!i,n.partManager.addsToTemporaryLayer=!i,this.startPoint=s.documentPoint;const o=n.copyParts(t,n,!0),r=z.l();this.JD(t,r);const a=r.x+r.width/2,h=r.y+r.height/2;z.s(r);const l=this.ym,u=new St,c=S.l(),d=t.iterator;for(;d.next();){const g=d.value;if(g instanceof dt&&g.canCopy()){const p=o.get(g);if(p===null)continue;p.points=g.points,p.pr(l.x-a,l.y-h),p.suspendsRouting=!0,u.set(p,this.Is())}}const m=t.iterator;for(;m.next();){const g=m.value;if(g.Pe()&&g.canCopy()){const p=o.get(g);if(p===null)continue;const y=g.location;c.e(l.x-(a-y.x),l.y-(h-y.y)),p.location=c,p.ensureBounds(),u.set(p,this.Is(c))}}if(S.s(c),this.copiedParts=u,this.mP(u.toKeySet()),this.draggedLink!==null){const g=this.draggedLink,p=g.routeBounds;g.pr(this.startPoint.x-(p.x+p.width/2),this.startPoint.y-(p.y+p.height/2))}this.doUpdateCursor(null)}qD(){this.isDragOutStarted=!0,this.gu=!1,Et.yt=this,Et.zh=this.diagram,this.doSimulatedDragOut()}doSimulatedDragOut(){const t=this.diagram;t.dc=!1,!this.mayCopy()&&!this.mayMove()?t.currentCursor=this.nodropCursor:t.currentCursor="",this.mu=null}computeMove(t,i,s,n){const o=this.diagram;return o!==null?o.computeMove(t,i,this.dragOptions,n):new S}};f(Et,"zw",new J),f(Et,"yt",null),f(Et,"zh",null);let di=Et;Ve.prototype.doCancel=function(){di.yt!==null&&di.yt.doCancel(),ke.prototype.doCancel.call(this)};class ts extends ke{constructor(){super();f(this,"CP");f(this,"LP");f(this,"Sl");f(this,"AP");f(this,"TP");f(this,"Xh");f(this,"DP");f(this,"Kh");f(this,"FP");f(this,"RP");f(this,"vP");f(this,"OP");f(this,"IP");f(this,"EP");f(this,"zC");f(this,"BP");f(this,"Ml");f(this,"UP");this.CP=100,this.LP=!1,this.Sl="pointer",this.AP=new dt({layerName:"Tool"}).add(new bt({isPanelMain:!0,stroke:"blue"}).theme("stroke","tempLink"),new bt({toArrow:"Standard",fill:"blue",stroke:"blue"}).theme("fill","tempLink").theme("stroke","tempLink")).li(),this.Xh=new bt("Rectangle",{portId:"",fill:null,stroke:"magenta",strokeWidth:2,desiredSize:ut.Dk}).theme("stroke","tempPort"),this.TP=new nt({selectable:!1,layerName:"Tool"}).add(this.Xh).li(),this.Kh=new bt("Rectangle",{portId:"",fill:null,stroke:"magenta",strokeWidth:2,desiredSize:ut.Dk}).theme("stroke","tempPort"),this.DP=new nt({selectable:!1,layerName:"Tool"}).add(this.Kh).li(),this.FP=null,this.RP=null,this.vP=null,this.OP=null,this.IP=null,this.EP=!0,this.zC=new St,this.BP=null,this.Ml=null,this.UP=null}doStop(){this.diagram.stopAutoScroll(),this.originalLink=null,this.originalFromNode=null,this.originalFromPort=null,this.originalToNode=null,this.originalToPort=null,this.validPortsCache.clear(),this.targetPort=null}get portGravity(){return this.CP}set portGravity(t){t>=0&&(this.CP=t)}get isUnconnectedLinkValid(){return this.LP}set isUnconnectedLinkValid(t){this.LP=t}get linkingCursor(){return this.Sl}set linkingCursor(t){this.Sl=t}get temporaryLink(){return this.AP}set temporaryLink(t){t.li(),this.AP=t}get temporaryFromNode(){return this.TP}set temporaryFromNode(t){t.li(),this.TP=t,t&&(this.Xh=t.port)}get temporaryFromPort(){return this.Xh}set temporaryFromPort(t){if(this.Xh!==null){const i=this.Xh.panel;if(i!==null){const s=i.L.indexOf(this.Xh);i.removeAt(s),i.insertAt(s,t)}}this.Xh=t}get temporaryToNode(){return this.DP}set temporaryToNode(t){t.li(),this.DP=t,t&&(this.Kh=t.port)}get temporaryToPort(){return this.Kh}set temporaryToPort(t){if(this.Kh!==null){const i=this.Kh.panel;if(i!==null){const s=i.L.indexOf(this.Kh);i.removeAt(s),i.insertAt(s,t)}}this.Kh=t}get originalLink(){return this.FP}set originalLink(t){this.FP=t}get originalFromNode(){return this.RP}set originalFromNode(t){this.RP=t}get originalFromPort(){return this.vP}set originalFromPort(t){this.vP=t}get originalToNode(){return this.OP}set originalToNode(t){this.OP=t}get originalToPort(){return this.IP}set originalToPort(t){this.IP=t}get isForwards(){return this.EP}set isForwards(t){this.EP=t}get validPortsCache(){return this.zC}get targetPort(){return this.BP}set targetPort(t){this.BP=t}copyPortProperties(t,i,s,n,o){if(t===null||i===null||s===null||n===null)return;const r=i.getDocumentScale(),a=ut.l();a.width=i.naturalBounds.width*r,a.height=i.naturalBounds.height*r,n.desiredSize=a,ut.s(a),o?(n.toSpot=i.toSpot,n.toEndSegmentLength=i.toEndSegmentLength):(n.fromSpot=i.fromSpot,n.fromEndSegmentLength=i.fromEndSegmentLength),s.locationSpot=B.Center;const h=S.l();s.location=i.getDocumentPoint(B.Center,h),S.s(h),n.angle=i.getDocumentAngle(),this.portTargeted!==null&&this.portTargeted(t,i,s,n,o)}setNoTargetPortProperties(t,i,s){i!==null&&(i.desiredSize=ut.Dk,i.fromSpot=B.None,i.toSpot=B.None),t!==null&&(t.location=this.diagram.lastInput.documentPoint),this.portTargeted!==null&&this.portTargeted(null,null,t,i,s)}doMouseDown(){this.isActive&&this.doMouseMove()}doMouseMove(){if(this.isActive){const t=this.diagram;if(this.targetPort=this.findTargetPort(this.isForwards),this.targetPort!==null&&this.targetPort.part instanceof nt){const i=this.targetPort.part;this.isForwards?this.copyPortProperties(i,this.targetPort,this.temporaryToNode,this.temporaryToPort,!0):this.copyPortProperties(i,this.targetPort,this.temporaryFromNode,this.temporaryFromPort,!1)}else this.isForwards?this.setNoTargetPortProperties(this.temporaryToNode,this.temporaryToPort,!0):this.setNoTargetPortProperties(this.temporaryFromNode,this.temporaryFromPort,!1);(t.allowHorizontalScroll||t.allowVerticalScroll)&&t.doAutoScroll(t.lastInput.viewPoint)}}findValidLinkablePort(t,i){if(t===null)return null;const s=t.part;if(!(s instanceof nt))return null;for(;t!==null;){const n=i?t.toLinkable:t.fromLinkable;if(n===!0&&(t.portId!==null||t instanceof nt)&&(i?this.isValidTo(s,t):this.isValidFrom(s,t)))return t;if(n===!1)return null;t=t.panel}return null}findTargetPort(t){const i=this.diagram,s=i.lastInput.documentPoint;let n=this.portGravity;n<=0&&(n=.1);const o=this,r=i.findObjectsNear(s,n,u=>o.findValidLinkablePort(u,t),null,!0);let a=1/0,h=null;const l=r.iterator;for(;l.next();){const u=l.value,c=u.part;if(!(c instanceof nt))continue;const d=u.getDocumentPoint(B.Center,S.l()),m=s.x-d.x,g=s.y-d.y;S.s(d);const p=m*m+g*g;if(p<a){const y=this.validPortsCache.get(u);y!==null?y&&(h=u,a=p):t&&this.isValidLink(this.originalFromNode,this.originalFromPort,c,u)||!t&&this.isValidLink(c,u,this.originalToNode,this.originalToPort)?(this.validPortsCache.set(u,!0),h=u,a=p):this.validPortsCache.set(u,!1)}}if(h!==null){const u=h.part;if(u instanceof nt&&(u.layer===null||u.layer.allowLink))return h}return null}isValidFrom(t,i){if(t===null||i===null)return this.isUnconnectedLinkValid;if(this.diagram.currentTool===this&&(t.layer!==null&&!t.layer.allowLink||i.fromLinkable!==!0))return!1;const s=i.fromMaxLinks;if(s<1/0){if(this.originalLink!==null&&t===this.originalFromNode&&i===this.originalFromPort)return!0;let n=i.portId;if(n===null&&(n=""),t.findLinksOutOf(n).count>=s)return!1}return!0}isValidTo(t,i){if(t===null||i===null)return this.isUnconnectedLinkValid;if(this.diagram.currentTool===this&&(t.layer!==null&&!t.layer.allowLink||i.toLinkable!==!0))return!1;const s=i.toMaxLinks;if(s<1/0){if(this.originalLink!==null&&t===this.originalToNode&&i===this.originalToPort)return!0;let n=i.portId;if(n===null&&(n=""),t.findLinksInto(n).count>=s)return!1}return!0}isInSameNode(t,i){if(t===null||i===null)return!1;if(t===i)return!0;const s=t.part,n=i.part;return s!==null&&s===n}isLinked(t,i){if(t===null||i===null)return!1;const s=t.part;if(!(s instanceof nt))return!1;let n=t.portId;n===null&&(n="");const o=i.part;if(!(o instanceof nt))return!1;let r=i.portId;r===null&&(r="");const a=o.findLinksInto(r);for(;a.next();){const h=a.value;if(h.fromNode===s&&h.fromPortId===n)return!0}return!1}isValidLink(t,i,s,n){if(!this.isValidFrom(t,i)||!this.isValidTo(s,n)||i!==null&&n!==null&&(!(i.fromLinkableSelfNode&&n.toLinkableSelfNode)&&this.isInSameNode(i,n)||!(i.fromLinkableDuplicates&&n.toLinkableDuplicates)&&this.isLinked(i,n))||this.originalLink!==null&&(t!==null&&this.isLabelDependentOnLink(t,this.originalLink)||s!==null&&this.isLabelDependentOnLink(s,this.originalLink))||t!==null&&s!==null&&(t.data===null&&s.data!==null||t.data!==null&&s.data===null)||!this.isValidCycle(t,s,this.originalLink))return!1;let o;return t!==null&&(o=t.linkValidation,o!==null&&!o(t,i,s,n,this.originalLink))||s!==null&&(o=s.linkValidation,o!==null&&!o(t,i,s,n,this.originalLink))?!1:(o=this.linkValidation,o!==null?o(t,i,s,n,this.originalLink):!0)}isLabelDependentOnLink(t,i){if(t===null)return!1;const s=t.labeledLink;if(s===null)return!1;if(s===i)return!0;const n=new K;return n.add(t),this.VP(s,i,n)}VP(t,i,s){if(t===i)return!0;const n=t.fromNode;if(n!==null&&n.isLinkLabel&&(s.add(n),this.VP(n.labeledLink,i,s)))return!0;const o=t.toNode;return!!(o!==null&&o.isLinkLabel&&(s.add(o),this.VP(o.labeledLink,i,s)))}isValidCycle(t,i,s){if(s===void 0&&(s=null),t===null||i===null)return this.isUnconnectedLinkValid;const n=this.diagram;let o=1;if(n&&(n.model.pc()?o=n.isTreePathToChildren?5:6:o=n.validCycle),o===1)return!0;if(o===5){const r=s||this.temporaryLink;if(r!==null&&!r.isTreeLink)return!0;const a=i.linksConnected;for(;a.next();){const h=a.value;if(h!==s&&h.isTreeLink&&h.toNode===i)return!1}return!this.xu(t,i,s,!0)}else if(o===6){const r=s||this.temporaryLink;if(r!==null&&!r.isTreeLink)return!0;const a=t.linksConnected;for(;a.next();){const h=a.value;if(h!==s&&h.isTreeLink&&h.fromNode===t)return!1}return!this.xu(t,i,s,!0)}else{if(o===2)return!this.tF(t,i,s);if(o===3)return!this.xu(t,i,s,!1);if(o===4)return!this.iF(t,i,s)}return!0}xu(t,i,s,n){if(t===i)return!0;if(t===null||i===null)return!1;const o=t.linksConnected;for(;o.next();){const r=o.value;if(r===s||n&&!r.isTreeLink||r.toNode!==t)continue;const a=r.fromNode;if(a!==t&&this.xu(a,i,s,n))return!0}return!1}tF(t,i,s){if(t===i)return!0;const n=new K;return n.add(i),this.XC(n,t,i,s)}XC(t,i,s,n){if(i===s)return!0;if(i===null||s===null||t.has(i))return!1;t.add(i);const o=i.linksConnected;for(;o.next();){const r=o.value;if(r===n||r.toNode!==i)continue;const a=r.fromNode;if(a!==i&&this.XC(t,a,s,n))return!0}return!1}iF(t,i,s){if(t===i)return!0;const n=new K;return n.add(i),this.KC(n,t,i,s)}KC(t,i,s,n){if(i===s)return!0;if(i===null||s===null||t.has(i))return!1;t.add(i);const o=i.linksConnected;for(;o.next();){const r=o.value;if(r===n)continue;const a=r.fromNode,h=r.toNode,l=a===i?h:a;if(l!==i&&this.KC(t,l,s,n))return!0}return!1}get linkValidation(){return this.Ml}set linkValidation(t){this.Ml=t}get portTargeted(){return this.UP}set portTargeted(t){this.UP=t}}var Xe=(v=>(v[v.Either=1]="Either",v[v.ForwardsOnly=2]="ForwardsOnly",v[v.BackwardsOnly=3]="BackwardsOnly",v))(Xe||{});class Ai extends ts{constructor(t){super();f(this,"zP");f(this,"XP");f(this,"S");f(this,"KP");this.name="Linking",this.zP={},this.XP=null,this.S=1,this.KP=null,t&&Object.assign(this,t)}get archetypeLinkData(){return this.zP}set archetypeLinkData(t){this.zP=t}get archetypeLabelNodeData(){return this.XP}set archetypeLabelNodeData(t){this.XP=t}get direction(){return this.S}set direction(t){this.S=t}get startObject(){return this.KP}set startObject(t){this.KP=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return t.isReadOnly||t.isModelReadOnly||!t.allowLink||!t.model.Xw()||!t.lastInput.left||t.currentTool!==this&&!this.isBeyondDragSize()?!1:this.findLinkablePort()!==null}findLinkablePort(){const t=this.diagram;let i=this.startObject;if(i===null&&(i=t.findObjectAt(t.firstInput.documentPoint,null,null)),i===null)return null;const s=i.part;if(!(s instanceof nt))return null;const n=this.direction;if(n===1||n===2){const o=this.findValidLinkablePort(i,!1);if(o!==null)return this.isForwards=!0,o;if(this.startObject===s){const r=s.port;if(this.findValidLinkablePort(r,!1))return this.isForwards=!0,r}}if(n===1||n===3){const o=this.findValidLinkablePort(i,!0);if(o!==null)return this.isForwards=!1,o;if(this.startObject===s){const r=s.port;if(this.findValidLinkablePort(r,!0))return this.isForwards=!1,r}}return null}doActivate(){const t=this.diagram,i=this.findLinkablePort();if(i===null){this.stopTool();return}if(this.startTransaction(this.name),t.isMouseCaptured=!0,t.currentCursor=this.linkingCursor,this.isForwards){this.temporaryToNode!==null&&(this.temporaryToNode.location=t.lastInput.documentPoint),this.originalFromPort=i;const s=this.originalFromPort.part;s instanceof nt&&(this.originalFromNode=s),this.copyPortProperties(this.originalFromNode,this.originalFromPort,this.temporaryFromNode,this.temporaryFromPort,!1)}else{this.temporaryFromNode!==null&&(this.temporaryFromNode.location=t.lastInput.documentPoint),this.originalToPort=i;const s=this.originalToPort.part;s instanceof nt&&(this.originalToNode=s),this.copyPortProperties(this.originalToNode,this.originalToPort,this.temporaryToNode,this.temporaryToPort,!0)}t.add(this.temporaryFromNode),this.temporaryFromNode&&this.temporaryFromNode.ensureBounds(),t.add(this.temporaryToNode),this.temporaryToNode&&this.temporaryToNode.ensureBounds(),this.temporaryLink!==null&&(this.temporaryFromNode!==null&&(this.temporaryLink.fromNode=this.temporaryFromNode),this.temporaryToNode!==null&&(this.temporaryLink.toNode=this.temporaryToNode),this.temporaryLink.isTreeLink=this.isNewTreeLink(),this.temporaryLink.invalidateRoute(),t.add(this.temporaryLink)),this.isActive=!0}doDeactivate(){this.isActive=!1;const t=this.diagram;t.remove(this.temporaryLink),t.remove(this.temporaryFromNode),t.remove(this.temporaryToNode),t.isMouseCaptured=!1,t.currentCursor="",this.stopTransaction()}doStop(){super.doStop(),this.startObject=null}doMouseUp(){if(this.isActive){const t=this.diagram;this.transactionResult=null;let i=null,s=null,n=null,o=null,r=null;try{this.targetPort=this.findTargetPort(this.isForwards);const a=this.targetPort;if(a!==null){const h=a.part;h instanceof nt&&(this.isForwards?(this.originalFromNode!==null&&(i=this.originalFromNode,s=this.originalFromPort),n=h,o=a):(i=h,s=a,this.originalToNode!==null&&(n=this.originalToNode,o=this.originalToPort)))}else this.isForwards?this.originalFromNode!==null&&this.isUnconnectedLinkValid&&(i=this.originalFromNode,s=this.originalFromPort):this.originalToNode!==null&&this.isUnconnectedLinkValid&&(n=this.originalToNode,o=this.originalToPort);i!==null||n!==null?(r=this.insertLink(i,s,n,o),r!==null?(a===null&&(this.isForwards?r.defaultToPoint=t.lastInput.documentPoint:r.defaultFromPoint=t.lastInput.documentPoint),t.allowSelect&&(t.v("ChangingSelection",t.selection),t.clearSelection(!0),r.isSelected=!0),this.transactionResult=this.name,t.v("LinkDrawn",r)):this.doNoLink(i,s,n,o)):this.isForwards?this.doNoLink(this.originalFromNode,this.originalFromPort,null,null):this.doNoLink(null,null,this.originalToNode,this.originalToPort)}finally{this.stopTool(),r&&t.allowSelect&&t.v("ChangedSelection",t.selection)}}}isNewTreeLink(){const t=this.archetypeLinkData;if(t===null)return!0;if(t instanceof dt)return t.isTreeLink;const i=this.diagram;if(i===null)return!0;const s=i.partManager.getLinkCategoryForData(t),n=i.partManager.findLinkTemplateForCategory(s);return n!==null?n.isTreeLink:!0}insertLink(t,i,s,n){return this.diagram.partManager.insertLink(t,i,s,n)}doNoLink(t,i,s,n){}}f(Ai,"Either",1),f(Ai,"ForwardsOnly",2),f(Ai,"BackwardsOnly",3);class H extends ts{constructor(t){super();f(this,"YP");f(this,"GP");f(this,"fs");f(this,"jP");this.name="Relinking",this.YP=new bt("Diamond",{desiredSize:ut.lu,fill:"lightblue",stroke:"dodgerblue",cursor:this.linkingCursor,segmentIndex:0}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.GP=new bt("Diamond",{desiredSize:ut.lu,fill:"lightblue",stroke:"dodgerblue",cursor:this.linkingCursor,segmentIndex:-1}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.fs=null,this.jP=new z,t&&Object.assign(this,t)}updateAdornments(t){if(t===null||!(t instanceof dt))return;let i="RelinkFrom",s=null;if(t.isSelected&&!this.diagram.isReadOnly){const n=t.selectionObject;n!==null&&t.canRelinkFrom()&&t.actualBounds.isReal()&&t.isVisible()&&n.actualBounds.isReal()&&n.isVisibleObject()&&(s=t.findAdornment(i),s===null&&(s=this.makeAdornment(n,!1),t.addAdornment(i,s)))}if(s===null&&t.removeAdornment(i),i="RelinkTo",s=null,t.isSelected&&!this.diagram.isReadOnly){const n=t.selectionObject;n!==null&&t.canRelinkTo()&&t.actualBounds.isReal()&&t.isVisible()&&n.actualBounds.isReal()&&n.isVisibleObject()&&(s=t.findAdornment(i),s===null?(s=this.makeAdornment(n,!0),t.addAdornment(i,s)):s.c())}s===null&&t.removeAdornment(i)}makeAdornment(t,i){const s=new Mt;s.type=ct.Link;const n=i?this.toHandleArchetype:this.fromHandleArchetype;return n!==null&&s.add(n.copy().xm()),s.adornedObject=t,s}get fromHandleArchetype(){return this.YP}set fromHandleArchetype(t){this.YP=t}get toHandleArchetype(){return this.GP}set toHandleArchetype(t){this.GP=t}get handle(){return this.fs}set handle(t){if(t!==null&&!(t.part instanceof Mt))throw new Error("new handle is not in an Adornment: "+t);this.fs=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;if(t.isReadOnly||t.isModelReadOnly||!t.allowRelink||!t.model.Xw()||!t.lastInput.left)return!1;let i=this.findToolHandleAt(t.firstInput.documentPoint,"RelinkFrom");return i===null&&(i=this.findToolHandleAt(t.firstInput.documentPoint,"RelinkTo")),i!==null}doActivate(){const t=this.diagram;if(this.originalLink===null){let i=this.handle;if(i===null&&(i=this.findToolHandleAt(t.firstInput.documentPoint,"RelinkFrom"),i===null&&(i=this.findToolHandleAt(t.firstInput.documentPoint,"RelinkTo"))),i===null)return;const s=i.part;if(!(s instanceof Mt)||!(s.adornedPart instanceof dt))return;this.handle=i,this.isForwards=s===null||s.category==="RelinkTo",this.originalLink=s.adornedPart}this.startTransaction(this.name),t.isMouseCaptured=!0,t.currentCursor=this.linkingCursor,this.originalFromPort=this.originalLink.fromPort,this.originalFromNode=this.originalLink.fromNode,this.originalToPort=this.originalLink.toPort,this.originalToNode=this.originalLink.toNode,this.jP.set(this.originalLink.actualBounds),this.originalLink!==null&&this.originalLink.pointsCount>0&&(this.originalLink.fromNode===null&&(this.temporaryFromPort!==null&&(this.temporaryFromPort.desiredSize=ut.ru),this.temporaryFromNode!==null&&(this.temporaryFromNode.location=this.originalLink.getPoint(0))),this.originalLink.toNode===null&&(this.temporaryToPort!==null&&(this.temporaryToPort.desiredSize=ut.ru),this.temporaryToNode!==null&&(this.temporaryToNode.location=this.originalLink.getPoint(this.originalLink.pointsCount-1)))),this.copyPortProperties(this.originalFromNode,this.originalFromPort,this.temporaryFromNode,this.temporaryFromPort,!1),this.copyPortProperties(this.originalToNode,this.originalToPort,this.temporaryToNode,this.temporaryToPort,!0),t.add(this.temporaryFromNode),t.add(this.temporaryToNode),this.temporaryLink!==null&&(this.temporaryFromNode!==null&&(this.temporaryLink.fromNode=this.temporaryFromNode),this.temporaryToNode!==null&&(this.temporaryLink.toNode=this.temporaryToNode),this.copyLinkProperties(this.originalLink,this.temporaryLink),this.temporaryLink.invalidateRoute(),t.add(this.temporaryLink)),this.isActive=!0}copyLinkProperties(t,i){if(t===null||i===null)return;i.adjusting=t.adjusting,i.corner=t.corner;let s=t.curve;(s===11||s===10)&&(s=0),i.curve=s,i.curviness=t.curviness,i.isTreeLink=t.isTreeLink,i.points=t.points,i.routing=t.routing,i.smoothness=t.smoothness,i.fromSpot=t.fromSpot,i.fromEndSegmentLength=t.fromEndSegmentLength,i.fromShortLength=t.fromShortLength,i.toSpot=t.toSpot,i.toEndSegmentLength=t.toEndSegmentLength,i.toShortLength=t.toShortLength}doDeactivate(){this.isActive=!1;const t=this.diagram;t.remove(this.temporaryLink),t.remove(this.temporaryFromNode),t.remove(this.temporaryToNode),t.isMouseCaptured=!1,t.currentCursor="",this.stopTransaction()}doStop(){super.doStop(),this.handle=null}doMouseUp(){if(this.isActive){const t=this.diagram;this.transactionResult=null;let i=this.originalFromNode,s=this.originalFromPort,n=this.originalToNode,o=this.originalToPort,r=this.originalLink;try{if(this.targetPort=this.findTargetPort(this.isForwards),this.targetPort!==null){const a=this.targetPort.part;a instanceof nt&&(this.isForwards?(n=a,o=this.targetPort):(i=a,s=this.targetPort))}else this.isUnconnectedLinkValid?this.isForwards?(n=null,o=null):(i=null,s=null):r=null;r!==null?(this.reconnectLink(r,this.isForwards?n:i,this.isForwards?o:s,this.isForwards),this.targetPort===null&&(this.isForwards?r.defaultToPoint=t.lastInput.documentPoint:r.defaultFromPoint=t.lastInput.documentPoint,r.invalidateRoute()),this.transactionResult=this.name,t.v("LinkRelinked",r,this.isForwards?this.originalToPort:this.originalFromPort)):this.doNoRelink(this.originalLink,this.isForwards),this.originalLink.invalidateOtherJumpOvers(this.jP)}finally{this.stopTool()}}}reconnectLink(t,i,s,n){const o=s!==null&&s.portId!==null?s.portId:"";return n?(t.toNode=i,t.toPortId=o):(t.fromNode=i,t.fromPortId=o),!0}doNoRelink(t,i){}doDraggingMouseMove(t,i,s,n){t!==null?(this.copyPortProperties(t,i,this.temporaryFromNode,this.temporaryFromPort,!1),this.diagram.add(this.temporaryFromNode)):this.diagram.remove(this.temporaryFromNode),s!==null?(this.copyPortProperties(s,n,this.temporaryToNode,this.temporaryToPort,!0),this.diagram.add(this.temporaryToNode)):this.diagram.remove(this.temporaryToNode)}stopDraggingMouseMove(){this.diagram.remove(this.temporaryFromNode),this.diagram.remove(this.temporaryToNode)}}var ht=(v=>(v[v.None=0]="None",v[v.Horizontal=1]="Horizontal",v[v.Vertical=2]="Vertical",v[v.All=3]="All",v))(ht||{});class rt extends ke{constructor(t){super();f(this,"Co");f(this,"HP");f(this,"qP");f(this,"fs");f(this,"Kw");f(this,"WP");f(this,"bm");this.name="LinkReshaping",this.Co=new bt("Rectangle",{desiredSize:ut._N,fill:"lightblue",stroke:"dodgerblue"}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.HP=new bt("Diamond",{desiredSize:ut.lu,fill:"lightblue",stroke:"dodgerblue",cursor:"move"}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.qP=3,this.fs=null,this.Kw=null,this.WP=new S,this.bm=new J,t&&Object.assign(this,t)}getReshapingBehavior(t){return t?t.wr:0}setReshapingBehavior(t,i){t.wr=i}updateAdornments(t){if(t===null||!(t instanceof dt))return;let i=null;if(t.isSelected&&!this.diagram.isReadOnly){const s=t.path;s!==null&&t.canReshape()&&t.actualBounds.isReal()&&t.isVisible()&&s.actualBounds.isReal()&&s.isVisibleObject()&&(i=t.findAdornment(this.name),(i===null||i.JP!==t.pointsCount||i.$P!==t.resegmentable)&&(i=this.makeAdornment(s),i!==null&&(i.JP=t.pointsCount,i.$P=t.resegmentable,t.addAdornment(this.name,i))))}i===null&&t.removeAdornment(this.name)}makeAdornment(t){const i=t.part,s=i.points,n=i.pointsCount,o=i.isOrthogonal;let r=null;if(s!==null&&n>1){r=new Mt,r.type=ct.Link;const a=i.firstPickIndex,h=i.lastPickIndex,l=o?1:0;if(i.resegmentable&&i.computeCurve()!==9)for(let u=a+l;u<h-l;u++){const c=this.makeResegmentHandle(t,u);c!==null&&(c.segmentIndex=u,c.segmentFraction=.5,c.fromMaxLinks=999,r.add(c))}for(let u=a+1;u<h;u++){const c=this.makeHandle(t,u);if(c!==null){if(c.segmentIndex=u,u!==a)if(u===a+1&&o){const d=i.getPoint(a);let m=i.getPoint(a+1);A.u(d.x,m.x)&&A.u(d.y,m.y)?(m=i.getPoint(a-1),A.u(d.x,m.x)?(this.setReshapingBehavior(c,2),c.cursor="n-resize"):A.u(d.y,m.y)&&(this.setReshapingBehavior(c,1),c.cursor="w-resize")):A.u(d.x,m.x)?(this.setReshapingBehavior(c,2),c.cursor="n-resize"):A.u(d.y,m.y)&&(this.setReshapingBehavior(c,1),c.cursor="w-resize")}else if(u===h-1&&o){let d=i.getPoint(h-1);const m=i.getPoint(h);A.u(d.x,m.x)&&A.u(d.y,m.y)?(d=i.getPoint(h+1),A.u(d.x,m.x)?(this.setReshapingBehavior(c,2),c.cursor="n-resize"):A.u(d.y,m.y)&&(this.setReshapingBehavior(c,1),c.cursor="w-resize")):A.u(d.x,m.x)?(this.setReshapingBehavior(c,2),c.cursor="n-resize"):A.u(d.y,m.y)&&(this.setReshapingBehavior(c,1),c.cursor="w-resize")}else u===h||(this.setReshapingBehavior(c,3),c.cursor="move");r.add(c)}}r.adornedObject=t}return r}makeHandle(t,i){const s=this.handleArchetype;return s===null?null:s.copy().xm()}get handleArchetype(){return this.Co}set handleArchetype(t){this.Co=t}makeResegmentHandle(t,i){const s=this.midHandleArchetype;return s===null?null:s.copy().xm()}get midHandleArchetype(){return this.HP}set midHandleArchetype(t){this.HP=t}get handle(){return this.fs}set handle(t){if(t!==null&&!(t.part instanceof Mt))throw new Error("new handle is not in an Adornment: "+t);this.fs=t}get adornedLink(){return this.Kw}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return t.isReadOnly||!t.allowReshape||!t.lastInput.left?!1:this.findToolHandleAt(t.firstInput.documentPoint,this.name)!==null}doActivate(){const t=this.diagram;if(this.handle===null&&(this.handle=this.findToolHandleAt(t.firstInput.documentPoint,this.name)),this.handle===null)return;const i=this.handle.part.adornedPart;if(i instanceof dt){if(this.Kw=i,t.isMouseCaptured=!0,this.startTransaction(this.name),i.resegmentable&&this.handle.fromMaxLinks===999){const s=i.points.copy(),n=this.getResegmentingPoint();if(s.insertAt(this.handle.segmentIndex+1,n),i.isOrthogonal&&s.insertAt(this.handle.segmentIndex+1,n),i.points=s,i.invalidateAdornments(),i.updateAdornments(),this.handle=this.findToolHandleAt(t.firstInput.documentPoint,this.name),this.handle===null){this.doDeactivate();return}}this.WP=i.getPoint(this.handle.segmentIndex),this.bm=i.points.copy(),this.isActive=!0}}doDeactivate(){this.stopTransaction(),this.handle=null,this.Kw=null;const t=this.diagram;t.isMouseCaptured=!1,this.isActive=!1}stopTransaction(){const t=this.diagram,i=super.stopTransaction();return i&&t.undoManager.transactionToUndo!==null&&t.undoManager.transactionToUndo.optimize(),i}doCancel(){const t=this.adornedLink;t!==null&&(t.points=this.bm),this.stopTool()}getResegmentingPoint(){return this.handle.getDocumentPoint(B.Center)}doMouseMove(){const t=this.diagram;if(this.isActive){const i=this.computeReshape(t.lastInput.documentPoint);this.reshape(i)}}doMouseUp(){const t=this.diagram;if(this.isActive){const i=this.computeReshape(t.lastInput.documentPoint);this.reshape(i);const s=this.adornedLink;if(s!==null&&s.resegmentable){const n=this.handle.segmentIndex,o=s.getPoint(n-1),r=s.getPoint(n),a=s.getPoint(n+1);if(s.isOrthogonal){if(n>s.firstPickIndex+1&&n<s.lastPickIndex-1){let h=s.getPoint(n-2);if(this.isWithinResegmentingDistance(o,r)&&(this.isInLineOrtho(h,o,r,a,!0)||this.isInLineOrtho(h,o,r,a,!1))){const l=s.points.copy();this.isInLineOrtho(h,o,r,a,!0)?(l.setElt(n-2,new S(h.x,(a.y+h.y)/2)),l.setElt(n+1,new S(a.x,(a.y+h.y)/2))):(l.setElt(n-2,new S((a.x+h.x)/2,h.y)),l.setElt(n+1,new S((a.x+h.x)/2,a.y))),l.removeAt(n),l.removeAt(n-1),s.points=l,s.invalidateAdornments()}else if(h=s.getPoint(n+2),this.isWithinResegmentingDistance(r,a)&&(this.isInLineOrtho(o,r,a,h,!0)||this.isInLineOrtho(o,r,a,h,!1))){const l=s.points.copy();this.isInLineOrtho(o,r,a,h,!0)?(l.setElt(n-1,new S(o.x,(o.y+h.y)/2)),l.setElt(n+2,new S(h.x,(o.y+h.y)/2))):(l.setElt(n-1,new S((o.x+h.x)/2,o.y)),l.setElt(n+2,new S((o.x+h.x)/2,h.y))),l.removeAt(n+1),l.removeAt(n),s.points=l,s.invalidateAdornments()}}}else{const h=S.l();if(A.ml(o.x,o.y,a.x,a.y,r.x,r.y,h)&&h.distanceSquaredPoint(r)<this.resegmentingDistance*this.resegmentingDistance){const l=s.points.copy();l.removeAt(n),s.points=l,s.invalidateAdornments()}S.s(h)}}t.invalidateDocumentBounds(),this.transactionResult=this.name,t.v("LinkReshaped",this.adornedLink,this.bm)}this.stopTool()}isWithinResegmentingDistance(t,i){return Math.abs(t.x-i.x)<this.resegmentingDistance&&Math.abs(t.y-i.y)<this.resegmentingDistance}isInLineOrtho(t,i,s,n,o){return o?Math.abs(t.y-i.y)<this.resegmentingDistance&&Math.abs(i.y-s.y)<this.resegmentingDistance&&Math.abs(s.y-n.y)<this.resegmentingDistance:Math.abs(t.x-i.x)<this.resegmentingDistance&&Math.abs(i.x-s.x)<this.resegmentingDistance&&Math.abs(s.x-n.x)<this.resegmentingDistance}get resegmentingDistance(){return this.qP}set resegmentingDistance(t){this.qP=t}reshape(t){const i=this.adornedLink;i.startRoute();let s=this.handle.segmentIndex;const n=this.getReshapingBehavior(this.handle);if(i.isOrthogonal)if(s===i.firstPickIndex+1){const o=i.firstPickIndex+1;n===2?(i.setPointAt(o,i.getPoint(o-1).x,t.y),i.setPointAt(o+1,i.getPoint(o+2).x,t.y)):n===1&&(i.setPointAt(o,t.x,i.getPoint(o-1).y),i.setPointAt(o+1,t.x,i.getPoint(o+2).y))}else if(s===i.lastPickIndex-1){const o=i.lastPickIndex-1;n===2?(i.setPointAt(o-1,i.getPoint(o-2).x,t.y),i.setPointAt(o,i.getPoint(o+1).x,t.y)):n===1&&(i.setPointAt(o-1,t.x,i.getPoint(o-2).y),i.setPointAt(o,t.x,i.getPoint(o+1).y))}else{let o=s;const r=i.getPoint(o),a=i.getPoint(o-1),h=i.getPoint(o+1);A.u(a.x,r.x)&&A.u(r.y,h.y)?(A.u(a.x,i.getPoint(o-2).x)&&!A.u(a.y,i.getPoint(o-2).y)?(i.insertPointAt(o,t.x,a.y),s++,o++):i.setPointAt(o-1,t.x,a.y),A.u(h.y,i.getPoint(o+2).y)&&!A.u(h.x,i.getPoint(o+2).x)?i.insertPointAt(o+1,h.x,t.y):i.setPointAt(o+1,h.x,t.y)):A.u(a.y,r.y)&&A.u(r.x,h.x)?(A.u(a.y,i.getPoint(o-2).y)&&!A.u(a.x,i.getPoint(o-2).x)?(i.insertPointAt(o,a.x,t.y),s++,o++):i.setPointAt(o-1,a.x,t.y),A.u(h.x,i.getPoint(o+2).x)&&!A.u(h.y,i.getPoint(o+2).y)?i.insertPointAt(o+1,t.x,h.y):i.setPointAt(o+1,t.x,h.y)):A.u(a.x,r.x)&&A.u(r.x,h.x)?(A.u(a.x,i.getPoint(o-2).x)&&!A.u(a.y,i.getPoint(o-2).y)?(i.insertPointAt(o,t.x,a.y),s++,o++):i.setPointAt(o-1,t.x,a.y),A.u(h.x,i.getPoint(o+2).x)&&!A.u(h.y,i.getPoint(o+2).y)?i.insertPointAt(o+1,t.x,h.y):i.setPointAt(o+1,t.x,h.y)):A.u(a.y,r.y)&&A.u(r.y,h.y)&&(A.u(a.y,i.getPoint(o-2).y)&&!A.u(a.x,i.getPoint(o-2).x)?(i.insertPointAt(o,a.x,t.y),s++,o++):i.setPointAt(o-1,a.x,t.y),A.u(h.y,i.getPoint(o+2).y)&&!A.u(h.x,i.getPoint(o+2).x)?i.insertPointAt(o+1,h.x,t.y):i.setPointAt(o+1,h.x,t.y)),i.setPointAt(s,t.x,t.y)}else{i.setPointAt(s,t.x,t.y);let o=i.fromNode,r=i.fromPort;if(o!==null){const l=o.findVisibleNode();l!==null&&l!==o&&(o=l,r=o.port)}if(s===1&&i.computeSpot(!0,r).isNoSpot()){const l=r.getDocumentPoint(B.Center,S.l()),u=i.getLinkPointFromPoint(o,r,l,t,!0,S.l());i.setPointAt(0,u.x,u.y),S.s(l),S.s(u)}let a=i.toNode,h=i.toPort;if(a!==null){const l=a.findVisibleNode();l!==null&&l!==a&&(a=l,h=a.port)}if(s===i.pointsCount-2&&i.computeSpot(!1,h).isNoSpot()){const l=h.getDocumentPoint(B.Center,S.l()),u=i.getLinkPointFromPoint(a,h,l,t,!1,S.l());i.setPointAt(i.pointsCount-1,u.x,u.y),S.s(l),S.s(u)}}i.commitRoute()}computeReshape(t){const i=this.adornedLink,s=this.handle.segmentIndex;switch(this.getReshapingBehavior(this.handle)){case 3:return t;case 2:{const n=i.getPoint(s);return new S(n.x,t.y)}case 1:{const n=i.getPoint(s);return new S(t.x,n.y)}default:case 0:return i.getPoint(s)}}get originalPoint(){return this.WP}get originalPoints(){return this.bm}}f(rt,"None",0),f(rt,"Horizontal",1),f(rt,"Vertical",2),f(rt,"All",3);class lt extends ke{constructor(t){super();f(this,"xr");f(this,"br");f(this,"Lo");f(this,"yc");f(this,"ZP");f(this,"us");f(this,"Co");f(this,"fs");f(this,"km");f(this,"QP");f(this,"wc");f(this,"Yw");f(this,"Gw");f(this,"jw");this.name="Resizing",this.xr=new ut(1,1).g(),this.br=new ut(9999,9999).g(),this.Lo=new ut(NaN,NaN).g(),this.yc=!1,this.ZP=!0,this.us=null,this.Co=new bt("Rectangle",{alignmentFocus:B.Center,desiredSize:ut._N,fill:"lightblue",stroke:"dodgerblue",strokeWidth:1,cursor:"pointer"}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.fs=null,this.km=new S,this.QP=new ut,this.wc=new S,this.Yw=new ut(0,0),this.Gw=new ut(1/0,1/0),this.jw=new ut(1,1),t&&Object.assign(this,t)}updateAdornments(t){if(!(t===null||t instanceof dt)){if(t.isSelected&&!this.diagram.isReadOnly){const i=t.resizeObject;let s=t.findAdornment(this.name);if(i!==null&&t.canResize()&&t.actualBounds.isReal()&&t.isVisible()&&i.actualBounds.isReal()&&i.isVisibleObject()&&((s===null||s.adornedObject!==i)&&(s=this.makeAdornment(i)),s!==null)){const n=i.getDocumentAngle();t.Nl()&&this.updateResizeHandles(s,n),t.addAdornment(this.name,s);return}}t.removeAdornment(this.name)}}makeAdornment(t){let i=null;const s=t.part.resizeAdornmentTemplate;if(s===null){i=new Mt,i.type=ct.Spot,i.locationSpot=B.Center;const n=new Ue;n.isPanelMain=!0,i.add(n),i.add(this.makeHandle(t,B.TopLeft)),i.add(this.makeHandle(t,B.TopRight)),i.add(this.makeHandle(t,B.BottomRight)),i.add(this.makeHandle(t,B.BottomLeft)),i.add(this.makeHandle(t,B.MiddleTop)),i.add(this.makeHandle(t,B.MiddleRight)),i.add(this.makeHandle(t,B.MiddleBottom)),i.add(this.makeHandle(t,B.MiddleLeft))}else if(s.li(),i=s.copy(),i===null)return null;return i.adornedObject=t,i}makeHandle(t,i){const s=this.handleArchetype;if(s===null)return null;const n=s.copy().xm();return n.alignment=i,n}updateResizeHandles(t,i){if(t!==null){if(!t.alignment.isDefault()&&(t.cursor==="pointer"||t.cursor.indexOf("resize")>0))this.eF(t,i);else if(t instanceof ct){const s=t.elements;for(;s.next();){const n=s.value;this.updateResizeHandles(n,i)}}}}eF(t,i){let s=t.alignment;s.isNoSpot()&&(s=B.Center);let n=i;if(s.x<=0)s.y<=0?n+=225:s.y>=1?n+=135:n+=180;else if(s.x>=1)s.y<=0?n+=315:s.y>=1&&(n+=45);else if(s.y<=0)n+=270;else if(s.y>=1)n+=90;else return;n<0?n+=360:n>=360&&(n-=360),n<22.5?t.cursor="e-resize":n<67.5?t.cursor="se-resize":n<112.5?t.cursor="s-resize":n<157.5?t.cursor="sw-resize":n<202.5?t.cursor="w-resize":n<247.5?t.cursor="nw-resize":n<292.5?t.cursor="n-resize":n<337.5?t.cursor="ne-resize":t.cursor="e-resize"}get handleArchetype(){return this.Co}set handleArchetype(t){this.Co=t}get handle(){return this.fs}set handle(t){if(t!==null&&!(t.part instanceof Mt))throw new Error("new handle is not in an Adornment: "+t);this.fs=t}get adornedObject(){return this.us}set adornedObject(t){if(t!==null&&t.part instanceof Mt)throw new Error("new handle must not be in an Adornment: "+t);this.us=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return t.isReadOnly||!t.allowResize||!t.lastInput.left?!1:this.findToolHandleAt(t.firstInput.documentPoint,this.name)!==null}doActivate(){const t=this.diagram;this.handle===null&&(this.handle=this.findToolHandleAt(t.firstInput.documentPoint,this.name)),this.handle!==null&&(this.adornedObject=this.handle.part.adornedObject,this.adornedObject!==null&&(t.isMouseCaptured=!0,t.animationManager.stopAnimation(),t.pu=!0,this.startTransaction(this.name),this.km.set(this.adornedObject.getDocumentPoint(this.handle.alignment.opposite())),this.wc.set(this.adornedObject.part.location),this.QP.set(this.adornedObject.desiredSize),this.jw=this.computeCellSize(),this.Yw=this.computeMinSize(),this.Gw=this.computeMaxSize(),this.isActive=!0))}doDeactivate(){const t=this.diagram;t.pu=!1,t.bl=!0,this.stopTransaction(),this.handle=null,this.us=null,t.isMouseCaptured=!1,this.isActive=!1}stopTransaction(){const t=this.diagram,i=super.stopTransaction();return i&&t.undoManager.transactionToUndo!==null&&t.undoManager.transactionToUndo.optimize(),i}doCancel(){this.adornedObject!==null&&(this.adornedObject.desiredSize=this.originalDesiredSize,this.adornedObject.part.location=this.originalLocation),this.stopTool()}doMouseMove(){const t=this.diagram;if(!this.isActive)return;const i=this.Yw,s=this.Gw,n=this.jw,o=t.lastInput.documentPoint,r=this.adornedObject.getLocalPoint(o,S.l()),a=this.computeReshape(),h=this.computeResize(r,this.handle.alignment,i,s,n,a);this.resize(h),t.maybeUpdate(),S.s(r)}doMouseUp(){const t=this.diagram;if(this.isActive){const i=this.Yw,s=this.Gw,n=this.jw,o=this.adornedObject.getLocalPoint(t.lastInput.documentPoint,S.l()),r=this.computeReshape(),a=this.computeResize(o,this.handle.alignment,i,s,n,r);this.resize(a),S.s(o),t.invalidateDocumentBounds(),this.transactionResult=this.name,t.v("PartResized",this.adornedObject,this.originalDesiredSize)}this.stopTool()}resize(t){const i=this.diagram,s=this.adornedObject;if(s===null)return;s.desiredSize=t.size;const n=s.part;n.ensureBounds();const o=s.getDocumentPoint(this.handle.alignment.opposite());if(n instanceof at){const r=new J;r.add(n);let a;!this.dragsMembers&&!n.hasPlaceholder()&&(a=new gs,a.dragsMembers=!1),i.moveParts(r,this.oppositePoint.copy().subtract(o),!0,a)}else n.location=n.location.copy().subtract(o).add(this.oppositePoint);i.maybeUpdate()}computeResize(t,i,s,n,o,r){i.isNoSpot()&&(i=B.Center);const a=this.adornedObject.naturalBounds,h=a.x,l=a.y,u=a.x+a.width,c=a.y+a.height;let d=1;if(!r){let p=a.width,y=a.height;p<=0&&(p=1),y<=0&&(y=1),d=y/p}const m=S.l();A.Ig(t.x,t.y,h,l,o.width,o.height,m);const g=a.copy();return i.x<=0?i.y<=0?(g.x=Math.max(m.x,u-n.width),g.x=Math.min(g.x,u-s.width),g.width=Math.max(u-g.x,s.width),g.y=Math.max(m.y,c-n.height),g.y=Math.min(g.y,c-s.height),g.height=Math.max(c-g.y,s.height),r||(g.height/g.width>=1?(g.height=Math.max(Math.min(d*g.width,n.height),s.height),g.width=g.height/d):(g.width=Math.max(Math.min(g.height/d,n.width),s.width),g.height=d*g.width),g.x=u-g.width,g.y=c-g.height)):i.y>=1?(g.x=Math.max(m.x,u-n.width),g.x=Math.min(g.x,u-s.width),g.width=Math.max(u-g.x,s.width),g.height=Math.max(Math.min(m.y-l,n.height),s.height),r||(g.height/g.width>=1?(g.height=Math.max(Math.min(d*g.width,n.height),s.height),g.width=g.height/d):(g.width=Math.max(Math.min(g.height/d,n.width),s.width),g.height=d*g.width),g.x=u-g.width)):(g.x=Math.max(m.x,u-n.width),g.x=Math.min(g.x,u-s.width),g.width=u-g.x,r||(g.height=Math.max(Math.min(d*g.width,n.height),s.height),g.width=g.height/d,g.y=l+.5*(c-l-g.height))):i.x>=1?i.y<=0?(g.width=Math.max(Math.min(m.x-h,n.width),s.width),g.y=Math.max(m.y,c-n.height),g.y=Math.min(g.y,c-s.height),g.height=Math.max(c-g.y,s.height),r||(g.height/g.width>=1?(g.height=Math.max(Math.min(d*g.width,n.height),s.height),g.width=g.height/d):(g.width=Math.max(Math.min(g.height/d,n.width),s.width),g.height=d*g.width),g.y=c-g.height)):i.y>=1?(g.width=Math.max(Math.min(m.x-h,n.width),s.width),g.height=Math.max(Math.min(m.y-l,n.height),s.height),r||(g.height/g.width>=1?(g.height=Math.max(Math.min(d*g.width,n.height),s.height),g.width=g.height/d):(g.width=Math.max(Math.min(g.height/d,n.width),s.width),g.height=d*g.width))):(g.width=Math.max(Math.min(m.x-h,n.width),s.width),r||(g.height=Math.max(Math.min(d*g.width,n.height),s.height),g.width=g.height/d,g.y=l+.5*(c-l-g.height))):i.y<=0?(g.y=Math.max(m.y,c-n.height),g.y=Math.min(g.y,c-s.height),g.height=c-g.y,r||(g.width=Math.max(Math.min(g.height/d,n.width),s.width),g.height=d*g.width,g.x=h+.5*(u-h-g.width))):i.y>=1&&(g.height=Math.max(Math.min(m.y-l,n.height),s.height),r||(g.width=Math.max(Math.min(g.height/d,n.width),s.width),g.height=d*g.width,g.x=h+.5*(u-h-g.width))),S.s(m),g}computeReshape(){let t=0;return this.adornedObject instanceof bt&&(t=this.adornedObject._P()),!(t===6||this.diagram.lastInput.shift)}computeMinSize(){const t=this.adornedObject.minSize.copy(),i=this.minSize;return!isNaN(i.width)&&i.width>t.width&&(t.width=i.width),!isNaN(i.height)&&i.height>t.height&&(t.height=i.height),t}computeMaxSize(){const t=this.adornedObject.maxSize.copy(),i=this.maxSize;return!isNaN(i.width)&&i.width<t.width&&(t.width=i.width),!isNaN(i.height)&&i.height<t.height&&(t.height=i.height),t}computeCellSize(){const t=new ut(NaN,NaN),i=this.adornedObject.part;if(i!==null){const o=i.resizeCellSize;!isNaN(o.width)&&o.width>0&&(t.width=o.width),!isNaN(o.height)&&o.height>0&&(t.height=o.height)}let s=this.cellSize;isNaN(t.width)&&!isNaN(s.width)&&s.width>0&&(t.width=s.width),isNaN(t.height)&&!isNaN(s.height)&&s.height>0&&(t.height=s.height);const n=this.diagram;if((isNaN(t.width)||isNaN(t.height))&&n){const o=n.grid;o!==null&&o.visible&&this.isGridSnapEnabled&&(s=o.gridCellSize,isNaN(t.width)&&!isNaN(s.width)&&s.width>0&&(t.width=s.width),isNaN(t.height)&&!isNaN(s.height)&&s.height>0&&(t.height=s.height))}return(isNaN(t.width)||t.width===0||t.width===1/0)&&(t.width=1),(isNaN(t.height)||t.height===0||t.height===1/0)&&(t.height=1),t}get minSize(){return this.xr}set minSize(t){if(!this.xr.equals(t)){let i=t.width;isNaN(i)&&(i=0);let s=t.height;isNaN(s)&&(s=0),this.xr.e(i,s)}}get maxSize(){return this.br}set maxSize(t){if(!this.br.equals(t)){let i=t.width;isNaN(i)&&(i=1/0);let s=t.height;isNaN(s)&&(s=1/0),this.br.e(i,s)}}get cellSize(){return this.Lo}set cellSize(t){this.Lo.equals(t)||this.Lo.a(t)}get isGridSnapEnabled(){return this.yc}set isGridSnapEnabled(t){this.yc=t}get dragsMembers(){return this.ZP}set dragsMembers(t){this.ZP=t}get oppositePoint(){return this.km}set oppositePoint(t){this.km.equals(t)||this.km.a(t)}get originalDesiredSize(){return this.QP}get originalLocation(){return this.wc}}class xt extends ke{constructor(t){super();f(this,"tS");f(this,"iS");f(this,"us");f(this,"Co");f(this,"fs");f(this,"eS");f(this,"Pm");f(this,"wc");f(this,"sS");f(this,"nS");this.name="Rotating",this.tS=45,this.iS=2,this.wc=new S,this.us=null,this.Co=new bt("Ellipse",{desiredSize:ut.lu,fill:"lightblue",stroke:"dodgerblue",strokeWidth:1,cursor:"pointer"}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.fs=null,this.eS=0,this.Pm=new S(NaN,NaN),this.sS=0,this.nS=50,t&&Object.assign(this,t)}updateAdornments(t){if(t!==null){if(t.Cl()){const i=t.rotateObject;if(i===t||i===t.path||i.isPanelMain)return}if(t.isSelected&&!this.diagram.isReadOnly){const i=t.rotateObject;if(i!==null&&t.canRotate()&&t.actualBounds.isReal()&&t.isVisible()&&i.actualBounds.isReal()&&i.isVisibleObject()){let s=t.findAdornment(this.name);if((s===null||s.adornedObject!==i)&&(s=this.makeAdornment(i)),s!==null){s.angle=i.getDocumentAngle(),s.hasPlaceholder()||(s.location=this.computeAdornmentLocation(i)),t.addAdornment(this.name,s);return}}}t.removeAdornment(this.name)}}makeAdornment(t){let i=null;const s=t.part.rotateAdornmentTemplate;if(s===null){i=new Mt,i.type=ct.Position,i.locationSpot=B.Center;const n=this.handleArchetype;n!==null&&i.add(n.copy().xm())}else if(s.li(),i=s.copy(),i===null)return null;return i.adornedObject=t,i}get handleArchetype(){return this.Co}set handleArchetype(t){this.Co=t}get handle(){return this.fs}set handle(t){if(t!==null&&!(t.part instanceof Mt))throw new Error("new handle is not in an Adornment: "+t);this.fs=t}get adornedObject(){return this.us}set adornedObject(t){if(t!==null&&t.part instanceof Mt)throw new Error("new handle must not be in an Adornment: "+t);this.us=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return t.isReadOnly||!t.allowRotate||!t.lastInput.left?!1:this.findToolHandleAt(t.firstInput.documentPoint,this.name)!==null}doActivate(){const t=this.diagram;if(this.adornedObject===null){if(this.handle===null&&(this.handle=this.findToolHandleAt(t.firstInput.documentPoint,this.name)),this.handle===null)return;this.adornedObject=this.handle.part.adornedObject}this.adornedObject!==null&&(t.isMouseCaptured=!0,t.delaysLayout=!0,this.startTransaction(this.name),this.eS=this.adornedObject.angle,this.Pm=this.computeRotationPoint(this.adornedObject),this.wc=this.adornedObject.part.location.copy(),this.isActive=!0)}computeRotationPoint(t){const i=t.part,s=i.locationObject;return i.rotationSpot.isSpot()?t.getDocumentPoint(i.rotationSpot):t===i||t===s?s.getDocumentPoint(i.locationSpot):t.getDocumentPoint(B.Center)}computeAdornmentLocation(t){let i=this.rotationPoint;i.isReal()||(i=this.computeRotationPoint(t));const s=t.getLocalPoint(i);let n=this.handleAngle;n<0?n+=360:n>=360&&(n-=360),n=Math.round(Math.round(n/45)*45);const o=this.handleDistance;return n===0?s.x=t.naturalBounds.width+o:n===45?(s.x=t.naturalBounds.width+o,s.y=t.naturalBounds.height+o):n===90?s.y=t.naturalBounds.height+o:n===135?(s.x=-o,s.y=t.naturalBounds.height+o):n===180?s.x=-o:n===225?(s.x=-o,s.y=-o):n===270?s.y=-o:n===315&&(s.x=t.naturalBounds.width+o,s.y=-o),t.getDocumentPoint(s)}doDeactivate(){const t=this.diagram;this.stopTransaction(),this.handle=null,this.us=null,this.Pm=new S(NaN,NaN),t.isMouseCaptured=!1,this.isActive=!1}stopTransaction(){const t=this.diagram,i=super.stopTransaction();return i&&t.undoManager.transactionToUndo!==null&&t.undoManager.transactionToUndo.optimize(),i}doCancel(){const t=this.diagram;t.delaysLayout=!1,this.rotate(this.originalAngle),this.stopTool()}doMouseMove(){const t=this.diagram;if(this.isActive){const i=this.computeRotate(t.lastInput.documentPoint);this.rotate(i)}}doMouseUp(){const t=this.diagram;if(this.isActive){t.delaysLayout=!1;const i=this.computeRotate(t.lastInput.documentPoint);this.rotate(i),t.invalidateDocumentBounds(),this.transactionResult=this.name,t.v("PartRotated",this.adornedObject,this.originalAngle)}this.stopTool()}rotate(t){const i=this.adornedObject;if(i===null)return;i.angle=t;const s=i.part;s.ensureBounds();const n=s.locationObject,o=s.rotateObject;if(n===o||n.isContainedBy(o)){const r=this.wc.copy();s.location=r.subtract(this.rotationPoint).rotate(t-this.originalAngle).add(this.rotationPoint)}this.diagram.maybeUpdate()}computeRotate(t){let i=this.rotationPoint.directionPoint(t)-this.handleAngle;const s=this.adornedObject.panel;s!==null&&(i-=s.getDocumentAngle()),i>=360?i-=360:i<0&&(i+=360);const n=Math.min(Math.abs(this.snapAngleMultiple),180),o=Math.min(Math.abs(this.snapAngleEpsilon),n/2);return!this.diagram.lastInput.shift&&n>0&&o>0&&(i%n<o?i=Math.floor(i/n)*n:i%n>n-o&&(i=(Math.floor(i/n)+1)*n)),i>=360?i-=360:i<0&&(i+=360),i}get snapAngleMultiple(){return this.tS}set snapAngleMultiple(t){this.tS=t}get snapAngleEpsilon(){return this.iS}set snapAngleEpsilon(t){this.iS=t}get originalAngle(){return this.eS}get rotationPoint(){return this.Pm}set rotationPoint(t){this.Pm=t.copy()}get handleAngle(){return this.sS}set handleAngle(t){this.sS=t}get handleDistance(){return this.nS}set handleDistance(t){this.nS=t}}class Ot extends ke{constructor(e){super(),this.name="ClickSelecting",e&&Object.assign(this,e)}canStart(){return!(!this.isEnabled||this.isBeyondDragSize())}doMouseUp(){this.isActive&&(this.standardMouseSelect(),this.standardMouseClick()||this.diagram.lastInput.isTouchEvent&&this.diagram.toolManager.doToolTip()),this.stopTool()}}class zt extends ke{constructor(t){super();f(this,"xc");this.name="Action",this.xc=null,t&&Object.assign(this,t)}canStart(){if(!this.isEnabled)return!1;const t=this.diagram,i=t.lastInput,s=t.findObjectAt(i.documentPoint,n=>{for(;n.panel!==null;){if(n.isActionable)return n;n=n.panel}return n});return s!==null&&s.isActionable?(this.xc=s,t.fc=t.findObjectAt(i.documentPoint,null,null),!0):!1}doMouseDown(){if(!this.isActive)this.canStart()&&this.doActivate();else{const t=this.diagram.lastInput,i=this.xc;if(i===null)return;t.targetObject=i,i.actionDown!==null&&i.actionDown(t,i)}}doMouseMove(){if(this.isActive){const t=this.diagram.lastInput,i=this.xc;if(i===null)return;t.targetObject=i,i.actionMove!==null&&i.actionMove(t,i)}}doMouseUp(){if(this.isActive){const t=this.diagram.lastInput,i=this.xc;if(i===null)return;t.targetObject=i,i.actionUp!==null&&i.actionUp(t,i),this.standardMouseClick(s=>{for(;s.panel!==null;){if(s.isActionable&&s===i)return s;s=s.panel}return s},s=>s===i)}this.stopTool()}doCancel(){const t=this.diagram.lastInput,i=this.xc;i!==null&&(t.targetObject=i,i.actionCancel!==null&&i.actionCancel(t,i),this.stopTool())}doStop(){this.xc=null}}class ae extends ke{constructor(t){super();f(this,"Ll");f(this,"oS");f(this,"yc");f(this,"rS");this.name="ClickCreating",this.Ll=null,this.oS=!0,this.yc=!1,this.rS=new S(0,0),t&&Object.assign(this,t)}canStart(){if(!this.isEnabled||this.archetypeNodeData===null)return!1;const t=this.diagram;if(t.isReadOnly||t.isModelReadOnly||!t.allowInsert||!t.lastInput.left||this.isBeyondDragSize())return!1;if(this.isDoubleClick){if(t.lastInput.clickCount===1&&(this.rS=t.lastInput.viewPoint.copy()),t.lastInput.clickCount!==2||this.isBeyondDragSize(this.rS))return!1}else if(t.lastInput.clickCount!==1)return!1;return!(t.currentTool!==this&&t.findPartAt(t.lastInput.documentPoint,!0)!==null)}doMouseUp(){const t=this.diagram;this.isActive&&this.insertPart(t.lastInput.documentPoint),this.stopTool()}insertPart(t){const i=this.diagram,s=this.archetypeNodeData;if(s===null)return null;let n=null;try{if(i.v("ChangingSelection",i.selection),this.startTransaction(this.name),s instanceof Bt)s.Pe()&&(s.li(),n=s.copy(),n!==null&&i.add(n));else if(s!==null){const o=i.model.copyNodeData(s);b.wt(o)&&(i.model.addNodeData(o),n=i.findPartForData(o))}if(n!==null){const o=S.X(t.x,t.y);this.isGridSnapEnabled&&this.diagram.lS(n,t,o),n.location=o,i.allowSelect&&(i.clearSelection(!0),n.isSelected=!0),S.s(o)}i.invalidateDocumentBounds(),this.transactionResult=this.name,i.v("PartCreated",n)}finally{this.stopTransaction(),i.v("ChangedSelection",i.selection)}return n}get archetypeNodeData(){return this.Ll}set archetypeNodeData(t){this.Ll=t}get isDoubleClick(){return this.oS}set isDoubleClick(t){this.oS=t}get isGridSnapEnabled(){return this.yc}set isGridSnapEnabled(t){this.yc=t}}class Re extends ke{constructor(t){super();f(this,"Vh");f(this,"hS");f(this,"Al");this.name="DragSelecting",this.Vh=175,this.hS=!1,this.Al=new Bt({layerName:"Tool",selectable:!1}).add(new bt("Rectangle",{name:"SHAPE",fill:null,stroke:"magenta"}).theme("stroke","dragSelect")).li(),t&&Object.assign(this,t)}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;if(!t.allowSelect)return!1;const i=t.lastInput;return!(!i.left||t.currentTool!==this&&(!this.isBeyondDragSize()||i.timestamp-t.firstInput.timestamp<this.delay||t.findPartAt(i.documentPoint,!0)!==null))}doActivate(){const t=this.diagram;this.isActive=!0,t.isMouseCaptured=!0,t.skipsUndoManager=!0,t.add(this.box),this.doMouseMove()}doDeactivate(){const t=this.diagram;t.stopAutoScroll(),t.remove(this.box),t.skipsUndoManager=!1,t.isMouseCaptured=!1,this.isActive=!1}doMouseMove(){const t=this.diagram;if(this.isActive&&this.box!==null){const i=this.computeBoxBounds();let s=this.box.findObject("SHAPE");s===null&&(s=this.box.findMainElement());const n=ut.l().e(i.width,i.height);s.desiredSize=n,this.box.bc(i.x,i.y,!1),ut.s(n),(t.allowHorizontalScroll||t.allowVerticalScroll)&&t.doAutoScroll(t.lastInput.viewPoint)}}doMouseUp(){if(this.isActive){const t=this.diagram;t.remove(this.box);try{t.currentCursor="wait",t.v("ChangingSelection",t.selection),this.selectInRect(this.computeBoxBounds()),t.v("ChangedSelection",t.selection)}finally{t.currentCursor=""}}this.stopTool()}computeBoxBounds(){const t=this.diagram;return new z(t.firstInput.documentPoint,t.lastInput.documentPoint)}selectInRect(t){const i=this.diagram,s=i.lastInput,n=i.findPartsIn(t,this.isPartialInclusion);if(b.rr?s.meta:s.control)if(s.shift){const o=n.iterator;for(;o.next();){const r=o.value;r.isSelected&&(r.isSelected=!1)}}else{const o=n.iterator;for(;o.next();){const r=o.value;r.isSelected=!r.isSelected}}else if(s.shift){const o=n.iterator;for(;o.next();){const r=o.value;r.isSelected||(r.isSelected=!0)}}else{const o=new J,r=i.selection.iterator;for(;r.next();){const l=r.value;n.has(l)||o.add(l)}const a=o.iterator;for(;a.next();){const l=a.value;l.isSelected=!1}const h=n.iterator;for(;h.next();){const l=h.value;l.isSelected||(l.isSelected=!0)}}}get delay(){return this.Vh}set delay(t){this.Vh=t}get isPartialInclusion(){return this.hS}set isPartialInclusion(t){this.hS=t}get box(){return this.Al}set box(t){t!==null&&t.li(),this.Al=t}}class Xi extends ke{constructor(t){super();f(this,"Hw");f(this,"YC");f(this,"No");f(this,"aS");this.name="Panning",this.Hw=new S,this.YC=new S,this.No=!1;const i=this;this.aS=()=>{const s=i.diagram;s!==null&&s.Mi(Z.document,"scroll",i.aS,!1),i.stopTool()},t&&Object.assign(this,t)}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return!(!t.allowHorizontalScroll&&!t.allowVerticalScroll||!t.lastInput.left||t.currentTool!==this&&!this.isBeyondDragSize())}doActivate(){const t=this.diagram;this.No?(t.lastInput.bubbles=!0,t.Vt(Z.document,"scroll",this.aS,!1)):(t.currentCursor="move",t.isMouseCaptured=!0,this.Hw.a(t.position)),this.isActive=!0}doDeactivate(){const t=this.diagram;t.currentCursor="",t.isMouseCaptured=!1,this.isActive=!1}doCancel(){const t=this.diagram;t.position=this.Hw,t.isMouseCaptured=!1,this.stopTool()}doMouseMove(){this.GC()}doMouseUp(){this.GC(),this.stopTool()}GC(){const t=this.diagram;if(this.isActive&&t){if(this.No){t.lastInput.bubbles=!0;return}const i=t.position,s=t.firstInput.documentPoint,n=t.lastInput.documentPoint;let o=i.x+s.x-n.x,r=i.y+s.y-n.y;t.allowHorizontalScroll||(o=i.x),t.allowVerticalScroll||(r=i.y),t.position=this.YC.e(o,r)}}get bubbles(){return this.No}set bubbles(t){this.No=t}get originalPosition(){return this.Hw}}class ti{constructor(e){f(this,"qw");f(this,"Ww");f(this,"cS");f(this,"fS");this.qw=null,this.Ww=null,this.cS=null,this.fS=null,e&&Object.assign(this,e)}get mainElement(){return this.cS}set mainElement(e){this.cS=e}get show(){return this.qw}set show(e){this.qw!==e&&(this.qw=e)}get hide(){return this.Ww}set hide(e){this.Ww!==e&&(this.Ww=e)}get valueFunction(){return this.fS}set valueFunction(e){this.fS=e}}class Ne{constructor(e,t,i){f(this,"hi");f(this,"Sm");f(this,"kc");this.hi=e,this.Sm=t,this.kc=i}}const $t=class $t extends ke{constructor(t){super();f(this,"uS");f(this,"Jw");f(this,"dS");f(this,"gS");f(this,"$w");f(this,"Zw");f(this,"Mm");this.name="ContextMenu",this.uS=null,this.Jw=null,this.dS=null,this.gS=new S,this.$w=null,this.Mm=!1;const i=this;this.Zw=()=>i.stopTool(),t&&Object.assign(this,t)}sF(){const t=new ti;t.show=(a,h,l)=>l.showDefaultContextMenu(),t.hide=(a,h)=>h.hideDefaultContextMenu(),$t.bu=t;const i=this;this.Zw=()=>i.stopTool();const s=b.en("div"),n=b.en("div");s.style.cssText="top: 0px;z-index:10002;position: fixed;display: none;text-align: center;left: 25%;width: 50%;background-color: #F5F5F5;padding: 16px;border: 16px solid #444;border-radius: 10px;margin-top: 10px",n.style.cssText="z-index:10001;position: fixed;display: none;top: 0;left: 0;width: 100%;height: 100%;background-color: black;opacity: 0.8;";const o=b.en("style");Z.document.getElementsByTagName("head")[0].appendChild(o),o.sheet.insertRule(".goCXul { list-style: none; }",0),o.sheet.insertRule(".goCXli {font:700 1.5em Helvetica, Arial, sans-serif;position: relative;min-width: 60px; }",0),o.sheet.insertRule(".goCXa {color: #444;display: inline-block;padding: 4px;text-decoration: none;margin: 2px;border: 1px solid gray;border-radius: 10px; }",0);const r=this.diagram;r!==null&&(r.Vt(s,"contextmenu",$t.Yh,!1),r.Vt(s,"selectstart",$t.Yh,!1),r.Vt(n,"contextmenu",$t.Yh,!1)),s.className="goCXforeground",n.className="goCXbackground",Z.document.body&&(Z.document.body.appendChild(s),Z.document.body.appendChild(n)),$t.Nm=s,$t.Cm=n,$t.mS=!0}static Yh(t){return t.preventDefault(),!1}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return this.isBeyondDragSize()||!t.lastInput.right||t.lastInput.clickCount>1?!1:!!(t.lastInput.isTouchEvent&&this.defaultTouchContextMenu!==null||this.findObjectWithContextMenu()!==null)}doStart(){const t=this.diagram;this.gS.set(t.firstInput.documentPoint)}doStop(){this.hideContextMenu(),this.currentObject=null,this.Mm=!1}findObjectWithContextMenu(t){t===void 0&&(t=null);const i=this.diagram,s=i.lastInput;let n=null;if(t instanceof At||(t instanceof he?n=t:n=i.findObjectAt(s.documentPoint,null,o=>!o.layer.isTemporary)),n!==null){let o=n;for(;o!==null;){if(o.contextMenu!==null)return o;o=o.panel}if(i.lastInput.isTouchEvent&&this.defaultTouchContextMenu)return n.part}else if(i.contextMenu!==null)return i;return null}doActivate(){}doMouseDown(){if(super.doMouseDown(),this.isActive&&this.currentContextMenu instanceof Mt){const t=this.diagram.toolManager.findTool("Action");t!==null&&t.canStart()&&(t.doActivate(),t.doMouseDown(),t.doDeactivate())}this.diagram.toolManager.mouseDownTools.has(this)&&this.doContextClick()}doMouseUp(){if(this.isActive&&this.currentContextMenu instanceof Mt){const t=this.diagram.toolManager.findTool("Action");t!==null&&t.canStart()&&(t.doActivate(),t.doCancel(),t.doDeactivate())}this.doContextClick()}doContextClick(){const t=this.diagram;if(!this.isActive)this.canStart()&&(this.openMenu(!0),this.isActive||this.stopTool());else{const i=this.currentContextMenu;if(i===null)return;let s=null;i instanceof ti||(s=t.findObjectAt(t.lastInput.documentPoint,null,null),s!==null&&s.isContainedBy(i)&&this.standardMouseClick(null,null)),this.maybeStopTool(s)}}maybeStopTool(t){this.stopTool(),this.canStart()&&(this.diagram.currentTool=this,this.doMouseUp())}openMenu(t,i){if(i===void 0&&(i=null),this.Mm)return;this.Mm=!0,t&&this.standardMouseSelect();const s=this.standardMouseClick();if(this.Mm=!1,!s){this.isActive=!0;const n=$t.bu;if(i===null&&(i=this.findObjectWithContextMenu()),i!==null){const o=i.contextMenu;o!==null?(this.currentObject=i instanceof he?i:null,this.showContextMenu(o,this.currentObject)):n!==null&&this.showContextMenu(n,this.currentObject)}else n!==null&&this.showContextMenu(n,null);this.currentContextMenu instanceof Mt&&!this.currentContextMenu.visible&&this.stopTool()}}doMouseMove(){const t=this.diagram.toolManager.findTool("Action");t!==null&&t.doMouseMove(),this.isActive&&this.diagram.toolManager.doMouseMove()}showContextMenu(t,i){const s=this.diagram;if(t!==this.currentContextMenu&&this.hideContextMenu(),t instanceof Mt){const n=t;n.layerName="Tool",n.selectable=!1,n.scale=1/s.scale,n.category=this.name,n.hasPlaceholder()&&(n.placeholder.scale=s.scale);const o=n.diagram;o!==null&&o!==s&&o.remove(n),s.add(n),i!==null?n.adornedObject=i:n.data=s.model,n.ensureBounds(),this.positionContextMenu(n,i)}else t instanceof ti&&t.show(i,s,this);this.currentContextMenu=t}positionContextMenu(t,i){if(t.hasPlaceholder())return;const s=t,n=this.diagram,o=n.lastInput.documentPoint.copy(),r=s.measuredBounds,a=n.viewportBounds;n.lastInput.isTouchEvent&&(o.x-=r.width),o.x+r.width>a.right&&(o.x-=r.width+5/n.scale),o.x<a.x&&(o.x=a.x),o.y+r.height>a.bottom&&(o.y-=r.height+5/n.scale),o.y<a.y&&(o.y=a.y),s.position=o}hideContextMenu(){const t=this.diagram,i=this.currentContextMenu;i!==null&&(i instanceof Mt?(t.remove(i),this.Jw!==null&&this.Jw.removeAdornment(i.category),i.data=null,i.adornedObject=null):i instanceof ti&&(i.hide!==null?i.hide(t,this):i.mainElement!==null&&(i.mainElement.style.display="none")),this.currentContextMenu=null,this.standardMouseOver())}nF(){const t=this,i=new J;return i.add(new Ne("Copy",s=>s.commandHandler.copySelection(),s=>s.commandHandler.canCopySelection())),i.add(new Ne("Cut",s=>s.commandHandler.cutSelection(),s=>s.commandHandler.canCutSelection())),i.add(new Ne("Delete",s=>s.commandHandler.deleteSelection(),s=>s.commandHandler.canDeleteSelection())),i.add(new Ne("Paste",s=>s.commandHandler.pasteSelection(t.mouseDownPoint),s=>s.commandHandler.canPasteSelection(t.mouseDownPoint))),i.add(new Ne("Select All",s=>s.commandHandler.selectAll(),s=>s.commandHandler.canSelectAll())),i.add(new Ne("Undo",s=>s.commandHandler.undo(),s=>s.commandHandler.canUndo())),i.add(new Ne("Redo",s=>s.commandHandler.redo(),s=>s.commandHandler.canRedo())),i.add(new Ne("Scroll To Part",s=>s.commandHandler.scrollToPart(),s=>s.commandHandler.canScrollToPart())),i.add(new Ne("Zoom To Fit",s=>s.commandHandler.zoomToFit(),s=>s.commandHandler.canZoomToFit())),i.add(new Ne("Reset Zoom",s=>s.commandHandler.resetZoom(),s=>s.commandHandler.canResetZoom())),i.add(new Ne("Group Selection",s=>s.commandHandler.groupSelection(),s=>s.commandHandler.canGroupSelection())),i.add(new Ne("Ungroup Selection",s=>s.commandHandler.ungroupSelection(),s=>s.commandHandler.canUngroupSelection())),i.add(new Ne("Edit Text",s=>s.commandHandler.editTextBlock(),s=>s.commandHandler.canEditTextBlock())),i}showDefaultContextMenu(){const t=this.diagram;this.$w===null&&(this.$w=this.nF()),$t.Nm.innerHTML="",$t.Cm.addEventListener("pointerdown",this.Zw,!1);const i=this,s=b.en("ul");s.className="goCXul",$t.Nm.appendChild(s),s.innerHTML="";const n=this.$w.iterator;for(;n.next();){const o=n.value,r=o.Sm,a=o.kc;if(typeof r!="function"||typeof a=="function"&&!a(t))continue;const h=b.en("li");h.className="goCXli";const l=b.en("a");l.className="goCXa",l.href="#",l.Sm=o.Sm,l.addEventListener("pointerdown",function(u){return this.Sm(t),i.stopTool(),u.preventDefault(),!1},!1),l.textContent=o.hi,h.appendChild(l),s.appendChild(h)}$t.Nm.style.display="block",$t.Cm.style.display="block"}hideDefaultContextMenu(){if(this.currentContextMenu===null||this.currentContextMenu!==$t.bu)return;$t.Nm.style.display="none",$t.Cm.style.display="none";const t=this.diagram;t!==null&&t.Mi($t.Cm,"pointerdown",this.Zw,!1),this.currentContextMenu=null}get currentContextMenu(){return this.uS}set currentContextMenu(t){this.uS=t,this.Jw=t instanceof Mt?t.adornedPart:null}get defaultTouchContextMenu(){return $t.mS===!1&&$t.bu===null&&At.isUsingDOM()&&this.sF(),$t.bu}set defaultTouchContextMenu(t){t===null&&($t.mS=!0),$t.bu=t}get currentObject(){return this.dS}set currentObject(t){this.dS=t}get mouseDownPoint(){return this.gS}};f($t,"bu",null),f($t,"mS",!1),f($t,"Cm",null),f($t,"Nm",null);let Di=$t;var es=(v=>(v[v.LostFocus=1]="LostFocus",v[v.MouseDown=2]="MouseDown",v[v.Tab=3]="Tab",v[v.Enter=4]="Enter",v))(es||{}),is=(v=>(v[v.SingleClick=1]="SingleClick",v[v.SingleClickSelected=2]="SingleClickSelected",v[v.DoubleClick=3]="DoubleClick",v))(is||{}),ss=(v=>(v[v.None=1]="None",v[v.Active=2]="Active",v[v.Editing=3]="Editing",v[v.Validating=4]="Validating",v[v.Invalid=5]="Invalid",v[v.Validated=6]="Validated",v))(ss||{});const oe=class oe extends ke{constructor(t){super();f(this,"Se");f(this,"pS");f(this,"yS");f(this,"Tl");f(this,"Yt");f(this,"wS");f(this,"xS");f(this,"bS");f(this,"Qw");f(this,"_w");this.name="TextEditing",this.Se=new Qt,this.pS=null,this.yS=2,this.Tl=null,this.Yt=1,this.wS=1,this.xS=!0,this.bS=null,this.Qw=new ti,this._w=null,this.oF(this.Qw),t&&Object.assign(this,t)}oF(t){if(!At.isUsingDOM())return;const i=b.en("textarea");this._w=i;const s=this;i.addEventListener("input",function(n){if(s.textBlock===null)return;const o=s.measureTemporaryTextBlock(this.value),r=this.textScale;this.style.width=20+Math.max(s.textBlock.measuredBounds.width,o.measuredBounds.width)*r+"px",this.rows=Math.max(s.textBlock.lineCount,o.lineCount)},!1),i.addEventListener("keydown",function(n){if(n.isComposing||s.textBlock===null)return;const o=n.key;if(o==="Enter"){s.textBlock.isMultiline===!1&&n.preventDefault(),s.acceptText(4);return}else if(o==="Tab"){s.acceptText(3),n.preventDefault();return}else o==="Escape"&&(s.doCancel(),s.diagram!==null&&s.diagram.doFocus())},!1),i.addEventListener("focus",function(n){s.rF(n)},!1),i.addEventListener("blur",function(n){s.lF(n)},!1),t.valueFunction=()=>i.value,t.mainElement=i,t.show=(n,o,r)=>{if(!(n instanceof Qt&&r instanceof oe))return;if(r.state===5){i.style.border="3px solid red",i.focus();return}const a=n.getDocumentPoint(B.Center),h=o.position,l=o.scale;let u=n.getDocumentScale()*l;u<r.minimumEditorScale&&(u=r.minimumEditorScale);const c=n.naturalBounds.width*u+6,d=n.naturalBounds.height*u+2,m=(a.x-h.x)*l,g=(a.y-h.y)*l,p=n.verticalAlignment,y=(n.lineHeight+n.spacingAbove+n.spacingBelow)*n.lineCount*u,x=.5*d-.5*y,P=p.y*d-p.y*y+p.offsetY-x-y/2;i.value=n.text,o.div.style.font=n.font;const k=1;i.style.position="absolute",i.style.zIndex="100",i.style.font="inherit",i.style.fontSize=u*100+"%",i.style.lineHeight="normal",i.style.width=c+"px",i.style.left=(m-c/2|0)-k+"px",i.style.top=(g+P|0)-k+"px",i.style.textAlign=n.textAlign,i.style.margin="0",i.style.padding=k+"px",i.style.border="0",i.style.outline="none",i.style.whiteSpace="pre-wrap",i.style.overflow="hidden",i.rows=n.lineCount,i.textScale=u,i.className="goTXarea",o.div.appendChild(i),i.focus(),r.selectsTextOnActivate&&(i.select(),i.setSelectionRange(0,9999))},t.hide=(n,o)=>{n.div.removeChild(i)}}get textBlock(){return this.pS}set textBlock(t){this.pS=t}get currentTextEditor(){return this.bS}set currentTextEditor(t){this.bS=t}get defaultTextEditor(){return this.Qw}set defaultTextEditor(t){this.Qw=t}get starting(){return this.yS}set starting(t){this.yS=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;if(t===null||t.isReadOnly||oe.Pc&&oe.Pc!==this&&(oe.Pc.acceptText(2),oe.Pc&&oe.Pc!==this)||!t.lastInput.left||this.isBeyondDragSize())return!1;const i=t.lastInput.documentPoint,s=t.findObjectAt(i);if(s===null||!(s instanceof Qt)||!s.editable||!s.part.canEdit())return!1;const n=s.part;return!(n===null||this.starting===2&&!n.isSelected||this.starting===3&&t.lastInput.clickCount<2)}doStart(){oe.Pc=this,this.textBlock!==null&&this.doActivate()}doActivate(){if(this.isActive)return;const t=this.diagram;if(t===null)return;let i=this.textBlock;if(i===null&&(i=t.findObjectAt(t.lastInput.documentPoint)),i===null||!(i instanceof Qt)||(this.textBlock=i,i.part===null))return;t.animationManager.stopAnimation(),this.isActive=!0,this.Yt=2;let s=this.defaultTextEditor;i.textEditor!==null&&(s=i.textEditor),this.Se=this.textBlock.copy();const n=new z(this.textBlock.getDocumentPoint(B.TopLeft),this.textBlock.getDocumentPoint(B.BottomRight));t.scrollToRect(n),s.show(i,t,this),this.currentTextEditor=s}doCancel(){this.stopTool()}doMouseUp(){this.canStart()&&this.doActivate()}doMouseDown(){this.isActive&&this.acceptText(2)}acceptText(t){switch(t){case 2:this.Yt===6?this.currentTextEditor instanceof HTMLElement&&this.currentTextEditor.focus():(this.Yt===2||this.Yt===5||this.Yt===3)&&(this.Yt=4,this.jC());break;case 1:case 4:case 3:if(t===4&&this.textBlock.isMultiline===!0)return;(this.Yt===2||this.Yt===5||this.Yt===3)&&(this.Yt=4,this.jC());break}}jC(){const t=this.textBlock,i=this.diagram,s=this.currentTextEditor;if(t!==null&&s!==null){const n=t.text;let o="";if(s.valueFunction!==null&&(o=s.valueFunction()),!this.isValidText(t,n,o)){this.Yt=5,this.doError(n,o);return}this.startTransaction(this.name),this.Yt=6,this.transactionResult=this.name,t.text=o,this.doSuccess(n,o),i!==null&&i.v("TextEdited",t,n),this.stopTransaction(),this.stopTool(),i!==null&&i.doFocus()}}doError(t,i){const s=this.textBlock;s.errorFunction!==null&&s.errorFunction(this,t,i);const n=this.currentTextEditor;n&&n.show(s,this.diagram,this)}doSuccess(t,i){const s=this.textBlock;s.textEdited!==null&&s.textEdited(s,t,i)}doDeactivate(){const t=this.diagram;t!==null&&(this.Yt=1,this.currentTextEditor!==null&&this.currentTextEditor.hide(t,this),this.textBlock=null,this.isActive=!1)}doStop(){oe.Pc=null}rF(t){if(this.currentTextEditor===null||this.state===1)return;const i=this._w;this.Yt===2&&(this.Yt=3),typeof i.select=="function"&&this.selectsTextOnActivate&&(i.select(),i.setSelectionRange(0,9999))}lF(t){if(this.currentTextEditor===null||this.state===1)return;const i=this._w;typeof i.focus=="function"&&i.focus(),typeof i.select=="function"&&this.selectsTextOnActivate&&(i.select(),i.setSelectionRange(0,9999))}isValidText(t,i,s){const n=this.textValidation;if(n!==null&&!n(t,i,s))return!1;const o=t.textValidation;return!(o!==null&&!o(t,i,s))}get textValidation(){return this.Tl}set textValidation(t){this.Tl=t}get minimumEditorScale(){return this.wS}set minimumEditorScale(t){this.wS=t}get selectsTextOnActivate(){return this.xS}set selectsTextOnActivate(t){this.xS=t}get state(){return this.Yt}set state(t){this.Yt!==t&&(this.Yt=t)}measureTemporaryTextBlock(t){const i=this.Se;return i.text=t,i.ut(this.textBlock.Dl,1/0),i}};f(oe,"LostFocus",1),f(oe,"MouseDown",2),f(oe,"Tab",3),f(oe,"Enter",4),f(oe,"SingleClick",1),f(oe,"SingleClickSelected",2),f(oe,"DoubleClick",3),f(oe,"StateNone",1),f(oe,"StateActive",2),f(oe,"StateEditing",3),f(oe,"StateValidating",4),f(oe,"StateInvalid",5),f(oe,"StateValidated",6),f(oe,"Pc",null);let Fi=oe;var ns=(v=>(v[v.Default=1]="Default",v[v.AnimateLocations=2]="AnimateLocations",v[v.None=3]="None",v))(ns||{});const Je=class Je{constructor(e){f(this,"p");f(this,"Ni");f(this,"Oi");f(this,"kr");f(this,"Gn");f(this,"Ao");f(this,"kS");f(this,"PS");f(this,"Lm");f(this,"wi");f(this,"Sc");f(this,"un");f(this,"Am");f(this,"Gh");f(this,"tx");f(this,"Tm");f(this,"ix");f(this,"Mc");f(this,"wu");f(this,"Dm");this.p=At.mm(),this.Ni=!1,this.Lm=!1,this.wi=!1,this.Sc=!1,this.ix=!0,this.Mc=1,this.wu=!1,this.Oi=!0,this.kr=!0,this.Ao=600,this.kS=!1,this.PS=!1,this.Gn=new K,this.un=new ei,this.Am=new ei,this.un.ds=this,this.Gh=new K,this.tx=new K,this.Tm=new K,this.Dm=new K,e&&Object.assign(this,e)}To(e){this.p=e}rE(){return this.p}canStart(e){return!0}Fl(e){return!this.Oi||!this.canStart(e)?!1:(this.Gn.add(e),this.defaultAnimation.isAnimating&&this.stopAnimation(),this.p.Ci(),this.wi=!0,!0)}getBundleAnimation(){return this.Am}SS(){if(!this.Oi||(this.Am.ce.count>0&&this.Am.start(),!this.wi))return;const e=this.un,t=this.p,i=this.Gn.has("Model");if(i&&(this.Sc=!0,this.Mc===1?(e.isViewportUnconstrained=!0,e.ce.clear(),e.add(t,"position",t.position.copy().offset(0,-200),t.position),e.add(t,"opacity",0,1)):this.Mc===3&&e.ce.clear(),this.Mc===2&&t.ex.equals(t.at)?this.ix=!0:this.ix=!1,t.v("InitialAnimationStarting",this)),i&&!this.kr||e.ce.count===0){this.Gn.clear(),this.wi=!1,e.ce.clear(),e.sx(t),this.Sc=!1,t.C();return}this.Gn.clear(),t.Pr=!1;const s=e.ce.get(t);t.autoScale!==1&&s!==null&&(delete s.si.scale,delete s.gs.scale);const n=this;Z.requestAnimationFrame(()=>{n.wi===!1||e.Ni||(t.getRenderingHint("temporaryPixelRatio")&&t.Uw(),t.MS(),n.wi=!1,e.start(),e.Ni&&(n.ku(),t.invalidateDocumentBounds(),e.HC(0),t.yr(!0),n.Pu(),t.v("AnimationStarting",n)))})}NS(){return this.Gn.has("Trigger")&&this.Gn.count===1}qC(e,t,i,s){this.isTicking||this.NS()||e instanceof dt&&(e.fromNode!==null||e.toNode!==null)||this.un.add(e,"position",t,i,s)}nx(e){return this.un.nx(e)}CS(e){return this.un.CS(e)}hF(e){const t=this.Gh,i=this;function s(){if(i.Tm.count>0&&(t.addAll(i.Tm),i.Tm.clear(),i.Ni=!0),i.Ni===!1||t.count===0)return;i.tx.addAll(t);const n=i.tx.iterator;for(;n.next();){const o=n.value;o.Ni!==!1&&(o.aF()?o.WC(!1):o.Nc=!0)}if(i.tx.clear(),i.Ni===!1){Z.requestAnimationFrame(s);return}i.ku(),i.p.yr(),i.Pu(),Z.requestAnimationFrame(s)}this.Ni?this.cF(e):(this.Ni=!0,t.add(e),Z.requestAnimationFrame(()=>s()))}cF(e){this.Tm.add(e)}fF(){const e=this.Gh.iterator;for(;e.next();)e.value.Nc=!1}ku(){if(this.Lm)return;const e=this.p;this.kS=e.skipsUndoManager,this.PS=e.fe,e.skipsUndoManager=!0,e.fe=!0,this.Lm=!0}Pu(){const e=this.p;e.skipsUndoManager=this.kS,e.fe=this.PS,this.Lm=!1}stopAnimation(e){const t=this.un;if(this.wi===!0&&(this.wi=!1,this.Sc=!1,this.Gn.clear(),t.uF()&&this.p.requestUpdate()),!this.Ni){t.ce.clear(),t.sx(this.p);return}if(t.Su(!0),t.sx(null),e===!0){const i=this.Gh.toArray();for(let s=0;s<i.length;s++)i[s].Su(!0)}}Su(e){this.Gh.delete(e),this.Gh.count===0&&(this.Ni=!1,this.p.requestUpdate()),e===this.defaultAnimation&&this.p.v("AnimationFinished",this)}Cc(e,t){this.wi&&(!this.Gn.has("Expand Tree")&&!this.Gn.has("Expand SubGraph")||(this.un.Cc(e,t),this.JC(e)))}Lc(e,t){this.wi&&(!this.Gn.has("Collapse Tree")&&!this.Gn.has("Collapse SubGraph")||(this.un.Lc(e,t),this.un.LS(t,"position",t.position,t.position),this.JC(e)))}$C(e,t){!this.wi||e.equals(t)||this.NS()||(this.p.Bh||(e=t.copy()),this.un.LS(this.p,"position",e,t))}ZC(e,t){this.wi&&(this.NS()||this.un.add(this.p,"scale",e,t))}AS(e,t){e.Me&&(e.Sr=t,this.Dm.add(e))}JC(e){const t=e.findLinksConnected();for(;t.next();){const i=t.value;i.Me&&(i.Sr=i.points.copy(),this.Dm.add(i))}}get isEnabled(){return this.Oi}set isEnabled(e){this.Oi=e,e&&this.Gh.each(t=>{!t.isAnimating&&t.runCount===1/0&&t.start()})}get duration(){return this.Ao}set duration(e){e<1&&b._(e,">= 1",Je,"duration"),this.Ao=e}get isAnimating(){return this.Ni}get isTicking(){return this.Lm}get isInitial(){return this.kr}set isInitial(e){this.kr=e}get defaultAnimation(){return this.un}get activeAnimations(){return this.Gh}get initialAnimationStyle(){return this.Mc}set initialAnimationStyle(e){this.Mc=e}static defineAnimationEffect(e,t){Je.ox.set(e,t)}static TS(e,t,i,s,n){e===null&&(e=[0,0,0,0]),t===null&&(t=[0,0,0,0]);let o=e[0],r=e[1];const a=e[2],h=e[3];let l=t[0],u=t[1];const c=t[2],d=t[3];a===0||a===100?(o=l,r=u):(c===0||c===100)&&(l=o,u=r),Math.abs(l-o)>180&&(l>o?o+=360:l+=360);const m=n(i,o,l-o,s)%360,g=n(i,r,u-r,s),p=n(i,a,c-a,s),y=n(i,h,d-h,s);return"hsla("+m+", "+g+"%, "+p+"%, "+y+")"}};f(Je,"ox",new St),(()=>{const e=Je.ox,t=(i,s,n,o,r,a)=>{i.position=new S(o(r,s.x,n.x-s.x,a),o(r,s.y,n.y-s.y,a))};e.set("position:diagram",t),e.set("position",t),e.set("position:part",(i,s,n,o,r,a)=>{r<a?i.bc(o(r,s.x,n.x-s.x,a),o(r,s.y,n.y-s.y,a),!1):i.position=new S(o(r,s.x,n.x-s.x,a),o(r,s.y,n.y-s.y,a))}),e.set("location",(i,s,n,o,r,a)=>{r<a?i.bc(o(r,s.x,n.x-s.x,a),o(r,s.y,n.y-s.y,a),!0):i.location=new S(o(r,s.x,n.x-s.x,a),o(r,s.y,n.y-s.y,a))}),e.set("position:placeholder",(i,s,n,o,r,a)=>{r<a?i.bc(o(r,s.x,n.x-s.x,a),o(r,s.y,n.y-s.y,a),!1):i.position=new S(o(r,s.x,n.x-s.x,a),o(r,s.y,n.y-s.y,a))}),e.set("position:nodeCollapse",(i,s,n,o,r,a)=>{const h=i.actualBounds,l=n.actualBounds,u=l.x+l.width/2-h.width/2,c=l.y+l.height/2-h.height/2;r<a?i.bc(o(r,s.x,u-s.x,a),o(r,s.y,c-s.y,a),!1):i.position=new S(o(r,s.x,u-s.x,a),o(r,s.y,c-s.y,a))}),e.set("desiredSize",(i,s,n,o,r,a)=>{i.desiredSize=new ut(o(r,s.width,n.width-s.width,a),o(r,s.height,n.height-s.height,a))}),e.set("width",(i,s,n,o,r,a)=>{i.width=o(r,s,n-s,a)}),e.set("height",(i,s,n,o,r,a)=>{i.height=o(r,s,n-s,a)}),e.set("fill",(i,s,n,o,r,a)=>{i.fill=Je.TS(s,n,r,a,o)}),e.set("stroke",(i,s,n,o,r,a)=>{i.stroke=Je.TS(s,n,r,a,o)}),e.set("strokeWidth",(i,s,n,o,r,a)=>{i.strokeWidth=o(r,s,n-s,a)}),e.set("strokeDashOffset",(i,s,n,o,r,a)=>{i.strokeDashOffset=o(r,s,n-s,a)}),e.set("background",(i,s,n,o,r,a)=>{i.background=Je.TS(s,n,r,a,o)}),e.set("opacity",(i,s,n,o,r,a)=>{i.opacity=o(r,s,n-s,a)}),e.set("scale",(i,s,n,o,r,a)=>{i.scale=o(r,s,n-s,a)}),e.set("angle",(i,s,n,o,r,a)=>{i.angle=o(r,s,n-s,a)})})(),f(Je,"Default",1),f(Je,"AnimateLocations",2),f(Je,"None",3);let yi=Je;const je=class je{constructor(e){f(this,"rx");f(this,"Fm");f(this,"Ni");f(this,"Mu");f(this,"Ao");f(this,"ms");f(this,"QC");f(this,"Ac");f(this,"ce");f(this,"lx");f(this,"si");f(this,"jn");f(this,"Nu");f(this,"Tc");f(this,"hx");f(this,"ax");f(this,"Nc");f(this,"DS");f(this,"cx");f(this,"ds");f(this,"p");f(this,"FS");f(this,"RS");f(this,"vS");this.p=null,this.ds=null,this.DS=null,this.cx=null,this.FS=!1,this.Ni=!1,this.Nc=!1,this.si=0,this.jn=0,this.rx=je.EaseInOutQuad,this.Fm=je.EaseInOutQuad,this.Nu=!1,this.Tc=!1,this.hx=1,this.ax=0,this.Ao=NaN,this.ms=NaN,this.RS=0,this.Mu=null,this.QC=S.Po,this.ce=new St,this.lx=new St,this.Ac=new K,this.vS=1,e&&Object.assign(this,e)}suspend(){this.Nc=!0}advanceTo(e,t){t&&(this.Nc=!1),this.Nu&&e>=this.ms&&(this.Tc=!0,e=e-this.ms),this.RS=e,this.WC(!0),this.ds.ku(),this.p.yr(),this.ds.Pu(),this.p.redraw()}sx(e){if(this.lx.clear(),this.Tc=!1,this.ax=0,this.ms=NaN,this.Ac.count>0&&this.Ac.clear(),e!==null){const t=e.links;for(;t.next();)t.value.Sr=null}}uF(){return this.ce.count>0}start(){if(this.ce.count===0)return this;if(this.Ni)return this;let e=this.p;const t=this.ce.iterator;for(;t.next();){const s=t.key;e===null&&(s instanceof At?e=s:s instanceof he&&(e=s.diagram))}if(e!==null)this.p=e,this.ds=e.animationManager;else return this;const i=this.ds;return i.isEnabled===!1?this:(this.ms=isNaN(this.Ao)?i.duration:this.Ao,this.Fm=this.rx,i.Sc&&i.Mc===1&&this===i.defaultAnimation&&(this.Fm=je.EaseOutExpo,this.ms=isNaN(this.Ao)?i.duration===600?900:i.duration:this.Ao),this.vS=e.scrollMode,this.isViewportUnconstrained&&(e.jh=2),i.ku(),this.Ac.each(s=>{s.data=null,e.add(s)}),i.Pu(),this.Ni=!0,this.si=+new Date,this.jn=this.si+this.ms,i.hF(this),this)}addTemporaryPart(e,t){return e.Pe()?(this.Ac.add(e),this.p=t,this):this}add(e,t,i,s,n){if(this.p===null&&(e instanceof At?this.p=e:e instanceof he&&e.diagram!==null&&(this.p=e.diagram)),e instanceof Bt){if(!e.isAnimated)return this;t==="position"&&(t="position:part")}return this.LS(e,t,i,s,n),this}LS(e,t,i,s,n){const o=this.ce;let r,a,h;if(e instanceof At&&t==="position"&&(t="position:diagram"),(t==="fill"||t==="stroke"||t==="background")&&(jt.Do(i),jt.OS(),i=[jt.Ii.n0,jt.Ii.n1,jt.Ii.n2,jt.Ii.n3],jt.Do(s),jt.OS(),s=[jt.Ii.n0,jt.Ii.n1,jt.Ii.n2,jt.Ii.n3]),o.has(e))r=o.get(e),a=r.si,h=r.gs,a[t]===void 0&&(a[t]=this.Cu(i)),h[t]=this.Cu(s);else{if(t==="position"&&i.equalsApprox(s))return;a={},h={},a[t]=this.Cu(i),h[t]=this.Cu(s),r=new On(a,h,n),o.set(e,r)}const l=a[t];l instanceof S&&!l.isReal()&&l.a(this.QC),n&&t.indexOf("position:")===0&&e instanceof Bt?r.fx.location=this.Cu(e.location):n&&(r.fx[t]=this.Cu(i))}Cu(e){return e instanceof S||e instanceof ut?e.copy():e}dF(e){const t=this.ce;if(t.has(e)){const i=t.get(e);i.ux=!0}}nx(e){if(!this.Ni)return!1;const t=this.ce.get(e);return t!==null&&t.ux}CS(e){if(!this.Ni)return!1;const t=this.ce.get(e);return t!==null&&!!(t.si.position||t.si["position:part"]||t.si.location)}aF(){if(this.Ac.count>0)return!0;const e=this.ce.iterator;for(;e.next();){const t=e.key;if(t instanceof he&&t.diagram!==null||t instanceof At)return!0}return!1}WC(e){if(this.Nc&&!e)return;const t=this.ds;if(this.Ni===!1)return;const i=+new Date;let s=i>this.jn?this.ms:i-this.si;e&&(s=this.RS,s<this.ms?(this.si=+new Date-s,this.jn=this.si+this.ms):s=this.ms),t.ku(),this.HC(s),this.p.yr(!0),t.Pu(),i>this.jn&&(this.Nu&&!this.Tc?(this.si=+new Date,this.jn=this.si+this.ms,this.Tc=!0):this.Su(!1))}HC(e){const t=this.ms,i=this.ce.iterator,s=this.Tc;for(;i.next();){const n=i.key;if(n instanceof he&&n.diagram===null)continue;const o=i.value,r=s?o.gs:o.si,a=s?o.si:o.gs,h=yi.ox;for(const l in a)l==="position"&&(a["position:placeholder"]||a["position:nodeCollapse"])||h.get(l)!==null&&h.get(l)(n,r[l],a[l],this.Fm,e,t,this)}}stop(){return this.Ni?(this.Su(!0),this):this}Su(e){if(this.cx!==null&&this.cx.gF(this.DS),!this.Ni)return;const t=this.p,i=this.ds;i.Sc=!1,this.Ni=!1,this.Nc=!1,i.ku();const s=this.ce,n=this.Ac.iterator;for(;n.next();)t.remove(n.value);const o=this.Nu,r=s.iterator,a=yi.ox;for(;r.next();){const l=r.key,u=r.value,c=o?u.gs:u.si,d=o?u.si:u.gs,m=u.fx;for(const g in d)if(a.get(g)!==null){let p=g;u.gx&&(p==="position:nodeCollapse"||p==="position:placeholder")&&(p="position"),a.get(p)(l,c[g],m[g]!==void 0?m[g]:u.gx?c[g]:d[g],this.Fm,this.ms,this.ms,this)}u.gx&&m.location!==void 0&&l instanceof Bt&&(l.location=m.location),u.ux&&l instanceof Bt&&l.Ei(!1)}this.ax++;const h=!e&&this.hx>this.ax;if(!h&&(this===i.Am||this===i.defaultAnimation)&&this.ce.clear(),t.mx.clear(),t.yP(!1),t.invalidateDocumentBounds(),t.C(),t.yr(!0),i.defaultAnimation===this){const l=i.Dm.iterator;for(;l.next();)l.value.mF();i.Dm.clear()}if(t.yr(!0),this.isViewportUnconstrained&&(t.scrollMode=this.vS),i.Pu(),h){this.Tc=!1,this.start();return}this.sx(null),t._C(),i.Su(this),this.Mu&&this.Mu(this),t.requestUpdate()}Cc(e,t){const i=t.actualBounds;let s=null;if(t instanceof at&&(s=t.placeholder),s!==null&&s.visible){const n=s.getDocumentPoint(B.TopLeft),o=s.padding;n.x+=o.left,n.y+=o.top,this.add(e,"position",n,e.position,!1)}else this.add(e,"position",new S(i.x+i.width/2,i.y+i.height/2),e.position,!1);this.add(e,"scale",.01,e.scale,!1),e instanceof at&&this.pF(e,t)}pF(e,t){const i=e.memberParts;for(;i.next();){const s=i.value;s instanceof nt&&this.Cc(s,t)}}Lc(e,t){if(!e.isVisible())return;let i=null;if(t instanceof at&&(i=t.placeholder),i!==null&&i.visible){const s=i.getDocumentPoint(B.TopLeft),n=i.padding;s.x+=n.left,s.y+=n.top,this.add(e,"position:placeholder",e.position,s,!0)}else this.add(e,"position:nodeCollapse",e.position,t,!0);this.add(e,"scale",e.scale,.01,!0),this.dF(e),e instanceof at&&this.yF(e,t)}yF(e,t){const i=e.memberParts;for(;i.next();){const s=i.value;s instanceof nt&&this.Lc(s,t)}}get duration(){return this.Ao}set duration(e){b.i(e,"number",je,"duration"),e<1&&b._(e,">= 1",je,"duration"),this.Ao=e}get reversible(){return this.Nu}set reversible(e){this.Nu=e}get runCount(){return this.hx}set runCount(e){e>0?this.hx=e:b.o("Animation.runCount value must be a positive integer.")}get finished(){return this.Mu}set finished(e){this.Mu!==e&&(e!==null&&b.i(e,"function",je,"finished"),this.Mu=e)}get easing(){return this.rx}set easing(e){this.rx=e}get isViewportUnconstrained(){return this.FS}set isViewportUnconstrained(e){this.FS=e}get isAnimating(){return this.Ni}getTemporaryState(e){let t=this.lx.get(e);return t===null&&(t={},this.lx.set(e,t)),t}};f(je,"EaseLinear",(e,t,i,s)=>i*e/s+t),f(je,"EaseInOutQuad",(e,t,i,s)=>(e/=s/2,e<1?i/2*e*e+t:-i/2*(--e*(e-2)-1)+t)),f(je,"EaseInQuad",(e,t,i,s)=>i*(e/=s)*e+t),f(je,"EaseOutQuad",(e,t,i,s)=>-i*(e/=s)*(e-2)+t),f(je,"EaseInExpo",(e,t,i,s)=>e===0?t:i*Math.pow(2,10*(e/s-1))+t),f(je,"EaseOutExpo",(e,t,i,s)=>e===s?t+i:i*(-Math.pow(2,-10*e/s)+1)+t);let ei=je;class On{constructor(e,t,i){f(this,"si");f(this,"gs");f(this,"fx");f(this,"gx");f(this,"ux");this.si=e,this.gs=t,this.fx={},this.gx=i,this.ux=!1}}var on=(v=>(v[v.Default=1]="Default",v[v.Immediate=2]="Immediate",v[v.Bundled=3]="Bundled",v))(on||{});const Ji=class Ji{constructor(e,t,i){f(this,"ke");f(this,"an");f(this,"Lu");f(this,"Dc");this.ke=null,this.an=e,this.Lu=i||1,this.Dc=null,t!==void 0&&(this.Dc=t,i===void 0&&(this.Lu=2))}copy(){const e=new Ji(this.an);e.Lu=this.Lu;const t=this.Dc;if(t!==null){const i={};t.duration!==void 0&&(i.duration=t.duration),t.finished!==void 0&&(i.finished=t.finished),t.easing!==void 0&&(i.easing=t.easing),e.Dc=i}return e}get propertyName(){return this.an}set propertyName(e){this.an=e}get animationSettings(){return this.Dc}set animationSettings(e){this.Dc=e}wF(e){const t=this.Dc;t!==null&&(t.duration&&(e.duration=t.duration),t.finished&&(e.finished=t.finished),t.easing&&(e.easing=t.easing))}get startCondition(){return this.Lu}set startCondition(e){this.Lu=e}};f(Ji,"Default",1),f(Ji,"Immediate",2),f(Ji,"Bundled",3);let os=Ji;class Be{constructor(e){f(this,"p");f(this,"Mt");f(this,"Wt");f(this,"Mr");f(this,"Rl");f(this,"vl");f(this,"Ol");f(this,"Il");f(this,"El");f(this,"Bl");f(this,"Ul");f(this,"Vl");f(this,"zl");f(this,"Xl");f(this,"Kl");f(this,"Yl");f(this,"kc");f(this,"Gl");f(this,"px");f(this,"Rm");f(this,"Au");f(this,"At");K.Yi(this),this.p=null,this.At=new J,this.Mt="",this.Wt=1,this.Mr=!1,this.Rl=!0,this.vl=!0,this.Ol=!0,this.Il=!0,this.El=!0,this.Bl=!0,this.Ul=!0,this.Vl=!0,this.zl=!0,this.Xl=!0,this.Kl=!0,this.Yl=!0,this.kc=!0,this.Gl=!0,this.px=!0,this.Rm=!1,this.Au=[],e&&Object.assign(this,e)}xF(){const e=this.At;for(let t=0;t<e.length;t++)e.r[t].IS(null);e.clear(),this.Au.length=0}To(e){this.p=e}toString(e){e===void 0&&(e=0);const t='Layer "'+this.name+'"';if(e<=0)return t;let i=0,s=0,n=0,o=0,r=0;const a=this.At.iterator;for(;a.next();){const l=a.value;l instanceof at?n++:l instanceof nt?s++:l instanceof dt?o++:l instanceof Mt?r++:i++}let h="";if(i>0&&(h+=i+" Parts "),s>0&&(h+=s+" Nodes "),n>0&&(h+=n+" Groups "),o>0&&(h+=o+" Links "),r>0&&(h+=r+" Adornments "),e>1){const l=this.At.iterator;for(;l.next();){const u=l.value;h+=`
    `+u.toString();const c=u.data;c!==null&&K.as(c)&&(h+=" #"+K.as(c)),u instanceof nt?h+=" "+b.toString(c):u instanceof dt&&(h+=" "+b.toString(u.fromNode)+" "+b.toString(u.toNode))}}return t+" "+this.At.count+": "+h}findObjectAt(e,t,i){if(t===void 0&&(t=null),i===void 0&&(i=null),this.Gl===!1)return null;let s=!1;this.diagram!==null&&this.diagram.viewportBounds.containsPoint(e)&&(s=!0);const n=S.l(),o=this.At.r,r=o.length;for(let a=r;a--;){const h=o[a];if(s===!0&&h.Nl()===!1||!h.isVisible())continue;n.a(e),n.Ie(h.Es);let l=h.tL(n,t,i);if(l!==null&&(t!==null&&(l=t(l)),l!==null&&(i===null||i(l))))return S.s(n),l}return S.s(n),null}findObjectsAt(e,t,i,s){if(t===void 0&&(t=null),i===void 0&&(i=null),!(s instanceof J)&&!(s instanceof K)&&(s=new K),this.Gl===!1)return s;let n=!1;this.diagram!==null&&this.diagram.viewportBounds.containsPoint(e)&&(n=!0);const o=S.l(),r=this.At.r,a=r.length;for(let h=a;h--;){const l=r[h];if(n===!0&&l.Nl()===!1||!l.isVisible())continue;o.a(e),o.Ie(l.Es);let u=l;l.iL(o,t,i,s)&&(t!==null&&(u=t(u)),u!==null&&(i===null||i(u))&&s.add(u))}return S.s(o),s}findObjectsIn(e,t,i,s,n){if(t===void 0&&(t=null),i===void 0&&(i=null),s===void 0&&(s=!1),!(n instanceof J)&&!(n instanceof K)&&(n=new K),this.Gl===!1)return n;let o=!1;this.diagram!==null&&this.diagram.viewportBounds.containsRect(e)&&(o=!0);const r=this.At.r,a=r.length;for(let h=a;h--;){const l=r[h];if(o===!0&&l.Nl()===!1||!l.isVisible())continue;let u=l;l.vm(e,t,i,s,n)&&(t!==null&&(u=t(u)),u!==null&&(i===null||i(u))&&n.add(u))}return n}NP(e,t,i,s,n,o,r){if(this.Gl===!1)return n;const a=this.At.r,h=a.length;for(let l=h;l--;){const u=a[l];if(r===!0&&u.Nl()===!1||!o(u)||!u.isVisible())continue;let c=u;u.vm(e,t,i,s,n)&&(t!==null&&(c=t(c)),c!==null&&(i===null||i(c))&&n.add(c))}return n}findObjectsNear(e,t,i,s,n,o){if(i===void 0&&(i=null),s===void 0&&(s=null),n===void 0&&(n=!0),n!==!1&&n!==!0&&((n instanceof J||n instanceof K)&&(o=n),n=!0),!(o instanceof J)&&!(o instanceof K)&&(o=new K),this.Gl===!1)return o;let r=!1;this.diagram!==null&&this.diagram.viewportBounds.containsPoint(e)&&(r=!0);const a=S.l(),h=S.l(),l=this.At.r,u=l.length;for(let c=u;c--;){const d=l[c];if(r===!0&&d.Nl()===!1||!d.isVisible())continue;a.a(e),a.Ie(d.Es),h.e(e.x+t,e.y),h.Ie(d.Es);let m=d;d.eL(a,h,i,s,n,o)&&(i!==null&&(m=i(m)),m!==null&&(s===null||s(m))&&o.add(m))}return S.s(a),S.s(h),o}ES(){return this.At.r}Bs(e,t){if(!this.visible)return;const i=this.At.r,s=i.length;if(s===0)return;const n=b.nt(),o=b.nt();for(let r=0;r<s;r++){const a=i[r];if(a.BS=r,a instanceof dt){if(a.Me===!1)continue}else if(a instanceof Mt&&a.adornedPart!==null)continue;const h=a.actualBounds;a.isVisible()&&h.intersectsRectPlus(t,10)?(a.Bs(!0),n.push(a)):(a.Bs(!1),a.adornments!==null&&a.adornments.count>0&&o.push(a))}for(let r=0;r<n.length;r++){const a=n[r];a.US();const h=a.adornments;for(;h.next();){const l=h.value;l.ut(1/0,1/0),l.zt(),l.Bs(!0)}}for(let r=0;r<o.length;r++)o[r].US();b.tt(n),b.tt(o)}Tu(e){let t=1;return this.Wt!==1&&(t=e.globalAlpha,e.globalAlpha=t*this.Wt),t}sL(e,t){for(let i=0;i<t;i++)e[i].Du()}Gi(e,t,i){if(!this.visible||this.Wt===0||(i===void 0&&(i=!0),!i&&this.isTemporary))return;const s=this.At.r,n=s.length;if(n===0)return;e.Mr&&this.sL(s,n);const o=this.Tu(e),r=this.Au;r.length=0;const a=t.scale,h=z.l();for(let l=0;l<n;l++){const u=s[l];this.Om(e,u,t,r,a,h,!0)}z.s(h),e.Mr&&this.sL(s,n),e.globalAlpha=o}lE(e,t,i){if(!this.visible||this.Wt===0)return;const s=this.At.r,n=s.length;if(n===0)return;const o=this.Tu(e),r=this.Au;r.length=0;const a=t.scale,h=z.l();for(let l=0;l<n;l++){const u=s[l];i.has(u)||this.Om(e,u,t,r,a,h,!0)}z.s(h),e.globalAlpha=o}bF(e,t,i,s){if(!this.visible||this.Wt===0||!s&&this.isTemporary)return;const n=this.At.r,o=n.length;if(o===0)return;const r=this.Tu(e),a=this.Au;a.length=0;const h=t.scale,l=z.l();for(let u=0;u<o;u++){const c=n[u];i.has(c)&&this.Om(e,c,t,a,h,l,!1)}z.s(l),e.globalAlpha=r}kF(e,t,i,s,n){if(!this.visible||this.opacity===0)return;const o=this.diagram.grid.part;if(!s&&this.isTemporary){if(n&&o.layer===this){const r=this.Tu(e);o.Gi(e,i),e.globalAlpha=r}}else{const r=this.Tu(e),a=i.scale,h=z.l(),l=this.At.r,u=l.length;for(let c=0;c<u;c++){const d=l[c];!n&&d===o||this.Om(e,d,i,null,a,h,!1)}z.s(h),e.globalAlpha=r}}hE(e,t,i){if(!this.visible||this.Wt===0)return;const s=this.Tu(e),n=this.Au;n.length=0;const o=t.scale,r=z.l(),a=this.At.r,h=a.length,l=i.length;for(let u=0;u<h;u++){const c=a[u],d=c.Hh(c.actualBounds);this.PF(d,i,l,o)&&this.Om(e,c,t,n,o,r,!0)}z.s(r),e.globalAlpha=s}Om(e,t,i,s,n,o,r){if(r&&!t.Nl()){e.removePartFromView(t);return}if(s!==null&&t instanceof dt&&(t.isOrthogonal&&s.push(t),t.Me===!1)){e.removePartFromView(t);return}let a=!1,h=t.containingGroup;for(;h!==null;)a?h.ni!==null&&o.intersectRect(h.ni):h.ni!==null&&(a=!0,o.a(h.ni)),h=h.containingGroup;const l=t.actualBounds;let u=!1;if(a&&t.isVisible()){if(!o.intersectsRect(l)){e.removePartFromView(t);return}u=!o.containsRect(l)}u&&(e.save(),e instanceof ze?e.partClipRect=o.copy():(e.beginPath(),e.rect(o.x,o.y,o.width,o.height),e.clip())),l.width*n>i.Im||l.height*n>i.Im?t.Gi(e,i):this.SF(e,t),u&&(e.restore(),e.clearContextCache(!0))}SF(e,t){const i=t.actualBounds,s=t.naturalBounds;if(i.width===0||i.height===0||isNaN(i.x)||isNaN(i.y)||!t.isVisible())return;const n=t.D;if(t.background===null){t.dn(e,"rgba(0,0,0,0.3)",!0,!1,s,i),e.fillRect(i.x,i.y,i.width,i.height);return}if(e.transform(n.m11,n.m12,n.m21,n.m22,n.dx,n.dy),t.dn(e,t.background,!0,!1,s,i),e.fillRect(0,0,s.width/2,s.height/2),!n.Ok()){const o=1/(n.m11*n.m22-n.m12*n.m21);e.transform(n.m22*o,-n.m12*o,-n.m21*o,n.m11*o,o*(n.m21*n.dy-n.m22*n.dx),o*(n.m12*n.dx-n.m11*n.dy))}}PF(e,t,i,s){const n=2/s,o=4/s;for(let r=0;r<i;r++){const a=t[r];if(!(a.width===0||a.height===0)&&e.intersects(a.x-n,a.y-n,a.width+o,a.height+o))return!0}return!1}t(e,t,i,s,n){const o=this.diagram;o!==null&&o.raiseChangedEvent(2,e,this,t,i,s,n)}qh(e,t,i){const s=this.At;if(t.IS(this),e>=s.count)e=s.count;else if(s.elt(e)===t)return-1;s.insertAt(e,t),t.Em(i);const n=this.diagram;return n!==null&&(i?n.C():n.qh(t)),this.yx(e,t),e}te(e,t,i){if(!i&&t.layer!==this&&t.layer!==null)return t.layer.te(e,t,i);const s=this.At;if(e<0||e>=s.length){if(e=s.indexOf(t),e<0)return-1}else if(s.elt(e)!==t&&(e=s.indexOf(t),e<0))return-1;t.Bm(i),s.removeAt(e);const n=this.diagram;return n!==null&&(i?n.C():n.te(t)),t.IS(null),e}yx(e,t){e=this.MF(e,t),t instanceof at&&this.NF(e,t),t.svg!==null&&t.svg.remove()}MF(e,t){const i=t.zOrder;if(isNaN(i))return e;const s=this.At,n=s.count;if(n<=1)return e;if(e<0&&(e=s.indexOf(t)),e<0)return-1;let o=e-1,r=NaN;for(;o>=0&&(r=s.elt(o).zOrder,!!isNaN(r));)o--;let a=e+1,h=NaN;for(;a<n&&(h=s.elt(a).zOrder,!!isNaN(h));)a++;if(!isNaN(r)&&r>i)for(;;){if(o===-1||r<=i)return o++,o===e?e:(s.removeAt(e),s.insertAt(o,t),o);for(r=NaN;--o>=0&&(r=s.elt(o).zOrder,!!isNaN(r)););}else if(!isNaN(h)&&h<i)for(;;){if(a===n||h>=i)return a--,a===e?e:(s.removeAt(e),s.insertAt(a,t),a);for(h=NaN;++a<n&&(h=s.elt(a).zOrder,!!isNaN(h)););}return e}NF(e,t){if(t===null||!isNaN(t.zOrder))return;this.CF(e,t);const i=t.containingGroup;i!==null&&this.yx(-1,i)}CF(e,t){if(t.memberParts.count===0)return;let i=-1;const s=this.At.r,n=s.length;for(let o=0;o<n;o++){const r=s[o];if(r===t&&(e=o,i>=0)||i<0&&r.containingGroup===t&&(i=o,e>=0))break}if(!(i<0)&&i<e){const o=this.At;o.removeAt(e),o.insertAt(i,t)}}get parts(){return this.At.iterator}get partsBackwards(){return this.At.iteratorBackwards}get diagram(){return this.p}get name(){return this.Mt}set name(e){const t=this.Mt;if(t!==e){const i=this.diagram;if(i!==null){t===""&&b.o("Cannot rename default Layer to: "+e);const n=i.layers;for(;n.next();)n.value.name===e&&b.o("Layer.name is already present in this diagram: "+e)}this.Mt=e,this.t("name",t,e);const s=this.At.iterator;for(;s.next();){const n=s.value;n.layerName=this.Mt}}}get opacity(){return this.Wt}set opacity(e){const t=this.Wt;if(t!==e){(e<0||e>1)&&b._(e,"0 <= value <= 1",Be,"opacity"),this.Wt=e;const i=this.diagram;i!==null&&i.C(),this.t("opacity",t,e)}}get isViewportAligned(){return this.Rm}set isViewportAligned(e){const t=this.Rm;t!==e&&(this.Rm=e,this.diagram&&(this.nL(),this.diagram.C()),this.t("isViewportAligned",t,e),e&&(this.isInDocumentBounds=!1))}nL(){if(!this.Rm)return;const e=this.diagram,t=this.At.r,i=t.length,s=e.kt,n=e.Pt;for(let o=0;o<i;o++){const r=t[o],a=r.naturalBounds.width,h=r.naturalBounds.height;let l=r.alignment;(l.isDefault()||!l.isSpot())&&(l=B.BottomRight);let u=r.alignmentFocus;u.isDefault()&&(u=new B(l.x,l.y));const c=l.x*s+l.offsetX-(u.x*a+u.offsetX),d=l.y*n+l.offsetY-(u.y*h+u.offsetY),m=S.X(c,d);e.LF(m),r.bc(m.x,m.y,!0),S.s(m),r.et=1/e.scale}}get isTemporary(){return this.Mr}set isTemporary(e){const t=this.Mr;t!==e&&(this.Mr=e,this.t("isTemporary",t,e))}get visible(){return this.kc}set visible(e){const t=this.kc;if(t!==e){this.kc=e;const i=this.At.iterator;for(;i.next();)i.value.Ei(e);const s=this.diagram;s!==null&&s.C(),this.t("visible",t,e)}}get pickable(){return this.Gl}set pickable(e){const t=this.Gl;t!==e&&(this.Gl=e,this.t("pickable",t,e))}get isInDocumentBounds(){return this.px}set isInDocumentBounds(e){const t=this.px;t!==e&&(this.px=e,this.diagram!==null&&this.diagram.invalidateDocumentBounds(),this.t("isInDocumentBounds",t,e))}get allowCopy(){return this.Rl}set allowCopy(e){const t=this.Rl;t!==e&&(this.Rl=e,this.t("allowCopy",t,e))}get allowDelete(){return this.vl}set allowDelete(e){const t=this.vl;t!==e&&(this.vl=e,this.t("allowDelete",t,e))}get allowTextEdit(){return this.Ol}set allowTextEdit(e){const t=this.Ol;t!==e&&(this.Ol=e,this.t("allowTextEdit",t,e))}get allowGroup(){return this.Il}set allowGroup(e){const t=this.Il;t!==e&&(this.Il=e,this.t("allowGroup",t,e))}get allowUngroup(){return this.El}set allowUngroup(e){const t=this.El;t!==e&&(this.El=e,this.t("allowUngroup",t,e))}get allowLink(){return this.Bl}set allowLink(e){const t=this.Bl;t!==e&&(this.Bl=e,this.t("allowLink",t,e))}get allowRelink(){return this.Ul}set allowRelink(e){const t=this.Ul;t!==e&&(this.Ul=e,this.t("allowRelink",t,e))}get allowMove(){return this.Vl}set allowMove(e){const t=this.Vl;t!==e&&(this.Vl=e,this.t("allowMove",t,e))}get allowReshape(){return this.zl}set allowReshape(e){const t=this.zl;t!==e&&(this.zl=e,this.t("allowReshape",t,e))}get allowResize(){return this.Xl}set allowResize(e){const t=this.Xl;t!==e&&(this.Xl=e,this.t("allowResize",t,e))}get allowRotate(){return this.Kl}set allowRotate(e){const t=this.Kl;t!==e&&(this.Kl=e,this.t("allowRotate",t,e))}get allowSelect(){return this.Yl}set allowSelect(e){const t=this.Yl;t!==e&&(this.Yl=e,this.t("allowSelect",t,e))}}var Ss=(v=>(v[v.None=1]="None",v[v.Uniform=2]="Uniform",v[v.UniformToFill=3]="UniformToFill",v))(Ss||{}),rn=(v=>(v[v.All=1]="All",v[v.NotDirected=2]="NotDirected",v[v.NotDirectedFast=3]="NotDirectedFast",v[v.NotUndirected=4]="NotUndirected",v[v.DestinationTree=5]="DestinationTree",v[v.SourceTree=6]="SourceTree",v))(rn||{}),an=(v=>(v[v.Document=1]="Document",v[v.Infinite=2]="Infinite",v))(an||{}),hn=(v=>(v[v.TreeParent=1]="TreeParent",v[v.AllParents=2]="AllParents",v[v.AnyParents=3]="AnyParents",v))(hn||{});const Y=class Y{constructor(e,t){f(this,"ds");f(this,"di");f(this,"VS");f(this,"wx");f(this,"Nr");f(this,"Fu");f(this,"xx");f(this,"bx");f(this,"kx");f(this,"Px");f(this,"Sx");f(this,"Mx");f(this,"Fc");f(this,"jh");f(this,"Nx");f(this,"Cx");f(this,"Lx");f(this,"jl");f(this,"Rc");f(this,"Cr");f(this,"Um");f(this,"Ax");f(this,"Tx");f(this,"Ru");f(this,"Hn");f(this,"Lr");f(this,"Wh");f(this,"Fo");f(this,"Vm");f(this,"vc");f(this,"zm");f(this,"Oc");f(this,"vu");f(this,"Ar");f(this,"qn");f(this,"zS");f(this,"XS");f(this,"Dx");f(this,"Fx");f(this,"KS");f(this,"Rx");f(this,"YS");f(this,"GS");f(this,"jS");f(this,"vx");f(this,"Xm");f(this,"Tr");f(this,"Dr");f(this,"Fr");f(this,"Rr");f(this,"vr");f(this,"Or");f(this,"Ox");f(this,"Ir");f(this,"Ix");f(this,"Er");f(this,"Br");f(this,"Ur");f(this,"Vr");f(this,"Ex");f(this,"HS");f(this,"Ro");f(this,"qS");f(this,"Bx");f(this,"Ux");f(this,"WS");f(this,"Si");f(this,"JS");f(this,"$S");f(this,"ZS");f(this,"vs");f(this,"vo");f(this,"Oi");f(this,"Vx");f(this,"Rl");f(this,"vl");f(this,"zx");f(this,"Xx");f(this,"Ol");f(this,"Il");f(this,"El");f(this,"Kx");f(this,"Bl");f(this,"Ul");f(this,"Vl");f(this,"zl");f(this,"Xl");f(this,"Kl");f(this,"Yl");f(this,"Yx");f(this,"Gx");f(this,"QS");f(this,"Ou");f(this,"Iu");f(this,"jx");f(this,"Hx");f(this,"qx");f(this,"Wx");f(this,"Km");f(this,"Jx");f(this,"$x");f(this,"Zx");f(this,"$t");f(this,"_S");f(this,"Qx");f(this,"tM");f(this,"Eu");f(this,"gn");f(this,"Wn");f(this,"ie");f(this,"Jn");f(this,"oL");f(this,"Hl");f(this,"iM");f(this,"eM");f(this,"Ym");f(this,"_x");f(this,"Bu");f(this,"Gm");f(this,"tb");f(this,"zr");f(this,"ql");f(this,"Jh");f(this,"sM");f(this,"nM");f(this,"jm");f(this,"ib");f(this,"eb");f(this,"ts");f(this,"Hm");f(this,"qm");f(this,"Uu");f(this,"Wl");f(this,"Ic");f(this,"Wm");f(this,"Xr");f(this,"$h");f(this,"oM");f(this,"Jm");f(this,"Ht");f(this,"D");f(this,"Ue");f(this,"Pr");f(this,"Bi");f(this,"ps");f(this,"rM");f(this,"Jl");f(this,"Kr");f(this,"bl");f(this,"Yr");f(this,"Zh");f(this,"Ec");f(this,"lM");f(this,"Vu");f(this,"Qh");f(this,"zu");f(this,"Gt");f(this,"$l");f(this,"at");f(this,"et");f(this,"Xu");f(this,"kt");f(this,"Pt");f(this,"dt");f(this,"Bc");f(this,"Bw");f(this,"sb");f(this,"_h");f(this,"Uc");f(this,"nb");f(this,"ob");f(this,"rb");f(this,"AF");f(this,"TF");f(this,"Ui");f(this,"Pl");f(this,"Im");f(this,"$m");f(this,"hM");f(this,"aM");f(this,"rL");f(this,"Zm");f(this,"DF");f(this,"FF");f(this,"RF");f(this,"lb");f(this,"vF");f(this,"OF");f(this,"IF");f(this,"ta");f(this,"lL");f(this,"Zl");f(this,"ia");f(this,"ea");f(this,"sa");f(this,"na");f(this,"yu");f(this,"Yh");f(this,"Zt");f(this,"Tt");f(this,"Vc");f(this,"Wk");f(this,"Jk");f(this,"fc");f(this,"Wt");f(this,"pu");f(this,"ab");f(this,"cb");f(this,"fb");f(this,"ub");f(this,"db");f(this,"Qm");f(this,"uM");f(this,"_m");f(this,"t0");f(this,"i0");f(this,"ex");f(this,"dM");f(this,"gb");f(this,"zc");if(Y.uw||(Y.Ik(),Y.uw=!0),K.Yi(this),Y.aL(this),this.Ht=!0,this.Tt=null,this.kt=0,this.Pt=0,this.dt=null,Y.isUsingDOM()){const s=this,n=()=>{s.Mi(Z.document,"DOMContentLoaded",n,!1),s.setRTL()};Z.document.body!==null?this.setRTL():s.Vt(Z.document,"DOMContentLoaded",n,!1)}this.Bc=null,Y.gM("Model",Ei);const i=this;return this.JS=s=>i.partManager.doModelDataChanged(s),this.$S=s=>i.partManager.doModelChanged(s),this.nb=null,this.ob=null,this.cL(),this.model=mt.initDiagramModel(),this.gb=null,this.themeManager=new us,this.Ro=!0,this.fL(),this.layout=new be,this.Ro=!1,this.DF=null,this.FF=null,this.RF=null,this.lb=null,this.vF=null,this.OF=null,this.IF=null,this.ta=null,this.lL=null,this.Zl=null,this.ia=null,this.ea=null,this.sa=null,this.na=null,this.yu=()=>{},this.Yh=null,this.Uu=!1,this.Vc=new Rn(this),e!==void 0&&(typeof e=="string"||Z.Element&&e instanceof Element?this.mM(e):t=e),t&&this.setProperties(t),this.Ht=!1,this.requestUpdate(),this}HD(){return this.dt!==null}get renderer(){return this.Ic}set renderer(e){if(this instanceof ms)return;e===""&&(e="default");const t=e.toLowerCase(),i=this.Ic;if(t===i)return;this.Ic=t;let s=null;t==="default"||t==="canvas"?(s=this.Wl.get("svg"),s!==null&&s.Ft.remove(),this.dt&&(this.Zt=this.dt.ai),this.Zt.clearContextCache(!0)):t==="svg"?(this.Wl.has("svg")?s=this.Wl.get("svg"):(s=new as(this,Z.document),this.addRenderer("svg",s)),this.div!==null&&this.div.appendChild(s.Ft),this.Zt=s.ai,this.dt&&(this.dt.ai.setTransform(this.Ui,0,0,this.Ui,0,0),this.dt.ai.clearRect(0,0,this.kt,this.Pt))):t==="debug"&&(this.Wl.has("SVG")||(s=new as(this,Z.document),this.addRenderer("SVG",s),s.Ft.style.backgroundColor="whitesmoke",this.div!==null&&this.div.after(s.Ft))),this.Ht||this.redraw()}cL(){this.zc=new J,this.setupRouters(),this.ds=new yi,this.ds.To(this),this.di=17,this.VS=!1,this.Xu=!1,this.wx="default",this.Gt=new J,this.Wl=new St,this.Ic="default",this.resetRenderingHints(),this.EF(),this.Wt=1,this.at=new S(NaN,NaN).g(),this.ex=new S(NaN,NaN),this.et=1,this.Jm=1,this.xx=new S(NaN,NaN).g(),this.bx=NaN,this.kx=1e-4,this.Px=100,this.D=new Tt,this.Sx=new S(NaN,NaN).g(),this.Mx=new z(NaN,NaN,NaN,NaN).g(),this.Fc=new Kt(0,0,0,0).g(),this.jh=1,this.Nx=!1,this.Cx=null,this.Lx=null,this.jl=1,this.Rc=B.Default,this.Cr=1,this.Um=B.Default,this.Ax=B.None,this.Tx=B.None,this.Ue=!0,this.Ru=!1,this.Hn=new Set,this.Lr=new K,this.Wh=new K,this.Fo=!1,this.$l=new St,this.Vu=!0,this.Vm=250,this.vc=-1,this.zm=new Kt(16,16,16,16).g(),this.Pr=!1,this.Oc=!1,this.vu=!0,this.Wm=new ui,this.Wm.diagram=this,this.Xr=new ui,this.Xr.diagram=this,this.$h=new ui,this.$h.diagram=this,this.Ar=null,this.qn=null,this.Bw=!1,this.BF(),this.Yr=new K,this.Dx=!0,this.Fx=1,this.KS=!1,this.Rx=1,this.vx="auto",this.Xm="auto",this.Tr=null,this.Dr=null,this.Fr=null,this.Rr=null,this.vr=null,this.Or=null,this.Ox=null,this.Ir=null,this.Ix=!1,this.Er=null,this.Br=null,this.Ur=null,this.Vr=null,this.Ex=!1,this.sb={},this._h=[null,null],this.Ro=!1,this.qS=!1,this.Bx=!1,this.Ux=!1,this.WS=!0,this.ps=!1,this.Qh=!1,this.ZS=!0,this.vs=-2,this.Jl=new St,this.zu=new J,this.vo=!1,this.Oi=!0,this.Vx=!0,this.Rl=!0,this.vl=!0,this.zx=!1,this.Xx=!0,this.Ol=!0,this.Il=!0,this.El=!0,this.Kx=!0,this.Bl=!0,this.Ul=!0,this.Vl=!0,this.zl=!0,this.Xl=!0,this.Kl=!0,this.Yl=!0,this.Yx=!0,this.Gx=!0,this.QS=!1,this.Uc=!1,this.Ou=!0,this.Iu=!0,this.jx=!0,this.Hx=!0,this.qx=16,this.Wx=16,this.Km=!1,this.Jx=!1,this.$x=0,this.Zx=0,this.$t=new Kt(5).g(),this._S=new K().g(),this.Qx=999999999,this.tM=new K().g(),this.Zh=!0,this.Eu=!0,this.Ec=!0,this.gn=!1,this.Wn=!1,this.Kr=!0,this.bl=!1,this.Jn=!1,this.oL=new K,this.lM=new K,this.Hl=null,this.iM=new ut(8,8),this.eM=999,this.Ym=!1,this.Wk=1,this.Jk=0,this.Bi={scale:1,position:new S,bounds:new z,canvasSize:new ut,newCanvasSize:new ut,isScroll:!1},this.Bi.canvasSize=this.Bi.canvasSize,this.Bi.newCanvasSize=this.Bi.newCanvasSize,this.Bi.isScroll=!1,this._x=new z(NaN,NaN,NaN,NaN).g(),this.Bu=new ut(NaN,NaN).g(),this.Gm=new z(NaN,NaN,NaN,NaN).g(),this.tb=!1,this.UF(),this.ts=null,this.Hm=!1,this.fc=null,this.partManager=new Ei,this.toolManager=new Ve,this.toolManager.initializeStandardTools(),this.defaultTool=this.toolManager,this.currentTool=this.defaultTool,this.cb=null,this.fb=new gs,this.ub=null,this.db=null,this.ab=!1,this.pu=!1,this.commandHandler=new Ye,this.t0=null,this.i0=S.Ak,this.dM=!1,this.Ui=1,this.Pl=null,this.Im=1,this.Qm=0,this.uM=[0,0,0,0,0],this._m=0,this.$m=1,this.hM=0,this.aM=new S,this.rL=500,this.qm=new S,this.Zm=!1}static isUsingDOM(){return Y.uL}static useDOM(e){Y.uL=e?Z.document!==void 0:!1}clear(){this.animationManager.stopAnimation(),this.model.clear(),Y.dL(),this.gL(!1),this.zu.clear(),this.mL(),this.Hl=null,this.invalidateDocumentBounds(),this.ensureBounds(),this.C()}gL(e){this.animationManager.stopAnimation(!0),this._S=new K().g(),this.tM=new K().g();const t=this.skipsUndoManager,i=this.Si!==null&&this.Si!==void 0;i&&(this.skipsUndoManager=!0);let s=null;this.ts!==null&&(s=this.ts.part,s!==null&&this.remove(s));const n=[],o=this.Gt.length;if(e){for(let r=0;r<o;r++){const a=this.Gt.r[r].parts;for(;a.next();){const h=a.value;h!==s&&h.data===null&&n.push(h)}}for(let r=0;r<n.length;r++){const a=n[r];this.remove(a)}}for(let r=0;r<o;r++)this.Gt.r[r].xF();return this.partManager.clear(),this.Hn.clear(),this.Lr.clear(),this.Wh.clear(),this.$l.clear(),this.Yr.clear(),this.fc=null,this.zu.clear(),this.mL(),b.Ck=[],s!==null&&(this.add(s),this.partManager.parts.delete(s)),i&&(this.skipsUndoManager=t),n}static dL(){Y.e0=null,Y.mb=""}static aE(){return null}reset(){this.clear(),this.Ht=!0,this.cL(),this.themeManager=new us,this.Ql(),this.Ro=!0,this.fL(),this.layout=new be,this.Ro=!1,this.model=mt.initDiagramModel(),this.model.undoManager=new Li,this.Uu=!1,this.Ht=!1,this.C()}UF(){this.zr=new St,this.sM=new nt().add(new Qt({stroke:"black",font:"10pt sans-serif"}).bind("text","",b.toString).theme("stroke","text").theme("font","normal")),this.zr.set("",this.sM),this.zr.set("Comment",new nt().add(new Qt({stroke:"brown",font:"10pt sans-serif"}).bind("text","",b.toString).theme("stroke","comment").theme("font","normal"))),this.zr.set("LinkLabel",new nt({selectable:!1,avoidable:!1}).add(new bt("Ellipse",{fill:"black",stroke:null,desiredSize:new ut(3,3).it()}).theme("fill","link"))),this.Jh=new St,this.rM=new at(ct.Vertical,{selectionObjectName:"GROUPPANEL"}).add(new Qt({stroke:"black",font:"bold 12pt sans-serif"}).bind("text","",b.toString).theme("stroke","text").theme("font","bold"),new ct(ct.Auto,{name:"GROUPPPANEL"}).add(new bt({fill:"rgba(128,128,128,0.2)",stroke:"black",strokeWidth:1}).theme("fill","group").theme("stroke","outline").theme("strokeWidth","group"),new Ue({padding:5}).theme("padding","group"))),this.Jh.set("",this.rM),this.ql=new St,this.nM=new dt().add(new bt({isPanelMain:!0,stroke:"black"}).theme("stroke","link"),new bt({toArrow:"Standard",fill:"black",stroke:null,strokeWidth:0}).theme("toArrow").theme("fill","link")),this.ql.set("",this.nM),this.ql.set("Comment",new dt().add(new bt({isPanelMain:!0,stroke:"brown"}).theme("stroke","comment"))),this.jm=new Mt(ct.Auto).add(new bt({fill:null,stroke:"dodgerblue",strokeWidth:3}).theme("stroke","selection").theme("strokeWidth","selection"),new Ue({margin:1.5}).theme("margin","selection","numbers",null,e=>e?new Kt(e/2):1.5)),this.ib=this.jm,this.eb=new Mt(ct.Link).add(new bt({isPanelMain:!0,fill:null,stroke:"dodgerblue",strokeWidth:3}).theme("stroke","selection").theme("strokeWidth","selection"))}setRTL(e){let t=e===void 0?this.div:e;t===null&&(t=Z.document.body);const i=b.en("div");i.dir="rtl",i.style.cssText="font-size: 14px; width: 1px; height: 1px; position: absolute; top: -1000px; overflow: scroll;",i.textContent="A",t.appendChild(i);let s="reverse";i.scrollLeft>0?s="default":(i.scrollLeft=1,i.scrollLeft===0&&(s="negative")),t.removeChild(i),this.wx=s}setScrollWidth(e){let t=e===void 0?this.div:e;t===null&&(t=Z.document.body);let i=0;if(Y.isUsingDOM()){let s=Y.fM,n=Y.cM;s===null&&(Y.fM=b.en("p"),s=Y.fM,s.style.width="100%",s.style.height="200px",s.style.boxSizing="content-box",Y.cM=b.en("div"),n=Y.cM,n.style.position="absolute",n.style.visibility="hidden",n.style.width="200px",n.style.height="150px",n.style.boxSizing="content-box",n.appendChild(s)),n.style.overflow="hidden",t.appendChild(n);const o=s.offsetWidth;n.style.overflow="scroll";let r=s.offsetWidth;o===r&&(r=n.clientWidth),t.removeChild(n),i=o-r,i===0&&!b.rr&&(i=11)}this.di=i,this.VS=!0}ri(e){e in Ss?this.autoScale=e:b.lr(this,e)}toString(e){e===void 0&&(e=0);let t="";this.div&&this.div.id&&(t=this.div.id);let i='Diagram "'+t+'"';if(e<=0)return i;const s=this.Gt.iterator;for(;s.next();){const n=s.value;i+=`
  `+n.toString(e-1)}return i}static aL(e){Y.hb=e}static mm(){return Y.hb}static fromDiv(e){let t=e;if(typeof e=="string"&&(t=Z.document.getElementById(e)),t instanceof HTMLDivElement){const i=Y.Ve.get(t);if(i)return i}return null}get div(){return this.Tt}set div(e){if(this.Tt!==e){const t=this.Tt;if(t!==null){if(Y.Ve.delete(t),t.goDiagram=void 0,t.go=void 0,t.innerHTML="",this.dt!==null){const s=this.dt.Ft;this.Mi(s,"pointermove",this.ia,!1),this.Mi(s,"pointerdown",this.Zl,!1),this.Mi(s,"pointerup",this.ea,!1),this.Mi(s,"pointerout",this.sa,!1),this.Mi(s,"pointercancel",this.na,!1),this.dt.dispose()}this.Bc&&(this.Bc.disconnect(),this.Bc=null);const i=this.toolManager;i!==null&&(i.mouseDownTools.each(s=>s.cancelWaitAfter()),i.mouseMoveTools.each(s=>s.cancelWaitAfter()),i.mouseUpTools.each(s=>s.cancelWaitAfter())),i.cancelWaitAfter(),this.currentTool.doCancel(),this.dt=null,this.Mi(Z,"resize",this.lb,!1),this.Mi(Z,"wheel",this.ta,!0),Y.mm()===this&&Y.aL(null)}else this.Zl===null&&(this.Jn=!1);if(this.Tt=null,e!==null){const i=Y.Ve.get(e);i&&(i.div=null),this.mM(e),this.yu(),this.themeManager&&this.themeManager.VF()}else this.themeManager&&this.themeManager.zF()}}setupRouters(){this.zc.push(new io)}mM(e){const t=this;if(!Y.isUsingDOM())return;e==null&&b.o("Diagram setup requires an argument DIV."),t.Tt!==null&&b.o("Diagram has already completed setup."),typeof e=="string"?t.Tt=Z.document.getElementById(e):e instanceof HTMLDivElement?t.Tt=e:b.o("No DIV or DIV id supplied: "+e),t.Tt===null&&b.o("Invalid DIV id; could not get element with id: "+e);const i=Y.Ve.get(t.Tt);if(i&&i!==this&&b.o("Invalid div id; div already has a Diagram associated with it."),!t.Bc&&Z.ResizeObserver){const u=Z.ResizeObserver,c=b.Nk(()=>t.requestUpdate(),250,!1);t.Bc=new u(()=>c()),t.Bc.observe(t.Tt)}Z.getComputedStyle(t.Tt,null).position==="static"&&(t.Tt.style.position="relative");let s=5;const n="rgba(2"+s+"5, 255, 255, 0)";s--,t.Tt.style["-webkit-tap-highlight-color"]=n,t.Tt.innerHTML="",Y.Ve.set(t.Tt,t),t.Tt.goDiagram=t,t.Tt.go=Z.go;const o=new Pi(t);o.style!==void 0&&(o.style.position="absolute",o.style.top="0px",o.style.left="0px",Z.getComputedStyle(t.Tt,null).getPropertyValue("direction")==="rtl"&&(t.Xu=!0),o.style.zIndex="2",o.style.userSelect="none",o.style.MozUserSelect="none",o.style.touchAction="none",o.style.letterSpacing="normal !important",o.style.wordSpacing="normal !important",o.style.lang="unknown"),t.dt=o,t.Zt=o.ai;const r=t.Zt;t.Ui=t.computePixelRatio(),t.viewSize.isReal()||(t.kt=t.Tt.clientWidth||1,t.Pt=t.Tt.clientHeight||1),t.pL(t.kt,t.Pt);const a=t;t.Tt.insertBefore(o.Ft,t.Tt.firstChild);const h=new Pi(null);if(h.width=1,h.height=1,t.AF=h,t.TF=h.ai,Y.isUsingDOM()){const u=b.en("div"),c=b.en("div");u.style.position="absolute",u.style.overflow="auto",u.style.width=t.kt+"px",u.style.height=t.Pt+"px",u.style.zIndex="1",c.style.position="absolute",c.style.width="1px",c.style.height="1px",t.Tt.appendChild(u),u.appendChild(c),u.onscroll=Y.XF,u.addEventListener("pointerdown",Y.KF),u.p=t,u.YF=!0,u.GF=!0,t.nb=u,t.ob=c}t.yu=b.Nk(()=>{t.Pl=null,t.C()},300,!1),t.lb=b.Nk(()=>{t.MS()},250,!1),t.Yh=u=>(u.preventDefault(),!1),t.ta=u=>{if(!a.isEnabled)return;const c=a.Xc(u,!0);c.bubbles=!0;let d=0,m=0;c.delta=0,u.deltaX!==void 0?(u.deltaX!==0&&(d=u.deltaX>0?1:-1),u.deltaY!==0&&(m=u.deltaY>0?1:-1),c.delta=Math.abs(u.deltaX)>Math.abs(u.deltaY)?-d:-m):u.wheelDeltaX!==void 0?(u.wheelDeltaX!==0&&(d=u.wheelDeltaX>0?-1:1),u.wheelDeltaY!==0&&(m=u.wheelDeltaY>0?-1:1),c.delta=Math.abs(u.wheelDeltaX)>Math.abs(u.wheelDeltaY)?-d:-m):u.wheelDelta!==void 0&&u.wheelDelta!==0&&(c.delta=u.wheelDelta>0?1:-1),a.doMouseWheel(),a.oa(c,u)},t.lL=u=>{if(!a.isEnabled)return;t.Uc=!1,a.Xc(u,!0);const c=a.currentTool;c.cancelWaitAfter(),c.standardMouseOver()},t.Zl=u=>{if(!a.isEnabled)return;t.Uc=!0;const c=a.sb;c[u.pointerId]===void 0&&(c[u.pointerId]=u);const d=a._h;let m=!1;if(d[0]!==null&&(d[0].pointerId===u.pointerId||d[0].pointerType!==u.pointerType))d[0]=u;else if(d[1]!==null&&d[1].pointerId===u.pointerId)d[1]=u,m=!0;else if(d[0]===null)d[0]=u;else if(d[1]===null)d[1]=u,m=!0;else{u.preventDefault();return}const g=u.pointerType==="touch"||u.pointerType==="pen";g&&(a.Bw=!1,a.Zm=!0);const p=a.jF(u,u,m),y=a.aM,x=g?25:10;if(u.timeStamp-a.hM<a.rL&&!(Math.abs(y.x-u.screenX)>x||Math.abs(y.y-u.screenY)>x)?a.$m++:a.$m=1,p.clickCount=a.$m,a.hM=u.timeStamp,a.aM.setTo(u.screenX,u.screenY),a.doMouseDown(),u.button===1){u.preventDefault();return}a.oa(p,u)},t.ia=u=>{if(!a.isEnabled)return;t.Uc=!0;const c=a._h;if(c[0]!==null&&(c[0].pointerId===u.pointerId||c[0].pointerType!==u.pointerType))c[0]=u;else if(c[1]!==null&&c[1].pointerId===u.pointerId){c[1]=u;return}else if(c[0]===null)c[0]=u;else return;if(c[0].pointerId!==u.pointerId)return;const d=a.HF(u,u,c[1]!==null);a.doMouseMove(),a.oa(d,u)},t.ea=u=>{if(!a.isEnabled)return;t.Uc=!0;const c=u.pointerType==="touch"||u.pointerType==="pen",d=a.sb;if(c&&a.Bw){delete d[u.pointerId],u.preventDefault();return}const m=a._h;if(m[0]!==null&&(m[0].pointerId===u.pointerId||m[0].pointerType!==u.pointerType))m[0]=null;else if(m[1]!==null&&m[1].pointerId===u.pointerId){m[1]=null;return}else return;const g=a.pM(u,!1,!0,!1,!0,!1);let p=Z.document.elementFromPoint(u.clientX,u.clientY)||null;p!==null&&p.shadowRoot!==void 0&&p.shadowRoot!==null&&(p=p.shadowRoot.elementFromPoint(u.clientX,u.clientY)),p!==null&&p.p instanceof Y&&p.p!==a&&p.p.s0(u,g),p===null&&(p=u.target),a.s0(u,g),g.clickCount=a.$m,g.targetDiagram=a.yM(u,p),g.targetObject=null,a.doMouseUp(),a.oa(g,u),c&&(a.Zm=!1)},t.sa=u=>{if(!a.isEnabled)return;t.Uc=!1;const c=a.sb;c[u.pointerId]&&delete c[u.pointerId];const d=a._h;if(d[0]!==null&&d[0].pointerId===u.pointerId&&(d[0]=null),d[1]!==null&&d[1].pointerId===u.pointerId&&(d[1]=null),u.pointerType==="touch"||u.pointerType==="pen")return;const m=a.currentTool;m.cancelWaitAfter(),m.standardMouseOver()},t.na=u=>{const c=a._h;c[0]!==null&&c[0].pointerId===u.pointerId?(c[0]=null,a.Zm=!1):c[1]!==null&&c[1].pointerId===u.pointerId&&(c[1]=null)};const l=r;if(t.rb=l.U[b.Cs("7eba17a4ca3b1a8346")][b.Cs("78a118b7")](l.U,Y.Ku,s,s),r.clearContextCache(!0),t.qF(),this.Ic==="svg"){const u=this.Wl.get("svg");this.Tt.appendChild(u.Ft),this.Zt=u.ai}}addEventListener(e,t,i,s){e.addEventListener(t,i,{capture:s,passive:!1})}Vt(e,t,i,s){e.addEventListener(t,i,{capture:s,passive:!1})}removeEventListener(e,t,i,s){e.removeEventListener(t,i,{capture:s})}Mi(e,t,i,s){e.removeEventListener(t,i,{capture:s})}qF(){const e=this;let t=this.dt.Ft;t instanceof HTMLCanvasElement||(t=e.div),this.Vt(t,"pointerdown",e.Zl,!1),this.Vt(t,"pointermove",e.ia,!1),this.Vt(t,"pointerup",e.ea,!1),this.Vt(t,"pointerout",e.sa,!1),this.Vt(t,"pointercancel",e.na,!1),this.Vt(t,"pointerenter",e.WF,!1),this.Vt(t,"pointerleave",e.JF,!1),this.Vt(t,"wheel",e.ta,!1),this.Vt(t,"keydown",e.$F,!1),this.Vt(t,"keyup",e.ZF,!1),this.Vt(t,"blur",e.QF,!1),this.Vt(t,"focus",e._F,!1),this.Vt(t,"selectstart",i=>(i.preventDefault(),!1),!1),this.Vt(t,"contextmenu",i=>(i.preventDefault(),!1),!1),this.Vt(Z,"resize",e.lb,!1)}Uw(){this.Qm>30&&(this.Pl=1)}yP(e){this.Pl!==null&&(this.Pl=null,e&&this.yu(),this.Qm=0,this.uM=[0,0,0,0,0],this._m=0)}computePixelRatio(){return this.Pl!==null?this.Pl:Z.devicePixelRatio||1}get avgSpf(){return this.Qm}doMouseDown(){this.currentTool.doMouseDown()}doMouseMove(){this.currentTool.doMouseMove()}doMouseUp(){this.currentTool.doMouseUp()}doMouseWheel(){this.currentTool.doMouseWheel()}doKeyDown(){this.currentTool.doKeyDown()}doKeyUp(){this.currentTool.doKeyUp()}doFocus(){this.focus()}focus(){if(this.dt)if(this.scrollsPageOnFocus)this.dt.focus();else{const e=Z.scrollX,t=Z.scrollY;this.dt.focus(),Z.scrollTo(e,t)}}_F(e){const t=Y.Ve.get(this);t&&t.v("GainedFocus")}QF(e){const t=Y.Ve.get(this);t&&t.v("LostFocus")}MS(){if(this.dt===null)return;const e=this.Tt;if(e===null||e.clientWidth===0||e.clientHeight===0)return;this.VS||this.setScrollWidth();const t=this.Wn?this.di:0,i=this.gn?this.di:0,s=this.Ui;if(this.Ui=this.computePixelRatio(),this.Ui!==s&&(this.Ru=!0,this.requestUpdate()),e.clientWidth!==this.kt+t||e.clientHeight!==this.Pt+i){this.ra(),this.Ue=!0;const n=this.layout;n!==null&&n.isViewportSized&&this.autoScale===1&&(this.Oc=!0,n.invalidateLayout()),this.ps||this.requestUpdate()}}fL(){let e=0,t=new Be;t.name="Grid",t.allowSelect=!1,t.pickable=!1,t.isTemporary=!0,t.isInDocumentBounds=!1,this.Gr(t,e++),t=new Be,t.name="ViewportBackground",t.isViewportAligned=!0,t.isTemporary=!0,t.isInDocumentBounds=!1,this.Gr(t,e++),t=new Be,t.name="Background",this.Gr(t,e++),t=new Be,t.name="",this.Gr(t,e++),t=new Be,t.name="Foreground",this.Gr(t,e++),t=new Be,t.name="ViewportForeground",t.isViewportAligned=!0,t.isTemporary=!0,t.isInDocumentBounds=!1,this.Gr(t,e++),t=new Be,t.name="Adornment",t.isTemporary=!0,t.isInDocumentBounds=!1,this.Gr(t,e++),t=new Be,t.name="Tool",t.isTemporary=!0,t.isInDocumentBounds=!0,this.Gr(t,e++)}yL(){const e=new ct(ct.Grid,{name:"GRID"}).add(new bt("LineH",{stroke:"lightgray",strokeWidth:.5,interval:1}).theme("stroke","gridMinor"),new bt("LineV",{stroke:"lightgray",strokeWidth:.5,interval:1}).theme("stroke","gridMinor"),new bt("LineH",{stroke:"gray",strokeWidth:.5,interval:5}).theme("stroke","gridMajor"),new bt("LineV",{stroke:"gray",strokeWidth:.5,interval:5}).theme("stroke","gridMajor"),new bt("LineH",{stroke:"gray",strokeWidth:1,interval:10}).theme("stroke","gridMajor"),new bt("LineV",{stroke:"gray",strokeWidth:1,interval:10}).theme("stroke","gridMajor")),t=new Bt({layerName:"Grid",zOrder:0,isInDocumentBounds:!1,isAnimated:!1,pickable:!1,locationObjectName:"GRID"}).add(e);return this.add(t),this.partManager.parts.delete(t),e.visible=!1,e}static XF(){const e=Y.Ve.get(this.parentElement||this);if(e){if(e.Jx){e.Jx=!1;return}if(!e.isEnabled){e.wL();return}e.diagramScroll(this)}}static KF(e){if(!this.p.isEnabled){this.p.updateScroll();return}this.p.$x=e.target.scrollTop,this.p.Zx=e.target.scrollLeft}diagramScroll(e){if(this.dt===null)return;const t=this.nb,i=this.ob;this.Km=!0;let s=this.documentBounds,n=this.viewportBounds;const o=this.Fc;let r=s.x-o.left,a=s.y-o.top;const h=s.width+o.left+o.right,l=s.height+o.top+o.bottom;let u=s.right+o.right,c=s.bottom+o.bottom,d=n.x,m=n.y;const g=n.width,p=n.height;let y=n.right,x=n.bottom;const P=this.scale;let k,w=e.scrollLeft;if(this.Xu)switch(this.wx){case"negative":w=w+e.scrollWidth-e.clientWidth;break;case"reverse":w=e.scrollWidth-w-e.clientWidth;break}const N=w;if(g<h||p<l){k=S.X(this.position.x,this.position.y),this.allowHorizontalScroll&&this.Zx!==N&&(k.x=N/P+r,this.Zx=N),this.allowVerticalScroll&&this.$x!==e.scrollTop&&(k.y=e.scrollTop/P+a,this.$x=e.scrollTop),this.position=k,S.s(k),this.Km=!1,this.Eu=!1;return}if(k=S.l(),e.YF&&this.allowHorizontalScroll&&(r<d&&(this.position=k.e(N+r,this.position.y)),u>y)){const M=t.scrollWidth-this.kt;this.position=k.e(-M+N-this.kt/P+u,this.position.y)}if(e.GF&&this.allowVerticalScroll&&(a<m&&(this.position=k.e(this.position.x,e.scrollTop+a)),c>x)){const M=t.scrollHeight-this.Pt;this.position=k.e(this.position.x,-M+e.scrollTop-this.Pt/P+c)}S.s(k),this._l(),this.Km=!1,this.Eu=!1,s=this.documentBounds,n=this.viewportBounds,u=s.right,y=n.right,c=s.bottom,x=n.bottom,r=s.x,d=n.x,a=s.y,m=n.y,g>=h&&r>=d&&u<=y&&(i.style.width="1px"),p>=l&&a>=m&&c<=x&&(i.style.height="1px")}computeBounds(e){return e===void 0&&(e=new z),this.Ci(),this.xL(e)}xL(e){if(this.fixedBounds.isReal())return e.a(this.fixedBounds),e.addMargin(this.$t),e;let t=!0;const i=this.Gt.r,s=i.length;for(let n=0;n<s;n++){const o=i[n];if(!o.visible||!o.isInDocumentBounds)continue;const r=o.At.r,a=r.length;for(let h=0;h<a;h++){const l=r[h];if(!l.isInDocumentBounds||!l.isVisible())continue;const u=l.actualBounds;u.isReal()&&(t?(t=!1,e.a(u)):e.unionRect(u))}}return t&&e.e(0,0,0,0),e.addMargin(this.$t),e}computePartsBounds(e,t){t===void 0&&(t=!1);let i=null;if(Array.isArray(e))for(let s=0;s<e.length;s++){const n=e[s];!t&&n instanceof dt||(n.ensureBounds(),i===null?i=n.actualBounds.copy():i.unionRect(n.actualBounds))}else{const s=e.iterator;for(;s.next();){const n=s.value;!t&&n instanceof dt||(n.ensureBounds(),i===null?i=n.actualBounds.copy():i.unionRect(n.actualBounds))}}return i===null?new z(NaN,NaN,0,0):i}Us(e){if(!e&&!this.Jn||this.Ht||this.dt===null||!this.documentBounds.isReal())return;if(this.Ht=!0,e){const c=this.initialPosition;if(c.isReal()){this.Ht=!1,this.position=c;return}let d=this.initialDocumentSpot,m=this.initialViewportSpot;d.isNoSpot()&&(d=B.TopLeft),m.isNoSpot()&&(m=B.TopLeft);const g=S.l();g.setRectSpot(this.documentBounds,d);const p=this.viewportBounds,y=z.X(0,0,p.width,p.height),x=S.l();x.setRectSpot(y,m),x.e(g.x-x.x,g.y-x.y),this.Ht=!1,this.position=x,z.s(y),S.s(x)}let t=this.jl;e&&this.Cr!==1&&(t=this.Cr);const i=t!==1?this.Yu(t):this.scale,s=this.at.x,n=this.at.y,o=this.kt/i,r=this.Pt/i;let a=this.Rc;const h=this.Um;if(e&&!a.isSpot()&&(h.isSpot()||h.isDefault())){const c=this.initialDocumentSpot.isSpot()&&this.initialViewportSpot.isSpot();a=h.isDefault()&&!c?B.Center:h}this.wM(this.documentBounds,o,r,a,e);const l=this.scale;this.scale=i,this.Ht=!1;const u=this.viewportBounds;u.equalsApproxTo(s,n,o,r)||this.onViewportBoundsChanged(new z(s,n,o,r),u,l,!1)}Yu(e){const t=this.Jm;if(this.dt===null)return t;this.ensureBounds();const i=this.documentBounds;if(!i.isReal())return t;const s=i.width,n=i.height,o=this.kt+(this.Wn?this.di:0),r=this.Pt+(this.gn?this.di:0),a=o/s,h=r/n;let l;return e===2?(l=Math.min(h,a),l>t&&(l=t),l<this.minScale&&(l=this.minScale),l>this.maxScale&&(l=this.maxScale),l):e===3?(l=0,h>a?l=(r-this.di)/n:l=(o-this.di)/s,l>t&&(l=t),l<this.minScale&&(l=this.minScale),l>this.maxScale&&(l=this.maxScale),l):this.scale}zoomToFit(){const e=this.jh;this.jh=1,this.scale=this.Yu(2),e!==1&&(this.Us(!1),this.wM(this.documentBounds,this.kt/this.et,this.Pt/this.et,this.Rc,!1)),this.jh=e}zoomToRect(e,t){t===void 0&&(t=2);const i=e.width,s=e.height;if(i===0||s===0||isNaN(i)&&isNaN(s))return;let n=1;if(t===2||t===3)if(isNaN(i))n=this.viewportBounds.height*this.scale/s;else if(isNaN(s))n=this.viewportBounds.width*this.scale/i;else{const o=this.kt,r=this.Pt;t===3?r/s>o/i?n=(r-(this.gn?this.di:0))/s:n=(o-(this.Wn?this.di:0))/i:n=Math.min(r/s,o/i)}this.scale=n,this.position=new S(e.x,e.y)}get tR(){return this.Ht}set tR(e){this.Ht=e}alignDocument(e,t){this.ensureBounds();const i=this.documentBounds,s=this.viewportBounds;this.position=new S(i.x+(e.x*i.width+e.offsetX)-(t.x*s.width-t.offsetX),i.y+(e.y*i.height+e.offsetY)-(t.y*s.height-t.offsetY))}focusObject(e){if(e instanceof he){this.t0=e;const t=S.l();this.i0=this.transformDocToView(e.getDocumentPoint(B.TopLeft,t)),S.s(t)}else this.t0=null,this.i0=S.Ak}wM(e,t,i,s,n){const o=S.X(this.at.x,this.at.y);let r=o.x,a=o.y;if(this.t0!==null){let h=S.l();h=this.t0.getDocumentPoint(B.TopLeft,h),r=h.x-this.i0.x/this.scale,a=h.y-this.i0.y/this.scale,s=B.None,S.s(h)}if(n||this.scrollMode===1){s.isSpot()&&(t>e.width&&(r=e.x+(s.x*e.width+s.offsetX)-(s.x*t-s.offsetX)),i>e.height&&(a=e.y+(s.y*e.height+s.offsetY)-(s.y*i-s.offsetY)));const h=this.Fc,l=t-e.width;if(t<e.width+h.left+h.right){let c=r+t/2;c=Math.min(c,e.right+Math.max(l,h.right)-t/2),c=Math.max(c,e.left-Math.max(l,h.left)+t/2),r=c-t/2}else r>e.left?r=e.left:r<e.right-t&&(r=e.right-t);const u=i-e.height;if(i<e.height+h.top+h.bottom){let c=a+i/2;c=Math.min(c,e.bottom+Math.max(u,h.bottom)-i/2),c=Math.max(c,e.top-Math.max(u,h.top)+i/2),a=c-i/2}else a>e.top?a=e.top:a<e.bottom-i&&(a=e.bottom-i)}if(o.x=isFinite(r)?r:-this.$t.left,o.y=isFinite(a)?a:-this.$t.top,this.positionComputation!==null){const h=this.positionComputation(this,o);o.x=h.x,o.y=h.y}this.ds.$C(this.at,o),this.at.e(o.x,o.y),this.pb(),this.Ql(),this.iR(),S.s(o)}findPartAt(e,t){if(t===void 0&&(t=!0),t){const i=this.PP(e,s=>s.part,s=>s.canSelect());if(i instanceof Bt)return i}else{const i=this.PP(e,s=>s.part);if(i instanceof Bt)return i}return null}findObjectAt(e,t,i){t===void 0&&(t=null),i===void 0&&(i=null),this.Ci();const s=this.Gt.iteratorBackwards;for(;s.next();){const n=s.value;if(!n.visible)continue;const o=n.findObjectAt(e,t,i);if(o!==null)return o}return null}PP(e,t,i){t===void 0&&(t=null),i===void 0&&(i=null),this.Ci();const s=this.Gt.iteratorBackwards;for(;s.next();){const n=s.value;if(!n.visible||n.isTemporary)continue;const o=n.findObjectAt(e,t,i);if(o!==null)return o}return null}findPartsAt(e,t,i){return t===void 0&&(t=!0),this.eR(e,s=>s.part,t?s=>s instanceof Bt&&s.canSelect():null,i)}eR(e,t,i,s){t===void 0&&(t=null),i===void 0&&(i=null),!(s instanceof J)&&!(s instanceof K)&&(s=new K),this.Ci();const n=this.Gt.iteratorBackwards;for(;n.next();){const o=n.value;!o.visible||o.isTemporary||o.findObjectsAt(e,t,i,s)}return s}findObjectsAt(e,t,i,s){t===void 0&&(t=null),i===void 0&&(i=null),!(s instanceof J)&&!(s instanceof K)&&(s=new K),this.Ci();const n=this.Gt.iteratorBackwards;for(;n.next();){const o=n.value;o.visible&&o.findObjectsAt(e,t,i,s)}return s}findPartsIn(e,t,i,s){return t===void 0&&(t=!1),i===void 0&&(i=!0),this.sR(e,null,n=>n instanceof Bt&&(!i||n.canSelect()),t,s)}findObjectsIn(e,t,i,s,n){t===void 0&&(t=null),i===void 0&&(i=null),s===void 0&&(s=!1),!(n instanceof J)&&!(n instanceof K)&&(n=new K),this.Ci();const o=this.Gt.iteratorBackwards;for(;o.next();){const r=o.value;r.visible&&r.findObjectsIn(e,t,i,s,n)}return n}NP(e,t,i,s,n,o){const r=new K;this.Ci();const a=this.Gt.iteratorBackwards;for(;a.next();){const h=a.value;h.visible&&h.NP(e,t,i,s,r,n,o)}return r}sR(e,t,i,s,n){t===void 0&&(t=null),i===void 0&&(i=null),s===void 0&&(s=!1),!(n instanceof J)&&!(n instanceof K)&&(n=new K),this.Ci();const o=this.Gt.iteratorBackwards;for(;o.next();){const r=o.value;!r.visible||r.isTemporary||r.findObjectsIn(e,t,i,s,n)}return n}findPartsNear(e,t,i,s,n){return i===void 0&&(i=!0),s===void 0&&(s=!0),this.nR(e,t,null,o=>o instanceof Bt&&(!s||o.canSelect()),i,n)}findObjectsNear(e,t,i,s,n,o){i===void 0&&(i=null),s===void 0&&(s=null),n===void 0&&(n=!0),n!==!1&&n!==!0&&((n instanceof J||n instanceof K)&&(o=n),n=!0),!(o instanceof J)&&!(o instanceof K)&&(o=new K),this.Ci();const r=this.Gt.iteratorBackwards;for(;r.next();){const a=r.value;a.visible&&a.findObjectsNear(e,t,i,s,n,o)}return o}nR(e,t,i,s,n,o){i===void 0&&(i=null),s===void 0&&(s=null),n===void 0&&(n=!0),n!==!1&&n!==!0&&((n instanceof J||n instanceof K)&&(o=n),n=!0),!(o instanceof J)&&!(o instanceof K)&&(o=new K),this.Ci();const r=this.Gt.iteratorBackwards;for(;r.next();){const a=r.value;!a.visible||a.isTemporary||a.findObjectsNear(e,t,i,s,n,o)}return o}acceptEvent(e){return this.Xc(e,e instanceof MouseEvent)}Xc(e,t){const i=this.Xr;this.Xr=this.$h,this.$h=i,i.diagram=this,i.event=e,t?this.s0(e,i):(i.viewPoint=this.Xr.viewPoint,i.documentPoint=this.Xr.documentPoint);let s=0;const n=e;return n.ctrlKey&&(s+=1),n.altKey&&(s+=2),n.shiftKey&&(s+=4),n.metaKey&&(s+=8),i.modifiers=s,i.button=n.button,n.buttons!==void 0&&(i.buttons=n.buttons),b.rr&&n.button===0&&n.ctrlKey&&(i.button=2),i.down=!1,i.up=!1,i.clickCount=1,i.delta=0,i.handled=!1,i.bubbles=!1,i.timestamp=e.timeStamp,i.isMultiTouch=!1,i.targetDiagram=this.yM(e,e.target),i.targetObject=null,i}yM(e,t){if(t===null)return null;const i=Y.Ve.get(t);if(i)return i;let s=e.path;if(!s&&typeof e.composedPath=="function"&&(s=e.composedPath()),s&&s[0]){const n=Y.Ve.get(s[0]);if(n)return n}return null}jF(e,t,i){const s=this.pM(e,!0,!1,!1,!0,i);return this.s0(t,s),s.targetDiagram=this.yM(e,e.target),s.targetObject=null,i||s.clone(this.Wm),s}HF(e,t,i){const s=this.pM(e,!1,!1,!1,!1,i);let n=Z.document.elementFromPoint(t.clientX,t.clientY)||null;n!==null&&n.shadowRoot!==void 0&&n.shadowRoot!==null&&(n=n.shadowRoot.elementFromPoint(t.clientX,t.clientY));let o=this,r=e;if(n){const a=Y.Ve.get(n);a&&(r=t,o=a)}return s.targetDiagram=o,this.s0(r,s),s.targetObject=null,s}pM(e,t,i,s,n,o){const r=this.Xr;this.Xr=this.$h,this.$h=r,r.diagram=this,r.clickCount=1,r.delta=0;let a=0;return e.ctrlKey&&(a+=1),e.altKey&&(a+=2),e.shiftKey&&(a+=4),e.metaKey&&(a+=8),r.modifiers=a,r.event=e,r.timestamp=e.timeStamp,r.button=i?this.firstInput.button:e.button,r.buttons=e.buttons,b.rr&&e.button===0&&e.ctrlKey&&(r.button=2),r.down=t,r.up=i,r.handled=s,r.bubbles=n,r.isMultiTouch=o,r}oa(e,t){return e.bubbles?!0:(t.stopPropagation!==void 0&&t.stopPropagation(),t.cancelable!==!1&&t.preventDefault(),t.cancelBubble=!0,!1)}$F(e){const t=Y.Ve.get(this);if(!t||!t.isEnabled)return!1;const i=t.Xc(e,!1);return i.key=e.key,i.code=e.code,i.down=!0,t.doKeyDown(),t.oa(i,e)}ZF(e){const t=Y.Ve.get(this);if(!t||!t.isEnabled)return!1;const i=t.Xc(e,!1);return i.key=e.key,i.code=e.code,i.up=!0,t.doKeyUp(),t.oa(i,e)}WF(e){const t=Y.Ve.get(this);if(!t||!t.isEnabled)return!1;const i=t.Xc(e,!0);return t.mouseEnter!==null&&t.mouseEnter(i),t.currentTool.standardMouseOver(),t.oa(i,e)}JF(e){const t=Y.Ve.get(this);if(!t||!t.isEnabled)return!1;const i=t.Xc(e,!0);return t.mouseLeave!==null&&t.mouseLeave(i),t.oa(i,e)}getMouse(e){const t=this.dt;if(t===null)return new S(0,0);const i=t.getBoundingClientRect(),s=(e.clientX-i.left)*(this.kt/i.width),n=(e.clientY-i.top)*(this.Pt/i.height);return new S(s,n).Ie(this.D)}s0(e,t){const i=this.dt;let s=0,n=0;if(i!==null){const r=i.getBoundingClientRect();s=(e.clientX-r.left)*(this.kt/r.width),n=(e.clientY-r.top)*(this.Pt/r.height)}t.viewPoint.e(s,n);const o=S.X(s,n);this.D._e(o),t.documentPoint.a(o),S.s(o)}kC(e,t,i){let s;if(this._h[0]!==null)s=this._h[t];else return;const n=this.dt;if(n!==null){const o=n.getBoundingClientRect();i.e((s.clientX-o.left)*(this.kt/o.width),(s.clientY-o.top)*(this.Pt/o.height))}}invalidateDocumentBounds(){this.Zh||(this.Zh=!0,this.requestUpdate(!1))}oR(){this.ps||this.Ci(),this.ensureBounds()}redraw(){this.Ht||this.ps||(this.C(),this.maybeUpdate())}isUpdateRequested(){return this.Pr}delayInitialization(e){e===void 0&&(e=null);const t=this.animationManager,i=t.isEnabled;t.stopAnimation(),t.isEnabled=!1,this.yr(),this.Jn=!1,this.ex=new S(NaN,NaN),t.isEnabled=i,this.ps=!0;const s=this;e!==null&&b.Oh(()=>{s.ps=!1,t.Fl("Model"),e(s)},1)}requestUpdate(e){if(e===void 0&&(e=!1),this.Pr===!0||this.Ht||e===!1&&this.ps)return;this.Pr=!0;const t=this;Z.requestAnimationFrame(()=>{t.Pr&&t.maybeUpdate()})}maybeUpdate(){this.vu&&!this.Pr||(this.vu&&(this.vu=!1),this.yr())}xM(e,t){!this.Eu||this.Ht||this.animationManager.defaultAnimation.isAnimating||this.wL()||(e&&this.Ci(),t&&this.Us(!1))}yr(e){if(this.ps||(this.Pr=!1,this.Tt===null&&!this.Bu.isReal()))return;this.ps=!0;const t=this.animationManager,i=this.zu;if(!t.isAnimating&&i.length!==0){const u=i.r,c=u.length;for(let d=0;d<c;d++){const m=u[d];m.ue(!1),m.c()}i.clear()}const s=this.lM;s.count>0&&(s.each(u=>u.bM()),s.clear());let n=!1,o=!1;t.defaultAnimation.isAnimating&&(o=!0,n=this.skipsUndoManager,this.skipsUndoManager=!0),t.wi||this.MS(),e||this.xM(!1,!0);const r=!this.undoManager.isUndoingRedoing&&(this.bl||this.zc.count!==0&&this.Lr.size!==0),a=!this.Jn||this.Kr;this.Ci(!0);let h=!1;(a||r)&&(this.Jn?this.kM(!this.Oc,r):(this.startTransaction("Initial Layout"),t.isEnabled===!1&&t.stopAnimation(),this.kM(!1,r)),h=a),this.Oc=!1,this.bl=!1,this.Ci(),this.ts!==null&&(this.ts.visible&&!this.Hm&&(this.jr(),this.Hm=!0),!this.ts.visible&&this.Hm&&(this.Hm=!1)),this.Bx||this.oR(),e||this.xM(!0,!1);let l=!1;if(h){const u=z.l();u.a(this.viewportBounds),this.Jn||(this.Jn=!0,l=!0,this.skipsUndoManager||(this.undoManager.Ow=!0),this.undoManager.Iw=!0,this.rR()),this.lR(),this.Ci(!1),e||this.xM(!0,!0),z.s(u)}else if(t.Sc&&t.ix){if(this.Cr!==1)this.scale=this.Yu(this.Cr);else if(this.jl!==1)this.scale=this.Yu(this.jl);else{const u=this.initialScale;isFinite(u)&&u>0&&(this.scale=u)}this.Us(!0)}h&&l&&this.commitTransaction("Initial Layout"),e||this.Gi(this.Zt),o&&(this.skipsUndoManager=n),this.ps=!1}get Bh(){return this.Jn}rR(){if(this.Cr!==1)this.scale=this.Yu(this.Cr);else if(this.jl!==1)this.scale=this.Yu(this.jl);else{const t=this.initialScale;isFinite(t)&&t>0&&(this.scale=t)}this.Us(!0);const e=this.Gt.r;this.Bs(e,e.length,this,this.viewportBounds),this.v("InitialLayoutCompleted"),this.ex.a(this.at),this.jr()}lR(){this.v("LayoutCompleted")}o0(e){this.Hn.add(e)}addInvalidRoute(e){this.Fo?this.Wh.add(e):this.Lr.add(e)}Ci(e){if(this.Hn.size!==0&&!(!this.ps&&this.animationManager.isTicking)){if(this.ps||(this.bl=!0),e){this.bL(this.Hn);return}for(let t=0;t<23&&this.Hn.size!==0;t++){const i=new Set(this.Hn);this.Hn.clear(),this.bM(i,this.Hn)}this.nodes.each(t=>{t instanceof at&&t.kL(!1)})}}bL(e,t){for(const i of e)!i.Pe()||i instanceof at||(i.Hr()?(i.ut(1/0,1/0),i.zt()):t&&t.add(i));for(const i of e)if(i instanceof at){if(!i.isVisible())continue;this.yb(i)}}bM(e,t){this.bL(e,t);for(const i of e){if(!(i instanceof dt))continue;const s=i;s.isVisible()&&(s.Hr()?(s.ut(1/0,1/0),s.zt()):t.add(s))}for(const i of e)i instanceof Mt&&i.isVisible()&&(i.Hr()?(i.ut(1/0,1/0),i.zt()):t.add(i))}r0(e){const t=e instanceof Y,i=t?e.links:e.memberParts,s=this.Hn;if(t)this.Ci(!0);else{for(;i.next();){const n=i.value;s.has(n)&&(!n.Pe()||n instanceof at||n.Hr()&&(n.ut(1/0,1/0),n.zt()))}for(i.reset();i.next();){const n=i.value;if(s.has(n)&&n instanceof at){if(!n.isVisible())continue;this.yb(n)}}i.reset()}for(;i.next();){const n=i.value;n instanceof dt&&s.has(n)&&n.isVisible()&&n.Hr()&&(n.ut(1/0,1/0),n.zt())}}yb(e){const t=b.nt(),i=b.nt(),s=e.memberParts;for(;s.next();){const o=s.value;o.isVisible()&&(o instanceof at?(o.Oo()||o.is()||o.th())&&this.yb(o):o instanceof dt?o.fromNode===e||o.toNode===e?i.push(o):t.push(o):(o.ut(1/0,1/0),o.zt()))}let n=t.length;for(let o=0;o<n;o++){const r=t[o];r.ut(1/0,1/0),r.zt()}b.tt(t),e.ut(1/0,1/0),e.zt(),n=i.length;for(let o=0;o<n;o++){const r=i[o];r.ut(1/0,1/0),r.zt()}b.tt(i)}Bs(e,t,i,s){if(!(!this.Ec&&!this.animationManager.isAnimating)){for(let n=0;n<t;n++)e[n].Bs(i,s);this.Ci()}}Gi(e){this.Tt!==null&&(this.dt===null&&b.o("No canvas specified"),this.Ic==="svg"?this.hR(e):this.aR(e))}aR(e){const t=this.animationManager;if(t.wi||t.isAnimating&&!t.isTicking)return;const i=new Date;if(this.l0(),this.Tt.style.opacity==="0")return;const s=e!==this.Zt,n=this.Gt.r,o=n.length,r=this;if(this.Bs(n,o,r,r.viewportBounds),s)e.clearContextCache(!0),this._l();else if(!this.Ue&&!t.isAnimating)return;const a=this.D,h=this.Ui;e.setTransform(h,0,0,h,0,0),e.clearRect(0,0,this.kt,this.Pt),this.Wt!==1&&(e.globalAlpha=this.Wt),this.PM(e);for(let m=0;m<o;m++)e.setTransform(h,0,0,h,0,0),e.transform(a.m11,a.m12,a.m21,a.m22,a.dx,a.dy),e.commitTransform(),n[m].Gi(e,r);let l=!1;this.Vc?this.Vc.Ku(this)&&(l=this.rb()):l=!0,l&&(Tt.prototype._e=Tt.prototype.ww),s?(this.Zt.clearContextCache(!0),this._l()):(this.Ec=!1,this.Ue=!1);const u=+new Date-+i,c=!1,d=this.uM;if(this.Pl===null){d[this._m]=u,this._m=(this._m+1)%d.length;let m=0;for(let g=0;g<d.length;g++)m+=d[g];this.Qm=m/d.length}this.Wt!==1&&(e.globalAlpha=1)}hR(e){if(this.Tt===null)return;const t=this.animationManager;if(t.wi||t.isAnimating&&!t.isTicking)return;this.l0();const i=this.kt,s=this.Pt;e.surface.resize(i,s,i,s);const n=this.Gt.r,o=n.length,r=this;if(this.Bs(n,o,r,r.viewportBounds),!this.Ue&&!t.isAnimating)return;const a=this.D;e.lastDrawnPart=null,e.setDiagramPosScale(a.m11,a.m12,a.m21,a.m22,a.dx,a.dy),this.Wt!==1&&(e.globalAlpha=this.Wt),this.PM(e);const h=this.Ui;this.dt.ai.setTransform(h,0,0,h,0,0),this.dt.ai.clearRect(0,0,this.kt,this.Pt);for(let u=0;u<o;u++)n[u].Gi(e,r);let l=!1;this.Vc?this.Vc.Ku(this)&&(l=this.rb()):l=!0,l&&(Tt.prototype._e=Tt.prototype.ww),this.Ec=!1,this.Ue=!1}wb(e,t,i,s,n,o,r,a,h){if(this.Tt===null)return;this.dt===null&&b.o("No canvas specified"),o===void 0&&(o=null),r===void 0&&(r=null),a===void 0&&(a=!1),h===void 0&&(h=!1),this.l0(),this.Zt.clearContextCache(!0),this._l(),this.Qh=!0;const l=this.et;this.et=s;const u=this,c=this.Gt.r,d=c.length;try{const m=new z(n.x,n.y,i.width/s,i.height/s),g=m.copy();g.addMargin(t),this.jr(g),this.Ci(),this.Bs(c,d,u,m),e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,i.width,i.height),r!==null&&r!==""&&(e.fillStyle=r,e.fillBackground(0,0,i.width,i.height));const p=this.Ui;e.scale(p,p);const y=Tt.l();y.Ri(),y.Ds(t.left,t.top),y.et(s),(n.x!==0||n.y!==0)&&y.Ds(-n.x,-n.y),e.setTransform(y.m11,y.m12,y.m21,y.m22,y.dx,y.dy),e.commitTransform(),e instanceof ze&&e.setDiagramPosScale(y.m11,y.m12,y.m21,y.m22,y.dx,y.dy),Tt.s(y),this.PM(e),e.globalAlpha=this.Wt;const x=this.findLayer("Grid");if(o){const P=new K,k=o.iterator;for(k.reset();k.next();){const w=k.value;w instanceof Bt&&(!h&&w.layer===x||(w.Du(),P.add(w)))}for(let w=0;w<d;w++)c[w].bF(e,u,P,a);P.each(w=>w.Du())}else for(let P=0;P<d;P++){const k=c[P];k===x?h&&k.Gi(e,u,!0):k.Gi(e,u,a)}this.Qh=!1,this.Vc&&this.Vc.Ku(this)&&this.rb()}finally{this.et=l,this.Zt.clearContextCache(!0),this._l(),this.Bs(c,d,u,u.viewportBounds),this.jr(),this.Zt instanceof ze&&(this.Zt.diagramGroup.replaceChildren(),this.redraw())}}getRenderingHint(e){return this.Nr[e]}setRenderingHint(e,t){e==="minDrawingLength"&&(this.Im=t),this.Nr[e]=t,this.redraw()}resetRenderingHints(){this.Nr=new fe,this.Nr.drawShadows=!0,this.Nr.textGreeking=!0,this.Nr.viewportOptimizations=!b.rr,this.Nr.temporaryPixelRatio=!0,this.Nr.pictureRatioOptimization=!0,this.Nr.minDrawingLength=1,this.Im=1}PM(e){const t=this.Nr;if(t===null)return;if(t.imageSmoothingEnabled!==void 0){const s=!!t.imageSmoothingEnabled;e.setImageSmoothingEnabled(s)}const i=t.defaultFont;i!=null&&(e.font=i)}getInputOption(e){return this.Fu[e]}setInputOption(e,t){this.Fu[e]=t}EF(){this.Fu=new fe,this.Fu.extraTouchArea=10,this.Fu.extraTouchThreshold=10,this.Fu.hasGestureZoom=!0}set(e){return Object.assign(this,e),this}attach(e){return this.setProperties(e)}setProperties(e){return Y.h0(this,e),this}static h0(e,t){const i=e instanceof ct,s=e instanceof Y;for(const n in t){n===""&&b.o("Setting properties requires non-empty property names");let o=e,r=n;if(i||s){const h=n.indexOf(".");if(h>0){const l=n.substring(0,h);i?o=e.findObject(l):(o=e[l],o==null&&(o=e.toolManager[l])),b.wt(o)?r=n.substring(h+1):b.o("Unable to find object named: "+l+" in "+e.toString()+" when trying to set property: "+n)}}if(r[0]!=="_"&&!b.fw(o,r))if(s&&r==="ModelChanged"){e.addModelChangedListener(t[r]);continue}else if(s&&r==="Changed"){e.addChangedListener(t[r]);continue}else if(s&&b.fw(e.toolManager,r))o=e.toolManager;else if(s&&e.PL(r)){e.addDiagramListener(r,t[r]);continue}else if(e instanceof mt&&r==="Changed"){e.addChangedListener(t[r]);continue}else b.o('Trying to set undefined property "'+r+'" on object: '+o.toString());const a=t[n];o[r]=a,r[0]==="_"&&o instanceof he&&o.addCopyProperty(r)}}_C(){if(this.$l.count!==0&&!(this.undoManager.transactionLevel>1)){for(;this.$l.count>0;){const e=this.$l;this.$l=new St;const t=e.iterator;for(;t.next();){const i=t.key;i.invalidateOtherJumpOvers(t.value),i.ee()}}this.C()}}C(e){if(e===void 0)this.Ue=!0,this.requestUpdate();else{const t=this.viewportBounds;e.isReal()&&t.intersectsRect(e)&&(this.Ue=!0,this.requestUpdate())}this.v("InvalidateDraw")}invalidateViewport(e,t){if(this.Ue!==!0){if(this.Ue=!0,this.Ic==="svg"){this.maybeUpdate();return}this.getRenderingHint("temporaryPixelRatio")===!0?(this.Uw(),this.maybeUpdate(),this.yP(!0)):this.maybeUpdate()}}ra(){this.Eu=!0}_l(){this.Ec=!0}l0(){this.Ru!==!1&&(this.Ru=!1,this.pL(this.kt,this.Pt))}pL(e,t){this.Ql();const i=this.Ui,s=e*i,n=t*i;this.dt.resize(s,n,e,t)&&(this.Ue=!0,this.Zt.clearContextCache(!0))}wL(){const e=this.dt;if(e===null||this.Bu.isReal())return!0;const t=this.kt,i=this.Pt,s=this.Tt;let n=!1,o=this.Wn?this.di:0,r=this.gn?this.di:0,a=s.clientWidth||t+o,h=s.clientHeight||i+r;const l=this.viewportBounds,u=l.x,c=l.y,d=l.width,m=l.height;if((a!==t+o||h!==i+r)&&(this.Wn=!1,this.gn=!1,o=0,r=0,this.kt=a,this.Pt=h,this.Ru=!0,n=!0,this.Ql()),!this.Jn||!this.viewportBounds.isReal())return!0;const g=this.nb,p=this.ob;if(this.Eu=!1,!n&&!this.Wn&&!this.gn&&!this.Ou&&!this.Iu)return!0;const y=this.documentBounds;let x=0,P=0,k=0,w=0;const N=l.width,M=l.height,C=this.Fc;this.contentAlignment.isSpot()?(y.width>N&&(x=C.left,P=C.right),y.height>M&&(k=C.top,w=C.bottom)):(x=C.left,P=C.right,k=C.top,w=C.bottom);const O=y.width+x+P,T=y.height+k+w,L=this.scale,F=L;let D=O>a/L,R=T>h/L;if(!n&&!this.Wn&&!this.gn&&!D&&!R)return!0;const I=y.x-x,j=l.x,X=y.right+P;let V=l.right+o;const G=y.y-k,$=l.y,pt=y.bottom+w;let Q=l.bottom+r,it="1px",et="1px";if(this.scrollMode===1&&(D||R)){if(D&&this.hasHorizontalScrollbar&&this.allowHorizontalScroll){let _=1;I+1<j&&(_=Math.max((j-I)*L+this.kt,_)),X>V+1&&(_=Math.max((X-V)*L+this.kt,_)),N+o+1<O&&(_=Math.max((O-N)*L+this.kt,_)),it=_.toString()+"px"}if(R&&this.hasVerticalScrollbar&&this.allowVerticalScroll){let _=1;G+1<$&&(_=Math.max(($-G)*L+this.Pt,_)),pt>Q+1&&(_=Math.max((pt-Q)*L+this.Pt,_)),M+r+1<T&&(_=Math.max((T-M)*L+this.Pt,_)),et=_.toString()+"px"}}let st=it!=="1px",Pt=et!=="1px";if(!(st&&Pt)&&(st||Pt)){if(D=!(O<N+o),R=!(T<M+r),Pt&&(V-=this.di),st&&(Q-=this.di),D&&this.hasHorizontalScrollbar&&this.allowHorizontalScroll){let ft=1;I+1<j&&(ft=Math.max((j-I)*L+this.kt,ft)),X>V+1&&(ft=Math.max((X-V)*L+this.kt,ft)),N+1<O&&(ft=Math.max((O-N)*L+this.kt,ft)),it=ft.toString()+"px"}st=it!=="1px";let _=this.Pt;if(st!==this.gn&&(_=st?this.Pt-this.di:this.Pt+this.di),R&&this.hasVerticalScrollbar&&this.allowVerticalScroll){let ft=1;G+1<$&&(ft=Math.max(($-G)*L+_,ft)),pt>Q+1&&(ft=Math.max((pt-Q)*L+_,ft)),M+1<T&&(ft=Math.max((T-M)*L+_,ft)),et=ft.toString()+"px"}Pt=et!=="1px"}if(this.Km&&!(st!==this.gn||Pt!==this.Wn))return(t!==this.kt||i!==this.Pt)&&this.maybeUpdate(),!1;if(st!==this.gn&&(it==="1px"?this.Pt=this.Pt+this.di:this.Pt=Math.max(this.Pt-this.di,1),n=!0),this.gn=st,p.style.width=it,Pt!==this.Wn&&(et==="1px"?this.kt=this.kt+this.di:this.kt=Math.max(this.kt-this.di,1),n=!0,this.Xu)){const _=S.l();Pt?(e.style.left=this.di+"px",this.position=_.e(this.at.x+this.di/this.scale,this.at.y)):(e.style.left="0px",this.position=_.e(this.at.x-this.di/this.scale,this.at.y)),S.s(_)}n&&this.Ql(),this.Wn=Pt,p.style.height=et,this.Jx=!0,n&&(this.Ru=!0);let wt=g.scrollLeft;if(this.hasHorizontalScrollbar&&this.allowHorizontalScroll&&(N+1<O?wt=(this.position.x-I)*L:I+1<j?wt=g.scrollWidth-g.clientWidth:X>V+1&&(wt=this.position.x*L)),this.Xu)switch(this.wx){case"negative":wt=-(g.scrollWidth-wt-g.clientWidth);break;case"reverse":wt=g.scrollWidth-wt-g.clientWidth;break}if(g.scrollLeft=wt,this.hasVerticalScrollbar&&this.allowVerticalScroll&&(M+1<T?g.scrollTop=(this.position.y-G)*L:G+1<$?g.scrollTop=g.scrollHeight-g.clientHeight:pt>Q+1&&(g.scrollTop=this.position.y*L)),a=this.kt,h=this.Pt,g.style.width=a+(this.Wn?this.di:0)+"px",g.style.height=h+(this.gn?this.di:0)+"px",t!==a||i!==h||this.animationManager.wi){const _=z.X(u,c,d,m);return this.onViewportBoundsChanged(_,this.viewportBounds,F,n),z.s(_),!1}return!0}add(e){const t=e.diagram;if(t===this)return;t!==null&&b.o("Cannot add part "+e.toString()+" to "+this.toString()+". It is already a part of "+t.toString());let i=this.findLayer(e.layerName);if(i===null&&(i=this.findLayer("")),i===null&&b.o('Cannot add a Part when unable find a Layer named "'+e.layerName+'" and there is no default Layer'),e.layer===i)return;const s=i.qh(99999999,e,e.diagram===this);s>=0&&this.raiseChangedEvent(3,"parts",i,null,e,null,s),i.isTemporary||this.invalidateDocumentBounds(),e.invalidateLayout(1);const n=e.layerChanged;n!==null&&n(e,null,i)}qh(e){this.partManager.qh(e);const t=this;e.qr(i=>t.SL(i)),e.data||e.Io(),e.hasPlaceholder()&&e.c(),e.data!==null&&e.qr(i=>t.partManager.SM(i,null)),(e.is()===!0||e.th()===!0)&&this.o0(e),e.ML(!0,this),e.NL()?(e.actualBounds.isReal()&&this.C(e.Hh(e.actualBounds)),this.invalidateDocumentBounds()):e.isVisible()&&e.actualBounds.isReal()&&this.C(e.Hh(e.actualBounds)),this.requestUpdate()}te(e){e.clearAdornments(),this.partManager.te(e);const t=this;e.data!==null&&e.qr(i=>t.partManager.MM(i,t)),this.Hn.delete(e),e instanceof dt&&this.Lr.delete(e),e.NL()?(e.actualBounds.isReal()&&this.C(e.Hh(e.actualBounds)),this.invalidateDocumentBounds()):e.isVisible()&&e.actualBounds.isReal()&&this.C(e.Hh(e.actualBounds)),this.requestUpdate()}remove(e){this.NM(e,!0)}NM(e,t){const i=e.layer;if(i===null||i.diagram!==this)return;e.isSelected=!1,e.isHighlighted=!1,e.invalidateLayout(2),t&&e.Kc();const s=i.te(-1,e,!1);s>=0&&this.raiseChangedEvent(4,"parts",i,e,null,s,null);const n=e.layerChanged;n!==null&&n(e,i,null)}removeParts(e,t){if(t===void 0&&(t=!1),Array.isArray(e)){const i=e.length;for(let s=0;s<i;s++){const n=e[s];t&&!n.canDelete()||this.remove(n)}}else{const i=new K;i.addAll(e);const s=i.iterator;for(;s.next();){const n=s.value;t&&!n.canDelete()||this.remove(n)}}}copyParts(e,t,i){return i===void 0&&(i=!1),this.partManager.copyParts(e,t,i)}moveParts(e,t,i,s){if(i===void 0&&(i=!1),s===void 0&&(s=this.a0()),this.toolManager===null)return;const n=new St;if(e!==null)if(Array.isArray(e))for(let o=0;o<e.length;o++)this.Wr(n,e[o],i,s);else{const o=e.iterator;for(;o.next();)this.Wr(n,o.value,i,s)}else{let o=this.parts;for(;o.next();){const r=o.value;this.Wr(n,r,i,s)}for(o=this.nodes;o.next();){const r=o.value;this.Wr(n,r,i,s)}for(o=this.links;o.next();){const r=o.value;this.Wr(n,r,i,s)}}this.bP(n,t,s,i)}Wr(e,t,i,s,n){if(!e.has(t)&&(n===void 0&&(n=!1),!(i&&!n&&!t.canMove()&&!t.canCopy())))if(s===void 0&&(s=this.a0()),t instanceof nt){if(e.set(t,this.Is(s,t,t.location)),t instanceof at&&(t.hasPlaceholder()||s.dragsMembers)){const r=t.memberParts;for(;r.next();){const a=r.value;this.Wr(e,a,i,s,s.groupsAlwaysMove)}}const o=t.linksConnected;for(;o.next();){const r=o.value;if(e.has(r))continue;const a=r.fromNode,h=r.toNode;a!==null&&e.has(a)&&h!==null&&e.has(h)&&this.Wr(e,r,i,s)}if(s.dragsTree){const r=t.findTreeChildrenNodes();for(;r.next();){const a=r.value;this.Wr(e,a,i,s)}}}else if(t instanceof dt){e.set(t,this.Is(s,t));const o=t.labelNodes;for(;o.next();){const r=o.value;this.Wr(e,r,i,s)}}else t instanceof Mt||e.set(t,this.Is(s,t,t.location))}bP(e,t,i,s){if(e===null||e.count===0)return;const n=S.l(),o=S.l();o.a(t),isNaN(o.x)&&(o.x=0),isNaN(o.y)&&(o.y=0);const r=this.ab;r||this.Vw(e);const a=b.nt(),h=b.nt(),l=e.iterator;let u=S.l();for(;l.next();){const p=l.key,y=l.value;if(p.Pe()){const x=this.CL(p,e);if(x!==null)a.push(new Bn(p,y,x));else if(!s||p.canMove()){const P=y.point;n.a(P),this.computeMove(p,n.add(o),i,u),p.location=u,y.shifted===void 0&&(y.shifted=new S),y.shifted.a(u.subtract(P))}}else l.key instanceof dt&&h.push(new Oe(l.key,l.value))}S.s(u);const c=a.length;for(let p=0;p<c;p++){const y=a[p],x=y.LL.point;n.a(x),y.xb.shifted===void 0&&(y.xb.shifted=new S),y.de.location=n.add(y.xb.shifted)}const d=S.l(),m=S.l(),g=h.length;for(let p=0;p<g;p++){const y=h[p],x=y.key;if(x instanceof dt){if(x.suspendsRouting){x.Sr=null;const P=x.fromNode,k=x.toNode;if(this.draggedLink!==null&&i.dragsLink){const w=y.value.point;if(x.dragComputation===null){e.set(x,this.Is(i,x,o));const N=o.x-w.x,M=o.y-w.y;x.pr(N,M)}else{const N=S.X(0,0),M=x.getPoint(0);M&&M.isReal()&&N.a(M),u=S.l().a(N).add(o);let C=u;i.isGridSnapEnabled&&(i.isGridSnapRealtime||this.lastInput.up)&&(C=S.l(),this.lS(x,u,C,i)),u.a(x.dragComputation(x,u,C)).subtract(N),e.set(x,this.Is(i,x,u));const O=u.x-w.x,T=u.y-w.y;x.pr(O,T),S.s(N),S.s(u),C!==u&&S.s(C)}}else{if(P!==null){d.a(P.location);const w=e.get(P);w!==null&&d.subtract(w.point)}if(k!==null){m.a(k.location);const w=e.get(k);w!==null&&m.subtract(w.point)}if(P!==null&&k!==null)if(d.equalsApprox(m)){const w=y.value.point,N=n;N.a(d),N.subtract(w),e.set(x,this.Is(i,x,d)),x.pr(N.x,N.y)}else x.suspendsRouting=!1,x.invalidateRoute();else{const w=y.value.point;let N;P!==null?N=d:k!==null?N=m:N=o,e.set(x,this.Is(i,x,N));const M=N.x-w.x,C=N.y-w.y;x.pr(M,C)}}}else if(x.fromNode===null||x.toNode===null){const P=y.value.point;e.set(x,this.Is(i,x,o));const k=o.x-P.x,w=o.y-P.y;x.pr(k,w)}}}S.s(n),S.s(o),S.s(d),S.s(m),b.tt(a),b.tt(h),r||(this.Ci(),this.wm(e))}computeMove(e,t,i,s){if(s===void 0&&(s=new S),s.a(t),e===null)return s;let n=t;const o=i.isGridSnapEnabled;o&&(i.isGridSnapRealtime||this.lastInput.up)&&(n=S.l(),this.lS(e,t,n,i));const r=e.dragComputation!==null?e.dragComputation(e,t,n):n,a=e.minLocation;let h=a.x;isNaN(h)&&(h=o?Math.round(e.location.x*1e3)/1e3:e.location.x);let l=a.y;isNaN(l)&&(l=o?Math.round(e.location.y*1e3)/1e3:e.location.y);const u=e.maxLocation;let c=u.x;isNaN(c)&&(c=o?Math.round(e.location.x*1e3)/1e3:e.location.x);let d=u.y;return isNaN(d)&&(d=o?Math.round(e.location.y*1e3)/1e3:e.location.y),s.e(Math.max(h,Math.min(r.x,c)),Math.max(l,Math.min(r.y,d))),n!==t&&S.s(n),s}a0(){const e=this.toolManager.findTool("Dragging");return e instanceof di?e.dragOptions:this.fb}lS(e,t,i,s){if(s===void 0&&(s=this.a0()),i.a(t),e===null)return i;const n=this.grid,o=s.gridSnapCellSize;let r=o.width,a=o.height;const h=s.gridSnapOrigin;let l=h.x,u=h.y;const c=s.gridSnapCellSpot;if(n!==null){const m=n.gridCellSize;isNaN(r)&&(r=m.width),isNaN(a)&&(a=m.height);const g=n.gridOrigin;isNaN(l)&&(l=g.x),isNaN(u)&&(u=g.y)}const d=S.X(0,0);return d.setSpot(0,0,r,a,c),A.Ig(t.x,t.y,l+d.x,u+d.y,r,a,i),S.s(d),i}Vw(e){if(e===null)return;this.ab=!0;const t=e.iterator;for(;t.next();){const i=t.key;i instanceof dt&&(i.suspendsRouting=!0)}}wm(e){if(e===null)return;const t=e.iterator;for(;t.next();){const i=t.key;i instanceof dt&&(i.suspendsRouting=!1,i.AL()&&i.invalidateRoute())}this.ab=!1}get draggedLink(){return this.cb}set draggedLink(e){this.cb!==e&&(this.cb=e,e!==null&&(this.ub=e.fromPort,this.db=e.toPort))}get SP(){return this.ub}set SP(e){this.ub=e}get MP(){return this.db}set MP(e){this.db=e}CL(e,t){const i=e.containingGroup;if(i!==null){let s=this.CL(i,t);if(s!==null||(s=t.get(i),s!==null))return s}return null}Is(e,t,i){if(i===void 0)return new Oi(S.Po);let s=e.isGridSnapEnabled;return!e.groupsSnapMembers&&t.containingGroup!==null&&(s=!1),s?new Oi(new S(Math.round(i.x*1e3)/1e3,Math.round(i.y*1e3)/1e3)):new Oi(i.copy())}CM(e,t){if(e.diagram!==null&&e.diagram!==this&&b.o("Cannot share a Layer with another Diagram: "+e+" of "+e.diagram),t===null?e.diagram!==null&&b.o("Cannot add an existing Layer to this Diagram again: "+e):(t.diagram!==this&&b.o("Existing Layer must be in this Diagram: "+t+" not in "+t.diagram),e===t&&b.o("Cannot move a Layer before or after itself: "+e)),e.diagram===this)return;const i=e.name,s=this.Gt,n=s.count;for(let o=0;o<n;o++)s.elt(o).name===i&&b.o("Cannot add Layer with the name '"+i+"'; a Layer with the same name is already present in this Diagram.")}addLayer(e){this.CM(e,null),e.To(this);const t=this.Gt;let i=t.count-1;if(!e.isTemporary)for(;i>=0&&t.elt(i).isTemporary;)i--;return t.insertAt(i+1,e),this.Si!==null&&this.raiseChangedEvent(3,"layers",this,null,e,null,i+1),this.C(),this.invalidateDocumentBounds(),this}addLayerBefore(e,t){this.CM(e,t),e.To(this);const i=this.Gt,s=i.indexOf(e);s>=0&&(i.delete(e),this.Si!==null&&this.raiseChangedEvent(4,"layers",this,e,null,s,null));const n=i.count;let o;for(o=0;o<n;o++)if(i.elt(o)===t){i.insertAt(o,e);break}return this.Si!==null&&this.raiseChangedEvent(3,"layers",this,null,e,null,o),this.C(),s<0&&this.invalidateDocumentBounds(),this}addLayerAfter(e,t){this.CM(e,t),e.To(this);const i=this.Gt,s=i.indexOf(e);s>=0&&(i.delete(e),this.Si!==null&&this.raiseChangedEvent(4,"layers",this,e,null,s,null));const n=i.count;let o;for(o=0;o<n;o++)if(i.elt(o)===t){i.insertAt(o+1,e);break}return this.Si!==null&&this.raiseChangedEvent(3,"layers",this,null,e,null,o+1),this.C(),s<0&&this.invalidateDocumentBounds(),this}Gr(e,t){e.To(this),this.Gt.insertAt(t,e)}TL(e){this.Gt.removeAt(e)}removeLayer(e){if(e.diagram!==this&&b.o("Cannot remove a Layer from another Diagram: "+e+" of "+e.diagram),e.name==="")return;const t=this.Gt,i=t.indexOf(e);if(t.delete(e)){const s=e.At.copy().iterator;for(;s.next();){const n=s.value,o=n.layerName;o!==e.name?n.layerName=o:n.layerName=""}this.Si!==null&&this.raiseChangedEvent(4,"layers",this,e,null,i,null),this.C(),this.invalidateDocumentBounds()}}findLayer(e){const t=this.layers;for(;t.next();){const i=t.value;if(i.name===e)return i}return null}findRouter(e){for(const t of this.zc)if(t.name===e)return t;return null}addModelChangedListener(e){return b.i(e,"function",Y,"addModelChangedListener:listener"),this.qn===null&&(this.qn=new J),this.qn.add(e),this.model.addChangedListener(e),this}removeModelChangedListener(e){b.i(e,"function",Y,"removeModelChangedListener:listener"),this.qn!==null&&(this.qn.delete(e),this.qn.count===0&&(this.qn=null)),this.model.removeChangedListener(e)}addChangedListener(e){return b.i(e,"function",Y,"addChangedListener:listener"),this.Ar===null&&(this.Ar=new J),this.Ar.add(e),this}removeChangedListener(e){b.i(e,"function",Y,"removeChangedListener:listener"),this.Ar!==null&&(this.Ar.delete(e),this.Ar.count===0&&(this.Ar=null))}Ew(e){if(!this.skipsUndoManager&&!this.model.skipsUndoManager&&this.model.undoManager.handleChanged(e),e.change!==1&&(this.isModified=!0),this.Ar!==null){const t=this.Ar,i=t.length;for(let s=0;s<i;s++)t.elt(s)(e)}}raiseChangedEvent(e,t,i,s,n,o,r){o===void 0&&(o=null),r===void 0&&(r=null);const a=new ci;a.diagram=this,a.change=e,a.propertyName=t,a.object=i,a.oldValue=s,a.oldParam=o,a.newValue=n,a.newParam=r,this.Ew(a)}raiseChanged(e,t,i,s,n){this.raiseChangedEvent(2,e,this,t,i,s,n)}t(e,t,i,s,n){this.raiseChangedEvent(2,e,this,t,i,s,n)}get animationManager(){return this.ds}get undoManager(){return this.Si.undoManager}get skipsUndoManager(){return this.Ro}set skipsUndoManager(e){b.i(e,"boolean",Y,"skipsUndoManager"),this.Ro=e,this.Si.skipsUndoManager=e}get delaysLayout(){return this.Ux}set delaysLayout(e){this.Ux=e}PC(e,t){if(e===null||e.diagram!==this)return;const i=this.fe;try{this.fe=!0;const s=e.change;if(s===2){const n=e.object,o=e.propertyName,r=e.getValue(t);if(mt.rt(n,o,r),n instanceof he){const a=n.part;a!==null&&a.invalidateAdornments()}this.isModified=!0}else if(s===3){const n=e.object,o=e.newParam,r=e.newValue;if(n instanceof ct)if(typeof o=="number"&&r instanceof he){t?n.te(o):n.insertAt(o,r);const a=n.part;a!==null&&a.invalidateAdornments()}else typeof o=="number"&&r instanceof Te&&(r.isRow?n.DL(o,t?void 0:r):n.FL(o,t?void 0:r));else if(n instanceof Be){const a=e.oldParam===!0;typeof o=="number"&&r instanceof Bt&&(t?(r.isSelected=!1,r.isHighlighted=!1,r.invalidateAdornments(),n.te(a?o:-1,r,a)):n.qh(o,r,a))}else n instanceof Y?typeof o=="number"&&r instanceof Be&&(t?this.TL(o):this.Gr(r,o)):b.o("unknown ChangeType.Insert object: "+e.toString());this.isModified=!0}else if(s===4){const n=e.object,o=e.oldParam,r=e.oldValue;if(n instanceof ct)typeof o=="number"&&r instanceof he?t?n.insertAt(o,r):n.te(o):typeof o=="number"&&r instanceof Te&&(r.isRow?n.DL(o,t?r:void 0):n.FL(o,t?r:void 0));else if(n instanceof Be){const a=e.newParam===!0;typeof o=="number"&&r instanceof Bt&&(t?n.At.indexOf(r)<0&&n.qh(o,r,a):(r.isSelected=!1,r.isHighlighted=!1,r.invalidateAdornments(),n.te(a?o:-1,r,a)))}else n instanceof Y?typeof o=="number"&&r instanceof Be&&(t?this.Gr(r,o):this.TL(o)):b.o("unknown ChangeType.Remove object: "+e.toString());this.isModified=!0}else s===1||b.o("unknown ChangedEvent: "+e.toString())}finally{this.fe=i}}startTransaction(e){return this.undoManager.startTransaction(e)}commitTransaction(e){return this.undoManager.commitTransaction(e)}rollbackTransaction(){return this.undoManager.rollbackTransaction()}commit(e,t){let i=t;i===void 0&&(i="");const s=this.skipsUndoManager;i===null&&(this.skipsUndoManager=!0,i=""),this.undoManager.startTransaction(i);let n=!1;try{e(this),n=!0}finally{n?this.undoManager.commitTransaction(i):this.undoManager.rollbackTransaction(),this.skipsUndoManager=s}}updateAllTargetBindings(e){this.partManager.updateAllTargetBindings(e)}updateAllThemeBindings(){if(this.partManager.updateAllThemeBindings(),this.ts!==null){const e=this.ts.part;e!==null&&e.Io()}}setDivBackground(e){this.div&&(this.div.style.backgroundColor=e)}updateAllRelationshipsFromData(){this.partManager.updateAllRelationshipsFromData()}pb(){const e=this.D,t=this.et,i=this.at;e.Ri(),t!==1&&e.et(t),(i.x!==0||i.y!==0)&&e.Ds(-i.x,-i.y)}RL(e,t){const i=this.animationManager;if(this.Ht||this.ps){this.et=t,this.Ql(),this.C(),this.ra(),i.ZC(e,this.et),this.pb();return}if(this.dt===null){this.et=t,this.pb();return}this.Ht=!0;const s=this.viewportBounds.copy(),n=this.kt,o=this.Pt;let r=this.zoomPoint.x,a=this.zoomPoint.y;const h=this.contentAlignment;isNaN(r)&&(h.isSide()?h.includesSide(B.LeftSide)?r=0:h.includesSide(B.RightSide)&&(r=n-1):h.isSpot()?r=h.x*(n-1):r=n/2),isNaN(a)&&(h.isSide()?h.includesSide(B.TopSide)?a=0:h.includesSide(B.BottomSide)&&(a=o-1):h.isSpot()?a=h.y*(o-1):a=o/2),this.scaleComputation!==null&&!this.animationManager.defaultAnimation.isAnimating&&(t=this.scaleComputation(this,t)),t<this.minScale&&(t=this.minScale),t>this.maxScale&&(t=this.maxScale);const l=S.X(this.at.x+r/e-r/t,this.at.y+a/e-a/t);this.position=l,S.s(l),this.et=t,this.Ql(),this.Ht=!1,this.onViewportBoundsChanged(s,this.viewportBounds,e,!1),this.Us(!1),i.ZC(e,this.et),this.C()}iR(){const e=this.Gt.r;for(let t=0;t<e.length;t++)e[t].nL()}onViewportBoundsChanged(e,t,i,s){if(e.equals(t))return;s===void 0&&(s=!1),s||this.ra(),this._l();const n=this.layout;n!==null&&n.isViewportSized&&this.autoScale===1&&(e.width!==t.width||e.height!==t.height)&&n.invalidateLayout();const o=this.currentTool;this.Uc===!0&&o instanceof Ve&&!this.animationManager.isTicking&&(this.lastInput.documentPoint=this.transformViewToDoc(this.lastInput.viewPoint),o.standardMouseActivity(this)),this.Ht||this.invalidateViewport(e,t),this.jr(),this.Bi.scale=i,this.Bi.position.x=e.x,this.Bi.position.y=e.y,this.Bi.bounds.a(e),this.Bi.canvasSize.width=Math.round(e.width*i),this.Bi.canvasSize.height=Math.round(e.height*i),this.Bi.newCanvasSize.width=this.kt,this.Bi.newCanvasSize.height=this.Pt,this.Bi.isScroll=s,this.v("ViewportBoundsChanged",this.Bi,e),this.isVirtualized&&this.links.each(r=>{r.isAvoiding&&r.actualBounds.intersectsRect(t)&&r.invalidateRoute()})}jr(e){const t=this.ts;if(t===null||!t.visible||t.layer===null)return;const i=e!==void 0?e:this._x;if(!i.isReal())return;const s=i.width,n=i.height;if(t.scale=1,t.angle=0,t.layer.isViewportAligned)t.width=s*this.scale,t.height=n*this.scale,t.part.alignment=B.TopLeft;else{t.xi===null&&(t.xi=new Gi);const o=t.xi.Yc;if(!o.isReal())return;t.width=s+o.width*2,t.height=n+o.height*2;const r=S.l();A.Ig(i.x,i.y,0,0,o.width,o.height,r),r.offset(-o.width,-o.height),t.part.location=r,S.s(r)}}clearSelection(e){e===void 0&&(e=!1);const t=this.selection;if(t.count===0)return;e||this.v("ChangingSelection",t);const i=t.toArray(),s=i.length;for(let n=0;n<s;n++){const o=i[n];o.isSelected=!1}t.ot(),t.clear(),t.g(),e||this.v("ChangedSelection",t)}select(e){e!==null&&e.diagram===this&&(!e.isSelected||this.selection.count>1)&&(this.v("ChangingSelection",this.selection),this.clearSelection(!0),e.isSelected=!0,this.v("ChangedSelection",this.selection))}selectCollection(e){if(this.v("ChangingSelection",this.selection),this.clearSelection(!0),Array.isArray(e)){const t=e.length;for(let i=0;i<t;i++){const s=e[i];s instanceof Bt||b.o("Diagram.selectCollection given something that is not a Part: "+s),s.isSelected=!0}}else{const t=e.iterator;for(;t.next();){const i=t.value;i instanceof Bt||b.o("Diagram.selectCollection given something that is not a Part: "+i),i.isSelected=!0}}this.v("ChangedSelection",this.selection)}clearHighlighteds(){const e=this.highlighteds;if(e.count>0){const t=e.toArray(),i=t.length;for(let s=0;s<i;s++){const n=t[s];n.isHighlighted=!1}e.ot(),e.clear(),e.g()}}highlight(e){e!==null&&e.diagram===this&&(!e.isHighlighted||this.highlighteds.count>1)&&(this.clearHighlighteds(),e.isHighlighted=!0)}highlightCollection(e){const t=new K().addAll(e),i=this.highlighteds.copy().removeAll(t).iterator;for(;i.next();){const n=i.value;n.isHighlighted=!1}const s=t.iterator;for(;s.next();){const n=s.value;n instanceof Bt||b.o("Diagram.highlightCollection given something that is not a Part: "+n),n.isHighlighted=!0}}scroll(e,t,i){i===void 0&&(i=1);const s=t==="up"||t==="down";let n=0;const o=S.l();if(e==="pixel")n=i;else if(e==="line")n=i*(s?this.scrollVerticalLineChange:this.scrollHorizontalLineChange);else if(e==="page"){let a=s?this.viewportBounds.height:this.viewportBounds.width;if(a*=this.scale,a!==0){const h=Math.max(a-(s?this.scrollVerticalLineChange:this.scrollHorizontalLineChange),0);n=i*h}}else if(e==="document"){const a=this.documentBounds,h=this.viewportBounds;t==="up"?this.position=o.e(h.x,a.y):t==="left"?this.position=o.e(a.x,h.y):t==="down"?this.position=o.e(h.x,a.bottom-h.height):t==="right"&&(this.position=o.e(a.right-h.width,h.y)),S.s(o);return}else b.o("scrolling unit must be 'pixel', 'line', 'page', or 'document', not: "+e);n/=this.scale;const r=this.position;t==="up"?this.position=o.e(r.x,r.y-n):t==="down"?this.position=o.e(r.x,r.y+n):t==="left"?this.position=o.e(r.x-n,r.y):t==="right"?this.position=o.e(r.x+n,r.y):b.o("scrolling direction must be 'up', 'down', 'left', or 'right', not: "+t),S.s(o)}scrollToRect(e){const t=this.viewportBounds;if(t.containsRect(e))return;const i=e.center;i.x-=t.width/2,i.y-=t.height/2,this.position=i}centerRect(e){const t=this.viewportBounds,i=e.center;i.x-=t.width/2,i.y-=t.height/2,this.position=i}transformDocToView(e){return e.copy().D(this.D)}transformViewToDoc(e){return e.copy().Ie(this.D)}LF(e){return e.Ie(this.D)}get opacity(){return this.Wt}set opacity(e){const t=this.Wt;t!==e&&(b.i(e,"number",Y,"opacity"),(e<0||e>1)&&b._(e,"0 <= value <= 1",Y,"opacity"),this.Wt=e,this.t("opacity",t,e),this.C())}get validCycle(){return this.Rx}set validCycle(e){const t=this.Rx;t!==e&&(this.Rx=e,this.t("validCycle",t,e))}get layers(){return this.Gt.iterator}get isModelReadOnly(){const e=this.Si;return e===null?!1:e.isReadOnly}set isModelReadOnly(e){const t=this.Si;t!==null&&(t.isReadOnly=e)}get isReadOnly(){return this.vo}set isReadOnly(e){const t=this.vo;t!==e&&(b.i(e,"boolean",Y,"isReadOnly"),this.vo=e,this.t("isReadOnly",t,e))}get isEnabled(){return this.Oi}set isEnabled(e){const t=this.Oi;t!==e&&(b.i(e,"boolean",Y,"isEnabled"),this.Oi=e,this.t("isEnabled",t,e))}get allowClipboard(){return this.Vx}set allowClipboard(e){const t=this.Vx;t!==e&&(b.i(e,"boolean",Y,"allowClipboard"),this.Vx=e,this.t("allowClipboard",t,e))}get allowCopy(){return this.Rl}set allowCopy(e){const t=this.Rl;t!==e&&(b.i(e,"boolean",Y,"allowCopy"),this.Rl=e,this.t("allowCopy",t,e))}get allowDelete(){return this.vl}set allowDelete(e){const t=this.vl;t!==e&&(b.i(e,"boolean",Y,"allowDelete"),this.vl=e,this.t("allowDelete",t,e))}get allowDragOut(){return this.zx}set allowDragOut(e){const t=this.zx;t!==e&&(b.i(e,"boolean",Y,"allowDragOut"),this.zx=e,this.t("allowDragOut",t,e))}get allowDrop(){return this.Xx}set allowDrop(e){const t=this.Xx;t!==e&&(b.i(e,"boolean",Y,"allowDrop"),this.Xx=e,this.t("allowDrop",t,e))}get allowTextEdit(){return this.Ol}set allowTextEdit(e){const t=this.Ol;t!==e&&(b.i(e,"boolean",Y,"allowTextEdit"),this.Ol=e,this.t("allowTextEdit",t,e))}get allowGroup(){return this.Il}set allowGroup(e){const t=this.Il;t!==e&&(b.i(e,"boolean",Y,"allowGroup"),this.Il=e,this.t("allowGroup",t,e))}get allowUngroup(){return this.El}set allowUngroup(e){const t=this.El;t!==e&&(b.i(e,"boolean",Y,"allowUngroup"),this.El=e,this.t("allowUngroup",t,e))}get allowInsert(){return this.Kx}set allowInsert(e){const t=this.Kx;t!==e&&(b.i(e,"boolean",Y,"allowInsert"),this.Kx=e,this.t("allowInsert",t,e))}get allowLink(){return this.Bl}set allowLink(e){const t=this.Bl;t!==e&&(b.i(e,"boolean",Y,"allowLink"),this.Bl=e,this.t("allowLink",t,e))}get allowRelink(){return this.Ul}set allowRelink(e){const t=this.Ul;t!==e&&(b.i(e,"boolean",Y,"allowRelink"),this.Ul=e,this.t("allowRelink",t,e))}get allowMove(){return this.Vl}set allowMove(e){const t=this.Vl;t!==e&&(b.i(e,"boolean",Y,"allowMove"),this.Vl=e,this.t("allowMove",t,e))}get allowReshape(){return this.zl}set allowReshape(e){const t=this.zl;t!==e&&(b.i(e,"boolean",Y,"allowReshape"),this.zl=e,this.t("allowReshape",t,e))}get allowResize(){return this.Xl}set allowResize(e){const t=this.Xl;t!==e&&(b.i(e,"boolean",Y,"allowResize"),this.Xl=e,this.t("allowResize",t,e))}get allowRotate(){return this.Kl}set allowRotate(e){const t=this.Kl;t!==e&&(b.i(e,"boolean",Y,"allowRotate"),this.Kl=e,this.t("allowRotate",t,e))}get allowSelect(){return this.Yl}set allowSelect(e){const t=this.Yl;t!==e&&(b.i(e,"boolean",Y,"allowSelect"),this.Yl=e,this.t("allowSelect",t,e))}get allowUndo(){return this.Yx}set allowUndo(e){const t=this.Yx;t!==e&&(b.i(e,"boolean",Y,"allowUndo"),this.Yx=e,this.t("allowUndo",t,e))}get allowZoom(){return this.Gx}set allowZoom(e){const t=this.Gx;t!==e&&(b.i(e,"boolean",Y,"allowZoom"),this.Gx=e,this.t("allowZoom",t,e))}get hasVerticalScrollbar(){return this.Iu}set hasVerticalScrollbar(e){const t=this.Iu;t!==e&&(b.i(e,"boolean",Y,"hasVerticalScrollbar"),this.Iu=e,this.ra(),this.C(),this.t("hasVerticalScrollbar",t,e),this.Us(!1))}get hasHorizontalScrollbar(){return this.Ou}set hasHorizontalScrollbar(e){const t=this.Ou;t!==e&&(b.i(e,"boolean",Y,"hasHorizontalScrollbar"),this.Ou=e,this.ra(),this.C(),this.t("hasHorizontalScrollbar",t,e),this.Us(!1))}get allowHorizontalScroll(){return this.jx}set allowHorizontalScroll(e){const t=this.jx;t!==e&&(b.i(e,"boolean",Y,"allowHorizontalScroll"),this.jx=e,this.t("allowHorizontalScroll",t,e),this.Us(!1))}get allowVerticalScroll(){return this.Hx}set allowVerticalScroll(e){const t=this.Hx;t!==e&&(b.i(e,"boolean",Y,"allowVerticalScroll"),this.Hx=e,this.t("allowVerticalScroll",t,e),this.Us(!1))}get scrollHorizontalLineChange(){return this.qx}set scrollHorizontalLineChange(e){const t=this.qx;t!==e&&(b.i(e,"number",Y,"scrollHorizontalLineChange"),e<0&&b._(e,">= 0",Y,"scrollHorizontalLineChange"),this.qx=e,this.t("scrollHorizontalLineChange",t,e))}get scrollVerticalLineChange(){return this.Wx}set scrollVerticalLineChange(e){const t=this.Wx;t!==e&&(b.i(e,"number",Y,"scrollVerticalLineChange"),e<0&&b._(e,">= 0",Y,"scrollVerticalLineChange"),this.Wx=e,this.t("scrollVerticalLineChange",t,e))}get lastInput(){return this.$h}set lastInput(e){this.$h=e}get previousInput(){return this.Xr}set previousInput(e){this.Xr=e}get firstInput(){return this.Wm}set firstInput(e){this.Wm=e}get currentCursor(){return this.vx}set currentCursor(e){if(e===""&&(e=this.Xm),this.vx!==e){b.i(e,"string",Y,"currentCursor");const t=this.dt,i=this.Tt;if(t===null||i===null)return;this.vx=e;const s=t.style.cursor;t.style.cursor=e,i.style.cursor=e,t.style.cursor===s&&(t.style.cursor="-webkit-"+e,i.style.cursor="-webkit-"+e,t.style.cursor===s&&(t.style.cursor="-moz-"+e,i.style.cursor="-moz-"+e,t.style.cursor===s&&(t.style.cursor=e,i.style.cursor=e)))}}get defaultCursor(){return this.Xm}set defaultCursor(e){e===""&&(e="auto");const t=this.Xm;t!==e&&(b.i(e,"string",Y,"defaultCursor"),this.Xm=e,this.t("defaultCursor",t,e))}get click(){return this.Tr}set click(e){const t=this.Tr;t!==e&&(e!==null&&b.i(e,"function",Y,"click"),this.Tr=e,this.t("click",t,e))}get doubleClick(){return this.Dr}set doubleClick(e){const t=this.Dr;t!==e&&(e!==null&&b.i(e,"function",Y,"doubleClick"),this.Dr=e,this.t("doubleClick",t,e))}get contextClick(){return this.Fr}set contextClick(e){const t=this.Fr;t!==e&&(e!==null&&b.i(e,"function",Y,"contextClick"),this.Fr=e,this.t("contextClick",t,e))}get mouseOver(){return this.Rr}set mouseOver(e){const t=this.Rr;t!==e&&(e!==null&&b.i(e,"function",Y,"mouseOver"),this.Rr=e,this.t("mouseOver",t,e))}get mouseHover(){return this.vr}set mouseHover(e){const t=this.vr;t!==e&&(e!==null&&b.i(e,"function",Y,"mouseHover"),this.vr=e,this.t("mouseHover",t,e))}get mouseHold(){return this.Or}set mouseHold(e){const t=this.Or;t!==e&&(e!==null&&b.i(e,"function",Y,"mouseHold"),this.Or=e,this.t("mouseHold",t,e))}get mouseDragOver(){return this.Ox}set mouseDragOver(e){const t=this.Ox;t!==e&&(e!==null&&b.i(e,"function",Y,"mouseDragOver"),this.Ox=e,this.t("mouseDragOver",t,e))}get mouseDrop(){return this.Ir}set mouseDrop(e){const t=this.Ir;t!==e&&(this.Ir=e,this.t("mouseDrop",t,e))}get handlesDragDropForTopLevelParts(){return this.Ix}set handlesDragDropForTopLevelParts(e){const t=this.Ix;t!==e&&(b.i(e,"boolean",Y,"handlesDragDropForTopLevelParts"),this.Ix=e,this.t("handlesDragDropForTopLevelParts",t,e))}get mouseEnter(){return this.Er}set mouseEnter(e){const t=this.Er;t!==e&&(e!==null&&b.i(e,"function",Y,"mouseEnter"),this.Er=e,this.t("mouseEnter",t,e))}get mouseLeave(){return this.Br}set mouseLeave(e){const t=this.Br;t!==e&&(e!==null&&b.i(e,"function",Y,"mouseLeave"),this.Br=e,this.t("mouseLeave",t,e))}get toolTip(){return this.Ur}set toolTip(e){const t=this.Ur;t!==e&&(this.Ur=e,this.t("toolTip",t,e))}get contextMenu(){return this.Vr}set contextMenu(e){const t=this.Vr;t!==e&&(this.Vr=e,this.t("contextMenu",t,e))}get commandHandler(){return this.HS}set commandHandler(e){this.HS!==e&&(this.HS=e,e.To(this))}get toolManager(){return this.YS}set toolManager(e){this.YS!==e&&(this.YS=e,e.diagram=this)}get defaultTool(){return this.GS}set defaultTool(e){const t=this.GS;t!==e&&(this.GS=e,e.diagram=this,this.currentTool===t&&(this.currentTool=e))}get currentTool(){return this.jS}set currentTool(e){const t=this.jS;t&&(t.isActive&&t.doDeactivate(),t.cancelWaitAfter(),t.doStop()),e===null&&(e=this.defaultTool),e!==null&&(this.jS=e,e.diagram=this,e.doStart())}get selection(){return this._S}get maxSelectionCount(){return this.Qx}set maxSelectionCount(e){const t=this.Qx;if(t!==e)if(b.i(e,"number",Y,"maxSelectionCount"),e>=0&&!isNaN(e)){if(this.Qx=e,this.t("maxSelectionCount",t,e),!this.undoManager.isUndoingRedoing){const i=this.selection.count-e;if(i>0){this.v("ChangingSelection",this.selection);const s=this.selection.toArray();for(let n=0;n<i;n++)s[n].isSelected=!1;this.v("ChangedSelection",this.selection)}}}else b._(e,">= 0",Y,"maxSelectionCount")}get nodeSelectionAdornmentTemplate(){return this.jm}set nodeSelectionAdornmentTemplate(e){const t=this.jm;t!==e&&(this.jm=e,this.t("nodeSelectionAdornmentTemplate",t,e))}get groupSelectionAdornmentTemplate(){return this.ib}set groupSelectionAdornmentTemplate(e){const t=this.ib;t!==e&&(this.ib=e,this.t("groupSelectionAdornmentTemplate",t,e))}get linkSelectionAdornmentTemplate(){return this.eb}set linkSelectionAdornmentTemplate(e){const t=this.eb;t!==e&&(this.eb=e,this.t("linkSelectionAdornmentTemplate",t,e))}get highlighteds(){return this.tM}get isModified(){const e=this.undoManager;return e.isEnabled?e.currentTransaction!==null?!0:this.Uu&&this.vs!==e.historyIndex:this.Uu}set isModified(e){if(this.Uu!==e){b.i(e,"boolean",Y,"isModified"),this.Uu=e;const t=this.undoManager;!e&&t.isEnabled&&(this.vs=t.historyIndex),e||this.vL()}}vL(){const e=this.isModified;this.ZS!==e&&(this.ZS=e,this.v("Modified"))}get model(){return this.Si}set model(e){const t=this.Si;if(t!==e){this.currentTool.doCancel(),t&&t.undoManager!==e.undoManager&&t.undoManager.isInTransaction&&b.o("Do not replace a Diagram.model while a transaction is in progress."),this.animationManager.stopAnimation(!0);const i=this.gL(!0);this.Jn=!1,this.vu=!0,this.vs=-2,this.Pr=!1;const s=this.Ht;this.Ht=!0,this.animationManager.Fl("Model"),t&&(this.qn!==null&&this.qn.each(n=>t.removeChangedListener(n)),t.removeChangedListener(this.$S)),this.Si=e,this.partManager=this.cR(this.Si.type),this.initializePartManager(this.partManager);for(let n=0;n<i.length;n++)this.add(i[n]);e.addChangedListener(this.JS),this.partManager.LM(),e.removeChangedListener(this.JS),e.addChangedListener(this.$S),this.qn!==null&&this.qn.each(n=>e.addChangedListener(n)),this.Ht=s,this.invalidateDocumentBounds(),this.Ht||this.C(),t&&e.undoManager.copyProperties(t.undoManager)}}get themeManager(){return this.gb}set themeManager(e){const t=this.gb;t!==e&&(t!==null&&t.removeDiagram(this),this.gb=e,e!==null&&e.addDiagram(this))}initializePartManager(e){}static gM(e,t){Y.hL.set(e,t)}static get licenseKey(){return Y.AM.last()}static set licenseKey(e){Y.AM.add(e.replace(/\s/g,""))}static get version(){return Y.fR}cR(e){const t=Y.hL.get(e);return t!==null?new t:new Ei}get Y(){return this.WS}set Y(e){this.WS=e}get mx(){return this.oL}uR(e){if(e.model!==this.model)return;const t=e.change,i=e.propertyName;if(t===1&&i[0]==="S"){if(i==="StartingFirstTransaction"){const s=this,n=this.toolManager;n.mouseDownTools.each(o=>o.diagram=s),n.mouseMoveTools.each(o=>o.diagram=s),n.mouseUpTools.each(o=>o.diagram=s),this.routers.each(o=>o.diagram=s),!this.ps&&!this.Jn&&(this.Oc=!0,this.vu&&(this.Pr=!0))}else if(i==="StartingUndo"||i==="StartingRedo"){const s=this.animationManager;this.skipsUndoManager||(s.defaultAnimation.isAnimating&&s.stopAnimation(),s.getBundleAnimation().isAnimating&&s.getBundleAnimation().stop()),this.v("ChangingSelection",this.selection)}else if(i==="StartedTransaction"){const s=this.animationManager;s.defaultAnimation.isAnimating&&!this.skipsUndoManager&&s.stopAnimation()}return}if(this.Y){this.Y=!1;try{if(e.modelChange===""&&t===1){(i==="FinishedUndo"||i==="FinishedRedo")&&(this.v("ChangedSelection",this.selection),this.Ci());const s=this.animationManager;i==="RolledBackTransaction"&&s.stopAnimation(),this._C(),this.Oc=!0,this.maybeUpdate(),(this.undoManager.transactionLevel===0||this.undoManager.transactionLevel===1)&&s.SS(),i==="CommittedTransaction"&&this.undoManager.isJustDiscarded&&(this.vs=Math.min(this.vs,this.undoManager.historyIndex-1)),(i==="CommittedTransaction"||i==="RolledBackTransaction")&&this.undoManager.Iw&&setTimeout(()=>{this.isModified=!1},1);const n=e.isTransactionFinished;if(n&&(this.vL(),this.mx.clear(),this.animationManager.fF()),!this.Ex&&n&&this.lastInput.targetDiagram){this.Ex=!0;const o=this;b.Oh(()=>{o.currentTool.standardMouseOver(),o.Ex=!1},10)}}}finally{this.Y=!0}}}get fe(){return this.qS}set fe(e){this.qS=e}get dc(){return this.Bx}set dc(e){this.Bx=e}SL(e){const t=e.L.r;for(const i of t)i instanceof Ge&&this.TM(i)}TM(e){const t=e.element;if(t===null||!(t instanceof HTMLImageElement)||(t.es instanceof K&&t.es.add(this),e.dR(),!t.c0))return;const i=t.getAttribute("src")||"",s=this.Jl.get(i);if(s===null){Ge.OL(e,t);const n=[];n.push(e),this.Jl.set(i,n)}else{for(let n=0;n<s.length;n++)if(s[n]===e)return;s.push(e)}}gR(e){const t=e.L.r,i=t.length;for(let s=0;s<i;s++)this.DM(t[s])}DM(e){if(!(e instanceof Ge))return;const t=e.element;if(t===null||!(t instanceof HTMLImageElement)||!t.c0)return;const i=t.getAttribute("src")||"",s=this.Jl.get(i);if(s!==null){for(let n=0;n<s.length;n++)if(s[n]===e){s.splice(n,1),s.length===0&&(this.Jl.delete(i),Ge.mR(t),t.es instanceof K&&t.es.delete(this),Ge.clearCache(i));return}}}mL(){Ge.clearCache(),this.Jl.clear()}rebuildParts(){this.partManager.rebuildParts()}Lc(e,t){this.ds.Lc(e,t)}Cc(e,t){this.ds.Cc(e,t)}findPartForKey(e){return this.partManager.findPartForKey(e)}findNodeForKey(e){return this.partManager.findNodeForKey(e)}findLinkForKey(e){return this.partManager.findLinkForKey(e)}findPartForData(e){return this.partManager.findPartForData(e)}findNodeForData(e){return this.partManager.findNodeForData(e)}findLinkForData(e){return this.partManager.findLinkForData(e)}findNodesByExample(...e){return this.partManager.findNodesByExample(...e)}findLinksByExample(...e){return this.partManager.findLinksByExample(...e)}get nodeTemplate(){return this.zr.get("")}set nodeTemplate(e){const t=this.zr.get("");t!==e&&(this.zr.set("",e),this.t("nodeTemplate",t,e),this.undoManager.isUndoingRedoing||this.rebuildParts())}get nodeTemplateMap(){return this.zr}set nodeTemplateMap(e){const t=this.zr;t!==e&&(this.zr=e,this.t("nodeTemplateMap",t,e),this.undoManager.isUndoingRedoing||this.rebuildParts())}get groupTemplate(){return this.Jh.get("")}set groupTemplate(e){const t=this.Jh.get("");t!==e&&(this.Jh.set("",e),this.t("groupTemplate",t,e),this.undoManager.isUndoingRedoing||this.rebuildParts())}get groupTemplateMap(){return this.Jh}set groupTemplateMap(e){const t=this.Jh;t!==e&&(this.Jh=e,this.t("groupTemplateMap",t,e),this.undoManager.isUndoingRedoing||this.rebuildParts())}get linkTemplate(){return this.ql.get("")}set linkTemplate(e){const t=this.ql.get("");t!==e&&(this.ql.set("",e),this.t("linkTemplate",t,e),this.undoManager.isUndoingRedoing||this.rebuildParts())}get linkTemplateMap(){return this.ql}set linkTemplateMap(e){const t=this.ql;t!==e&&(this.ql=e,this.t("linkTemplateMap",t,e),this.undoManager.isUndoingRedoing||this.rebuildParts())}get isMouseCaptured(){return this.QS}set isMouseCaptured(e){const t=this.dt;if(t===null)return;const i=t.Ft;i instanceof SVGElement||(e?(this.lastInput.bubbles=!1,this.Mi(i,"pointermove",this.ia,!1),this.Mi(i,"pointerdown",this.Zl,!1),this.Mi(i,"pointerup",this.ea,!1),this.Mi(i,"pointerout",this.sa,!1),this.Mi(i,"pointercancel",this.na,!1),this.Vt(Z,"pointermove",this.ia,!0),this.Vt(Z,"pointerdown",this.Zl,!0),this.Vt(Z,"pointerup",this.ea,!0),this.Vt(Z,"pointerout",this.sa,!0),this.Vt(Z,"pointercancel",this.na,!0),this.Mi(i,"wheel",this.ta,!1),this.Vt(Z,"wheel",this.ta,!0),this.Vt(Z,"selectstart",this.Yh,!1)):(this.Mi(Z,"pointermove",this.ia,!0),this.Mi(Z,"pointerdown",this.Zl,!0),this.Mi(Z,"pointerup",this.ea,!0),this.Mi(Z,"pointerout",this.sa,!0),this.Mi(Z,"pointercancel",this.na,!0),this.Vt(i,"pointermove",this.ia,!1),this.Vt(i,"pointerdown",this.Zl,!1),this.Vt(i,"pointerup",this.ea,!1),this.Vt(i,"pointerout",this.sa,!1),this.Vt(i,"pointercancel",this.na,!1),this.Mi(Z,"wheel",this.ta,!0),this.Mi(Z,"selectstart",this.Yh,!1),this.Vt(i,"wheel",this.ta,!1)),this.QS=e)}get position(){return this.at}set position(e){if(this.at.equals(e))return;const t=S.l().a(this.at),i=this.viewportBounds.copy();if(this.at.a(e),this.animationManager.$C(t,this.at),!this.Ht&&!(this.dt===null&&!this.Bu.isReal())){this.Ht=!0;const s=this.scale,n=this.kt/s,o=this.Pt/s;this.wM(this.Gm,n,o,this.Rc,!1),this.Ht=!1}else this.Ql(),this.pb();if(!this.Ht){const s=this.viewportBounds;this.onViewportBoundsChanged(i,s,this.et,!1)}S.s(t)}get initialPosition(){return this.xx}set initialPosition(e){this.xx.equals(e)||(this.xx=e.N())}get initialScale(){return this.bx}set initialScale(e){this.bx!==e&&(b.i(e,"number",Y,"initialScale"),this.bx=e)}get grid(){return this.ts===null&&(this.ts=this.yL()),this.ts}set grid(e){let t=this.ts;if(t!==e){t===null&&(this.ts=this.yL(),t=this.ts),e.type!==ct.Grid&&b.o("Diagram.grid must be a Panel of type Panel.Grid");const i=t.panel;i!==null&&i.remove(t),this.ts=e,e.name="GRID",i!==null&&i.add(e),this.jr(),this.C(),this.t("grid",t,e)}}get viewportBounds(){return this._x}Ql(){const e=this._x,t=this.at,i=this.et;e.e(t.x,t.y,Math.max(this.kt,0)/i,Math.max(this.Pt,0)/i),this._l()}get viewSize(){return this.Bu}set viewSize(e){const t=this.viewSize;if(!t.equals(e)){e=e.N(),this.Bu=e;let i=0,s=0;e.isReal()?(i=e.width,s=e.height):this.Tt!==null&&(i=this.Tt.clientWidth||1,s=this.Tt.clientHeight||1),this.kt=i,this.Pt=s,this.Ql(),this.invalidateDocumentBounds(),this.t("viewSize",t,e),this.C()}}get fixedBounds(){return this.Mx}set fixedBounds(e){const t=this.Mx;t.equals(e)||((e.width===-1/0||e.height===1/0||e.height===-1/0)&&b.o("fixedBounds width/height must not be Infinity"),e=e.N(),this.Mx=e,this.invalidateDocumentBounds(),this.t("fixedBounds",t,e))}get scrollMargin(){return this.Fc}set scrollMargin(e){typeof e=="number"&&(e=new Kt(e));const t=this.Fc;t.equals(e)||(e=e.N(),this.Fc=e,this.t("scrollMargin",t,e),this.yu())}get scrollMode(){return this.jh}set scrollMode(e){const t=this.jh;t!==e&&(this.jh=e,e===1&&this.Us(!1),this.t("scrollMode",t,e),this.ra(),this.C())}get scrollsPageOnFocus(){return this.Nx}set scrollsPageOnFocus(e){const t=this.Nx;t!==e&&(b.i(e,"boolean",Y,"scrollsPageOnFocus"),this.Nx=e,this.t("scrollsPageOnFocus",t,e))}get positionComputation(){return this.Cx}set positionComputation(e){const t=this.Cx;t!==e&&(e!==null&&b.i(e,"function",Y,"positionComputation"),this.Cx=e,this.Us(!1),this.t("positionComputation",t,e))}get scaleComputation(){return this.Lx}set scaleComputation(e){const t=this.Lx;t!==e&&(e!==null&&b.i(e,"function",Y,"scaleComputation"),this.Lx=e,this.RL(this.scale,this.scale),this.t("scaleComputation",t,e))}get documentBounds(){return this.Gm}IL(e){this.Zh=!1;let t=this.Gm;t.equals(e)||(t=t.copy(),this.Gm.a(e),this.Us(!1),this.v("DocumentBoundsChanged",void 0,t),this.ra(),this.C())}ensureBounds(){if(this.Zh){const e=z.l();this.IL(this.computeBounds(e)),z.s(e)}}get isVirtualized(){return this.tb}set isVirtualized(e){const t=this.tb;t!==e&&(b.i(e,"boolean",Y,"isVirtualized"),this.tb=e,this.t("isVirtualized",t,e))}get scale(){return this.et}set scale(e){const t=this.et;t!==e&&this.RL(t,e)}get defaultScale(){return this.Jm}set defaultScale(e){this.Jm=e}get autoScale(){return this.jl}set autoScale(e){const t=this.jl;t!==e&&(this.jl=e,this.t("autoScale",t,e),e!==1&&this.Us(!1))}get initialAutoScale(){return this.Cr}set initialAutoScale(e){const t=this.Cr;t!==e&&(this.Cr=e,this.t("initialAutoScale",t,e))}get initialViewportSpot(){return this.Tx}set initialViewportSpot(e){const t=this.Tx;t!==e&&(e.isSpot()||b.o("initialViewportSpot must be a specific Spot: "+e),this.Tx=e,this.t("initialViewportSpot",t,e))}get initialDocumentSpot(){return this.Ax}set initialDocumentSpot(e){const t=this.Ax;t!==e&&(e.isSpot()||b.o("initialViewportSpot must be a specific Spot: "+e),this.Ax=e,this.t("initialDocumentSpot",t,e))}get minScale(){return this.kx}set minScale(e){const t=this.kx;t!==e&&(e>0?(this.kx=e,this.t("minScale",t,e),e>this.scale&&(this.scale=e)):b._(e,"> 0",Y,"minScale"))}get maxScale(){return this.Px}set maxScale(e){const t=this.Px;t!==e&&(e>0?(this.Px=e,this.t("maxScale",t,e),e<this.scale&&(this.scale=e)):b._(e,"> 0",Y,"maxScale"))}get zoomPoint(){return this.Sx}set zoomPoint(e){this.Sx.equals(e)||(e=e.N(),this.Sx=e)}get contentAlignment(){return this.Rc}set contentAlignment(e){const t=this.Rc;t.equals(e)||(e=e.N(),this.Rc=e,this.t("contentAlignment",t,e),this.Us(!1))}get initialContentAlignment(){return this.Um}set initialContentAlignment(e){const t=this.Um;t.equals(e)||(e=e.N(),this.Um=e,this.t("initialContentAlignment",t,e))}get padding(){return this.$t}set padding(e){typeof e=="number"&&(e=new Kt(e));const t=this.$t;t.equals(e)||(e=e.N(),this.$t=e,this.invalidateDocumentBounds(),this.t("padding",t,e))}get partManager(){return this.oM}set partManager(e){const t=this.oM;t!==e&&(e.diagram!==null&&b.o("Cannot share PartManagers between Diagrams: "+e.toString()),t&&t.To(null),this.oM=e,e.To(this))}get nodes(){return this.partManager.nodes.iterator}get links(){return this.partManager.links.iterator}get parts(){return this.partManager.parts.iterator}findTopLevelNodesAndLinks(){const e=new K,t=this.nodes;for(;t.next();){const s=t.value;s.isTopLevel&&e.add(s)}const i=this.links;for(;i.next();){const s=i.value;s.isTopLevel&&e.add(s)}return e.iterator}findTopLevelGroups(){return this.Yr.iterator}get routers(){return this.zc}doLinkRouting(e){this.Fo=!0;const t=this.zc.r;for(let i=0;i<t.length;i++)t[i].canRoute(e)&&t[i].routeLinks(this.Lr,e);this.Fo=!1}get layout(){return this.ie}set layout(e){const t=this.ie;t!==e&&(this.ie=e,e.diagram=this,e.group=null,this.Kr=!0,this.t("layout",t,e),this.requestUpdate())}layoutDiagram(e){this.Ci(),e&&this.bb(!0),this.ps?this.kM(!1,this.bl||this.zc.count!==0&&this.Hn.size!==0):(this.Oc=!0,this.yr())}bb(e){const t=this.Yr.iterator;for(;t.next();)this.EL(t.value,e);this.layout&&(e?this.layout.isValidLayout=!1:this.layout.invalidateLayout())}EL(e,t){if(e===null)return;const i=e.la.iterator;for(;i.next();){const s=i.value;this.EL(s,t)}e.layout!==null&&(t?e.layout.isValidLayout=!1:e.layout.invalidateLayout())}kM(e,t){if(this.Ux)return;const i=this.Y;this.Y=!0;const s="Layout",n=this.undoManager.transactionLevel,o=this.layout,r=this.animationManager;try{n===0&&(this.undoManager.xl=!0,this.startTransaction(s)),n<=1&&!r.defaultAnimation.isAnimating&&!r.wi&&(e||r.Fl(s)),this.Kr=!1;let a=this.Yr.iterator;for(;a.next();)this.BL(a.value,e,n,t);let h=!1;if(o.isValidLayout||(!e||o.isRealtime||o.isRealtime===null||n===0?(o.doLayout(this),this.r0(this),h=!0,o.isValidLayout=!0):this.Kr=!0),h||this.r0(this),this.doLinkRouting(this),this.Lr.clear(),this.Wh.size!==0){for(let l=0;l<23&&this.Wh.size!==0;l++){for(a=this.Yr.iterator;a.next();)this.UL(a.value);const u=this.Lr;this.Lr=this.Wh,this.Wh=u,this.r0(this),this.doLinkRouting(this)}this.Lr.clear(),this.Wh.clear()}}finally{const a=this.undoManager.xl;n===0&&(this.commitTransaction(s),this.undoManager.xl=!1),a&&(n===0||n===1)&&r.SS(),this.Kr&&(this.Kr=!o.isValidLayout),this.Y=i}}BL(e,t,i,s){const n=e.la.iterator;for(;n.next();)this.BL(n.value,t,i,s);const o=e.layout;o!==null&&!o.isValidLayout?!t||o.isRealtime||i===0?(e.Jr=!e.location.isReal(),o.doLayout(e),e.invalidateLayout(32),this.yb(e),this.r0(e),this.doLinkRouting(e),o.isValidLayout=!0):(this.doLinkRouting(e),this.Kr=!0):s&&this.doLinkRouting(e)}UL(e){const t=e.la.iterator;for(;t.next();)this.UL(t.value);this.r0(e),this.doLinkRouting(e)}get isTreePathToChildren(){return this.Dx}set isTreePathToChildren(e){const t=this.Dx;if(t!==e&&(b.i(e,"boolean",Y,"isTreePathToChildren"),this.Dx=e,this.t("isTreePathToChildren",t,e),!this.undoManager.isUndoingRedoing)){const i=this.nodes;for(;i.next();)i.value.f0()}}findTreeRoots(){const e=new J,t=this.nodes;for(;t.next();){const i=t.value;i.isTopLevel&&i.findTreeParentLink()===null&&e.add(i)}return e.iterator}get treeCollapsePolicy(){return this.Fx}set treeCollapsePolicy(e){const t=this.Fx;t!==e&&(e!==1&&e!==2&&e!==3&&b.o("Unknown Diagram.treeCollapsePolicy: "+e),this.Fx=e,this.t("treeCollapsePolicy",t,e))}get isCollapsingExpanding(){return this.KS}set isCollapsingExpanding(e){this.KS=e}BF(){const e=new St,t=new St;function i(s){const n=s.toLowerCase(),o=new J;e.set(s,o),e.set(n,o),t.set(s,s),t.set(n,s)}i("InitialAnimationStarting"),i("AnimationStarting"),i("AnimationFinished"),i("BackgroundSingleClicked"),i("BackgroundDoubleClicked"),i("BackgroundContextClicked"),i("ClipboardChanged"),i("ClipboardPasted"),i("DocumentBoundsChanged"),i("ExternalObjectsDropped"),i("GainedFocus"),i("InitialLayoutCompleted"),i("LayoutCompleted"),i("LinkDrawn"),i("LinkRelinked"),i("LinkReshaped"),i("LostFocus"),i("Modified"),i("ObjectSingleClicked"),i("ObjectDoubleClicked"),i("ObjectContextClicked"),i("PartCreated"),i("PartResized"),i("PartRotated"),i("SelectionMoved"),i("SelectionCopied"),i("SelectionDeleting"),i("SelectionDeleted"),i("SelectionGrouped"),i("SelectionUngrouped"),i("ChangingSelection"),i("ChangedSelection"),i("SubGraphCollapsed"),i("SubGraphExpanded"),i("TextEdited"),i("ThemeChanged"),i("TreeCollapsed"),i("TreeExpanded"),i("ViewportBoundsChanged"),i("InvalidateDraw"),this.zS=e,this.XS=t}PL(e){const t=this.XS.get(e);return t!==null?t:this.XS.get(e.toLowerCase())}FM(e){let t=this.zS.get(e);if(t!==null)return t;const i=e.toLowerCase();if(t=this.zS.get(i),t!==null)return t;b.o("Unknown DiagramEvent name: "+e)}addDiagramListener(e,t){b.i(e,"string",Y,"addDiagramListener:name"),b.i(t,"function",Y,"addDiagramListener:listener");const i=this.FM(e);return i!==null&&i.add(t),this}removeDiagramListener(e,t){b.i(e,"string",Y,"removeDiagramListener:name"),b.i(t,"function",Y,"addDiagramListener:listener");const i=this.FM(e);i!==null&&i.delete(t)}raiseDiagramEvent(e,t,i){this.v(e,t,i)}v(e,t,i){const s=this.FM(e),n=new Ki;n.diagram=this;const o=this.PL(e);o!==null&&(n.name=o),t!==void 0&&(n.subject=t),i!==void 0&&(n.parameter=i);const r=s.length;if(r===1)s.elt(0)(n);else if(r!==0){const a=s.toArray();for(let h=0;h<r;h++){const l=a[h];l(n)}}}isUnoccupied(e,t){return this.getPositions(!1,null,t||null).isUnoccupied(e.x,e.y,e.width,e.height)}computeOccupiedArea(e){return this.isVirtualized?this.viewportBounds.copy():this.Zh?this.xL(e):e.a(this.documentBounds)}getPositions(e,t,i){let s=this.Hl;s===null&&(this.Hl=s=new xi(this.avoidanceCellSize));let n=t;if(s.Eo||s.ha!==n||s.RM!==i){if(s.vM=Math.max(s.Gc+1,Math.floor(this.avoidanceLimit/this.avoidanceCellSize.width)),s.OM=Math.max(s.Gc+1,Math.floor(this.avoidanceLimit/this.avoidanceCellSize.height)),n!==null&&(n=this.VL(n)),n===null){const o=z.l();this.computeOccupiedArea(o),o.inflate(100,100),s.kb(o);const r=this.nodes;for(;r.next();){const a=r.value,h=a.layer;h===null||!h.visible||h.isTemporary||this.IM(a,i,o)}z.s(o)}else{if(n.memberParts.count>0){const a=this.computePartsBounds(n.memberParts,!1);a.inflate(20,20),s.kb(a)}const o=z.l(),r=n.memberParts;for(;r.next();){const a=r.value;a instanceof nt&&this.IM(a,i,o)}z.s(o)}s.ha=n,s.RM=i,s.Eo=!1}else e&&s.zL();return s}get avoidanceCellSize(){return this.iM}set avoidanceCellSize(e){this.Hl=null,this.iM=new ut(Math.max(1,e.width),Math.max(1,e.height))}get avoidanceLimit(){return this.eM}set avoidanceLimit(e){this.eM=Math.max(1,e)}VL(e){return e.canAvoid()?e:e.containingGroup!==null?this.VL(e.containingGroup):null}IM(e,t,i){if(e===t||!e.isVisible())return;const s=e.canAvoid();if(s){const n=e.getAvoidableRect(i);this.Hl.pR(n.x,n.y,n.width,n.height)}if(e instanceof at&&(!s||e.avoidableMembers)){const n=e.memberParts;for(;n.next();){const o=n.value;o instanceof nt&&this.IM(o,t,i)}}}EM(e){this.Hl!==null&&!this.Hl.Eo&&(e===void 0||e.canAvoid())&&(this.Hl.Eo=!0)}get autoScrollInterval(){return this.Vm}set autoScrollInterval(e){const t=this.Vm;t!==e&&(this.Vm=e,this.t("autoScrollInterval",t,e))}get autoScrollRegion(){return this.zm}set autoScrollRegion(e){typeof e=="number"&&(e=new Kt(e));const t=this.zm;t.equals(e)||(e=e.N(),this.zm=e,this.invalidateDocumentBounds(),this.t("autoScrollRegion",t,e))}doAutoScroll(e){this.qm.a(e),this.computeAutoScrollPosition(this.qm).equalsApprox(this.position)?this.stopAutoScroll():this.XL()}XL(){if(this.vc!==-1)return;const e=this.Vm,t=this;this.vc=b.Oh(()=>{if(t.vc===-1||(t.stopAutoScroll(),t.lastInput.event===null))return;const i=t.computeAutoScrollPosition(t.qm);if(i.equalsApprox(t.position))return;t.position=i,t.lastInput.documentPoint=t.transformViewToDoc(t.qm),t.doMouseMove(),t.Zh=!0;const s=z.l();t.computeBounds(s),s.unionRect(t.documentBounds),t.IL(s),z.s(s),t.Ue=!0,t.maybeUpdate(),t.XL()},e)}stopAutoScroll(){this.vc!==-1&&(b.Og(this.vc),this.vc=-1)}computeAutoScrollPosition(e){let t=this.position;const i=this.zm;if(i.top<=0&&i.left<=0&&i.right<=0&&i.bottom<=0)return t;const s=this.viewportBounds,n=this.scale,o=z.X(0,0,s.width*n,s.height*n),r=S.X(0,0);if(e.x>=o.x&&e.x<o.x+i.left&&this.allowHorizontalScroll){let a=Math.max(this.scrollHorizontalLineChange,1);a=a|0,r.x-=a,e.x<o.x+i.left/2&&(r.x-=a),e.x<o.x+i.left/4&&(r.x-=4*a)}else if(e.x<=o.x+o.width&&e.x>o.x+o.width-i.right&&this.allowHorizontalScroll){let a=Math.max(this.scrollHorizontalLineChange,1);a=a|0,r.x+=a,e.x>o.x+o.width-i.right/2&&(r.x+=a),e.x>o.x+o.width-i.right/4&&(r.x+=4*a)}if(e.y>=o.y&&e.y<o.y+i.top&&this.allowVerticalScroll){let a=Math.max(this.scrollVerticalLineChange,1);a=a|0,r.y-=a,e.y<o.y+i.top/2&&(r.y-=a),e.y<o.y+i.top/4&&(r.y-=4*a)}else if(e.y<=o.y+o.height&&e.y>o.y+o.height-i.bottom&&this.allowVerticalScroll){let a=Math.max(this.scrollVerticalLineChange,1);a=a|0,r.y+=a,e.y>o.y+o.height-i.bottom/2&&(r.y+=a),e.y>o.y+o.height-i.bottom/4&&(r.y+=4*a)}return r.equalsApprox(S.Po)||(t=new S(t.x+r.x/n,t.y+r.y/n)),z.s(o),S.s(r),t}makeSvg(e){this.Wl.has("SVG")||this.addRenderer("SVG",new as(this,Z.document));const t=new as(this,Z.document,!0);e===void 0&&(e={});const i=this;function s(n,o){const r=i.KL(n,"SVG",t),a=r!==null?r.svg:null;return typeof o=="function"?(o(a),null):a}return this.YL(s,e)}makeSVG(e){return this.makeSvg(e)}addRenderer(e,t){this.Wl.set(e,t)}removeRenderer(e){this.Wl.delete(e)}cacheGroupExternalLinks(e){this.dM=e,e||this.nodes.each(t=>{t instanceof at&&(t.u0=null)})}YL(e,t){const i=t.callback;let s=!0;const n=this.Jl.iterator;for(;n.next();)if(!n.value[0].mn){s=!1;break}if(typeof i!="function"||s)return e(t,i,this);const o=this;function r(){const l=+new Date;for(s=!0,n.reset();n.next();)if(!n.value[0].mn){s=!1;break}if(s||l-h>a){e(t,i,o);return}Z.requestAnimationFrame(r)}const a=t.callbackTimeout||300,h=+new Date;return Z.requestAnimationFrame(()=>r()),null}makeImage(e){return Y.isUsingDOM()?(e===void 0&&(e={}),e.returnType="Image",this.makeImageData(e)):null}makeImageData(e){return e===void 0&&(e={}),this.YL(this.yR,e)}yR(e,t,i){const s=i.KL(e,"canvas",null);if(s===null)return null;const n=s.U.canvas;let o=null;if(n!==null){let r=e.returnType;switch(r===void 0?r="string":r=r.toLowerCase(),r){case Y.img+"data":o=s.getImageData(0,0,n.width,n.height);break;case Y.img:const a=(e.document||document).createElement("img");a.src=n.toDataURL(e.type,e.details),o=a;break;case"blob":{const h=n;return typeof t!="function"&&(o="",b.o('Error: Diagram.makeImageData called with "returnType: toBlob", but no required "callback" function property defined.')),typeof h.toBlob=="function"?(h.toBlob(t,e.type,e.details),"toBlob"):(t(null),null)}case"string":default:o=n.toDataURL(e.type,e.details)}}return typeof t=="function"?(t(o),null):o}KL(e,t,i){if(this.animationManager.stopAnimation(),this.maybeUpdate(),this.dt===null)return null;typeof e!="object"&&b.o("properties argument must be an Object.");let s=!1,n=e.size||null,o=e.scale||null;e.scale!==void 0&&isNaN(e.scale)&&(o="NaN");let r=e.maxSize;e.maxSize===void 0&&(s=!0,t==="SVG"?r=new ut(1/0,1/0):r=new ut(2e3,2e3));const a=e.position||null;let h=e.parts||null;Array.isArray(h)&&(h=new J(h));let l=e.padding===void 0?1:e.padding;const u=e.background||null;let c=e.omitTemporary;c===void 0&&(c=!0);const d=e.document||document,m=e.elementFinished||null;let g=e.showTemporary;g===void 0&&(g=!c);let p=e.showGrid;p===void 0&&(p=g),n!==null&&isNaN(n.width)&&isNaN(n.height)&&(n=null),typeof l=="number"?l=new Kt(l):l instanceof Kt||b.o("MakeImage padding must be a Margin or a number."),l.left=Math.max(l.left,0),l.right=Math.max(l.right,0),l.top=Math.max(l.top,0),l.bottom=Math.max(l.bottom,0),this.Zt.clearContextCache(!0);const y=new Pi(null,d,void 0,!0),x=y.ai;if(!(n||o||h||a))return y.width=this.kt+Math.ceil(l.left+l.right),y.height=this.Pt+Math.ceil(l.top+l.bottom),t==="SVG"?i===null?null:(i.resize(y.width,y.height,y.width,y.height),i.aa=d,i.Gu=m,this.wb(i.ai,l,new ut(y.width,y.height),this.et,this.at,h,u,g,p),i.ai):(this.Vu=!1,this.wb(x,l,new ut(y.width,y.height),this.et,this.at,h,u,g,p),this.Vu=!0,y.ai);const P=this.Jm,k=this.documentBounds.copy();if(k.subtractMargin(this.$t),g){const F=this.Gt.r,D=F.length;for(let R=0;R<D;R++){const I=F[R];if(!I.visible||!I.isTemporary)continue;const j=I.At.r,X=j.length;for(let V=0;V<X;V++){const G=j[V];if(!G.isInDocumentBounds||!G.isVisible())continue;const $=G.actualBounds;$.isReal()&&k.unionRect($)}}}let w=new S(k.x,k.y);if(h!==null){const F=new z(0,0,0,0);let D=!0;const R=h.iterator;for(R.reset();R.next();){const I=R.value;if(!(I instanceof Bt))continue;const j=I.layer;if(j!==null&&!j.visible||j!==null&&!g&&j.isTemporary||!I.isVisible())continue;const X=I.actualBounds;X.isReal()&&(D?(D=!1,F.a(X)):F.unionRect(X))}k.width=F.width,k.height=F.height,w.x=F.x,w.y=F.y}a!==null&&a.isReal()&&(w=a,o||(o=P));let N=0,M=0;l!==null&&(N=l.left+l.right,M=l.top+l.bottom);let C=0,O=0;n!==null&&(C=n.width,O=n.height,isFinite(C)&&(C=Math.max(0,C-N)),isFinite(O)&&(O=Math.max(0,O-M)));let T=0,L=0;if(n!==null&&o!==null?(o==="NaN"&&(o=P),n.isReal()?(T=C,L=O):isNaN(O)?(T=C,L=k.height*o):(T=k.width*o,L=O)):n!==null?n.isReal()?(o=Math.min(C/k.width,O/k.height),T=C,L=O):isNaN(O)?(o=C/k.width,T=C,L=k.height*o):(o=O/k.height,T=k.width*o,L=O):o!==null?o==="NaN"&&r.isReal()?(o=Math.min((r.width-N)/k.width,(r.height-M)/k.height),o>P?(o=P,T=k.width,L=k.height):(T=r.width,L=r.height)):(T=k.width*o,L=k.height*o):(o=P,T=k.width,L=k.height),l!==null?(T+=N,L+=M):l=new Kt(0),r!==null){let F=r.width,D=r.height;t!=="SVG"&&s&&Y.wR,isNaN(F)&&(F=2e3),isNaN(D)&&(D=2e3),isFinite(F)&&(T=Math.min(T,F)),isFinite(D)&&(L=Math.min(L,D))}return y.width=Math.ceil(T),y.height=Math.ceil(L),t==="SVG"?i===null?null:(i.resize(y.width,y.height,y.width,y.height),i.aa=d,i.Gu=m,this.wb(i.ai,l,new ut(Math.ceil(T),Math.ceil(L)),o,w,h,u,g,p),i.ai):(this.Vu=!1,this.wb(x,l,new ut(Math.ceil(T),Math.ceil(L)),o,w,h,u,g,p),this.Vu=!0,y.ai)}};f(Y,"hb",null),f(Y,"hL",new St),f(Y,"cM"),f(Y,"fM",null),f(Y,"uL",Z.document!==void 0),f(Y,"Ve",new WeakMap),f(Y,"e0",null),f(Y,"mb",""),f(Y,"None",1),f(Y,"Uniform",2),f(Y,"UniformToFill",3),f(Y,"CycleAll",1),f(Y,"CycleNotDirected",2),f(Y,"CycleNotDirectedFast",3),f(Y,"CycleNotUndirected",4),f(Y,"CycleDestinationTree",5),f(Y,"CycleSourceTree",6),f(Y,"DocumentScroll",1),f(Y,"InfiniteScroll",2),f(Y,"TreeParentCollapsed",1),f(Y,"AllParentsCollapsed",2),f(Y,"AnyParentsCollapsed",3),f(Y,"AM",new J),f(Y,"fR","3.0.12"),f(Y,"img","image"),f(Y,"wR",!1),f(Y,"Ku",null),f(Y,"GL","5da73c80a36555d4038e4972187c3cae51fd22"),f(Y,"uw",!1),f(Y,"Ik",()=>{if(Y.GL[5]===void 0&&(Tt.prototype._e=Tt.prototype.ww),!Y.isUsingDOM())return;const e=Z.document.createElement("canvas"),t=e.getContext("2d"),i=b.Cs("7ca11abfd022028846");t[i]=b.Cs("398c3597c01238");const s="7ca11abfd7330390",n=[Y.GL,b.uw+"4ae6247590da4bb21c324ba3a84e385776",Tt.Ik+"fb236cdfda5de14c134ba1a95a2d4c7cc6f93c1387",A.za],o=10,r=0;for(let a=1;a<5;a++)t[b.Cs(s)](b.Cs(n[a-1]),o,a*15+r);t[i]=b.Cs("39f046ebb36e4b");for(let a=1;a<5;a++)t[b.Cs(s)](b.Cs(n[a-1]),o,a*15+r);(n.length!==4||n[0][0]!=="5"||n[3][0]!=="7")&&(Tt.prototype._e=Tt.prototype.ww),Y.Ku=e});let At=Y;class Rn{constructor(e){f(this,"jL");f(this,"HL");f(this,"BM");f(this,"Ne");if(this.jL=null,this.HL="63ad05bbe23a1786468a4c741b6d2",this.BM="@onz",this.HL===this._tk){this.BM=!0,this.Ne=this.BM;return}this.Ne=null}xR(e,t){let i="f";const s=Z[b.Cs("76a715b2f73f148a")][b.Cs("72ba13b5")]||"",n=b.Cs;if(this.Ne=!0,!At.isUsingDOM())return;let o=At[n("76a115b6ed251eaf4692")];if(!o){const a=s[n("76ad18b4f73e")];for(let l=s[n("73a612b6fb191d")](n("35e7"))+2;l<a;l++)i+=s[l];const h=i[n("73a612b6fb191d")](n("7da71ca0ad381e90"));this.Ne=!(h>=0&&h<i[n("73a612b6fb191d")](n("35")));return}const r=At.AM.iterator;for(;r.next();){o=r.value;const a=n(o).split(n("39e9"));if(a.length<6)return;const h=n(a[1]).split(".");if(a[4]!=="7da71ca0")return;const l=n(b[n("6cae19")]).split(".");if(!(h[0]>l[0]||h[0]===l[0]&&h[1]>=l[1]))continue;const u="73a612b6fb191d",c=Z[n("74a900bae4370f8b51")][n("6fbb13a1c2311e8a57")].toLowerCase(),d=c[n(u)](n("3aad1ab6e022098b4dc4")),m=n(a[2]);if(d>-1){const T=c[n(u)](m.toLowerCase()+"/");if(this.Ne=!(T>-1&&T<d),!this.Ne)return}const g=s[n("76ad18b4f73e")];for(let T=s[n(u)](n("35e7"))+2;T<g;T++)i+=s[T];let p=i[n(u)](m);if(p<0&&m!==n("7da71ca0ad381e90")&&(p=i[n(u)](n("76a715b2ef3e149757"))),p<0&&(p=i[n(u)](n("76a715b2ef3e149757"))),p<0&&(p=i[n(u)](n("2bfa41fdb3784bca12"))),p<0&&(p=s[n(u)](n("7baa19a6f76c1988428554"))),this.Ne=!(p>=0&&p<i[n(u)](n("35"))||i[n(u)](n("35"))===-1),!this.Ne||s[n(u)](n("7fb002b6ed25128b4da25b2e"))&&(this.Ne=!(s[n(u)](m)>-1),!this.Ne))return;const y=Z[b.Cs("76a715b2f73f148a")][b.Cs("69ad17a1e03e")],x=y[n(u)](n("7fb002b6ed25128b4da25b2e"));if(x>-1&&(this.Ne=!(y[n(u)](m)>x),!this.Ne))return;const P=m;if(P[0]!=="#")continue;const k=Z.document.createElement("div");let w=a[0].replace(/[A-Za-z]/g,"");for(;w.length<4;)w+="9";const N=w;w=w.substring(w.length-4);let M="";const C=["gsh","gsf"],O=["Header","Background","Display","Feedback"];if(M+=C[parseInt(w.substring(0,1),10)%2],M+=O[parseInt(w.substring(0,1),10)%4],k[n("79a417a0f0181a8946")]=M,Z.document[n("78a712aa")]){Z.document[n("78a712aa")][n("7bb806b6ed32388c4a875b")](k);const T=Z.getComputedStyle(k).getPropertyValue(n("78a704b7e62456904c9b12701b6532a8")),L=Z.getComputedStyle(k).getPropertyValue(n("75b817b0ea2202"));if(Z.document[n("78a712aa")][n("68ad1bbcf533388c4a875b")](k),!T)continue;const F=Z[n("77a902b0eb1b1e804a8a")],D="0."+parseInt(N,10)%100;if(L===D||T.indexOf(parseInt(P[1]+P[2],16))!==-1&&T.indexOf(parseInt(P[3]+P[4],16))!==-1){this.Ne=!1;return}else if(F&&F(n("32ae19a1e0331fc94084537c067a67fa59f1386b89d006")).matches){M="."+M;for(let R=0;R<document.styleSheets.length;R++){const I=document.styleSheets[R].rules||document.styleSheets[R].cssRules;for(const j in I)if(M===I[j].selectorText){this.Ne=!1;return}}}}else this.Ne=null,t&&(this.Ne=!1)}}Ku(e){return e.Zt.setTransform(e.Ui,0,0,e.Ui,0,0),e.Zt.commitTransform(),this.Ne===null&&this.xR(e,!0),0<this.Ne&&this!==this.jL}}class Oi{constructor(e){f(this,"UM");f(this,"VM");this.UM=e===void 0?new S:e,this.VM=new S}get point(){return this.UM}set point(e){this.UM=e}get shifted(){return this.VM}set shifted(e){this.VM=e}}class Bn{constructor(e,t,i){f(this,"de");f(this,"LL");f(this,"xb");this.de=e,this.LL=t,this.xb=i}}class gs{constructor(e){f(this,"isGridSnapEnabled");f(this,"isGridSnapRealtime");f(this,"gridSnapCellSize");f(this,"gridSnapCellSpot");f(this,"gridSnapOrigin");f(this,"dragsLink");f(this,"dragsTree");f(this,"groupsSnapMembers");f(this,"groupsAlwaysMove");f(this,"dragsMembers");this.Ri(),e&&Object.assign(this,e)}Ri(){this.isGridSnapEnabled=!1,this.isGridSnapRealtime=!0,this.gridSnapCellSize=new ut(NaN,NaN).g(),this.gridSnapCellSpot=B.TopLeft,this.gridSnapOrigin=new S(NaN,NaN).g(),this.dragsLink=!1,this.dragsTree=!1,this.groupsSnapMembers=!1,this.groupsAlwaysMove=!0,this.dragsMembers=!0}}class En extends At{constructor(e,t){let i;return e===void 0||typeof e=="string"||Z.Element&&e instanceof Element?i=e:typeof e=="object"&&(t=e),super(i),this.qL(),t&&this.setProperties(t),this}qL(){this.allowDragOut=!0,this.allowMove=!1,this.isReadOnly=!0,this.contentAlignment=B.TopCenter,this.layout=new xs}setupRouters(){}reset(){super.reset(),this.qL()}}class ms extends At{constructor(t,i){let s;t===void 0||typeof t=="string"||Z.Element&&t instanceof Element?s=t:typeof t=="object"&&(i=t);super(s);f(this,"Pb");f(this,"Sb");f(this,"Mb");f(this,"Nb");f(this,"d0");f(this,"jc");f(this,"Al");f(this,"zM");f(this,"XM");f(this,"Cb");f(this,"KM");return this.animationManager.isEnabled=!1,this.Ht=!0,this.Pb=null,this.Ou=!1,this.Iu=!1,this.Sb=!0,this.Mb=!0,this.Nb=0,this.d0=!1,this.jc=null,this.setRenderingHint("drawShadows",!1),this.Al=new Bt({selectable:!0,selectionAdorned:!1,selectionObjectName:"BOXSHAPE",locationObjectName:"BOXSHAPE",resizeObjectName:"BOXSHAPE",cursor:"move"}).add(new bt({name:"BOXSHAPE",fill:"transparent",stroke:"magenta",strokeWidth:2}).theme("stroke","overviewBox")).li(),this.allowCopy=!1,this.allowDelete=!1,this.allowDrop=!1,this.allowSelect=!0,this.autoScrollRegion=new Kt(0,0,0,0),this.at.e(0,0),this.toolManager.Jt("Dragging",new In,this.toolManager.mouseMoveTools),this.click=()=>{const n=this.observed;if(n===null)return;const o=n.viewportBounds,r=this.lastInput.documentPoint;n.position=new S(r.x-o.width/2,r.y-o.height/2)},this.zM=n=>{this.invalidateDocumentBounds(),this.g0()},this.XM=n=>{this.observed!==null&&(this.invalidateDocumentBounds(),this.C())},this.Cb=n=>{this.updateDelay<1?this.C():this.d0||(this.d0=!0,setTimeout(()=>this.redraw(),this.updateDelay))},this.KM=n=>{this.observed!==null&&this.g0()},this.autoScale=2,this.Ht=!1,i&&Object.assign(this,i),this}setupRouters(){}computePixelRatio(){return 1}redraw(){this.d0&&this.updateDelay>=1&&(this.d0=!1,this.bR()),super.redraw()}Gi(){if(this.Tt===null&&b.o("No div specified"),this.dt===null&&b.o("No canvas specified"),this.dt instanceof as||(this.box.US(),!this.Ue))return;const t=this.observed;if(t===null||t.animationManager.defaultAnimation.isAnimating||!t.Bh)return;this.l0();const i=this.dt,s=this.Zt;if(s.clearContextCache(!0),s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,i.width,i.height),this.updateDelay<1)this.WL();else if(this.jc!==null){s.drawImage(this.jc.Ft,0,0);const r=this.D;s.scale(this.Ui,this.Ui),s.transform(r.m11,r.m12,r.m21,r.m22,r.dx,r.dy),s.commitTransform()}const n=this.Gt.r,o=n.length;for(let r=0;r<o;r++)n[r].Gi(s,this);this.Ec=!1,this.Ue=!1}bR(){const t=this.dt,i=this.Zt;if(!(t===null||i===null)){if(this.l0(),this.jc===null){const s=new Pi(null);s.width=t.width,s.height=t.height,this.jc=s}try{this.dt=this.jc,this.Zt=this.dt.ai,this.Zt.clearContextCache(!0),this.Zt.setTransform(1,0,0,1,0,0),this.Zt.clearRect(0,0,this.dt.width,this.dt.height),this.WL()}finally{this.dt=t,this.Zt=i}}}WL(){const t=this.observed;if(t===null)return;const i=this.drawsTemporaryLayers,s=this.drawsGrid&&i,n=t.grid;if(s&&n!==null&&n.visible&&!(isNaN(n.width)||isNaN(n.height))){const u=z.l().a(this.viewportBounds).unionRect(t.viewportBounds);t.jr(u),z.s(u),t.Ci()}const o=this.D,r=this.Zt;r.scale(this.Ui,this.Ui),r.transform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),r.commitTransform();const a=this.viewportBounds,h=t.Gt.r,l=h.length;for(let u=0;u<l;u++)h[u].kF(r,a,this,i,s)}get observed(){return this.Pb}set observed(t){const i=this.Pb;if(t instanceof ms&&b.o("Overview.observed Diagram may not be an Overview itself: "+t),i!==t){if(this.kR(i),this.Pb=t,this.PR(t),this.invalidateDocumentBounds(),t===null){this.jc=null;const s=this.dt,n=this.Zt;s&&n&&(n.setTransform(1,0,0,1,0,0),n.clearRect(0,0,s.width,s.height))}else this.Cb(null),this.g0(),this.C();this.t("observed",i,t)}}get box(){return this.Al}set box(t){const i=this.Al;i!==t&&(t.li(),this.Al=t,this.remove(i),this.add(this.Al),this.g0(),this.t("box",i,t))}get drawsTemporaryLayers(){return this.Sb}set drawsTemporaryLayers(t){this.Sb!==t&&(this.Sb=t,this.redraw())}get drawsGrid(){return this.Mb}set drawsGrid(t){this.Mb!==t&&(this.Mb=t,this.redraw())}get updateDelay(){return this.Nb}set updateDelay(t){t<0&&(t=0),this.Nb!==t&&(this.Nb=t)}PR(t){t!==null&&(t.addDiagramListener("ViewportBoundsChanged",this.zM),t.addDiagramListener("DocumentBoundsChanged",this.XM),t.addDiagramListener("InvalidateDraw",this.Cb),t.addDiagramListener("AnimationFinished",this.KM),this.add(this.box))}kR(t){t!==null&&(this.remove(this.box),t.removeDiagramListener("ViewportBoundsChanged",this.zM),t.removeDiagramListener("DocumentBoundsChanged",this.XM),t.removeDiagramListener("InvalidateDraw",this.Cb),t.removeDiagramListener("AnimationFinished",this.KM))}g0(){const t=this.box;if(t===null)return;const i=this.observed;if(i===null)return;this.Ue=!0;const s=i.viewportBounds,n=t.selectionObject,o=ut.l();o.e(s.width,s.height),n.desiredSize=o,ut.s(o);const r=2/this.scale;n instanceof bt&&(n.strokeWidth=r),t.location=new S(s.x-r/2,s.y-r/2),t.isSelected=!0}computeBounds(){const t=this.observed;if(t===null)return z.pw;const i=t.documentBounds.copy();return i.unionRect(t.viewportBounds),i}invalidateViewport(t,i){this.Ue!==!0&&(this.Ue=!0,this.requestUpdate())}onViewportBoundsChanged(t,i,s,n){this.Ht||(this._l(),this.C(),this.ra(),this.invalidateDocumentBounds(),this.g0(),this.Bi.scale=s,this.Bi.position.x=t.x,this.Bi.position.y=t.y,this.Bi.bounds.a(t),this.Bi.isScroll=n,this.v("ViewportBoundsChanged",this.Bi,t))}}class In extends di{constructor(){super();f(this,"ih");this.ih=null}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;if(t===null||!t.allowMove||!t.allowSelect)return!1;const i=t.observed;if(i===null)return!1;const s=t.lastInput;if(!s.left||t.currentTool!==this&&(!this.isBeyondDragSize()||s.isTouchEvent&&s.timestamp-t.firstInput.timestamp<this.delay))return!1;if(this.findDraggablePart()===null){const n=i.viewportBounds;this.ih=new S(n.width/2,n.height/2);const o=t.firstInput.documentPoint;i.position=new S(o.x-this.ih.x,o.y-this.ih.y)}return!0}doActivate(){this.ih=null,super.doActivate()}doUpdateCursor(t){const i=this.diagram,s=i.box;s!==null&&s.cursor&&(i.currentCursor=s.cursor)}moveParts(t,i,s){const n=this.diagram,o=n.observed;if(o===null)return;const r=n.box;if(r===null)return;if(this.ih===null){const h=n.firstInput.documentPoint,l=r.location;this.ih=new S(h.x-l.x,h.y-l.y)}const a=n.lastInput.documentPoint;o.position=new S(a.x-this.ih.x,a.y-this.ih.y)}}class Ye{constructor(e){f(this,"p");f(this,"YM");f(this,"GM");f(this,"jM");f(this,"HM");f(this,"qM");f(this,"WM");f(this,"JM");f(this,"$M");f(this,"eh");f(this,"ZM");f(this,"Lb");f(this,"QM");f(this,"Ab");f(this,"Tb");f(this,"_M");f(this,"Bo");f(this,"t2");K.Yi(this),this.p=At.mm(),this.YM=!0,this.GM=!0,this.jM=!0,this.HM=!1,this.qM=!1,this.WM=!1,this.JM=!1,this.$M=null,this.eh=null,this.ZM=1.05,this.Lb=NaN,this.QM=null,this.Ab=NaN,this.Tb=z.pw,this._M=!1,this.Bo=null,this.t2=200,e&&Object.assign(this,e)}toString(){return"CommandHandler"}get diagram(){return this.p}To(e){this.p=e}doKeyDown(){const e=this.diagram,t=e.lastInput,i=b.rr?t.meta:t.control,s=t.shift,n=t.alt,o=t.commandKey;i&&(o==="Insert"||o==="c")?this.canCopySelection()&&this.copySelection():i&&o==="x"||s&&o==="Delete"?this.canCutSelection()&&this.cutSelection():i&&o==="v"||s&&o==="Insert"?this.canPasteSelection()&&this.pasteSelection():i&&o==="y"||n&&s&&o==="Backspace"?this.canRedo()&&this.redo():i&&o==="z"||n&&o==="Backspace"?this.canUndo()&&this.undo():o==="Delete"||o==="Backspace"?this.canDeleteSelection()&&this.deleteSelection():i&&o==="a"?this.canSelectAll()&&this.selectAll():o==="Escape"?this.canStopCommand()&&this.stopCommand():o==="ArrowUp"?e.allowVerticalScroll&&(i?e.scroll("pixel","up"):e.scroll("line","up")):o==="ArrowDown"?e.allowVerticalScroll&&(i?e.scroll("pixel","down"):e.scroll("line","down")):o==="ArrowLeft"?e.allowHorizontalScroll&&(i?e.scroll("pixel","left"):e.scroll("line","left")):o==="ArrowRight"?e.allowHorizontalScroll&&(i?e.scroll("pixel","right"):e.scroll("line","right")):o==="PageUp"?s&&e.allowHorizontalScroll?e.scroll("page","left"):e.allowVerticalScroll&&e.scroll("page","up"):o==="PageDown"?s&&e.allowHorizontalScroll?e.scroll("page","right"):e.allowVerticalScroll&&e.scroll("page","down"):o==="Home"?i&&e.allowVerticalScroll?e.scroll("document","up"):!i&&e.allowHorizontalScroll&&e.scroll("document","left"):o==="End"?i&&e.allowVerticalScroll?e.scroll("document","down"):!i&&e.allowHorizontalScroll&&e.scroll("document","right"):o==="Space"?this.canScrollToPart()&&this.scrollToPart():o==="Minus"||o==="NumpadSubtract"?this.canDecreaseZoom()&&this.decreaseZoom():o==="Equal"||o==="NumpadAdd"?this.canIncreaseZoom()&&this.increaseZoom():i&&o==="Digit0"?this.canResetZoom()&&this.resetZoom():s&&o==="z"?this.canZoomToFit()&&this.zoomToFit():i&&!s&&o==="g"?this.canGroupSelection()&&this.groupSelection():i&&s&&o==="g"?this.canUngroupSelection()&&this.ungroupSelection():o==="F2"?this.canEditTextBlock()&&this.editTextBlock():o==="ContextMenu"?this.canShowContextMenu()&&this.showContextMenu():t.bubbles=!0}doKeyUp(){const e=this.diagram.lastInput;e.bubbles=!0}stopCommand(){const e=this.diagram,t=e.currentTool;t instanceof Ve&&e.allowSelect&&e.clearSelection(),t!==null&&t.doCancel()}canStopCommand(){return!0}selectAll(){const e=this.diagram;e.C();try{e.currentCursor="wait",e.v("ChangingSelection",e.selection);const t=e.parts;for(;t.next();){const n=t.value;n.canSelect()&&!n.layer.isTemporary&&(n.isSelected=!0)}const i=e.nodes;for(;i.next();){const n=i.value;n.canSelect()&&!n.layer.isTemporary&&(n.isSelected=!0)}const s=e.links;for(;s.next();){const n=s.value;n.canSelect()&&!n.layer.isTemporary&&(n.isSelected=!0)}}finally{e.v("ChangedSelection",e.selection),e.currentCursor=""}}canSelectAll(){return this.diagram.allowSelect}deleteSelection(){const e=this.diagram;try{e.currentCursor="wait",e.v("ChangingSelection",e.selection),e.startTransaction("Delete"),e.v("SelectionDeleting",e.selection);const t=new K,i=e.selection.iterator;for(;i.next();){const s=i.value;Bt.sh(t,s,!0,this.deletesTree?1/0:0,this.deletesConnectedLinks?null:!1,n=>n.canDelete())}e.removeParts(t,!0),e.v("SelectionDeleted",t)}finally{e.commitTransaction("Delete"),e.v("ChangedSelection",e.selection),e.currentCursor=""}}canDeleteSelection(){const e=this.diagram;return!(e.isReadOnly||e.isModelReadOnly||!e.allowDelete||e.selection.count===0)}copySelection(){const e=this.diagram;try{const t=new K,i=e.selection.iterator;for(;i.next();){const s=i.value;Bt.sh(t,s,!0,this.copiesTree?1/0:0,this.copiesConnectedLinks,n=>n.canCopy())}this.copyToClipboard(t)}finally{}}canCopySelection(){const e=this.diagram;return!(!e.allowCopy||!e.allowClipboard||e.selection.count===0)}cutSelection(){this.copySelection(),this.deleteSelection()}canCutSelection(){const e=this.diagram;return!(e.isReadOnly||e.isModelReadOnly||!e.allowCopy||!e.allowDelete||!e.allowClipboard||e.selection.count===0)}copyToClipboard(e){const t=this.diagram;let i=null;if(e===null)At.dL();else{const s=t.model;let n=!1,o=!1,r=null;try{s.pc()&&(n=s.copiesParentKeyOfNodeData,s.copiesParentKeyOfNodeData=this.copiesParentKey),(s.gc()||s.ju())&&(o=s.copiesGroupKeyOfNodeData,s.copiesGroupKeyOfNodeData=this.copiesGroupKey),r=t.copyParts(e,null,!0)}finally{s.pc()&&(s.copiesParentKeyOfNodeData=n),(s.gc()||s.ju())&&(s.copiesGroupKeyOfNodeData=o),i=new J,i.addAll(r.iteratorValues),At.e0=i,At.mb=t.model.dataFormat}}t.v("ClipboardChanged",i)}pasteFromClipboard(){const e=new K,t=At.e0;if(t===null)return e;const i=this.diagram;if(At.mb!==i.model.dataFormat)return e;const s=i.model;let n=!1,o=!1,r=null;try{s.pc()&&(n=s.copiesParentKeyOfNodeData,s.copiesParentKeyOfNodeData=this.copiesParentKey),(s.gc()||s.ju())&&(o=s.copiesGroupKeyOfNodeData,s.copiesGroupKeyOfNodeData=this.copiesGroupKey),r=i.copyParts(t,i,!1)}finally{s.pc()&&(s.copiesParentKeyOfNodeData=n),(s.gc()||s.ju())&&(s.copiesGroupKeyOfNodeData=o);const a=r.iterator;for(;a.next();){const h=a.value,l=a.key;h.location.isReal()||(l.location.isReal()?h.location=l.location:!h.position.isReal()&&l.position.isReal()&&(h.position=l.position)),e.add(h)}}return e}pasteSelection(e){e===void 0&&(e=null);const t=this.diagram;try{t.currentCursor="wait",t.v("ChangingSelection",t.selection),t.startTransaction("Paste");const i=this.pasteFromClipboard();i.count>0&&t.clearSelection(!0);const s=i.iterator;for(;s.next();){const n=s.value;n.isSelected=!0}if(e!==null){const n=t.computePartsBounds(t.selection);if(n.isReal()){const o=this.computeEffectiveCollection(t.selection,t.fb);t.bP(o,new S(e.x-n.centerX,e.y-n.centerY),t.fb,!1)}}t.v("ClipboardPasted",i)}finally{t.commitTransaction("Paste"),t.v("ChangedSelection",t.selection),t.currentCursor=""}}canPasteSelection(e){const t=this.diagram;return!(t.isReadOnly||t.isModelReadOnly||!t.allowInsert||!t.allowClipboard||At.e0===null||At.e0.count===0||At.mb!==t.model.dataFormat)}undo(){this.diagram.undoManager.undo()}canUndo(){const e=this.diagram;return e.isReadOnly||e.isModelReadOnly?!1:e.allowUndo&&e.undoManager.canUndo()}redo(){this.diagram.undoManager.redo()}canRedo(){const e=this.diagram;return e.isReadOnly||e.isModelReadOnly?!1:e.allowUndo&&e.undoManager.canRedo()}decreaseZoom(e){e===void 0&&(e=1/this.zoomFactor);const t=this.diagram;if(t.autoScale!==1)return;const i=t.scale*e;i<t.minScale||i>t.maxScale||(t.scale=i)}canDecreaseZoom(e){e===void 0&&(e=1/this.zoomFactor);const t=this.diagram;if(t.autoScale!==1)return!1;const i=t.scale*e;return i<t.minScale||i>t.maxScale?!1:t.allowZoom}increaseZoom(e){e===void 0&&(e=this.zoomFactor);const t=this.diagram;if(t.autoScale!==1)return;const i=t.scale*e;i<t.minScale||i>t.maxScale||(t.scale=i)}canIncreaseZoom(e){e===void 0&&(e=this.zoomFactor);const t=this.diagram;if(t.autoScale!==1)return!1;const i=t.scale*e;return i<t.minScale||i>t.maxScale?!1:t.allowZoom}resetZoom(e){e===void 0&&(e=this.defaultScale);const t=this.diagram;e<t.minScale||e>t.maxScale||(t.scale=e)}canResetZoom(e){e===void 0&&(e=this.defaultScale);const t=this.diagram;return e<t.minScale||e>t.maxScale?!1:t.allowZoom}zoomToFit(){const e=this.diagram,t=e.animationManager;t.stopAnimation(),e.redraw();const i=e.position,s=e.scale;t.Fl("Zoom To Fit"),this.isZoomToFitRestoreEnabled&&s===this.Ab&&!isNaN(this.Lb)&&e.documentBounds.equals(this.Tb)?(e.scale=this.Lb,e.position=this.QM,this.Ab=NaN,this.Tb=z.pw):(this.Lb=s,this.QM=i.copy(),e.zoomToFit(),this.Ab=e.scale,this.Tb=e.documentBounds.copy()),t.SS()}canZoomToFit(){return this.diagram.allowZoom}scrollToPart(e){e===void 0&&(e=null);const t=this.diagram;if(t.ensureBounds(),e===null){try{this.Bo!==null&&(this.Bo.next()?e=this.Bo.value:this.Bo=null)}catch{this.Bo=null}e===null&&(t.highlighteds.count>0?this.Bo=t.highlighteds.iterator:t.selection.count>0&&(this.Bo=t.selection.iterator),this.Bo!==null&&this.Bo.next()&&(e=this.Bo.value))}if(e!==null){const i=t.animationManager;i.Fl("Scroll To Part");const s=this.scrollToPartPause;if(s>0){const n=this.Hc(e,[e]);if(n.length===1)t.startTransaction(),t.centerRect(e.actualBounds),t.commitTransaction("Scroll To Part");else{const o=()=>{t.startTransaction();let a=n.pop();for(;n.length>0&&a instanceof nt&&a.isTreeExpanded&&(!(a instanceof at)||a.isSubGraphExpanded);)a=n.pop();n.length>0?(a instanceof Bt&&t.scrollToRect(a.actualBounds),a instanceof nt&&!a.isTreeExpanded&&(a.isTreeExpanded=!0),a instanceof at&&!a.isSubGraphExpanded&&(a.isSubGraphExpanded=!0)):(a instanceof Bt&&t.centerRect(a.actualBounds),t.removeDiagramListener("LayoutCompleted",r)),t.commitTransaction("Scroll To Part")},r=()=>{b.Oh(o,(i.isEnabled?i.duration:0)+s)};t.addDiagramListener("LayoutCompleted",r),o()}}else{const n=t.position.copy();t.centerRect(e.actualBounds),n.equalsApprox(t.position)&&i.stopAnimation()}}}Hc(e,t){if(e.isVisible())return t;if(e instanceof Mt)this.Hc(e.adornedPart,t);else if(e instanceof dt){const i=e.fromNode;i!==null&&this.Hc(i,t);const s=e.toNode;s!==null&&this.Hc(s,t)}else{if(e instanceof nt){const s=e.labeledLink;s!==null&&this.Hc(s,t);const n=e.findTreeParentNode();n!==null&&(!n.isTreeExpanded&&!n.wasTreeExpanded&&t.push(n),this.Hc(n,t))}const i=e.containingGroup;i!==null&&(!i.isSubGraphExpanded&&!i.wasSubGraphExpanded&&t.push(i),this.Hc(i,t))}return t}canScrollToPart(e){if(e===void 0&&(e=null),e!==null&&!(e instanceof Bt))return!1;const t=this.diagram;return t.selection.count===0&&t.highlighteds.count===0?!1:t.allowHorizontalScroll&&t.allowVerticalScroll}collapseTree(e){e===void 0&&(e=null);const t=this.diagram,i="Collapse Tree";try{t.startTransaction(i),t.animationManager.Fl(i);const s=new J;if(e!==null&&e.isTreeExpanded)e.collapseTree(),s.add(e);else if(e===null){const n=t.selection.iterator;for(;n.next();){const o=n.value;o instanceof nt&&o.isTreeExpanded&&(o.collapseTree(),s.add(o))}}t.v("TreeCollapsed",s)}finally{t.commitTransaction(i)}}canCollapseTree(e){e===void 0&&(e=null);const t=this.diagram;if(t.isReadOnly)return!1;if(e!==null){if(!(e instanceof nt)||!e.isTreeExpanded)return!1;if(e.findTreeChildrenLinks().count>0)return!0}else{const i=t.selection.iterator;for(;i.next();){const s=i.value;if(s instanceof nt){if(!s.isTreeExpanded)continue;if(s.findTreeChildrenLinks().count>0)return!0}}}return!1}expandTree(e){e===void 0&&(e=null);const t=this.diagram,i="Expand Tree";try{t.startTransaction(i),t.animationManager.Fl(i);const s=new J;if(e!==null&&!e.isTreeExpanded)e.expandTree(),s.add(e);else if(e===null){const n=t.selection.iterator;for(;n.next();){const o=n.value;o instanceof nt&&(o.isTreeExpanded||(o.expandTree(),s.add(o)))}}t.v("TreeExpanded",s)}finally{t.commitTransaction(i)}}canExpandTree(e){e===void 0&&(e=null);const t=this.diagram;if(t.isReadOnly)return!1;if(e!==null){if(!(e instanceof nt)||e.isTreeExpanded)return!1;if(e.findTreeChildrenLinks().count>0)return!0}else{const i=t.selection.iterator;for(;i.next();){const s=i.value;if(s instanceof nt){if(s.isTreeExpanded)continue;if(s.findTreeChildrenLinks().count>0)return!0}}}return!1}groupSelection(){const e=this.diagram,t=e.model;if(!t.qc())return;const i=this.archetypeGroupData;if(i===null)return;let s=null;try{e.currentCursor="wait",e.v("ChangingSelection",e.selection),e.startTransaction("Group");const n=new J,o=e.selection.iterator;for(;o.next();){const h=o.value;h.Pe()&&h.canGroup()&&n.add(h)}const r=new J,a=n.iterator;for(;a.next();){const h=a.value;let l=!1;const u=n.iterator;for(;u.next();){const c=u.value;if(h.isMemberOf(c)){l=!0;break}}l||r.add(h)}if(r.count>0){let h=r.first().containingGroup;if(h!==null)for(;h!==null;){let l=!1;const u=r.iterator;for(;u.next();)if(!u.value.isMemberOf(h)){l=!0;break}if(l)h=h.containingGroup;else break}if(i instanceof at)i.li(),s=i.copy(),s!==null&&e.add(s);else if(t.isGroupForData(i)){const l=t.copyNodeData(i);b.wt(l)&&(t.addNodeData(l),s=e.findNodeForData(l))}if(s!==null){h!==null&&this.isValidMember(h,s)&&(s.containingGroup=h);const l=r.iterator;for(;l.next();){const u=l.value;this.isValidMember(s,u)&&(u.containingGroup=s)}e.clearSelection(!0),s.isSelected=!0}}e.v("SelectionGrouped",s)}finally{e.commitTransaction("Group"),e.v("ChangedSelection",e.selection),e.currentCursor=""}}canGroupSelection(){const e=this.diagram;if(e.isReadOnly||e.isModelReadOnly||!e.allowInsert||!e.allowGroup||!e.model.qc()||this.archetypeGroupData===null)return!1;const t=e.selection.iterator;for(;t.next();){const i=t.value;if(i.Pe()&&i.canGroup())return!0}return!1}i2(e){const t=b.nt();if(Array.isArray(e))e.forEach(n=>{n instanceof dt||n instanceof Bt&&t.push(n)});else{const n=e.iterator;for(;n.next();){const o=n.value;o instanceof dt||o instanceof Bt&&t.push(o)}}const i=new K,s=t.length;for(let n=0;n<s;n++){const o=t[n];let r=!0;for(let a=0;a<s;a++)if(o.isMemberOf(t[a])){r=!1;break}r&&i.add(o)}return b.tt(t),i}isValidMember(e,t){if(t===null||e===t||t instanceof dt)return!1;let i;return e!==null&&(e===t||e.isMemberOf(t)||(i=e.memberValidation,i!==null&&!i(e,t))||e.data===null&&t.data!==null||e.data!==null&&t.data===null)?!1:(i=this.memberValidation,i!==null?i(e,t):!0)}ungroupSelection(e){e===void 0&&(e=null);const t=this.diagram,i=t.model;if(i.qc())try{t.currentCursor="wait",t.v("ChangingSelection",t.selection),t.startTransaction("Ungroup");const s=new J;if(e!==null)s.add(e);else{const o=t.selection.iterator;for(;o.next();){const r=o.value;r instanceof at&&r.canUngroup()&&s.add(r)}}const n=new J;if(s.count>0){t.clearSelection(!0);const o=s.iterator;for(;o.next();){const r=o.value;r.expandSubGraph();const a=r.containingGroup,h=a!==null&&a.data!==null?i.getKeyForNodeData(a.data):void 0;n.addAll(r.memberParts);const l=n.iterator;for(;l.next();){const u=l.value;if(u.isSelected=!0,u instanceof dt)continue;const c=u.data;c!==null?i.setGroupForData(c,h):u.containingGroup=a}t.remove(r)}}t.v("SelectionUngrouped",s,n)}finally{t.commitTransaction("Ungroup"),t.v("ChangedSelection",t.selection),t.currentCursor=""}}canUngroupSelection(e){e===void 0&&(e=null);const t=this.diagram;if(t.isReadOnly||t.isModelReadOnly||!t.allowDelete||!t.allowUngroup||!t.model.qc())return!1;if(e!==null){if(!(e instanceof at))return!1;if(e.canUngroup())return!0}else{const i=t.selection.iterator;for(;i.next();){const s=i.value;if(s instanceof at&&s.canUngroup())return!0}}return!1}addTopLevelParts(e,t){const i=this.i2(e);let s=!0;const n=i.iterator;for(;n.next();){const o=n.value;o.containingGroup!==null&&(!t||this.isValidMember(null,o)?o.containingGroup=null:s=!1)}return s}collapseSubGraph(e){e===void 0&&(e=null);const t=this.diagram,i="Collapse SubGraph";try{t.startTransaction(i),t.animationManager.Fl(i);const s=new J;if(e!==null&&e.isSubGraphExpanded)e.collapseSubGraph(),s.add(e);else if(e===null){const n=t.selection.iterator;for(;n.next();){const o=n.value;o instanceof at&&o.isSubGraphExpanded&&(o.collapseSubGraph(),s.add(o))}}t.v("SubGraphCollapsed",s)}finally{t.commitTransaction(i)}}canCollapseSubGraph(e){e===void 0&&(e=null);const t=this.diagram;if(t.isReadOnly)return!1;if(e!==null)return!(!(e instanceof at)||!e.isSubGraphExpanded);{const i=t.selection.iterator;for(;i.next();){const s=i.value;if(s instanceof at&&s.isSubGraphExpanded)return!0}}return!1}expandSubGraph(e){e===void 0&&(e=null);const t=this.diagram,i="Expand SubGraph",s=new J;try{if(t.startTransaction(i),t.animationManager.Fl(i),e!==null&&!e.isSubGraphExpanded)e.expandSubGraph(),s.add(e);else if(e===null){const n=t.selection.iterator;for(;n.next();){const o=n.value;o instanceof at&&(o.isSubGraphExpanded||(o.expandSubGraph(),s.add(o)))}}t.v("SubGraphExpanded",s)}finally{for(const n of s)this.JL(t,n);e&&this.JL(t,e),t.commitTransaction(i)}}JL(e,t){for(const i of t.memberParts)i instanceof nt&&e.Cc(i,t)}canExpandSubGraph(e){e===void 0&&(e=null);const t=this.diagram;if(t.isReadOnly)return!1;if(e!==null)return!(!(e instanceof at)||e.isSubGraphExpanded);{const i=t.selection.iterator;for(;i.next();){const s=i.value;if(s instanceof at&&!s.isSubGraphExpanded)return!0}}return!1}editTextBlock(e){e===void 0&&(e=null);const t=this.diagram,i=t.toolManager.findTool("TextEditing");if(i!==null){if(e===null){let s=null;const n=t.selection.iterator;for(;n.next();){const o=n.value;if(o.canEdit()){s=o;break}}if(s===null)return;e=s.findInVisualTree(o=>o instanceof Qt&&o.editable)}e!==null&&(t.currentTool=null,i.textBlock=e,t.currentTool=i)}}canEditTextBlock(e){e===void 0&&(e=null);const t=this.diagram;if(t.isReadOnly||t.isModelReadOnly||!t.allowTextEdit||t.toolManager.findTool("TextEditing")===null)return!1;if(e!==null){if(!(e instanceof Qt))return!1;const i=e.part;if(i!==null&&i.canEdit())return!0}else{const i=t.selection.iterator;for(;i.next();){const s=i.value;if(s.canEdit()&&(e=s.findInVisualTree(n=>n instanceof Qt&&n.editable),e!==null))return!0}}return!1}showContextMenu(e){const t=this.diagram,i=t.toolManager.findTool("ContextMenu");if(i===null)return;e===void 0&&(t.selection.count>0?e=t.selection.first():e=t);const s=i.findObjectWithContextMenu(e);if(s!==null){const n=t.lastInput;let o=null;if(s instanceof he)o=s.getDocumentPoint(B.Center);else if(!t.viewportBounds.containsPoint(n.documentPoint)){const r=t.viewportBounds;o=new S(r.x+r.width/2,r.y+r.height/2)}if(o!==null){const r=new ui;r.diagram=t,r.viewPoint=t.transformDocToView(o),r.documentPoint=o,r.button=2,r.up=!0,t.lastInput=r}t.currentTool=i,i.openMenu(!1,s)}}canShowContextMenu(e){const t=this.diagram,i=t.toolManager.findTool("ContextMenu");return!(i===null||(e===void 0&&(t.selection.count>0?e=t.selection.first():e=t),i.findObjectWithContextMenu(e)===null))}get copiesClipboardData(){return this.YM}set copiesClipboardData(e){b.i(e,"boolean",Ye,"copiesClipboardData"),this.YM=e}get copiesConnectedLinks(){return this.GM}set copiesConnectedLinks(e){b.i(e,"boolean",Ye,"copiesConnectedLinks"),this.GM=e}get deletesConnectedLinks(){return this.jM}set deletesConnectedLinks(e){b.i(e,"boolean",Ye,"deletesConnectedLinks"),this.jM=e}get copiesTree(){return this.HM}set copiesTree(e){b.i(e,"boolean",Ye,"copiesTree"),this.HM=e}get deletesTree(){return this.qM}set deletesTree(e){b.i(e,"boolean",Ye,"deletesTree"),this.qM=e}get copiesParentKey(){return this.WM}set copiesParentKey(e){b.i(e,"boolean",Ye,"copiesParentKey"),this.WM=e}get copiesGroupKey(){return this.JM}set copiesGroupKey(e){b.i(e,"boolean",Ye,"copiesGroupKey"),this.JM=e}get archetypeGroupData(){return this.$M}set archetypeGroupData(e){e!==null&&b.i(e,"object",Ye,"archetypeGroupData"),this.diagram,this.$M=e}get memberValidation(){return this.eh}set memberValidation(e){e!==null&&b.i(e,"function",Ye,"memberValidation"),this.eh=e}get defaultScale(){return this.diagram.defaultScale}set defaultScale(e){this.diagram.defaultScale=e}get zoomFactor(){return this.ZM}set zoomFactor(e){e>1||b.o("zoomFactor must be larger than 1.0, not: "+e),this.ZM=e}get isZoomToFitRestoreEnabled(){return this._M}set isZoomToFitRestoreEnabled(e){b.i(e,"boolean",Ye,"isZoomToFitRestoreEnabled"),this._M=e}get scrollToPartPause(){return this.t2}set scrollToPartPause(e){this.t2=e}computeEffectiveCollection(e,t){const i=this.diagram,s=i.toolManager.findTool("Dragging"),n=i.currentTool===s;t===void 0&&(t=i.a0());const o=new St;if(e===null)return o;let r=e.iterator;for(;r.next();){const a=r.value;i.Wr(o,a,n,t)}if(i.draggedLink!==null&&t.dragsLink)return o;for(r=e.iterator;r.next();){const a=r.value;if(a instanceof dt){const h=a.fromNode;if(h!==null&&!o.has(h))o.delete(a);else{const l=a.toNode;l!==null&&!o.has(l)&&o.delete(a)}}}return o}}var Ms=(v=>(v[v.None=0]="None",v[v.Default=1]="Default",v[v.Vertical=4]="Vertical",v[v.Horizontal=5]="Horizontal",v[v.Fill=2]="Fill",v))(Ms||{}),Ns=(v=>(v[v.None=0]="None",v[v.Along=21]="Along",v[v.Plus90=22]="Plus90",v[v.Minus90=23]="Minus90",v[v.Opposite=24]="Opposite",v[v.Upright=25]="Upright",v[v.Plus90Upright=26]="Plus90Upright",v[v.Minus90Upright=27]="Minus90Upright",v[v.Upright45=28]="Upright45",v))(Ns||{}),ln=(v=>(v[v.None=0]="None",v[v.Vertical=1]="Vertical",v[v.Horizontal=2]="Horizontal",v[v.Both=3]="Both",v))(ln||{});const yt=class yt{constructor(){f(this,"n");f(this,"Hu");f(this,"qu");f(this,"Uo");f(this,"f");f(this,"nh");f(this,"q");f(this,"at");f(this,"se");f(this,"Wt");f(this,"Wu");f(this,"Vs");f(this,"Ct");f(this,"ze");f(this,"$r");f(this,"oh");f(this,"bi");f(this,"ca");f(this,"et");f(this,"Xt");f(this,"Zr");f(this,"Li");f(this,"Vi");f(this,"Ju");f(this,"oi");f(this,"Wc");f(this,"Bt");f(this,"ni");f(this,"Qr");f(this,"Db");f(this,"rh");f(this,"$u");K.Yi(this),this.n=30723,this.Wt=1,this.Wu="",this.Vs=null,this.Ct=null,this.at=new S(NaN,NaN).g(),this.ze=ut.gw,this.$r=new Tt,this.oh=new Tt,this.bi=null,this.ca=1,this.et=1,this.Xt=0,this.Zr=Kt.Eg,this.se=new z(NaN,NaN,NaN,NaN).g(),this.Li=new z(NaN,NaN,NaN,NaN).g(),this.Vi=new z(0,0,NaN,NaN).g(),this.Ju=null,this.Hu=null,this.q=null,this.oi=B.Default,this.Wc=B.Default,this.qu=0,this.Uo=0,this.Bt=null,this.f=null,this.nh=null,this.ni=null,this.Db=null,this.rh=null,this.Qr=null,this.$u=null}cloneProtected(e){e.n=(this.n|2048|4096)&-32769,e.Wt=this.Wt,e.Wu=this.Wu,e.Ct=this.Ct,e.at.a(this.at),e.ze=this.ze.N(),this.bi!==null?e.bi=this.bi.copy():e.bi=null,e.et=this.et,e.Xt=this.Xt,e.Zr=this.Zr.N(),e.se.a(this.se),e.Li.a(this.Li),e.Vi.a(this.Vi),e.Hu=this.Hu,this.q!==null&&(e.q=this.q.copy()),e.oi=this.oi.N(),e.Wc=this.Wc.N(),e.qu=this.qu,e.Uo=this.Uo,this.Bt!==null&&(e.Bt=this.Bt.copy()),this.f!==null&&(this.f.gi?e.f=this.f:e.f=this.f.copy()),this.nh!==null&&(e.nh=this.nh.slice()),this.ni!==null&&(e.ni=this.ni.copy())}addCopyProperty(e){let t=this.nh;if(!Array.isArray(t))t=[],this.nh=t;else for(let i=0;i<t.length;i++)if(t[i]===e)return;t.push(e)}Vo(e){e.Ju=null,e.Qr=null,e.c()}clone(){const e=new this.constructor;if(this.cloneProtected(e),this.nh!==null)for(let t=0;t<this.nh.length;t++){const i=this.nh[t];e[i]=this[i]}return e}copy(){return this.clone()}xm(){const e=this.Ai;if(e!==null){this.Ai=null;for(const t of e)t.Zu()&&(t.isToData?this.themeData(t.targetProperty,t.sourceProperty,t.themeSource,t.converter,t.themeConverter):t.isToObject?this.themeObject(t.targetProperty,t.sourceProperty,t.themeSource,t.converter,t.themeConverter,t.sourceName):t.isToModel?this.themeModel(t.targetProperty,t.sourceProperty,t.themeSource,t.converter,t.themeConverter):this.theme(t.targetProperty,t.sourceProperty,t.themeSource,t.converter,t.themeConverter))}return this}ri(e){e in Ns?this.segmentOrientation=e:e in Ms?this.stretch=e:b.lr(this,e)}toString(){return b.sn(this.constructor)+"#"+K.as(this)}lh(){this.f!==null&&(this.f.gi=!0)}jt(){this.f===null?this.f=new Ri:this.f.gi&&(this.f=this.f.copy())}Xe(){if(this.q===null){const e=new ys;e.fa=B.None,e.ua=B.None,e.da=10,e.ga=10,e.ma=0,e.pa=0,this.q=e}}raiseChangedEvent(e,t,i,s,n,o,r){const a=this.part;if(a!==null){a.Jc(e,t,i,s,n,o,r),i===this&&e===2&&this.$c()&&this.ya(a,t);const h=this.diagram;if(this.ys!==null&&h!==null&&h.Bh&&!h.undoManager.isUndoingRedoing&&!h.animationManager.wu){const l=this.ys.get(t);if(l!==null&&h.animationManager.isEnabled&&!h.animationManager.isTicking){this.$u===null&&(this.$u=new St);let u=h.undoManager.transactionLevel===0;if(l.startCondition===2?u=!0:l.startCondition===3&&(u=!1),u){const c=new ei;l.wF(c);const d=this.$u.get(l);d!==null&&d.stop(),this.$u.set(l,c),c.cx=this,c.DS=l,c.add(this,t,s,n),c.start()}else h.animationManager.getBundleAnimation().add(this,t,s,n)}}if(this instanceof ct&&i===a&&a.e2()&&a.data!==null){const l=this.L.r,u=l.length;for(let c=0;c<u;c++){const d=l[c];d instanceof ct&&d.qr(m=>{m.data!==null&&m.e2()&&m.updateTargetBindings(t)})}}}}gF(e){this.$u.delete(e)}Io(){if(this.diagram!==null&&this.findBindingPanel()===null&&this.Ai!==null){const e=this.Ai.iterator;for(;e.next();){const t=e.value;if(!t.isToTheme)continue;let i=null;const s=t.sourceName;t.isToObject&&(i=this.$L(s));let n=this;const o=t.targetId;o!==-1&&(n=this.m0(o),n===null)||(s==="/"?i=n.part:s==="."?i=n:s===".."&&(i=n.panel),t.updateTarget(n,i))}}}ya(e,t){const i=this.findBindingPanel();if(i!==null){const s=this.Ai.iterator;for(;s.next();){const n=s.value;let o=null;if(n.isToObject){if(o=n.ZL(i,this),o===null)continue;n.updateSource(this,o,t,null)}else if(n.isToModel){const r=e.diagram;r!==null&&!r.fe&&n.updateSource(this,r.model.modelData,t,i)}else if(!n.isToTheme){const r=i.data;if(r===null)continue;const a=e.diagram;a!==null&&!a.fe&&n.updateSource(this,r,t,i)}if(o===this){const r=n.targetId,a=i.m0(r);a!==null&&n.updateTarget(a,o,t)}}}}m0(e){return this.$n===e?this:null}$L(e){let t;return e===""?t=this:e==="/"?t=this:e==="."?t=this:e===".."?t=this:t=this.part.findObject(e),t}get $n(){return this.f!==null?this.f.$n:-1}set $n(e){this.$n!==e&&(this.f===null&&(this.f=new Ri),this.f.$n=e)}get Ai(){return this.f!==null?this.f.Ai:null}set Ai(e){this.Ai!==e&&(this.f===null&&(this.f=new Ri),this.f.Ai=e)}get Zn(){return this.f!==null?this.f.Zn:null}set Zn(e){this.Zn!==e&&(this.f===null&&(this.f=new Ri),this.f.Zn=e)}raiseChanged(e,t,i){this.raiseChangedEvent(2,e,this,t,i)}t(e,t,i){this.raiseChangedEvent(2,e,this,t,i)}Qn(e,t,i,s){const n=this.se;if(n.e(e,t,i,s),this.et!==1||this.Xt!==0){this.bi===null&&(this.bi=new Tt);const o=this.bi;o.Ri(),this.p0(o,e,t,i,s),o.xw(n)}}QL(e,t,i){return this.pickable===!1?!1:(i.ic(this.D),t?this.intersectsRect(e,i):this.containedInRect(e,i))}_L(e,t,i){if(this.pickable===!1)return!1;const s=this.naturalBounds,n=e.distanceSquaredPoint(t);return i?S.distanceLineSegmentSquared(e.x,e.y,0,0,0,s.height)<=n||S.distanceLineSegmentSquared(e.x,e.y,0,s.height,s.width,s.height)<=n||S.distanceLineSegmentSquared(e.x,e.y,s.width,s.height,s.width,0)<=n||S.distanceLineSegmentSquared(e.x,e.y,s.width,0,0,0)<=n:e.distanceSquared(0,0)<=n&&e.distanceSquared(0,s.height)<=n&&e.distanceSquared(s.width,0)<=n&&e.distanceSquared(s.width,s.height)<=n}pn(){return!0}containsPoint(e){const t=S.l();t.a(e),this.D.xt(t);const i=this.actualBounds;if(!i.isReal())return S.s(t),!1;const s=this.diagram;if(s!==null&&s.Zm){const o=s.getInputOption("extraTouchThreshold"),r=s.getInputOption("extraTouchArea"),a=r/2,h=this.naturalBounds,l=this.getDocumentScale()*s.scale,u=1/l;if(h.width*l<o&&h.height*l<o){const c=z.contains(i.x-a*u,i.y-a*u,i.width+r*u,i.height+r*u,t.x,t.y);return S.s(t),c}}let n=!1;return(this instanceof Mt||this instanceof bt?z.contains(i.x-5,i.y-5,i.width+10,i.height+10,t.x,t.y):i.containsPoint(t))&&(this.ni&&!this.ni.containsPoint(t)?n=!1:this.Ct!==null&&this.Vi.containsPoint(e)?n=!0:n=this.hh(e)),S.s(t),n}hh(e){const t=this.naturalBounds;return z.contains(0,0,t.width,t.height,e.x,e.y)}containsRect(e){if(this.angle===0)return this.actualBounds.containsRect(e);const t=this.naturalBounds,i=z.X(0,0,t.width,t.height),s=this.D;let n=!1;const o=S.X(e.x,e.y);return i.containsPoint(s._e(o))&&(o.e(e.x,e.bottom),i.containsPoint(s._e(o))&&(o.e(e.right,e.bottom),i.containsPoint(s._e(o))&&(o.e(e.right,e.y),i.containsPoint(s._e(o))&&(n=!0)))),S.s(o),z.s(i),n}containedInRect(e,t){if(t===void 0)return e.containsRect(this.actualBounds);const i=this.naturalBounds,s=t;let n=!1;const o=S.X(0,0);return e.containsPoint(s.xt(o))&&(o.e(0,i.height),e.containsPoint(s.xt(o))&&(o.e(i.width,i.height),e.containsPoint(s.xt(o))&&(o.e(i.width,0),e.containsPoint(s.xt(o))&&(n=!0)))),S.s(o),n}intersectsRect(e,t){if(t===void 0&&(t=this.D,this.angle===0))return e.intersectsRect(this.actualBounds);const i=this.naturalBounds,s=t,n=S.X(0,0),o=S.X(0,i.height),r=S.X(i.width,i.height),a=S.X(i.width,0);let h=!1;if(e.containsPoint(s.xt(n))||e.containsPoint(s.xt(o))||e.containsPoint(s.xt(r))||e.containsPoint(s.xt(a)))h=!0;else{const l=z.X(0,0,i.width,i.height),u=S.X(e.x,e.y);l.containsPoint(s._e(u))?h=!0:(u.e(e.x,e.bottom),l.containsPoint(s._e(u))?h=!0:(u.e(e.right,e.bottom),l.containsPoint(s._e(u))?h=!0:(u.e(e.right,e.y),l.containsPoint(s._e(u))&&(h=!0)))),S.s(u),z.s(l),h||(A.Pw(e,n,o)||A.Pw(e,o,r)||A.Pw(e,r,a)||A.Pw(e,a,n))&&(h=!0)}return S.s(n),S.s(o),S.s(r),S.s(a),h}getDocumentPoint(e,t){if(t===void 0&&(t=new S),e instanceof B){const i=e,s=this.naturalBounds;return t.e(i.x*s.width+i.offsetX,i.y*s.height+i.offsetY),this.Es.xt(t),t}else return t.set(e),this.Es.xt(t),t}getDocumentBounds(e){e===void 0&&(e=new z);const t=this.naturalBounds,i=this.Es,s=S.X(0,0).D(i);return e.e(s.x,s.y,0,0),s.e(t.width,0).D(i),e.unionNoCheck(s.x,s.y,0,0),s.e(t.width,t.height).D(i),e.unionNoCheck(s.x,s.y,0,0),s.e(0,t.height).D(i),e.unionNoCheck(s.x,s.y,0,0),S.s(s),e}getDocumentAngle(){return this.Es.TD()}getDocumentScale(){if(this.y0()===!1)return this.ca;const e=this.et;return this.panel!==null?e*this.panel.getDocumentScale():e}getLocalPoint(e,t){return t===void 0&&(t=new S),t.a(e),this.Es._e(t),t}getNearestIntersectionPoint(e,t,i){return this.Zc(e.x,e.y,t.x,t.y,i)}Zc(e,t,i,s,n){const o=this.D,r=1/(o.m11*o.m22-o.m12*o.m21),a=o.m22*r,h=-o.m12*r,l=-o.m21*r,u=o.m11*r,c=r*(o.m21*o.dy-o.m22*o.dx),d=r*(o.m12*o.dx-o.m11*o.dy),m=e*a+t*l+c,g=e*h+t*u+d,p=i*a+s*l+c,y=i*h+s*u+d;n.e(0,0);const x=this.naturalBounds,P=A.pl(0,0,x.width,x.height,m,g,p,y,n);return n.D(o),P}ut(e,t,i,s){if(this.Oo()===!1)return;const n=this.Zr,o=n.right+n.left,r=n.top+n.bottom;e=Math.max(e-o,0),t=Math.max(t-r,0),i=i||0,s=s||0,i=Math.max(i-o,0),s=Math.max(s-r,0);const a=this.angle;let h=0;const l=this.desiredSize,u=this.w0();a===90||a===270?(e=isFinite(l.height)?l.height+u:e,t=isFinite(l.width)?l.width+u:t):(e=isFinite(l.width)?l.width+u:e,t=isFinite(l.height)?l.height+u:t);let c=i||0,d=s||0;const m=this instanceof ct;switch(this.zs(!0)){case 0:c=0,d=0,m&&(e=1/0,t=1/0);break;case 2:isFinite(e)&&e>i&&(c=e),isFinite(t)&&t>s&&(d=t);break;case 5:isFinite(e)&&e>i&&(c=e),d=0,m&&(t=1/0);break;case 4:isFinite(t)&&t>s&&(d=t),c=0,m&&(e=1/0);break}const g=this.maxSize,p=this.minSize;c>g.width&&p.width<g.width&&(c=g.width),d>g.height&&p.height<g.height&&(d=g.height),i=Math.max(c,p.width),s=Math.max(d,p.height),g.width<i&&(i=Math.min(p.width,i)),g.height<s&&(s=Math.min(p.height,s)),e=Math.min(g.width,e),t=Math.min(g.height,t),e=Math.max(i,e),t=Math.max(s,t),(a===90||a===270)&&(h=e,e=t,t=h,h=i,i=s,s=h),this.se.ot(),this.Qu(e,t,i,s),this.se.g(),this.se.isReal()||b.o("Non-real measuredBounds has been set. Object "+this+", measuredBounds: "+this.se.toString()),this.ue(!1)}Qu(e,t,i,s){}Xs(){return!1}zt(e,t,i,s,n){this._u();const o=z.l();o.a(this.Li),this.Li.ot(),this.is()===!1?this.Li.e(e,t,i,s):this.ah(e,t,i,s),this.Li.g(),n===void 0?this.ni=null:this.ni=n;let r=!1;if(n!==void 0)r=!0;else{let a=this.panel;if(a!==null&&a._r()&&(a=a.panel),a!==null){const h=a.Vi,l=this.measuredBounds,u=t+l.height,c=e+l.width;if(r=!(0<=e+.05&&c<=h.width+.05&&0<=t+.05&&u<=h.height+.05),this instanceof Qt){const d=this.naturalBounds;(this.x0>d.height||this.mi>d.width)&&(r=!0)}}}r?this.n|=256:this.n&=-257,this.Li.isReal()||b.o("Non-real actualBounds has been set. Object "+this+", actualBounds: "+this.Li.toString()),this.td(o,this.Li),this._n(!1),z.s(o)}ah(e,t,i,s){}commonArrange(e,t,i,s){if(this.Li.e(e,t,i,s),this.desiredSize.isReal())return;const n=this.se,o=this.Zr,r=o.right+o.left,a=o.top+o.bottom,h=n.width+r,l=n.height+a;i+=r,s+=a;let u=this.zs(!0);switch(h===i&&l===s&&(u=0),u){case 0:(h>i||l>s)&&(this.ue(!0),this.ut(h>i?i:h,l>s?s:l,0,0));break;case 2:this.ue(!0),this.ut(i,s,0,0);break;case 5:this.ue(!0),this.ut(i,l,0,0);break;case 4:this.ue(!0),this.ut(h,s,0,0);break}}td(e,t){const i=this.part;i!==null&&i.diagram!==null&&((i.selectionObject===this||i.resizeObject===this||i.rotateObject===this)&&i.s2(!0),this.C(),!e.equalsApproxClose(t)&&(i.ch(),this.b0(i)))}b0(e){this.portId!==null&&(e.s2(!0),e instanceof nt&&e.tA(this))}get shadowVisible(){return this.f!==null?this.f.k0:null}set shadowVisible(e){const t=this.shadowVisible;t!==e&&(this.jt(),this.f.k0=e,this.ss(!0),this.C(),this.t("shadowVisible",t,e))}SR(e,t){const i=this.naturalBounds,s=this.oh,n=s.m11,o=s.m21,r=s.dx,a=s.m12,h=s.m22,l=s.dy;let u=0,c=0,d=u,m=c;u=d*n+m*o+r,c=d*a+m*h+l;let g=u,p=c,y=0,x=0;d=i.width+t,m=0,u=d*n+m*o+r,c=d*a+m*h+l;let P=Math.min(g,u),k=Math.min(p,c);y=Math.max(g+y,u)-P,x=Math.max(p+x,c)-k,g=P,p=k,d=i.width+t,m=i.height+t,u=d*n+m*o+r,c=d*a+m*h+l,P=Math.min(g,u),k=Math.min(p,c),y=Math.max(g+y,u)-P,x=Math.max(p+x,c)-k,g=P,p=k,d=0,m=i.height+t,u=d*n+m*o+r,c=d*a+m*h+l,P=Math.min(g,u),k=Math.min(p,c),y=Math.max(g+y,u)-P,x=Math.max(p+x,c)-k,g=P,p=k;const w=e.viewportBounds,N=w.x,M=w.y,C=w.width,O=w.height;return g>C+N||N>y+g||p>O+M||M>x+p}Gi(e,t){if(this.MR(e,t)||!this.visible)return;const i=this.opacity;if(i===0)return;let s=1;i!==1&&(s=e.globalAlpha,e.globalAlpha=s*i);let n="";this.filter!==""&&(n=e.filter,e.filter=this.filter);const o=this.D,r=this.panel;this.y0()===!0&&this.Fb();const a=this.part;let h=!1,l=0;if(a&&t.getRenderingHint("drawShadows")&&(h=a.isShadowed,h)){const p=a.shadowOffset;l=Math.max(p.y,p.x)*t.scale*t.Ui}const u=this instanceof ct&&this._r(),c=this.Li;if(u&&(this.iA(h,e,!1,r),this.NR(e,t),this.eA(h,e,!1,r),this.sA(h,e,!1)),u||!u&&(c.width===0||c.height===0||isNaN(c.x)||isNaN(c.y))){i!==1&&(e.globalAlpha=s),this.filter!==""&&(e.filter=n);return}const d=this.Xs();if(!t.Qh&&d&&this.SR(t,l)){i!==1&&(e.globalAlpha=s),this.filter!==""&&(e.filter=n);return}let m=(this.n&256)!==0;if(e.clipInsteadOfFill&&(m=!1),this instanceof Qt&&(e.font=this.font),m){const p=r.pn()?r.naturalBounds:r.actualBounds;let y=Math.max(c.x,p.x),x=Math.max(c.y,p.y),P=Math.min(c.right,p.right)-y,k=Math.min(c.bottom,p.bottom)-x;const w=this.ni;if(w!==null&&(y=w.x,x=w.y,P=w.width,k=w.height),y>c.width+c.x||c.x>p.width+p.x){i!==1&&(e.globalAlpha=s),this.filter!==""&&(e.filter=n);return}e.save(),e.beginPath(),e.rect(y,x,P,k),e.clip()}if(d){if(!a.isVisible()){i!==1&&(e.globalAlpha=s),this.filter!==""&&(e.filter=n);return}if(h){const p=a.shadowOffset;e.shadowsSet(p.x*t.scale*this.scale*t.Ui,p.y*t.scale*this.scale*t.Ui,a.shadowBlur),e.shadowsOn(),e.shadowColor=a.shadowColor}}const g=this.naturalBounds;if(e.transform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),this.iA(h,e,d,r),this.Ct!==null&&(e.commitTransform(),this.Rb(e,g,c)),this.eA(h,e,d,r),this.fh(e,t),this.sA(h,e,d),m&&(e.restore(),e.clearContextCache(this instanceof ct)),!o.Ok()){const p=1/(o.m11*o.m22-o.m12*o.m21);e.transform(o.m22*p,-o.m12*p,-o.m21*p,o.m11*p,p*(o.m21*o.dy-o.m22*o.dx),p*(o.m12*o.dx-o.m11*o.dy))}i!==1&&(e.globalAlpha=s),this.filter!==""&&(e.filter=n)}iA(e,t,i,s){e&&this.shadowVisible===!0?t.shadowsOn():e&&this.shadowVisible===!1&&t.shadowsOff(),e&&this.vb(s)&&this.shadowVisible===null&&t.shadowsOff()}eA(e,t,i,s){e&&(this.Ct!==null||this.vb(s))?(this.Ob(!0),this.shadowVisible===null&&t.shadowsOff()):this.Ob(!1)}sA(e,t,i){e&&this.o2()===!0&&t.shadowsOn(),i&&e&&t.shadowsOff()}CR(e,t,i){const s=this.part;let n=!1;s&&e.getRenderingHint("drawShadows")&&(n=s.isShadowed),t.clipInsteadOfFill&&(n=!1),this.Xs()&&n&&t.shadowsOn(),n&&this.shadowVisible===!0?t.shadowsOn():n&&this.shadowVisible===!1&&t.shadowsOff();const o=this.panel;if(n&&this.vb(o)&&this.shadowVisible===null&&t.shadowsOff(),t.tl){const r=e.computePixelRatio(),a=`drop-shadow(${t.shadowOffsetX/r}px ${t.shadowOffsetY/r}px ${t.shadowBlur/r/2}px ${t.shadowColor})`;this.background!==null&&i.Ct.setAttributeNS(null,"filter",a)}return n&&(this.Ct!==null||this.vb(o))?(this.Ob(!0),this.shadowVisible===null&&t.shadowsOff()):this.Ob(!1),n}LR(e,t,i,s){if(i.tl){const n=t.computePixelRatio(),o=`drop-shadow(${i.shadowOffsetX/n}px ${i.shadowOffsetY/n}px ${i.shadowBlur/n/2}px ${i.shadowColor})`;this.l2(e,o)}s&&this.o2()===!0&&i.shadowsOn(),this.Xs()&&i.shadowsOff()}vb(e){return e===null?!1:(e._r()&&(e=e.panel),e.o2()||(e.type===ct.Auto||e.type===ct.Spot)&&e.findMainElement()!==this)}l2(e,t){}Rb(e,t,i){const s=this.w0(),n=t.x,o=t.y,r=t.width+s,a=t.height+s;this.dn(e,this.Ct,!0,!1,t,i),this.Ct instanceof jt&&this.Ct.type===3?(e.beginPath(),e.rect(n-s/2,o-s/2,r,a),e.fillContext(this.Ct,!1,null)):e.fillRect(n-s/2,o-s/2,r,a)}nA(e,t){let i=e.AR(this);const s=e.rh!==null?e.rh:e.svg;if(i!==-1)if(i===0)if(s.Ct)s.Ct.after(t);else if(e.type===ct.Table){const n=s.getElementsByClassName("gojs-ts"),o=n.length!==0?n[0]:null;o!==null&&o.after(t)}else s.prepend(t);else{for(;i!==0&&!e.elt(i-1).isVisibleObject();)i--;if(i===0)s.prepend(t);else{const n=e.elt(i-1).svg;n!==null?n.after(t):s.appendChild(t)}}}MR(e,t){if(!(e instanceof ze))return!1;if(!this.visible||this.opacity===0)return this.svg!==null&&this.svg.parentNode!==null&&this.svg.remove(),!0;if(this.Xs()&&!this.isVisible())return this.svg!==null&&this.svg.parentNode!==null&&this.svg.remove(),!0;const i=this.panel,s=this.ed(e);if(this.Qc(e,t,s))return this.oA(this.svg),this.svg.parentElement!==null?(this.Xs()&&(e.lastDrawnPart=this.svg),!0):(this.Xs()?(e.lastDrawnPart!==null?e.lastDrawnPart.after(this.svg):e.diagramGroup.prepend(this.svg),e.lastDrawnPart=this.svg):i&&this.nA(i,this.svg),!0);if(this.Xs()&&this.isShadowed){const g=this.shadowOffset;e.shadowsSet(g.x*t.scale*this.scale*t.Ui,g.y*t.scale*this.scale*t.Ui,this.shadowBlur),e.shadowsOn(),e.shadowColor=this.shadowColor}this instanceof Qt&&(e.font=this.font),e.currentElement=null;const n=this.D,o=this instanceof ct,r=this instanceof ct?this._r():!1,a=this.svg;this.y0()===!0&&this.Fb();const h=this.Li;if(e.setCurrentTransform(1,0,0,1,0,0),e.outerGroup=!1,s)if(e.outerGroup=!0,o&&r)e.newGroup(1,0,0,1,0,0),this.svg=e.lastCreatedElement;else if(o&&this.isClipping){const g=this.findMainElement();let p=0,y=0;g!==null&&(p=g.actualBounds.x,y=g.actualBounds.y),e.newGroup(n.m11,n.m12,n.m21,n.m22,n.dx+p,n.dy+y),this.svg=e.lastCreatedElement,g!==null&&e.createOrUpdateClipGroup(this,g.actualBounds),e.currentElement=e.lastCreatedElement}else o?(e.newGroup(n.m11,n.m12,n.m21,n.m22,n.dx,n.dy),this.svg=e.lastCreatedElement):e.newGroup(1,0,0,1,0,0);const l=this.naturalBounds;o||e.setCurrentTransform(n.m11,n.m12,n.m21,n.m22,n.dx,n.dy),this.background!==null&&(o?(r&&e.setCurrentTransform(n.m11,n.m12,n.m21,n.m22,n.dx,n.dy),this.Rb(e,l,h),r&&e.setCurrentTransform(1,0,0,1,0,0)):(e.setCurrentTransform(n.m11,n.m12,n.m21,n.m22,n.dx,n.dy),this.Rb(e,l,h)),e.currentElement.Ct=e.lastCreatedElement,e.currentElement.prepend(e.lastCreatedElement));const u=this.CR(t,e,e.currentElement);this.fh(e,t),o&&e.endGroup(),e.outerGroup&&e.endGroup();const c=e.surface.Gu,d=o?this.svg:e.currentElement;if(!o&&a!==null&&d!==a&&a.parentNode===this.panel.svg){const g=this.svg.getAttribute("filter");return g!==null&&d.setAttribute("filter",g),this.svg.replaceWith(d),this.svg=d,d!==null&&this.P0(e,i,h,d),e.rA(a),!0}if(this.svg=d,c!==null&&d===null&&e.dummyGroup(),d===null)return!0;this.P0(e,i,h,d),this.LR(d,t,e,u);const m=this.Xs()?this.opacity*e.globalAlpha:this.opacity;if(m!==1&&d.setAttributeNS(null,"opacity",m.toString()),this.filter!==""&&d.setAttributeNS(null,"filter",this.filter),this.Xs()){if(a!==null&&d!==a&&a.parentNode===e.diagramGroup){const g=a.getAttribute("filter");g!==null&&d.setAttribute("filter",g),a.replaceWith(d)}else e.lastDrawnPart?e.lastDrawnPart.after(d):e.diagramGroup.prepend(d);e.lastDrawnPart=d}else i!==null&&this.nA(i,d);return c!==null&&c(this,d),this.oA(d),!0}oA(e){const t=this,i=e.dataset;t instanceof yt&&(t.portId!==null&&(i.portId=t.portId),t instanceof ct&&(isNaN(t.itemIndex)||(i.itemIndex=t.itemIndex.toString()),t instanceof Bt&&(i.className=b.sn(t),t.key!==void 0&&(i.key=t.key.toString()),t.containingGroup!==null&&(i.group=t.containingGroup.key.toString()),t instanceof dt&&(t.fromNode!==null&&t.fromNode.key!==void 0&&(i.fromKey=t.fromNode.key.toString()),t.fromPortId!==""&&(i.fromPortId=t.fromPortId),t.toNode!==null&&t.toNode.key!==void 0&&(i.toKey=t.toNode.key.toString()),t.toPortId!==""&&(i.toPortId=t.toPortId)))))}P0(e,t,i,s){let n=(this.n&256)!==0;if(e.clipInsteadOfFill&&(n=!1),!n){s.removeAttributeNS(null,"clip-path"),e.rA(s);return}const o=t.pn()?t.naturalBounds:t.actualBounds;let r=Math.max(i.x,o.x),a=Math.max(i.y,o.y),h=Math.min(i.right,o.right)-r,l=Math.min(i.bottom,o.bottom)-a;const u=this.ni;u!==null&&(r=u.x,a=u.y,h=u.width,l=u.height);const c=e.TR(s);if(c===null){const d="CLIP"+K.su++,m={id:d},g=e.makeElement("clipPath",m),p=e.makeElement("rect",{x:r,y:a,width:h,height:l});if(this instanceof ct){const y=this.D.copy().yw();p.setAttribute("transform",`matrix(${y.m11}, ${y.m12}, ${y.m21}, ${y.m22}, ${y.dx}, ${y.dy})`)}g.appendChild(p),e.svg.appendChild(g),s.setAttributeNS(null,"clip-path","url(#"+d+")")}else{const d=c.firstElementChild;d.setAttribute("x",r.toString()),d.setAttribute("y",a.toString()),d.setAttribute("width",h.toString()),d.setAttribute("height",l.toString())}}DR(){if(this.svg===null)return;const e=this.svg.innerHTML.match(/url\(#((CLIP|GRAD).+?)\)/g),t=this.svg.ownerDocument;if(e!==null)for(const i of e){const s=t.getElementById(i.split("#")[1].slice(0,-1));s!==null&&s.remove()}this.svg.remove()}NR(e,t){const i=this.Li,s=this.Vi,n=this.Ct;n!==null&&e.commitTransform(),n!==null&&(this.dn(e,n,!0,!1,s,i),n instanceof jt&&n.type===3?(e.beginPath(),e.rect(i.x,i.y,i.width,i.height),e.fillContext(n,!1,null)):e.fillRect(i.x,i.y,i.width,i.height)),this.fh(e,t)}fh(e,t){}S0(){this.ss(!0)}Qc(e,t,i){const s=this.svg;if(this.FR()){if(this.S0(),this.ss(!1),s===null)return!1;const u=this.svg.getAttribute("clip-path");if(u!==null&&u.includes("url")){const c=e.svg.getElementById(u.split("#")[1].slice(0,-1));c!==null&&c.remove()}return!1}if(s===null)return!1;if(!this.visible)return s.remove(),!1;if(s.nodeName!=="g"&&i||s.nodeName==="g"&&!i)return!1;const n=this.D,o="matrix("+n.m11+", "+n.m12+", "+n.m21+", "+n.m22+", "+n.dx+", "+n.dy+")",r=this instanceof ct,a=r?this._r():!1;if(!(r&&a))if(this instanceof Ge){const u=this.Ib;e.setCurrentTransform(n.m11,n.m12,n.m21,n.m22,n.dx,n.dy),u!==null&&e.amendImageTransform(u[0],u[1],u[2],u[3],u[4],u[5],u[6],u[7]),i?s.lastElementChild.setAttributeNS(null,"transform",e.getCurrentTransform()):s.setAttributeNS(null,"transform",e.getCurrentTransform())}else if(i&&!r)if(this instanceof bt){const u=s.getElementsByTagName("path");for(let c=0;c<u.length;c++)u[c].setAttributeNS(null,"transform",o)}else if(this instanceof Qt){const u=s.getElementsByTagName("text");for(let c=0;c<u.length;c++)u[c].setAttributeNS(null,"transform",o)}else(s.lastElementChild||s).setAttributeNS(null,"transform",o);else if(r&&this.isClipping&&this.rh){const u=this.findMainElement(),c=u!==null?u.actualBounds.x:0,d=u!==null?u.actualBounds.y:0;this.rh.setAttributeNS(null,"transform","matrix(1,0,0,1,"+-c+", "+-d+")"),s.setAttributeNS(null,"transform","matrix("+n.m11+", "+n.m12+", "+n.m21+", "+n.m22+", "+(n.dx+c)+", "+(n.dy+d)+")")}else s.setAttributeNS(null,"transform",o);const h=this.Xs()?this.opacity*e.globalAlpha:this.opacity;h===1?s.removeAttribute("opacity"):s.setAttributeNS(null,"opacity",h.toString()),e.setCurrentTransform(1,0,0,1,0,0);const l=this.rh?this.rh:this.Db;if(this.background!==null||l.Ct!==void 0){const u=l.Ct;if(this.background===null)e.removeOldGradient(this,l.Ct,"fill"),l.Ct.remove(),l.Ct=void 0;else{if((a||i&&!(this instanceof ct))&&e.setCurrentTransform(n.m11,n.m12,n.m21,n.m22,n.dx,n.dy),this.Rb(e,this.naturalBounds,this.actualBounds),l.Ct){e.removeOldGradient(this,l.Ct,"fill");const c=l.Ct.getAttribute("filter");c!==null&&e.lastCreatedElement.setAttribute("filter",c),l.Ct.replaceWith(e.lastCreatedElement)}else l.prepend(e.lastCreatedElement);l.Ct=e.lastCreatedElement}u&&e.removeOldGradient(this,u,"fill")}return this.P0(e,this.panel,this.actualBounds,s),!0}ed(e){if(this.background!==null)return!0;let t=(this.n&256)!==0;return e.clipInsteadOfFill&&(t=!1),!!t}static cE(e,t,i,s,n,o,r){let a=.001;const h=o.length;e.moveTo(t,i);let l=s-t;const u=n-i;l===0&&(l=.001);const c=u/l;let d=Math.sqrt(l*l+u*u),m=0,g=!0;a=o[m%h];let p=r!==0;for(;d>=.1;){if(p){for(a=o[m++%h],a-=r;a<0;)a+=o[m++%h],g=!g;p=!1}else a=o[m++%h];a>d&&(a=d);let y=Math.sqrt(a*a/(1+c*c));l<0&&(y=-y),t+=y,i+=c*y,g?e.lineTo(t,i):e.moveTo(t,i),d-=a,g=!g}}dn(e,t,i,s,n,o){let r=1,a=1;if(typeof t=="string"){i?e.fillStyle=t:e.strokeStyle=t;return}else if(t.type===1){i?e.fillStyle=t.color:e.strokeStyle=t.color;return}let h;const l=this.w0();r=n.width,a=n.height,s?(r=o.width,a=o.height):i||(r+=l,a+=l);const u=e instanceof hs;if(u&&t.yn&&(t.type===4||t._c===r&&t.Eb===a))h=t.yn;else{let c=0,d=0,m=0,g=0,p=0,y=0,x=0,P=0;if(s?(x=o.x,P=o.y):i||(x-=l/2,P-=l/2),c=t.start.x*r+t.start.offsetX+x,d=t.start.y*a+t.start.offsetY+P,m=t.end.x*r+t.end.offsetX+x,g=t.end.y*a+t.end.offsetY+P,t.type===2)h=e.createLinearGradient(c,d,m,g);else if(t.type===3)y=isNaN(t.endRadius)?Math.max(r,a)/2:t.endRadius,isNaN(t.startRadius)?(p=0,y=Math.max(r,a)/2):p=t.startRadius,h=e.createRadialGradient(c,d,p,m,g,y);else if(t.type===4)try{h=e.createPattern(t.pattern,"repeat")}catch{h=null}else b.we(t.type,"Brush type");if(t.type!==4){const k=t.colorStops;if(k!==null){const w=k.iterator;for(;w.next();)h.addColorStop(w.key,w.value)}}if(u&&(t.yn=h,h!==null&&(t._c=r,t.Eb=a),h===null&&t.type===4&&t._c!==-1)){t._c=-1;const k=this.diagram;k!==null&&t._c===-1&&b.Oh(()=>{k.redraw()},600)}}i?e.fillStyle=h:e.strokeStyle=h}isContainedBy(e){return e instanceof ct?this.RR(this,e):!1}RR(e,t){if(e===t||t===null)return!1;let i=e.panel;for(;i!==null;){if(i===t)return!0;i=i.panel}return!1}isVisibleObject(){if(!this.visible)return!1;const e=this.panel;return e!==null?e.isVisibleObject():!0}isEnabledObject(){let e=this instanceof ct?this:this.panel;for(;e!==null&&e.isEnabled;)e=e.panel;return e===null}get enabledChanged(){return this.f!==null?this.f.M0:null}set enabledChanged(e){const t=this.enabledChanged;t!==e&&(e!==null&&b.i(e,"function",yt,"enabledChanged"),this.jt(),this.f.M0=e,this.t("enabledChanged",t,e))}Fb(){if(this.Bb()===!0){const e=this.$r;if(e.Ri(),!this.Li.isReal()||!this.se.isReal()){this.sd(!1);return}if(e.Ds(this.Li.x-this.se.x,this.Li.y-this.se.y),this.scale!==1||this.angle!==0){const t=this.naturalBounds;this.p0(e,t.x,t.y,t.width,t.height)}this.sd(!1),this.wa(!0)}if(this.y0()===!0){const e=this.panel;if(e===null)this.oh.set(this.$r),this.ca=this.scale;else if(e.Es!==null){const t=this.oh;t.Ri(),e.pn()?t.ic(e.oh):e.panel!==null&&t.ic(e.panel.oh),t.ic(this.$r),this.ca=this.scale*e.ca}this.wa(!1)}}p0(e,t,i,s,n){if(this.et!==1&&e.et(this.et),this.Xt===0)return;const o=S.l();o.setSpot(t,i,s,n,B.Center),e.cs(this.Xt,o.x,o.y),S.s(o)}c(e){if(this.Oo())return;e===void 0&&(e=!1),this.ue(!0),this._n(!0);const t=this.panel;t!==null&&!e&&t.c()}tf(){this.Oo()||(this.ue(!0),this._n(!0))}ef(e){if(this.is())return;const t=this.panel;!e&&t!==null&&t.c(),this._n(!0)}_u(){this.Bb()===!1&&(this.sd(!0),this.wa(!0))}h2(){this.wa(!0)}C(){const e=this.part;e!==null&&e.C()}zs(e){const t=this.stretch,i=this.panel;if(i===null)return this.zo(t===1?0:t,e);if(i.type===ct.Table)return this.N0(i.getRowDefinition(this.row),i.getColumnDefinition(this.column),e);if(i.type===ct.Auto&&i.findMainElement()===this)return this.zo(2,e);if(t===1){if(i.type===ct.Spot&&i.findMainElement()===this)return this.zo(2,e);const s=i.defaultStretch;return s===1?this.zo(0,e):this.zo(s,e)}return this.zo(t,e)}N0(e,t,i){const s=this.stretch;if(s!==1)return this.zo(s,i);let n=null,o=null;switch(e.stretch){case 1:case 5:break;case 4:o=!0;break;case 2:o=!0;break}switch(t.stretch){case 1:case 4:break;case 5:n=!0;break;case 2:n=!0;break}const r=this.panel.defaultStretch;return n===null&&(n=r===5||r===2),o===null&&(o=r===4||r===2),n===!0&&o===!0?this.zo(2,i):n===!0?this.zo(5,i):o===!0?this.zo(4,i):this.zo(0,i)}zo(e,t){if(t)return e;if(e===0)return 0;const i=this.desiredSize;if(i.isReal())return 0;const s=!isNaN(i.width),n=!isNaN(i.height),o=this.angle;if(s)if(o!==90&&o!==270){if(e===5)return 0;if(e===2)return 4}else{if(e===4)return 0;if(e===2)return 5}if(n)if(o!==90&&o!==270){if(e===4)return 0;if(e===2)return 5}else{if(e===5)return 0;if(e===2)return 4}return e}get segmentOrientation(){return this.Bt!==null?this.Bt.C0:0}set segmentOrientation(e){const t=this.segmentOrientation;t!==e&&(this.Bt===null&&(this.Bt=new Si),this.Bt.C0=e,this.c(),this.t("segmentOrientation",t,e),e===0&&(this.angle=0))}vR(){this.segmentOrientation=21}get segmentIndex(){return this.Bt!==null?this.Bt.L0:-1/0}set segmentIndex(e){e=Math.round(e);const t=this.segmentIndex;t!==e&&(this.Bt===null&&(this.Bt=new Si),this.Bt.L0=e,this.c(),this.t("segmentIndex",t,e))}get segmentFraction(){return this.Bt!==null?this.Bt.A0:0}set segmentFraction(e){isNaN(e)||e<0?e=0:e>1&&(e=1);const t=this.segmentFraction;t!==e&&(this.Bt===null&&(this.Bt=new Si),this.Bt.A0=e,this.c(),this.t("segmentFraction",t,e))}get segmentOffset(){return this.Bt!==null?this.Bt.T0:S.Po}set segmentOffset(e){const t=this.segmentOffset;t.equals(e)||(e=e.N(),this.Bt===null&&(this.Bt=new Si),this.Bt.T0=e,this.c(),this.t("segmentOffset",t,e))}get stretch(){return this.f!==null?this.f.to:1}set stretch(e){const t=this.stretch;t!==e&&(this.jt(),this.f.to=e,this.c(),this.t("stretch",t,e))}get name(){return this.f!==null?this.f.Mt:""}set name(e){const t=this.name;t!==e&&(this.jt(),this.f.Mt=e,this.part!==null&&this.part.D0(),this.t("name",t,e))}get opacity(){return this.Wt}set opacity(e){const t=this.Wt;if(t!==e){b.i(e,"number",yt,"opacity"),(e<0||e>1)&&b._(e,"0 <= value <= 1",yt,"opacity"),this.Wt=e,this.t("opacity",t,e);const i=this.diagram,s=this.part;i!==null&&s!==null&&i.C(s.Hh(s.actualBounds))}}get filter(){return this.Wu}set filter(e){const t=this.Wu;if(t!==e){this.Wu=e,this.ss(!0),this.t("filter",t,e);const i=this.diagram,s=this.part;i!==null&&s!==null&&i.C(s.Hh(s.actualBounds))}}get visible(){return(this.n&1)!==0}set visible(e){const t=(this.n&1)!==0;if(t!==e){this.n=this.n^1,this.t("visible",t,e);const i=this.panel;i!==null?i.c():this.Xs()&&this.Ei(e),this.C(),this.lA()}}get pickable(){return(this.n&2)!==0}set pickable(e){const t=(this.n&2)!==0;t!==e&&(this.n=this.n^2,this.t("pickable",t,e))}get fromLinkableDuplicates(){return(this.n&4)!==0}set fromLinkableDuplicates(e){const t=(this.n&4)!==0;t!==e&&(this.n=this.n^4,this.t("fromLinkableDuplicates",t,e))}get fromLinkableSelfNode(){return(this.n&8)!==0}set fromLinkableSelfNode(e){const t=(this.n&8)!==0;t!==e&&(this.n=this.n^8,this.t("fromLinkableSelfNode",t,e))}get toLinkableDuplicates(){return(this.n&16)!==0}set toLinkableDuplicates(e){const t=(this.n&16)!==0;t!==e&&(this.n=this.n^16,this.t("toLinkableDuplicates",t,e))}get toLinkableSelfNode(){return(this.n&32)!==0}set toLinkableSelfNode(e){const t=(this.n&32)!==0;t!==e&&(this.n=this.n^32,this.t("toLinkableSelfNode",t,e))}get isPanelMain(){return(this.n&64)!==0}set isPanelMain(e){const t=(this.n&64)!==0;t!==e&&(this.n=this.n^64,this.c(),this.t("isPanelMain",t,e))}get isActionable(){return(this.n&128)!==0}set isActionable(e){const t=(this.n&128)!==0;t!==e&&(this.n=this.n^128,this.t("isActionable",t,e))}get background(){return this.Ct}set background(e){const t=this.Ct;t!==e&&(e!==null&&jt.nd(e,"GraphObject.background"),e instanceof jt&&e.g(),this.Ct=e,this.C(),this.t("background",t,e))}o2(){return(this.n&512)!==0}Ob(e){e?this.n|=512:this.n&=-513}$c(){return(this.n&1024)!==0}a2(e){e?this.n|=1024:this.n&=-1025}Bb(){return(this.n&2048)!==0}sd(e){e?this.n|=2048:this.n&=-2049}y0(){return(this.n&4096)!==0}wa(e){e?this.n|=4096:this.n&=-4097}Oo(){return(this.n&8192)!==0}ue(e){e?this.n|=8192:this.n&=-8193}is(){return(this.n&16384)!==0}_n(e){e?this.n|=16384:this.n&=-16385}FR(){return(this.n&32768)!==0}ss(e){e?this.n|=32768:this.n&=-32769}get part(){if(this.Xs())return this;if(this.Qr!==null)return this.Qr;let e=this;for(e=e.panel;e;){if(e instanceof Bt)return this.Qr=e,e;e=e.panel}return null}get svg(){return this.Db}set svg(e){this.Db=e}Du(){this.svg=null}get panel(){return this.Vs}xa(e){this.Vs=e,this.svg!==null&&this.svg.remove()}get layer(){const e=this.part;return e!==null?e.layer:null}get diagram(){const e=this.part;return e!==null?e.diagram:null}get position(){return this.at}set position(e){const t=e.x,i=e.y,s=this.at,n=s.x,o=s.y;n!==t&&(!isNaN(n)||!isNaN(t))||o!==i&&(!isNaN(o)||!isNaN(i))?(e=e.copy(),this.c2(e,n,o)&&this.t("position",new S(n,o),e)):this.f2()}f2(){}c2(e,t,i){return this.at=e,this.ef(),!0}bc(e,t,i){this.at.x===e&&this.at.y===t||(this.at.e(e,t),this._u())}get actualBounds(){return this.Li}get scale(){return this.et}set scale(e){const t=this.et;t!==e&&(e<=0&&b.o("GraphObject.scale for "+this+" must be greater than zero, not: "+e),this.et=e,this.c(),this.t("scale",t,e))}get angle(){return this.Xt}set angle(e){const t=this.Xt;if(t!==e){if(e=e%360,e<0&&(e+=360),t===e)return;this.Xt=e,this.lA(),this.c(),this.t("angle",t,e)}}get desiredSize(){return this.ze}set desiredSize(e){const t=e.width,i=e.height,s=this.ze,n=s.width,o=s.height;if((n!==t&&(!isNaN(n)||!isNaN(t))||o!==i&&(!isNaN(o)||!isNaN(i)))&&(e=e.N(),this.ze=e,this.c(),this instanceof bt&&this.ee(),this.t("desiredSize",s,e),this.$c())){const r=this.part;r!==null&&(this.ya(r,"width"),this.ya(r,"height"))}}get width(){return this.ze.width}set width(e){const t=this.ze.width;if(t!==e&&(!isNaN(t)||!isNaN(e))){const i=this.ze,s=new ut(e,this.ze.height).g();if(this.ze=s,this.c(),this instanceof bt&&this.ee(),this.t("desiredSize",i,s),this.$c()){const n=this.part;n!==null&&this.ya(n,"width")}}}get height(){return this.ze.height}set height(e){const t=this.ze.height;if(t!==e&&(!isNaN(t)||!isNaN(e))){const i=this.ze,s=new ut(this.ze.width,e).g();if(this.ze=s,this.c(),this instanceof bt&&this.ee(),this.t("desiredSize",i,s),this.$c()){const n=this.part;n!==null&&this.ya(n,"height")}}}get minSize(){return this.f!==null?this.f.xr:ut.ru}set minSize(e){const t=this.minSize;t.equals(e)||(e=e.copy(),isNaN(e.width)&&(e.width=0),isNaN(e.height)&&(e.height=0),e.g(),this.jt(),this.f.xr=e,this.c(),this.t("minSize",t,e))}get maxSize(){return this.f!==null?this.f.br:ut.iC}set maxSize(e){const t=this.maxSize;t.equals(e)||(e=e.copy(),isNaN(e.width)&&(e.width=1/0),isNaN(e.height)&&(e.height=1/0),e.g(),this.jt(),this.f.br=e,this.c(),this.t("maxSize",t,e))}get measuredBounds(){return this.se}get naturalBounds(){return this.Vi}w0(){return 0}get margin(){return this.Zr}set margin(e){typeof e=="number"&&(e=new Kt(e));const t=this.Zr;t.equals(e)||(e=e.N(),this.Zr=e,this.c(),this.t("margin",t,e))}get D(){return this.Bb()===!0&&this.Fb(),this.$r}get Es(){return this.y0()===!0&&this.Fb(),this.oh}trigger(e,t,i){let s=null;return typeof e=="string"?s=new os(e,t,i):s=e,s.ke=this,this.ys===null&&(this.ys=new St),this.ys.set(s.propertyName,s),this}get ys(){return this.f!==null?this.f.ys:null}set ys(e){this.ys!==e&&(this.jt(),this.f.ys=e)}get wr(){return this.f!==null?this.f.wr:0}set wr(e){this.wr!==e&&(this.jt(),this.f.wr=e)}get alignment(){return this.oi}set alignment(e){const t=this.oi;t.equals(e)||(e.isNoSpot()&&!e.isDefault()&&b.o("GraphObject.alignment for "+this+" must be a real Spot or Spot.Default, not: "+e),e=e.N(),this.oi=e,this.ef(),this.t("alignment",t,e))}get column(){return this.Uo}set column(e){e=Math.round(e);const t=this.Uo;t!==e&&(e<0&&b._(e,">= 0",yt,"column"),this.Uo=e,this.c(),this.t("column",t,e),this.svg!==null&&this.svg.remove())}get columnSpan(){return this.f!==null?this.f.F0:1}set columnSpan(e){e=Math.round(e);const t=this.columnSpan;t!==e&&(e<1&&b._(e,">= 1",yt,"columnSpan"),this.jt(),this.f.F0=e,this.c(),this.t("columnSpan",t,e))}get row(){return this.qu}set row(e){e=Math.round(e);const t=this.qu;t!==e&&(e<0&&b._(e,">= 0",yt,"row"),this.qu=e,this.c(),this.t("row",t,e),this.svg!==null&&this.svg.remove())}get rowSpan(){return this.f!==null?this.f.R0:1}set rowSpan(e){e=Math.round(e);const t=this.rowSpan;t!==e&&(e<1&&b._(e,">= 1",yt,"rowSpan"),this.jt(),this.f.R0=e,this.c(),this.t("rowSpan",t,e))}get spanAllocation(){return this.f!==null?this.f.v0:null}set spanAllocation(e){const t=this.spanAllocation;t!==e&&(e!==null&&b.i(e,"function",yt,"spanAllocation"),this.jt(),this.f.v0=e,this.c(),this.t("spanAllocation",t,e))}get alignmentFocus(){return this.Wc}set alignmentFocus(e){const t=this.Wc;t.equals(e)||(e=e.N(),this.Wc=e,this.c(),this.t("alignmentFocus",t,e))}get portId(){return this.Hu}set portId(e){const t=this.Hu;if(t!==e){const i=this.part;i!==null&&!(i instanceof nt)&&b.o("Cannot set portID on a Link: "+e);const s=i;t!==null&&s!==null&&s.u2(this),this.Hu=e,e!==null&&s!==null&&(s.wn=!0,s.hA(this)),this.t("portId",t,e)}}ba(){const e=this.part;if(e instanceof nt&&(this.portId!==null||this===e.port)){const t=e.diagram;t!==null&&!t.undoManager.isUndoingRedoing&&e.tA(this)}}lA(){const e=this.diagram;e===null||e.undoManager.isUndoingRedoing||(this instanceof ct?this instanceof nt?this.invalidateConnectedLinks():this.walkVisualTreeFrom(this,t=>{t.ba()}):this.ba())}get toSpot(){return this.q!==null?this.q.ua:B.None}set toSpot(e){const t=this.toSpot;t.equals(e)||(e=e.N(),this.Xe(),this.q.ua=e,this.t("toSpot",t,e),this.ba())}get toEndSegmentLength(){return this.q!==null?this.q.ga:10}set toEndSegmentLength(e){const t=this.toEndSegmentLength;t!==e&&(e<0&&b._(e,">= 0",yt,"toEndSegmentLength"),this.Xe(),this.q.ga=e,this.t("toEndSegmentLength",t,e),this.ba())}get toShortLength(){return this.q!==null?this.q.pa:0}set toShortLength(e){const t=this.toShortLength;t!==e&&(this.Xe(),this.q.pa=e,this.t("toShortLength",t,e),this.ba())}get toLinkable(){return this.q!==null?this.q.O0:null}set toLinkable(e){const t=this.toLinkable;t!==e&&(this.Xe(),this.q.O0=e,this.t("toLinkable",t,e))}get toMaxLinks(){return this.q!==null?this.q.I0:1/0}set toMaxLinks(e){const t=this.toMaxLinks;t!==e&&(e<0&&b._(e,">= 0",yt,"toMaxLinks"),this.Xe(),this.q.I0=e,this.t("toMaxLinks",t,e))}get fromSpot(){return this.q!==null?this.q.fa:B.None}set fromSpot(e){const t=this.fromSpot;t.equals(e)||(e=e.N(),this.Xe(),this.q.fa=e,this.t("fromSpot",t,e),this.ba())}get fromEndSegmentLength(){return this.q!==null?this.q.da:10}set fromEndSegmentLength(e){const t=this.fromEndSegmentLength;t!==e&&(e<0&&b._(e,">= 0",yt,"fromEndSegmentLength"),this.Xe(),this.q.da=e,this.t("fromEndSegmentLength",t,e),this.ba())}get fromShortLength(){return this.q!==null?this.q.ma:0}set fromShortLength(e){const t=this.fromShortLength;t!==e&&(this.Xe(),this.q.ma=e,this.t("fromShortLength",t,e),this.ba())}get fromLinkable(){return this.q!==null?this.q.E0:null}set fromLinkable(e){const t=this.fromLinkable;t!==e&&(this.Xe(),this.q.E0=e,this.t("fromLinkable",t,e))}get fromMaxLinks(){return this.q!==null?this.q.B0:1/0}set fromMaxLinks(e){const t=this.fromMaxLinks;t!==e&&(e<0&&b._(e,">= 0",yt,"fromMaxLinks"),this.Xe(),this.q.B0=e,this.t("fromMaxLinks",t,e))}get cursor(){return this.f!==null?this.f.Sl:""}set cursor(e){const t=this.cursor;t!==e&&(b.i(e,"string",yt,"cursor"),this.jt(),this.f.Sl=e,this.t("cursor",t,e))}get click(){return this.f!==null?this.f.Tr:null}set click(e){const t=this.click;t!==e&&(e!==null&&b.i(e,"function",yt,"click"),this.jt(),this.f.Tr=e,this.t("click",t,e))}get doubleClick(){return this.f!==null?this.f.Dr:null}set doubleClick(e){const t=this.doubleClick;t!==e&&(e!==null&&b.i(e,"function",yt,"doubleClick"),this.jt(),this.f.Dr=e,this.t("doubleClick",t,e))}get contextClick(){return this.f!==null?this.f.Fr:null}set contextClick(e){const t=this.contextClick;t!==e&&(e!==null&&b.i(e,"function",yt,"contextClick"),this.jt(),this.f.Fr=e,this.t("contextClick",t,e))}get mouseEnter(){return this.f!==null?this.f.Er:null}set mouseEnter(e){const t=this.mouseEnter;t!==e&&(e!==null&&b.i(e,"function",yt,"mouseEnter"),this.jt(),this.f.Er=e,this.t("mouseEnter",t,e))}get mouseLeave(){return this.f!==null?this.f.Br:null}set mouseLeave(e){const t=this.mouseLeave;t!==e&&(e!==null&&b.i(e,"function",yt,"mouseLeave"),this.jt(),this.f.Br=e,this.t("mouseLeave",t,e))}get mouseOver(){return this.f!==null?this.f.Rr:null}set mouseOver(e){const t=this.mouseOver;t!==e&&(e!==null&&b.i(e,"function",yt,"mouseOver"),this.jt(),this.f.Rr=e,this.t("mouseOver",t,e))}get mouseHover(){return this.f!==null?this.f.vr:null}set mouseHover(e){const t=this.mouseHover;t!==e&&(e!==null&&b.i(e,"function",yt,"mouseHover"),this.jt(),this.f.vr=e,this.t("mouseHover",t,e))}get mouseHold(){return this.f!==null?this.f.Or:null}set mouseHold(e){const t=this.mouseHold;t!==e&&(e!==null&&b.i(e,"function",yt,"mouseHold"),this.jt(),this.f.Or=e,this.t("mouseHold",t,e))}get mouseDragEnter(){return this.f!==null?this.f.U0:null}set mouseDragEnter(e){const t=this.mouseDragEnter;t!==e&&(e!==null&&b.i(e,"function",yt,"mouseDragEnter"),this.jt(),this.f.U0=e,this.t("mouseDragEnter",t,e))}get mouseDragLeave(){return this.f!==null?this.f.V0:null}set mouseDragLeave(e){const t=this.mouseDragLeave;t!==e&&(e!==null&&b.i(e,"function",yt,"mouseDragLeave"),this.jt(),this.f.V0=e,this.t("mouseDragLeave",t,e))}get mouseDrop(){return this.f!==null?this.f.Ir:null}set mouseDrop(e){const t=this.mouseDrop;t!==e&&(e!==null&&b.i(e,"function",yt,"mouseDrop"),this.jt(),this.f.Ir=e,this.t("mouseDrop",t,e))}get actionDown(){return this.f!==null?this.f.z0:null}set actionDown(e){const t=this.actionDown;t!==e&&(e!==null&&b.i(e,"function",yt,"actionDown"),this.jt(),this.f.z0=e,this.t("actionDown",t,e))}get actionMove(){return this.f!==null?this.f.X0:null}set actionMove(e){const t=this.actionMove;t!==e&&(e!==null&&b.i(e,"function",yt,"actionMove"),this.jt(),this.f.X0=e,this.t("actionMove",t,e))}get actionUp(){return this.f!==null?this.f.K0:null}set actionUp(e){const t=this.actionUp;t!==e&&(e!==null&&b.i(e,"function",yt,"actionUp"),this.jt(),this.f.K0=e,this.t("actionUp",t,e))}get actionCancel(){return this.f!==null?this.f.Y0:null}set actionCancel(e){const t=this.actionCancel;t!==e&&(e!==null&&b.i(e,"function",yt,"actionCancel"),this.jt(),this.f.Y0=e,this.t("actionCancel",t,e))}get toolTip(){return this.f!==null?this.f.Ur:null}set toolTip(e){const t=this.toolTip;t!==e&&(this.jt(),this.f.Ur=e,this.t("toolTip",t,e))}get contextMenu(){return this.f!==null?this.f.Vr:null}set contextMenu(e){const t=this.contextMenu;t!==e&&(this.jt(),this.f.Vr=e,this.t("contextMenu",t,e))}findBindingPanel(){let e=this instanceof ct?this:this.panel;for(;e!==null;){if(e.d2())return e;e=e.panel}return null}bind(e,t,i,s){return this.sf(e,t,i,s),this}bindTwoWay(e,t,i,s){return this.sf(e,t,i,s).makeTwoWay(),this}bindModel(e,t,i,s){return this.sf(e,t,i,s).ofModel(),this}bindObject(e,t,i,s,n){return this.sf(e,t,i,s).ofObject(n),this}theme(e,t,i,s,n){return this.uh(e,t,i,s,n),this}themeData(e,t,i,s,n){return this.uh(e,t,i,s,n).ofData(),this}themeObject(e,t,i,s,n,o){return this.uh(e,t,i,s,n).ofObject(o),this}themeModel(e,t,i,s,n){return this.uh(e,t,i,s,n).ofModel(),this}sf(e,t,i,s){let n=null;return typeof e=="string"?n=new bi(e,t,i,s):n=e,this.G0(n),n}uh(e,t,i,s,n){let o=null;return typeof e=="string"?o=new Hi(e,t,i,s,n):o=e,this.G0(o),o}G0(e){e.ke=this;const t=this.findBindingPanel();t!==null&&t.aA()&&b.o("Cannot add a Binding to a template that has already been copied: "+e),this.Ai===null&&(this.Ai=new J),this.Ai.add(e)}set(e){return Object.assign(this,e),this}attach(e){return yt.g2(this,e),this}apply(e){return e(this),this}setProperties(e){return At.h0(this,e),this}static build(e,t,...i){const s=yt.j0.get(e);if(typeof s=="function"){const n=s([e].concat(i));if(n instanceof yt)return t&&n.setProperties(t),n}b.o('GraphObject.build invoked object builder "'+e+'", but it did not return an Object')}static make(e,...t){let i=arguments,s=null,n=null;if(typeof e=="function")n=e;else if(typeof e=="string"){const r=yt.j0.get(e);typeof r=="function"?(i=Array.prototype.slice.call(i),s=r(i),b.wt(s)||b.o('GraphObject.make invoked object builder "'+e+'", but it did not return an Object')):n=Z.go[e]}s===null&&((n==null||!n.constructor)&&b.o("GraphObject.make requires a class function or GoJS class name or name of an object builder, not: "+e),s=new n);let o=1;if(s instanceof At&&i.length>1){const r=s,a=i[1];(typeof a=="string"||a instanceof HTMLDivElement)&&(r.mM(a),o++)}for(let r=o;r<i.length;r++){const a=i[r];a===void 0?b.o("Undefined value at argument "+r+" for object being constructed by GraphObject.make: "+s):yt.g2(s,a)}return s}static g2(e,t){if(typeof t=="number")yt.OR(e,t);else if(typeof t=="string")yt.IR(e,t);else if(t instanceof yt)e instanceof ct||b.o("A GraphObject can only be added to a Panel, not to: "+e),e.add(t);else if(t instanceof Te){let i;t.isRow&&typeof e.getRowDefinition=="function"?i=e.getRowDefinition(t.index):!t.isRow&&typeof e.getColumnDefinition=="function"&&(i=e.getColumnDefinition(t.index)),i instanceof Te?i.Ub(t):b.o("A RowColumnDefinition can only be added to an object that implements getRowDefinition/getColumnDefinition, not to: "+e)}else if(t instanceof Rt){const i=e;i.type=t}else if(t instanceof bi)e instanceof yt||e instanceof Te?e.bind(t):b.o("A Binding can only be applied to a GraphObject or RowColumnDefinition, not to: "+e);else if(t instanceof os)e instanceof yt?e.trigger(t):b.o("An AnimationTrigger can only be applied to a GraphObject, not to: "+e);else if(t instanceof _t)e instanceof Ft&&e.type===4?e.figures.add(t):b.o("A PathFigure can only be added to a Path Geometry, not to: "+e);else if(t instanceof kt)e instanceof _t?e.segments.add(t):b.o("A PathSegment can only be added to a PathFigure, not to: "+e);else if(t instanceof be)e instanceof At||e instanceof at?e.layout=t:b.o("A Layout can only be assigned to a Diagram or a Group, not to: "+e);else if(Array.isArray(t))for(let i=0;i<t.length;i++){const s=t[i];yt.g2(e,s)}else typeof t=="object"&&t!==null?yt.ER(e,t):b.o('Unknown initializer "'+t+'" for object being constructed by GraphObject.make: '+e)}static IR(e,t){if(e instanceof Qt)e.text=t;else if(e instanceof bt)e.figure=t;else if(e instanceof Ge)e.source=t;else if(e instanceof ct){const i=Rt.Layouts.get(t);i!==null&&(e.type=i)}else if(e instanceof jt){const i=b.Ih(Bi,t);i!==null?e.type=i:b.o("Unknown Brush type as an argument to GraphObject.make: "+t)}else if(e instanceof Ft){const i=b.Ih(pi,t);i!==null&&(e.type=i)}else if(e instanceof kt){const i=b.Ih(_e,t);i!==null&&(e.type=i)}}static OR(e,t){typeof e.ri=="function"?e.ri(t):b.lr(e,t)}static ER(e,t){if(e instanceof jt){const i=new fe;for(const s in t){const n=parseFloat(s);isNaN(n)?i[s]=t[s]:e.addColorStop(n,t[s])}At.h0(e,i)}else if(e instanceof Te){if(t.row!==void 0){const s=t.row;(s==null||s===1/0||isNaN(s)||s<0)&&b.o("Must specify non-negative integer row for RowColumnDefinition "+t+", not: "+s),e.isRow=!0,e.index=s}else if(t.column!==void 0){const s=t.column;(s==null||s===1/0||isNaN(s)||s<0)&&b.o("Must specify non-negative integer column for RowColumnDefinition "+t+", not: "+s),e.isRow=!1,e.index=s}const i=new fe;for(const s in t)s==="row"||s==="column"||(i[s]=t[s]);At.h0(e,i)}else At.h0(e,t)}static fE(){const e=new St;for(const t in yt.j0){if(t===t.toLowerCase())continue;const i=yt.j0.get(t);typeof i=="function"&&e.set(t,i)}return e.g(),e}static defineBuilder(e,t){b.i(e,"string",yt,"defineBuilder:name"),b.i(t,"function",yt,"defineBuilder:func"),e.toLowerCase(),yt.j0.set(e,t)}static takeBuilderArgument(e,t,i){i===void 0&&(i=null);const s=e[1];if(typeof i=="function"?i(s):typeof s=="string")return e.splice(1,1),s;if(t===void 0)throw new Error("no "+(typeof i=="function"?"satisfactory":"string")+" argument for GraphObject builder "+e[0]);return t}};f(yt,"None",0),f(yt,"Default",1),f(yt,"Fill",2),f(yt,"Vertical"),f(yt,"Horizontal"),f(yt,"Uniform",6),f(yt,"UniformToFill",7),f(yt,"FlipVertical",1),f(yt,"FlipHorizontal",2),f(yt,"FlipBoth",3),f(yt,"j0",new St),yt.Vertical=4,yt.Horizontal=5,yt.defineBuilder("Button",e=>{const t="#f5f5f5",i="#737373",s="#d4d4d4",n="#737373",o="#a3a3a3",r=2.76142374915397,a=2.761423749153969,h=new ct(ct.Auto,{isActionable:!0,enabledChanged:(l,u)=>{if(l instanceof ct){const c=l.findObject("ButtonBorder");c!==null&&(u?(l._buttonFillDisabled=c.fill,c.fill=l._buttonFillNormal):(l._buttonFillNormal=c.fill,c.fill=l._buttonFillDisabled))}},cursor:"pointer"}).attach({_buttonFillNormal:t,_buttonStrokeNormal:i,_buttonFillOver:s,_buttonStrokeOver:n,_buttonFillDisabled:o}).add(new bt("RoundedRectangle",{name:"ButtonBorder",spot1:new B(0,0,r,a),spot2:new B(1,1,-r,-a),parameter1:2,fill:t,stroke:i}));return h.mouseEnter=(l,u,c)=>{if(!u.isEnabledObject()||!(u instanceof ct))return;const d=u.findObject("ButtonBorder");d instanceof bt&&(u._buttonFillNormal=d.fill,d.fill=u._buttonFillOver,u._buttonStrokeNormal=d.stroke,d.stroke=u._buttonStrokeOver)},h.mouseLeave=(l,u,c)=>{if(!u.isEnabledObject()||!(u instanceof ct))return;const d=u.findObject("ButtonBorder");d instanceof bt&&(d.fill=u._buttonFillNormal,d.stroke=u._buttonStrokeNormal)},h}),yt.defineBuilder("TreeExpanderButton",e=>{const t=yt.build("Button");return t.attach({_treeExpandedFigure:"MinusLine",_treeCollapsedFigure:"PlusLine",visible:!1}),t.add(new bt("MinusLine",{name:"ButtonIcon",stroke:"#0a0a0a",strokeWidth:2,desiredSize:ut.lu}).bindObject("figure","isTreeExpanded",(i,s)=>{const n=s.panel;return i?n._treeExpandedFigure:n._treeCollapsedFigure})),t.bindObject("visible","isTreeLeaf",i=>!i),t.click=(i,s)=>{let n=s.part;if(n instanceof Mt&&(n=n.adornedPart),!(n instanceof nt))return;const o=n.diagram;if(o===null)return;const r=o.commandHandler;if(n.isTreeExpanded){if(!r.canCollapseTree(n))return}else if(!r.canExpandTree(n))return;i.handled=!0,n.isTreeExpanded?r.collapseTree(n):r.expandTree(n)},t}),yt.defineBuilder("SubGraphExpanderButton",e=>{const t=yt.build("Button");return t.attach({_subGraphExpandedFigure:"MinusLine",_subGraphCollapsedFigure:"PlusLine"}),t.add(new bt("MinusLine",{name:"ButtonIcon",stroke:"#0a0a0a",strokeWidth:2,desiredSize:ut.lu}).bindObject("figure","isSubGraphExpanded",(i,s)=>{const n=s.panel;return i?n._subGraphExpandedFigure:n._subGraphCollapsedFigure})),t.click=(i,s)=>{let n=s.part;if(n instanceof Mt&&(n=n.adornedPart),!(n instanceof at))return;const o=n.diagram;if(o===null)return;const r=o.commandHandler;if(n.isSubGraphExpanded){if(!r.canCollapseSubGraph(n))return}else if(!r.canExpandSubGraph(n))return;i.handled=!0,n.isSubGraphExpanded?r.collapseSubGraph(n):r.expandSubGraph(n)},t}),yt.defineBuilder("ToolTip",e=>new Mt(ct.Auto,{isShadowed:!0,shadowColor:"rgba(0, 0, 0, .4)",shadowOffset:new S(0,2)}).add(new bt("RoundedRectangle",{name:"Border",parameter1:1,fill:"#f5f5f5",strokeWidth:0,spot1:new B(0,0,4,6),spot2:new B(1,1,-4,-4)}))),yt.defineBuilder("ContextMenu",e=>new Mt(ct.Vertical,{background:"#f5f5f5",isShadowed:!0,shadowColor:"rgba(0, 0, 0, .4)",shadowOffset:new S(0,2)}).bindObject("background","",t=>t.adornedPart!==null&&t.hasPlaceholder()?null:"#f5f5f5")),yt.defineBuilder("ContextMenuButton",e=>{const t=yt.build("Button");t.stretch=5;const i=t.findObject("ButtonBorder");return i instanceof bt&&(i.figure="Rectangle",i.strokeWidth=0,i.spot1=new B(0,0,4,6),i.spot2=new B(1,1,-4,-4)),t}),yt.defineBuilder("PanelExpanderButton",e=>{const t=yt.takeBuilderArgument(e,"COLLAPSIBLE"),i=yt.build("Button");i.attach({_buttonExpandedFigure:"M0 0 M0 6 L4 2 8 6 M8 8",_buttonCollapsedFigure:"M0 0 M0 2 L4 6 8 2 M8 8",_buttonFillNormal:"rgba(0, 0, 0, 0)",_buttonStrokeNormal:null,_buttonFillOver:"rgba(0, 0, 0, .2)",_buttonStrokeOver:null}),i.add(new bt({name:"ButtonIcon",strokeWidth:2}).bindObject("geometryString","visible",n=>n?i._buttonExpandedFigure:i._buttonCollapsedFigure,void 0,t));const s=i.findObject("ButtonBorder");return s instanceof bt&&(s.stroke=null,s.fill="rgba(0, 0, 0, 0)"),i.click=(n,o)=>{if(!(o instanceof ct))return;const r=o.diagram;if(r===null||r.isReadOnly)return;let a=o.findBindingPanel();if(a===null&&(a=o.part),a!==null){const h=a.findObject(t);h!==null&&(n.handled=!0,r.startTransaction("Collapse/Expand Panel"),h.visible=!h.visible,r.commitTransaction("Collapse/Expand Panel"))}},i}),yt.defineBuilder("CheckBoxButton",e=>{const t=yt.takeBuilderArgument(e),i=yt.build("Button",{desiredSize:new ut(14,14)});i.attach({"ButtonBorder.spot1":new B(0,0,1,1),"ButtonBorder.spot2":new B(1,1,-1,-1)});const s=new bt({name:"ButtonIcon",geometryString:"M0 0 M0 8.85 L4.9 13.75 16.2 2.45 M16.2 16.2",strokeWidth:2,stretch:2,geometryStretch:6,visible:!1});return t!==""&&s.bindTwoWay("visible",t),i.add(s),i.click=(n,o)=>{if(!(o instanceof ct))return;const r=n.diagram;if(r===null||r.isReadOnly||t!==""&&r.model.isReadOnly)return;n.handled=!0;const a=o.findObject("ButtonIcon");r.startTransaction("checkbox"),a!==null&&(a.visible=!a.visible),typeof o._doClick=="function"&&o._doClick(n,o),r.commitTransaction("checkbox")},i}),yt.defineBuilder("CheckBox",e=>{const t=yt.takeBuilderArgument(e),i=yt.build("CheckBoxButton",{name:"Button",isActionable:!1,margin:new Kt(0,1,0,0)},t),s=new ct("Horizontal",{isActionable:!0,cursor:i.cursor,margin:new Kt(1),mouseEnter:i.mouseEnter,mouseLeave:i.mouseLeave,click:i.click}).attach({_buttonFillNormal:i._buttonFillNormal,_buttonStrokeNormal:i._buttonStrokeNormal,_buttonFillOver:i._buttonFillOver,_buttonStrokeOver:i._buttonStrokeOver,_buttonFillDisabled:i._buttonFillDisabled,_buttonClick:i.click});return s.add(i),i.mouseEnter=null,i.mouseLeave=null,i.click=null,s});let he=yt;class Ri{constructor(){f(this,"gi");f(this,"Mt");f(this,"$n");f(this,"Ai");f(this,"Zn");f(this,"Ks");f(this,"Sl");f(this,"Tr");f(this,"Dr");f(this,"Fr");f(this,"Er");f(this,"Br");f(this,"Rr");f(this,"vr");f(this,"Or");f(this,"U0");f(this,"V0");f(this,"Ir");f(this,"z0");f(this,"X0");f(this,"K0");f(this,"Y0");f(this,"Ur");f(this,"Vr");f(this,"M0");f(this,"v0");f(this,"ys");f(this,"xr");f(this,"br");f(this,"to");f(this,"R0");f(this,"F0");f(this,"wr");f(this,"k0");f(this,"H0");f(this,"q0");this.gi=!1,this.Mt="",this.$n=-1,this.Ai=null,this.Zn=null,this.Ks=null,this.Sl="",this.Tr=null,this.Dr=null,this.Fr=null,this.Er=null,this.Br=null,this.Rr=null,this.vr=null,this.Or=null,this.U0=null,this.V0=null,this.Ir=null,this.z0=null,this.X0=null,this.K0=null,this.Y0=null,this.Ur=null,this.Vr=null,this.M0=null,this.v0=null,this.ys=null,this.xr=ut.ru,this.br=ut.iC,this.to=1,this.R0=1,this.F0=1,this.wr=0,this.k0=null,this.H0=null,this.q0="category"}copy(){const e=new Ri;return e.Mt=this.Mt,e.$n=this.$n,e.Ai=this.Ai,e.Ks=this.Ks,e.Sl=this.Sl,e.Tr=this.Tr,e.Dr=this.Dr,e.Fr=this.Fr,e.Er=this.Er,e.Br=this.Br,e.Rr=this.Rr,e.vr=this.vr,e.Or=this.Or,e.U0=this.U0,e.V0=this.V0,e.Ir=this.Ir,e.z0=this.z0,e.X0=this.X0,e.K0=this.K0,e.Y0=this.Y0,e.Ur=this.Ur,e.Vr=this.Vr,e.M0=this.M0,e.v0=this.v0,e.ys=this.ys,e.xr=this.xr.N(),e.br=this.br.N(),e.to=this.to,e.R0=this.R0,e.F0=this.F0,e.wr=this.wr,e.k0=this.k0,e.H0=this.H0,e.q0=this.q0,e}}class ps{constructor(){f(this,"m");this.m=[1,0,0,1,0,0]}copy(){const e=new ps;return e.m[0]=this.m[0],e.m[1]=this.m[1],e.m[2]=this.m[2],e.m[3]=this.m[3],e.m[4]=this.m[4],e.m[5]=this.m[5],e}translate(e,t){this.m[4]+=this.m[0]*e+this.m[2]*t,this.m[5]+=this.m[1]*e+this.m[3]*t}scale(e,t){this.m[0]*=e,this.m[1]*=e,this.m[2]*=t,this.m[3]*=t}rotate(e,t,i){if(e>=360?e-=360:e<0&&(e+=360),e===0)return;this.translate(t,i);let s=0,n=0;if(e===90)s=0,n=1;else if(e===180)s=-1,n=0;else if(e===270)s=0,n=-1;else{const l=e*Math.PI/180;s=Math.cos(l),n=Math.sin(l)}const o=this.m[0]*s+this.m[2]*n,r=this.m[1]*s+this.m[3]*n,a=this.m[0]*-n+this.m[2]*s,h=this.m[1]*-n+this.m[3]*s;this.m[0]=o,this.m[1]=r,this.m[2]=a,this.m[3]=h,this.translate(-t,-i)}}class rs{constructor(e){f(this,"type");f(this,"x1");f(this,"y1");f(this,"r1");f(this,"x2");f(this,"y2");f(this,"r2");f(this,"colors");f(this,"pattern");this.type=e,this.x1=0,this.y1=0,this.r1=0,this.x2=0,this.y2=0,this.r2=0,this.colors=[],this.pattern=null}addColorStop(e,t){this.colors.push({offset:e,color:t})}}class as{constructor(e,t,i){f(this,"Ft");f(this,"ai");f(this,"aa");f(this,"Gu");f(this,"m2");const s=t===void 0?Z.document:t;this.aa=s,this.m2="http://www.w3.org/2000/svg";const n="http://www.w3.org/2000/xmlns/";s!==void 0&&(this.Ft=this.makeElement("svg",{width:"1px",height:"1px",viewBox:"0 0 1 1"}),this.style.display="block",this.style.letterSpacing="normal",this.style.wordSpacing="normal",i||(this.style.position="absolute"),this.Ft.setAttributeNS(n,"xmlns",this.m2),this.Ft.setAttributeNS(n,"xmlns:xlink","http://www.w3.org/1999/xlink")),this.Gu=null,this.ai=new ze(this,i)}resize(e,t,i,s){return this.width!==e||this.height!==t?(this.width=e,this.height=t,this.style.width=i+"px",this.style.height=s+"px",this.Ft.setAttributeNS(null,"width",i+"px"),this.Ft.setAttributeNS(null,"height",s+"px"),this.Ft.setAttributeNS(null,"viewBox","0 0 "+i+" "+s),this.ai.p2.firstElementChild.setAttributeNS(null,"width",i+"px"),this.ai.p2.firstElementChild.setAttributeNS(null,"height",s+"px"),!0):!1}makeElement(e,t,i){const s=this.aa.createElementNS(this.m2,e);if(b.wt(t))for(const n in t)s.setAttributeNS(n==="href"?"http://www.w3.org/1999/xlink":"",n,t[n]);return i!==void 0&&(s.textContent=i),s}getBoundingClientRect(){return this.Ft.getBoundingClientRect()}focus(){this.Ft.focus()}get width(){return this.Ft.width.baseVal.value}set width(e){this.Ft.setAttribute("width",e+"px")}get height(){return this.Ft.height.baseVal.value}set height(e){this.Ft.setAttribute("height",e+"px")}dispose(){this.aa=null}get style(){return this.Ft.style}}class ze{constructor(e,t){f(this,"nf");f(this,"of");f(this,"xn");f(this,"Ti");f(this,"Ke");f(this,"fillStyle");f(this,"font");f(this,"globalAlpha");f(this,"lineCap");f(this,"lineDashOffset");f(this,"lineJoin");f(this,"lineWidth");f(this,"miterLimit");f(this,"shadowBlur");f(this,"shadowColor");f(this,"shadowOffsetX");f(this,"shadowOffsetY");f(this,"strokeStyle");f(this,"textAlign");f(this,"imageSmoothingEnabled");f(this,"clipInsteadOfFill");f(this,"lastCreatedElement");f(this,"rf");f(this,"lf");f(this,"surface");f(this,"svg");f(this,"p2");f(this,"cA");f(this,"Vb");f(this,"Xo");f(this,"dh");f(this,"ka");f(this,"currentElement");f(this,"clipPathGroup");f(this,"diagramGroup");f(this,"lastDrawnPart");f(this,"currentPath");f(this,"outerGroup");f(this,"pathAttributes");f(this,"tl");f(this,"Mr");f(this,"filter");f(this,"partClipRect");this.surface=e,this.svg=e.Ft,this.rf=[],this.lf=[],this.fillStyle="#000000",this.font="10px sans-serif",this.globalAlpha=1,this.lineCap="butt",this.lineDashOffset=0,this.lineJoin="miter",this.lineWidth=1,this.miterLimit=10,this.shadowBlur=0,this.shadowColor="rgba(0, 0, 0, 0)",this.shadowOffsetX=0,this.shadowOffsetY=0,this.tl=!1,this.strokeStyle="#000000",this.textAlign="start",this.clipInsteadOfFill=!1,this.nf=0,this.of=0,this.xn=0,this.lastCreatedElement=null,this.currentElement=null,this.Ti=[],this.pathAttributes={},this.Vb=!1,this.Xo=null,this.dh=0,this.Ke=new ps,this.clipPathGroup=this.newGroup2(),this.diagramGroup=this.newGroup2("gojs-diagram"),this.lastDrawnPart=null,this.currentPath=null;const i=K.su++,s=this.makeElement("clipPath",{id:"mainClip"+i}),n={x:0,y:0,width:e.width,height:e.height};s.appendChild(this.makeElement("rect",n)),this.p2=s,this.svg.appendChild(this.clipPathGroup),this.clipPathGroup.appendChild(this.diagramGroup),this.svg.appendChild(s),this.clipPathGroup.setAttributeNS(null,"clip-path","url(#mainClip"+i+")"),this.cA={},this.Mr=!!t,this.filter="",this.partClipRect=null}setDiagramPosScale(e,t,i,s,n,o){this.diagramGroup===void 0?this.newGroup(e,t,i,s,n,o):this.diagramGroup.setAttribute("transform","matrix("+e+", "+t+", "+i+", "+s+", "+n+", "+o+")")}resetInnerSVG(){this.diagramGroup!==null&&(this.diagramGroup.innerHTML="")}arc(e,t,i,s,n,o,r,a){const h=2*Math.PI,l=1e-6,u=h-l,c=i*Math.cos(s),d=i*Math.sin(s),m=e+c,g=t+d,p=o?0:1;let y=o?s-n:n-s;(Math.abs(r-m)>l||Math.abs(a-g)>l)&&this.Ti.push(["L",m,+g]),y<0&&(y=y%h+h),y>u?(this.Ti.push(["A",i,i,0,1,p,e-c,t-d]),this.Ti.push(["A",i,i,0,1,p,m,g])):y>l&&this.Ti.push(["A",i,i,0,+(y>=Math.PI),p,e+i*Math.cos(n),t+i*Math.sin(n)])}beginPath(){this.Ti=[],this.pathAttributes={stroke:"none",fill:"none"}}endPath(e){this.BR(this.Ti,this.Ke,e||0)}bezierCurveTo(e,t,i,s,n,o){this.Ti.push(["C",e,t,i,s,n,o])}clearRect(e,t,i,s){}clip(){this.pathAttributes.clipPath=!0}closePath(){this.Ti.push(["z"])}createLinearGradient(e,t,i,s){const n=new rs("linear");return n.x1=e,n.y1=t,n.x2=i,n.y2=s,n}createPattern(e,t){let i="";e instanceof HTMLCanvasElement&&(i=e.toDataURL()),e instanceof HTMLImageElement&&(i=e.getAttribute("src"));const s=this.cA;if(s[i])return"url(#"+s[i]+")";const n="PATTERN"+K.su++,o={width:e.width,height:e.height,id:n,patternUnits:"userSpaceOnUse"},r={x:0,y:0,width:e.width,height:e.height,href:i},a=this.makeElement("pattern",o);return a.appendChild(this.makeElement(At.img,r)),this.svg.appendChild(a),s[i]=n,"url(#"+n+")"}createRadialGradient(e,t,i,s,n,o){const r=new rs("radial");return r.x1=e,r.y1=t,r.r1=i,r.x2=s,r.y2=n,r.r2=o,r}amendImageTransform(e,t,i,s,n,o,r,a){const h=r/i,l=a/s;(n!==0||o!==0)&&this.Ke.translate(n,o),(h!==1||l!==1)&&this.Ke.scale(h,l),(e!==0||t!==0)&&this.Ke.translate(-e,-t)}drawImage(e,t,i,s,n,o,r,a,h){let l="";e instanceof HTMLCanvasElement&&(l=e.toDataURL()),e instanceof HTMLImageElement&&(l=e.getAttribute("src"));const u=e instanceof HTMLImageElement?e.naturalWidth:e.width,c=e instanceof HTMLImageElement?e.naturalHeight:e.height;s===void 0&&(o=t,r=i,a=s=u,h=n=c),s=s||0,n=n||0,o=o||0,r=r||0,a=a||0,h=h||0,this.amendImageTransform(t,i,s,n,o,r,a,h);const d={x:0,y:0,width:u||s,height:c||n,href:l};!A.K(s,a)||!A.K(n,h)?d.preserveAspectRatio="none":l.toLowerCase().indexOf(".svg")===-1&&l.toLowerCase().indexOf("data:image/svg")===-1&&(d.preserveAspectRatio="xMidYMid slice"),(t!==0||i!==0||s!==u||n!==c)&&(s+=t,n+=i,d["clip-path"]=`path('M ${t},${i} L ${s} ${i} L ${s} ${n} L ${t} ${n} z')`),this.processCommon(At.img,d,this.Ke),this.od(At.img,d)}fill(e,t){e&&(this.pathAttributes["fill-rule"]="evenodd"),this.setFill(this.pathAttributes)}fillContext(e,t,i){this.clipInsteadOfFill?this.clip():this.fill(t,i)}createOrUpdateClipGroup(e,t){const i=this.newGroup(1,0,0,1,-t.x,-t.y);i.setAttributeNS(null,"class","spotClip"),e.rh=i}fillRect(e,t,i,s){this.addRect("fill",[e,t,i,s],this.Ke)}fillBackground(e,t,i,s){const n={x:e,y:t,width:i,height:s};this.processCommon("fill",n,this.Ke),this.setFill(n),this.svg.prepend(this.makeElement("rect",n))}fillText(e,t,i){this.addText("fill",[e,t,i],this.Ke)}lineTo(e,t){this.Ti.push(["L",e,t])}moveTo(e,t){this.Ti.push(["M",e,t])}quadraticCurveTo(e,t,i,s){this.Ti.push(["Q",e,t,i,s])}rect(e,t,i,s){this.Ti.push(["M",e,t],["L",e+i,t],["L",e+i,t+s],["L",e,t+s],["z"])}restore(){this.Ke=this.rf.pop(),this.Ti=this.rf.pop();const e=this.rf.pop();this.fillStyle=e.fillStyle,this.font=e.font,this.globalAlpha=e.globalAlpha,this.lineCap=e.lineCap,this.lineDashOffset=e.lineDashOffset,this.lineJoin=e.lineJoin,this.lineWidth=e.lineWidth,this.miterLimit=e.miterLimit,this.shadowBlur=e.shadowBlur,this.shadowColor=e.shadowColor,this.shadowOffsetX=e.shadowOffsetX,this.shadowOffsetY=e.shadowOffsetY,this.strokeStyle=e.strokeStyle,this.textAlign=e.textAlign,this.partClipRect=e.partClipRect}save(){const e={fillStyle:this.fillStyle,font:this.font,globalAlpha:this.globalAlpha,lineCap:this.lineCap,lineDashOffset:this.lineDashOffset,lineJoin:this.lineJoin,lineWidth:this.lineWidth,miterLimit:this.miterLimit,shadowBlur:this.shadowBlur,shadowColor:this.shadowColor,shadowOffsetX:this.shadowOffsetX,shadowOffsetY:this.shadowOffsetY,strokeStyle:this.strokeStyle,textAlign:this.textAlign,partClipRect:this.partClipRect};this.rf.push(e);const t=[];for(let i=0;i<this.Ti.length;i++)t.push(this.Ti[i]);this.rf.push(t),this.rf.push(this.Ke.copy())}setTransform(e,t,i,s,n,o){e===1&&t===0&&i===0&&s===1&&n===0&&o===0||this.newGroup(e,t,i,s,n,o)}setCurrentTransform(e,t,i,s,n,o){this.Ke.m=[e,t,i,s,n,o]}getCurrentTransform(){const e=this.Ke.m;return"matrix("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}scale(e,t){this.Ke.scale(e,t)}translate(e,t){this.Ke.translate(e,t)}transform(e,t,i,s,n,o){}commitTransform(){}stroke(){this.setStroke(this.pathAttributes)}strokeContext(){this.clipInsteadOfFill||this.stroke()}strokeRect(e,t,i,s){this.addRect("stroke",[e,t,i,s],this.Ke)}makeElement(e,t,i){return this.surface.makeElement(e,t,i)}od(e,t,i){const s=this.makeElement(e,t,i);return this.currentElement!==null?this.currentElement.appendChild(s):this.currentElement=s,this.lastCreatedElement=s,s}processCommon(e,t,i){if(e==="fill"?this.setFill(t):e==="stroke"&&this.setStroke(t),i!==null){const s=i.m;t.transform="matrix("+s[0]+", "+s[1]+", "+s[2]+", "+s[3]+", "+s[4]+", "+s[5]+")"}}setFill(e){if(this.fillStyle instanceof rs){e.fill=this.addGradient(this.fillStyle,!0);return}if(/^rgba\(/.test(this.fillStyle)){const t=/^\s*rgba\s*\(([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\)\s*$/i.exec(this.fillStyle);e.fill="rgb("+t[1]+","+t[2]+","+t[3]+")",e["fill-opacity"]=t[4]}else e.fill=this.fillStyle}setFillOrStrokeInPlace(e,t){const i=t?"fill":"stroke";if(this.fillStyle instanceof rs){e.setAttributeNS(null,"fill",this.addGradient(this.fillStyle,!0));return}if(/^rgba\(/.test(this.fillStyle)){const s=/^\s*rgba\s*\(([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\)\s*$/i.exec(this.fillStyle);e.setAttributeNS(null,i,"rgb("+s[1]+","+s[2]+","+s[3]+")"),e.setAttributeNS(null,i+"-opacity",s[4])}else e.setAttributeNS(null,i,this.fillStyle)}setStroke(e){if(this.strokeStyle instanceof rs)e.stroke=this.addGradient(this.strokeStyle,!1);else if(/^rgba\(/.test(this.strokeStyle)){const t=/^\s*rgba\s*\(([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\)\s*$/i.exec(this.strokeStyle);e.stroke="rgb("+t[1]+","+t[2]+","+t[3]+")",e["stroke-opacity"]=t[4]}else e.stroke=this.strokeStyle;e["stroke-width"]=this.lineWidth,e["stroke-linecap"]=this.lineCap,e["stroke-linejoin"]=this.lineJoin,e["stroke-miterlimit"]=this.miterLimit,this.Vb&&(e["stroke-dasharray"]=this.Xo.toString(),e["stroke-dashoffset"]=this.dh)}addGradient(e,t){let i="";const s=this.currentPath!==null?this.currentPath.getAttribute(t?"fill":"stroke"):null;if(s!==null&&s.indexOf("GRAD")!==-1){i=s.split("#")[1].slice(0,-1);const h=this.svg.getElementById(i);h!==null&&h.remove()}else i="GRAD"+K.su++;let n;if(e.type==="linear"){const h={x1:e.x1,x2:e.x2,y1:e.y1,y2:e.y2,id:i,gradientUnits:"userSpaceOnUse"};n=this.makeElement("linearGradient",h)}else if(e.type==="radial"){const h={x1:e.x1,x2:e.x2,y1:e.y1,y2:e.y2,r1:e.r1,r2:e.r2,id:i};n=this.makeElement("radialGradient",h)}else throw new Error("invalid gradient");const o=e.colors,r=o.length,a=[];for(let h=0;h<r;h++){const l=o[h],u=l.color,c={offset:l.offset,"stop-color":u};if(/^rgba\(/.test(u)){const d=/^\s*rgba\s*\(([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\)\s*$/i.exec(u);c["stop-color"]="rgb("+d[1]+","+d[2]+","+d[3]+")",c["stop-opacity"]=d[4]}a.push(c)}a.sort((h,l)=>h.offset>l.offset?1:-1);for(let h=0;h<r;h++)n.appendChild(this.makeElement("stop",a[h]));return this.svg.appendChild(n),"url(#"+i+")"}addRect(e,t,i){const s={x:t[0],y:t[1],width:t[2],height:t[3]};this.processCommon(e,s,i),this.od("rect",s)}addText(e,t,i){let s=this.textAlign;s==="left"?s="start":s==="right"?s="end":s==="center"&&(s="middle");const n={x:t[1],y:t[2],style:"font: "+this.font,"text-anchor":s};this.processCommon(e,n,i),this.od("text",n,t[0])}BR(e,t,i){const s=this.UR(e),n=this.pathAttributes;if(n.clipPath){this.lf.length>1&&this.lf[this.lf.length-2].setAttributeNS(null,"clip-path",'path("'+s+'") view-box');return}if(n.d=s,this.processCommon("",n,t),this.currentPath!==null){const o=this.currentPath;if(o.nodeName!=="g")for(const r in n)r!=="transform"&&o.setAttributeNS(null,r,n[r]);else{const r=o.getElementsByTagName("path");for(const a in n)a!=="transform"&&r[i].setAttributeNS(null,a,n[a])}}else this.od("path",n)}TR(e){const t=e.getAttribute("clip-path");return t===null?null:this.svg.getElementById(t.split("#")[1].slice(0,-1))}rA(e){const t=e.getAttribute("clip-path");if(t===null)return;const i=this.svg.getElementById(t.split("#")[1].slice(0,-1));i!==null&&i.remove()}UR(e){const t=[];for(let i=0;i<e.length;i++){const s=e[i].slice(),n=[s.shift()];if(n[0]==="A")n.push(s.shift()+","+s.shift(),s.shift(),s.shift()+","+s.shift(),s.shift()+","+s.shift());else for(;s.length;)n.push(s.shift()+","+s.shift());t.push(n.join(" "))}return t.join(" ")}newGroup(e,t,i,s,n,o){const r=new ps;r.m=[e,t,i,s,n,o];const a={};this.processCommon("g",a,r);const h=this.od("g",a);return this.lf.push(h),h}newGroup2(e){const t={};e&&(t.class=e);const i=this.od("g",t);return this.lf.push(i),i}endGroup(){return this.lf.pop()}dummyGroup(){return this.newGroup2(),this.endGroup()}shadowsSet(e,t,i){this.nf=e,this.of=t,this.xn=i}shadowsOff(){this.tl=!1,this.shadowOffsetX=0,this.shadowOffsetY=0,this.shadowBlur=0}shadowsOn(){this.tl=!0,this.shadowOffsetX=this.nf,this.shadowOffsetY=this.of,this.shadowBlur=this.xn}enableDash(e,t){this.Vb=!0,this.Xo=e,this.dh=t}disableDash(){this.Vb=!1}clearContextCache(e){}setImageSmoothingEnabled(e){}rotate(e){this.Ke.rotate(e*57.2958,0,0)}getImageData(e,t,i,s){return null}measureText(e){return null}removeOldGradient(e,t,i){const s=t.getAttribute(i);if(s===null)return;const n=s.split("#");if(n.length===1)return;const o=this.svg.getElementById(n[1].slice(0,-1));if(o!==null){const r=new RegExp(o.id,"g");this.svg.innerHTML.match(r).length===1&&o.remove()}}removePartFromView(e){e.svg!==null&&e.svg.parentNode===this.diagramGroup&&e.svg.remove()}}class Pi{constructor(e,t,i,s){f(this,"Ft");f(this,"ai");f(this,"aa");f(this,"Gu");const n=t===void 0?Z.document:t;this.aa=n,this.Gu=null;const o=n.createElement("canvas");o.tabIndex=0,this.Ft=o,this.ai=new hs(o,i,s),At.Ve.set(o,e)}resize(e,t,i,s){return this.width!==e||this.height!==t?(this.width=e,this.height=t,this.style.width=i+"px",this.style.height=s+"px",!0):!1}toDataURL(e,t){return this.Ft.toDataURL(e,t)}getBoundingClientRect(){return this.Ft.getBoundingClientRect()}focus(){this.Ft.focus()}get width(){return this.Ft.width}set width(e){this.Ft.width=e}get height(){return this.Ft.height}set height(e){this.Ft.height=e}dispose(){At.Ve.delete(this.Ft),this.aa=null}get style(){return this.Ft.style}}const ks=class ks{constructor(e,t,i){f(this,"U");f(this,"zb");f(this,"Xb");f(this,"Kb");f(this,"clipInsteadOfFill");f(this,"nf");f(this,"of");f(this,"xn");f(this,"ka");f(this,"tl");f(this,"Mr");this.U=e.getContext?e.getContext("2d",t):null,this.U===null&&b.o("Browser does not support HTML Canvas Element"),this.zb="",this.Xb="",this.Kb="",this.clipInsteadOfFill=!1,this.nf=0,this.of=0,this.xn=0,this.tl=!1,this.ka=new Tt,this.Mr=!!i}createOrUpdateClipGroup(e,t){}setImageSmoothingEnabled(e){this.U.imageSmoothingEnabled=e}get fillStyle(){return this.U.fillStyle}set fillStyle(e){this.Kb!==e&&(this.U.fillStyle=e,this.Kb=e)}get font(){return this.U.font}set font(e){this.zb!==e&&(this.U.font=e,this.zb=e)}get globalAlpha(){return this.U.globalAlpha}set globalAlpha(e){this.U.globalAlpha=e}get lineCap(){return this.U.lineCap}set lineCap(e){this.U.lineCap=e}get lineDashOffset(){return this.U.lineDashOffset}set lineDashOffset(e){this.U.lineDashOffset=e}get lineJoin(){return this.U.lineJoin}set lineJoin(e){this.U.lineJoin=e}get lineWidth(){return this.U.lineWidth}set lineWidth(e){this.U.lineWidth=e}get miterLimit(){return this.U.miterLimit}set miterLimit(e){this.U.miterLimit=e}get shadowBlur(){return this.U.shadowBlur}set shadowBlur(e){this.U.shadowBlur=e}get shadowColor(){return this.U.shadowColor}set shadowColor(e){this.U.shadowColor=e}get shadowOffsetX(){return this.U.shadowOffsetX}set shadowOffsetX(e){this.U.shadowOffsetX=e}get shadowOffsetY(){return this.U.shadowOffsetY}set shadowOffsetY(e){this.U.shadowOffsetY=e}get strokeStyle(){return this.U.strokeStyle}set strokeStyle(e){this.Xb!==e&&(this.U.strokeStyle=e,this.Xb=e)}get textAlign(){return this.U.textAlign}set textAlign(e){this.U.textAlign=e}get imageSmoothingEnabled(){return this.U.imageSmoothingEnabled}set imageSmoothingEnabled(e){this.U.imageSmoothingEnabled=e}get filter(){return this.U.filter}set filter(e){e===""?this.U.filter="none":this.U.filter=e}arc(e,t,i,s,n,o,r,a){this.U.arc(e,t,i,s,n,o)}beginPath(){this.U.beginPath()}endPath(){}bezierCurveTo(e,t,i,s,n,o){this.U.bezierCurveTo(e,t,i,s,n,o)}clearRect(e,t,i,s){this.commitTransform(),this.U.clearRect(e,t,i,s)}clip(e){e?this.U.clip(e):this.U.clip()}closePath(){this.U.closePath()}createLinearGradient(e,t,i,s){return this.U.createLinearGradient(e,t,i,s)}createPattern(e,t){return this.U.createPattern(e,t)}createRadialGradient(e,t,i,s,n,o){return this.U.createRadialGradient(e,t,i,s,n,o)}drawImage(e,t,i,s,n,o,r,a,h){s===void 0?this.U.drawImage(e,t,i):this.U.drawImage(e,t,i,s,n,o,r,a,h)}fill(e,t){t?this.U.fill(t,e?"evenodd":"nonzero"):this.U.fill(e?"evenodd":"nonzero")}fillRect(e,t,i,s){this.U.fillRect(e,t,i,s)}fillBackground(e,t,i,s){this.U.fillRect(e,t,i,s)}fillText(e,t,i){this.U.fillText(e,t,i)}getImageData(e,t,i,s){return this.U.getImageData(e,t,i,s)}lineTo(e,t){this.U.lineTo(e,t)}measureText(e){return this.U.measureText(e)}moveTo(e,t){this.U.moveTo(e,t)}quadraticCurveTo(e,t,i,s){this.U.quadraticCurveTo(e,t,i,s)}rect(e,t,i,s){this.U.rect(e,t,i,s)}restore(){this.U.restore()}save(){this.commitTransform(),this.U.save()}rotate(e){this.ka.cs(e*57.2958,0,0)}setTransform(e,t,i,s,n,o){this.ka.setTo(e,t,i,s,n,o)}scale(e,t){this.ka.et(e,t)}translate(e,t){this.ka.Ds(e,t)}stroke(e){e?this.U.stroke(e):this.U.stroke()}transform(e,t,i,s,n,o){if(e===1&&t===0&&i===0&&s===1&&n===0&&o===0)return;const r=this.ka,a=r.m11*e+r.m21*t,h=r.m12*e+r.m22*t,l=r.m11*i+r.m21*s,u=r.m12*i+r.m22*s;r.dx=r.m11*n+r.m21*o+r.dx,r.dy=r.m12*n+r.m22*o+r.dy,r.m11=a,r.m12=h,r.m21=l,r.m22=u}commitTransform(){const e=this.ka;this.U.setTransform(e.m11,e.m12,e.m21,e.m22,e.dx,e.dy)}fillContext(e,t,i){this.radialFill(e,t,i)||this.fillOrClip(t,i)}radialFill(e,t,i){if(!(e instanceof jt)||e.type!==3)return!1;const s=e._c,n=e.Eb;return n>s?(this.scale(s/n,1),this.translate((n-s)/2,0)):s>n&&(this.scale(1,n/s),this.translate(0,(s-n)/2)),this.fillOrClip(t,i),n>s?(this.translate(-(n-s)/2,0),this.scale(1/(s/n),1)):s>n&&(this.translate(0,-(s-n)/2),this.scale(1,1/(n/s))),!0}strokeContext(){this.clipInsteadOfFill||this.stroke()}fillOrClip(e,t){this.clipInsteadOfFill?this.clip(t):this.fill(e,t)}shadowsSet(e,t,i){this.nf=e,this.of=t,this.xn=i}shadowsOff(){this.tl=!1,this.shadowOffsetX=0,this.shadowOffsetY=0,this.shadowBlur=0}shadowsOn(){this.tl=!0,this.shadowOffsetX=this.nf,this.shadowOffsetY=this.of,this.shadowBlur=this.xn}enableDash(e,t){const i=this.U;i.setLineDash!==void 0&&(i.setLineDash(e),i.lineDashOffset=t)}disableDash(){const e=this.U;e.setLineDash!==void 0&&(e.setLineDash(ks.EmptyArray),e.lineDashOffset=0)}clearContextCache(e){e&&(this.zb=""),this.Xb="",this.Kb=""}removePartFromView(e){}};f(ks,"EmptyArray",Object.freeze([]));let hs=ks;var Bi=(v=>(v[v.Solid=1]="Solid",v[v.Linear=2]="Linear",v[v.Radial=3]="Radial",v[v.Pattern=4]="Pattern",v))(Bi||{}),un=(v=>(v[v.Lab=1]="Lab",v[v.HSL=2]="HSL",v[v.Oklch=3]="Oklch",v))(un||{});class Yi{constructor(){f(this,"n0");f(this,"n1");f(this,"n2");f(this,"n3");this.n0=0,this.n1=0,this.n2=0,this.n3=0}}const E=class E{constructor(e,t){f(this,"h");f(this,"$");f(this,"Pa");f(this,"si");f(this,"gs");f(this,"W0");f(this,"J0");f(this,"bn");f(this,"$0");f(this,"yn");f(this,"_c");f(this,"Eb");if(K.Yi(this),this.h=!1,e===void 0)this.$=1,this.Pa="black";else if(typeof e=="string"){const s=b.Ih(Bi,e);s!==null?(this.$=s,this.Pa="black"):(this.$=1,this.Pa=e)}else this.$=e,this.Pa="black";const i=this.$;if(i===2?(this.si=B.TopCenter,this.gs=B.BottomCenter):i===3?(this.si=B.Center,this.gs=B.Center):(this.si=B.None,this.gs=B.None),this.W0=0,this.J0=NaN,this.bn=null,this.$0=null,this.yn=null,this._c=0,this.Eb=0,t){const s={};for(const n in t)isFinite(parseFloat(n))?this.addColorStop(parseFloat(n),t[n]):s[n]=t[n];Object.assign(this,s)}}copy(){const e=new E;return e.$=this.$,e.Pa=this.Pa,e.si=this.si.N(),e.gs=this.gs.N(),e.W0=this.W0,e.J0=this.J0,this.bn!==null&&(e.bn=this.bn.copy()),e.$0=this.$0,e}g(){return this.h=!0,this.bn!==null&&this.bn.g(),this}ot(){return Object.isFrozen(this)&&b.o("cannot thaw constant: "+this),this.h=!1,this.bn!==null&&this.bn.ot(),this}ri(e){e in Bi?this.type=e:b.lr(this,e)}toString(){let e="Brush(";if(this.type===1)e+=this.color;else if(this.type===2?e+="Linear ":this.type===3?e+="Radial ":this.type===4?e+="Pattern ":e+="(unknown) ",e+=this.start+" "+this.end,this.colorStops!==null){const t=this.colorStops.iterator;for(;t.next();){const i=t.key,s=t.value;e+=" "+i+":"+s}}return e+=")",e}addColorStop(e,t){return this.h&&b.T(this),(typeof e!="number"||!isFinite(e)||e>1||e<0)&&b._(e,"0 <= loc <= 1",E,"addColorStop:loc"),b.i(t,"string",E,"addColorStop:color"),this.bn===null&&(this.bn=new St),this.bn.set(e,t),this.$===1&&(this.type=2),this.yn=null,this}get type(){return this.$}set type(e){this.h&&b.T(this,e),this.$=e,this.start.isNoSpot()&&(e===2?this.start=B.TopCenter:e===3&&(this.start=B.Center)),this.end.isNoSpot()&&(e===2?this.end=B.BottomCenter:e===3&&(this.end=B.Center)),this.yn=null}get color(){return this.Pa}set color(e){this.h&&b.T(this,e),this.Pa=e,this.yn=null}get start(){return this.si}set start(e){this.h&&b.T(this,e),this.si=e.N(),this.yn=null}get end(){return this.gs}set end(e){this.h&&b.T(this,e),this.gs=e.N(),this.yn=null}get startRadius(){return this.W0}set startRadius(e){this.h&&b.T(this,e),e<0&&b._(e,">= zero",E,"startRadius"),this.W0=e,this.yn=null}get endRadius(){return this.J0}set endRadius(e){this.h&&b.T(this,e),e<0&&b._(e,">= zero",E,"endRadius"),this.J0=e,this.yn=null}get colorStops(){return this.bn}set colorStops(e){this.h&&b.T(this,e),this.bn=e,this.yn=null}get pattern(){return this.$0}set pattern(e){this.h&&b.T(this,e),this.$0=e,this.yn=null}static randomColor(e,t){e===void 0&&(e=128),t===void 0&&(t=Math.max(e,255));const i=Math.abs(t-e);let s=Math.floor(e+Math.random()*i).toString(16),n=Math.floor(e+Math.random()*i).toString(16),o=Math.floor(e+Math.random()*i).toString(16);return s.length<2&&(s="0"+s),n.length<2&&(n="0"+n),o.length<2&&(o="0"+o),"#"+s+n+o}static isValidColor(e){return Z.CSS?Z.CSS.supports("color",e):!0}static lighten(e){return E.lightenBy(e)}lightenBy(e,t){this.h&&b.T(this);const i=e===void 0||typeof e!="number"?.2:e,s=t===void 0?3:t;if(this.type===1)E.Do(this.color),this.color=E.rd(i,s);else if((this.type===2||this.type===3)&&this.colorStops!==null){const n=this.colorStops.iterator;for(;n.next();)E.Do(n.value),this.addColorStop(n.key,E.rd(i,s))}return this}static lightenBy(e,t,i){const s=t===void 0||typeof t!="number"?.2:t,n=i===void 0?3:i;return E.Do(e),E.rd(s,n)}static darken(e){return E.darkenBy(e)}darkenBy(e,t){this.h&&b.T(this);const i=e===void 0||typeof e!="number"?.2:e,s=t===void 0?3:t;if(this.type===1)E.Do(this.color),this.color=E.rd(-i,s);else if((this.type===2||this.type===3)&&this.colorStops!==null){const n=this.colorStops.iterator;for(;n.next();)E.Do(n.value),this.addColorStop(n.key,E.rd(-i,s))}return this}static darkenBy(e,t,i){const s=t===void 0||typeof t!="number"?.2:t,n=i===void 0?3:i;return E.Do(e),E.rd(-s,n)}static mix(e,t,i){E.Do(e);const s=E.G.n0,n=E.G.n1,o=E.G.n2,r=E.G.n3;E.Do(t),i===void 0&&(i=.5);const a=Math.round((E.G.n0-s)*i+s),h=Math.round((E.G.n1-n)*i+n),l=Math.round((E.G.n2-o)*i+o),u=Math.round((E.G.n3-r)*i+r);return`rgba(${a}, ${h}, ${l}, ${u})`}isDark(){if(this.type===1)return E.isDark(this.color);if((this.type===2||this.type===3)&&this.colorStops!==null){const e=this.colorStops;if(this.type===3)return E.isDark(e.first().value);if(e.get(.5)!==null)return E.isDark(e.get(.5));if(e.count===2){const a=e.toArray();return E.isDark(E.mix(a[0].value,a[1].value))}const t=e.iterator;let i=-1,s=-1,n=1,o=1;for(;t.next();){const a=t.key,h=Math.abs(.5-t.key);n>o&&h<n?(i=a,n=h):o>=n&&h<o&&(s=a,o=h)}if(i>s){let a=i;i=s,s=a,a=n,n=o,o=a}const r=s-i;return E.isDark(E.mix(e.get(i),e.get(s),1-o/r))}return!1}static isDark(e){return e?e instanceof E?e.isDark():(E.Do(e),(299*E.G.n0+587*E.G.n1+114*E.G.n2)/1e3<128):!1}static rd(e,t){switch(t){case 1:return E.VR(),E.io.n0=Math.min(100,Math.max(0,E.io.n0+100*e)),E.zR(),"rgba("+E.G.n0+", "+E.G.n1+", "+E.G.n2+", "+E.G.n3+")";case 2:return E.OS(),E.Ii.n2=Math.min(100,Math.max(0,E.Ii.n2+100*e)),"hsla("+E.Ii.n0+", "+E.Ii.n1+"%, "+E.Ii.n2+"%, "+E.Ii.n3+")";case 3:return E.XR(),E.eo.n0=Math.min(100,Math.max(0,E.eo.n0+100*e)),E.KR(),"rgba("+E.G.n0+", "+E.G.n1+", "+E.G.n2+", "+E.G.n3+")";default:b.o("Unknown color space: "+t)}}static Do(e){const t=E.il;if(t===null)return;t.clearRect(0,0,1,1),t.fillStyle="#000000";const i=t.fillStyle;if(t.fillStyle=e,t.fillStyle!==i){t.fillRect(0,0,1,1);const s=t.getImageData(0,0,1,1).data;E.G.n0=s[0],E.G.n1=s[1],E.G.n2=s[2],E.G.n3=s[3]/255}else t.fillStyle="#FFFFFF",t.fillStyle,t.fillStyle=e,t.fillStyle,E.G.n0=0,E.G.n1=0,E.G.n2=0,E.G.n3=1}static OS(){const e=E.G.n0/255,t=E.G.n1/255,i=E.G.n2/255,s=Math.max(e,t,i),n=Math.min(e,t,i),o=s-n;let r,a;const h=(s+n)/2;if(o===0)r=a=0;else{switch(s){case e:r=(t-i)/o%6;break;case t:r=(i-e)/o+2;break;case i:r=(e-t)/o+4;break}r*=60,r<0&&(r+=360),a=o/(1-Math.abs(2*h-1))}E.Ii.n0=Math.round(r),E.Ii.n1=Math.round(a*100),E.Ii.n2=Math.round(h*100),E.Ii.n3=E.G.n3}static uE(){const e=E.Ii.n0,t=E.Ii.n1/100,i=E.Ii.n2/100;let s,n,o;const r=(1-Math.abs(2*i-1))*t,a=e/60,h=r*(1-Math.abs(a%2-1));a>=0&&a<1?(s=r,n=h,o=0):a>=1&&a<2?(s=h,n=r,o=0):a>=2&&a<3?(s=0,n=r,o=h):a>=3&&a<4?(s=0,n=h,o=r):a>=4&&a<5?(s=h,n=0,o=r):a>=5&&a<6&&(s=r,n=0,o=h);const l=i-.5*r;s+=l,n+=l,o+=l,E.G.n0=Math.round(s*255),E.G.n1=Math.round(n*255),E.G.n2=Math.round(o*255),E.G.n3=E.Ii.n3}static VR(){E.fA(),E.YR()}static zR(){E.GR(),E.uA()}static w2(e){return e/=255,e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}static b2(e){return e<=.0031308?e*12.92:1.055*Math.pow(e,1/2.4)-.055}static fA(){const e=E.w2(E.G.n0),t=E.w2(E.G.n1),i=E.w2(E.G.n2);E.Rt.n0=.4124564*e+.3575761*t+.1804375*i,E.Rt.n1=.2126729*e+.7151522*t+.072175*i,E.Rt.n2=.0193339*e+.119192*t+.9503041*i,E.Rt.n3=E.G.n3}static uA(){const e=3.2404542*E.Rt.n0+-1.5371385*E.Rt.n1+-.4985314*E.Rt.n2,t=-.969266*E.Rt.n0+1.8760108*E.Rt.n1+.041556*E.Rt.n2,i=.0556434*E.Rt.n0+-.2040259*E.Rt.n1+1.0572252*E.Rt.n2;E.G.n0=E.b2(e)*255,E.G.n1=E.b2(t)*255,E.G.n2=E.b2(i)*255,E.G.n3=E.Rt.n3,E.G.n0=Math.round(E.G.n0),E.G.n0>255?E.G.n0=255:E.G.n0<0&&(E.G.n0=0),E.G.n1=Math.round(E.G.n1),E.G.n1>255?E.G.n1=255:E.G.n1<0&&(E.G.n1=0),E.G.n2=Math.round(E.G.n2),E.G.n2>255?E.G.n2=255:E.G.n2<0&&(E.G.n2=0)}static P2(e){return e>E.k2?Math.pow(e,1/3):(E.Yb*e+16)/116}static YR(){const e=E.P2(E.Rt.n0*100/E.ld[0]),t=E.P2(E.Rt.n1*100/E.ld[1]),i=E.P2(E.Rt.n2*100/E.ld[2]);E.io.n0=116*t-16,E.io.n1=500*(e-t),E.io.n2=200*(t-i),E.io.n3=E.Rt.n3}static dA(e){const t=e*e*e;return t>E.k2?t:(116*e-16)/E.Yb}static GR(){const e=(E.io.n0+16)/116,t=E.io.n1/500+e,i=e-E.io.n2/200;E.Rt.n0=E.ld[0]/100*E.dA(t),E.Rt.n1=E.ld[1]/100*(E.io.n0>E.Yb*E.k2?Math.pow(e,3):E.io.n0/E.Yb),E.Rt.n2=E.ld[2]/100*E.dA(i),E.Rt.n3=E.io.n3}static jR(){let e=.8190224*E.Rt.n0+.3619062*E.Rt.n1+-.1288737*E.Rt.n2,t=.03298366*E.Rt.n0+.9292868*E.Rt.n1+.03614466*E.Rt.n2,i=.04817719*E.Rt.n0+.2642395*E.Rt.n1+.6335478*E.Rt.n2;e=Math.cbrt(e),t=Math.cbrt(t),i=Math.cbrt(i),E.ci.n0=.2104542*e+.7936177*t+-.004072046*i,E.ci.n1=1.977998*e+-2.428592*t+.4505937*i,E.ci.n2=.02590403*e+.7827717*t+-.8086757*i,E.ci.n3=E.Rt.n3,E.ci.n0*=100}static HR(){E.ci.n0/=100;let e=.9999999*E.ci.n0+.3963377*E.ci.n1+.2158037*E.ci.n2,t=1.000000009*E.ci.n0+-.1055613*E.ci.n1+-.06385417*E.ci.n2,i=1.00000005*E.ci.n0+-.08948418*E.ci.n1+-1.291485*E.ci.n2;e=e**3,t=t**3,i=i**3,E.Rt.n0=1.2268798*e+-.5578149*t+.281391*i,E.Rt.n1=-.04057576*e+1.112286*t+-.07171106*i,E.Rt.n2=-.07637294*e+-.4214933*t+1.586924*i,E.Rt.n3=E.ci.n3}static qR(){const e=Math.atan2(E.ci.n2,E.ci.n1)*180/Math.PI;E.eo.n0=E.ci.n0,E.eo.n1=Math.sqrt(E.ci.n1**2+E.ci.n2**2),E.eo.n2=e>=0?e:e+360,E.eo.n3=E.ci.n3}static WR(){E.ci.n0=E.eo.n0,E.ci.n1=E.eo.n1*Math.cos(E.eo.n2*Math.PI/180),E.ci.n2=E.eo.n1*Math.sin(E.eo.n2*Math.PI/180),E.ci.n3=E.eo.n3}static XR(){E.fA(),E.jR(),E.qR()}static KR(){E.WR(),E.HR(),E.uA()}static nd(e,t){typeof e=="string"||e instanceof E||b.o("Value for "+t+" must be a color string or a Brush, not "+e)}};f(E,"k2",216/24389),f(E,"Yb",24389/27),f(E,"ld",[95.047,100,108.883]),f(E,"Solid",1),f(E,"Linear",2),f(E,"Radial",3),f(E,"Pattern",4),f(E,"Lab",1),f(E,"HSL",2),f(E,"il",At.isUsingDOM()?new Pi(null,void 0,{willReadFrequently:!0}).ai:null),f(E,"G",new Yi),f(E,"Ii",new Yi),f(E,"Rt",new Yi),f(E,"io",new Yi),f(E,"ci",new Yi),f(E,"eo",new Yi);let jt=E;const Ps=class Ps{constructor(){f(this,"Mt","Base")}static definePanelLayout(e,t){t.name=e,Ps.Layouts.set(e,t)}get name(){return this.Mt}set name(e){this.Mt=e}get classType(){return ct}measure(e,t,i,s,n,o,r){}measureElement(e,t,i,s,n){e.ut(t,i,s,n)}arrange(e,t,i){}arrangeElement(e,t,i,s,n,o){e.zt(t,i,s,n,o)}remeasureObject(e){e.tf()}Gi(e,t,i){}};f(Ps,"Layouts",new St);let Rt=Ps;class Vn extends Rt{constructor(){super()}measure(e,t,i,s,n,o,r){const a=s.length,h=e.Ko();for(let l=0;l<a;l++){const u=s[l];if(!u.visible&&u!==h)continue;const c=u.margin,d=c.right+c.left,m=c.top+c.bottom;u.ut(t,i,o,r);const g=u.measuredBounds,p=Math.max(g.width+d,0),y=Math.max(g.height+m,0);let x=u.position.x,P=u.position.y;if(isFinite(x)||(x=0),isFinite(P)||(P=0),u instanceof bt&&u.isGeometryPositioned){const k=u.strokeWidth/2;x-=k,P-=k}n.unionNoCheck(x,P,p,y)}}arrange(e,t,i){const s=t.length,n=e.padding,o=i.x-n.left,r=i.y-n.top;for(let a=0;a<s;a++){const h=t[a],l=h.measuredBounds,u=h.margin,c=h.position.x,d=h.position.y;let m=isNaN(c)?-o:c-o,g=isNaN(d)?-r:d-r;if(h instanceof bt&&h.isGeometryPositioned){const p=h.strokeWidth/2;m-=p,g-=p}h.visible&&h.zt(m+u.left,g+u.top,l.width,l.height)}}}Rt.definePanelLayout("Position",new Vn);class zn extends Rt{constructor(){super()}measure(e,t,i,s,n,o,r){const a=s.length,h=b.nt(),l=e.Ko();for(let c=0;c<a;c++){const d=s[c];if(!d.visible&&d!==l)continue;const m=d.zs(!1);if(m!==0&&m!==5){h.push(d);continue}d.ut(1/0,i,0,r);const g=d.margin,p=d.measuredBounds,y=Math.max(p.width+g.right+g.left,0),x=Math.max(p.height+g.top+g.bottom,0);n.En(n.width+y,Math.max(n.height,x))}const u=h.length;e.desiredSize.height?i=Math.min(e.desiredSize.height,e.maxSize.height):n.height!==0&&(i=Math.min(n.height,e.maxSize.height));for(let c=0;c<u;c++){const d=h[c];if(!d.visible&&d!==l)continue;const m=d.margin,g=m.right+m.left,p=m.top+m.bottom;d.ut(1/0,i,0,r);const y=d.measuredBounds,x=Math.max(y.width+g,0),P=Math.max(y.height+p,0);n.width+=x,n.height=Math.max(n.height,P)}b.tt(h)}arrange(e,t,i){const s=t.length,n=e.padding,o=n.top,r=e.isOpposite;let a=r?i.width:n.left;for(let h=0;h<s;h++){const l=o,u=t[h];if(!u.visible)continue;const c=u.measuredBounds,d=u.margin,m=d.top+d.bottom,g=o+n.bottom;let p=c.height;const y=u.zs(!1);(isNaN(u.desiredSize.height)&&y===2||y===4)&&(p=Math.max(i.height-m-g,0));const x=p+m+g;let P=u.alignment;P.isDefault()&&(P=e.defaultAlignment),P.isSpot()||(P=B.Center),r&&(a-=c.width+d.left+d.right),u.zt(a+P.offsetX+d.left,l+P.offsetY+d.top+(i.height*P.y-x*P.y),c.width,p),r||(a+=c.width+d.left+d.right)}}}Rt.definePanelLayout("Horizontal",new zn);class jn extends Rt{constructor(){super()}measure(e,t,i,s,n,o,r){const a=s.length,h=b.nt(),l=e.Ko();for(let c=0;c<a;c++){const d=s[c];if(!d.visible&&d!==l)continue;const m=d.zs(!1);if(m!==0&&m!==4){h.push(d);continue}d.ut(t,1/0,o,0);const g=d.margin,p=d.measuredBounds,y=Math.max(p.width+g.right+g.left,0),x=Math.max(p.height+g.top+g.bottom,0);n.En(Math.max(n.width,y),n.height+x)}const u=h.length;e.desiredSize.width?t=Math.min(e.desiredSize.width,e.maxSize.width):n.width!==0&&(t=Math.min(n.width,e.maxSize.width));for(let c=0;c<u;c++){const d=h[c];if(!d.visible&&d!==l)continue;const m=d.margin,g=m.right+m.left,p=m.top+m.bottom;d.ut(t,1/0,o,0);const y=d.measuredBounds,x=Math.max(y.width+g,0),P=Math.max(y.height+p,0);n.width=Math.max(n.width,x),n.height+=P}b.tt(h)}arrange(e,t,i){const s=t.length,n=e.padding,o=n.left,r=e.isOpposite;let a=r?i.height:n.top;for(let h=0;h<s;h++){const l=o,u=t[h];if(!u.visible)continue;const c=u.measuredBounds,d=u.margin,m=d.left+d.right,g=o+n.right;let p=c.width;const y=u.zs(!1);(isNaN(u.desiredSize.width)&&y===2||y===5)&&(p=Math.max(i.width-m-g,0));const x=p+m+g;let P=u.alignment;P.isDefault()&&(P=e.defaultAlignment),P.isSpot()||(P=B.Center),r&&(a-=c.height+d.bottom+d.top),u.zt(l+P.offsetX+d.left+(i.width*P.x-x*P.x),a+P.offsetY+d.top,p,c.height),r||(a+=c.height+d.bottom+d.top)}}}Rt.definePanelLayout("Vertical",new jn);const cs=class cs extends Rt{constructor(){super()}measure(e,t,i,s,n,o,r){const a=s.length;if(a===0)return;const h=e.findMainElement();let l=h.margin,u=0,c=0;const d=l.right+l.left,m=l.top+l.bottom;h.ut(t,i,o,r);let g=h.measuredBounds,p=g.width,y=g.height,x=Math.max(p+d,0),P=Math.max(y+m,0);const k=e.isClipping;k&&h.w0()!==0&&!cs.gA&&(cs.gA=!0,b.ii("Main Shape for Spot Panel with isClipping = true must have a zero strokeWidth: "+e.toString()));const w=z.X(-l.left,-l.top,x,P);let N=z.X(0,0,p,y);this.S2(h,N,!0),p=N.width,y=N.height;let M=!0;const C=e.Ko();let O;for(let T=0;T<a;T++){const L=s[T];let F=t,D=i;if(L===h||!L.visible&&L!==C)continue;l=L.margin;let R=l.left,I=l.top;switch(u=l.right+l.left,c=l.top+l.bottom,O=L.zs(!1),O){case 2:F=p,D=y,u=0,c=0,R=0,I=0;break;case 5:F=p,u=0,R=0;break;case 4:D=y,c=0,I=0;break}L.ut(F,D,0,0),g=L.measuredBounds,x=Math.max(g.width+u,0),P=Math.max(g.height+c,0);let j=L.alignment;j.isDefault()&&(j=e.defaultAlignment),j.isSpot()||(j=B.Center);let X=L.alignmentFocus;X.isDefault()&&(X=B.Center);let V=null;L instanceof ct&&L.so!==""&&(V=L.findObject(L.so),V===L&&(V=null));let G=N.x-R,$=N.y-I;if(V!==null){L.zt(0,0,g.width,g.height);const pt=V.actualBounds,Q=S.X(pt.x+(X.x*pt.width-X.offsetX),pt.y+(X.y*pt.height-X.offsetY));for(V=V.panel;V!==L;)V.D.xt(Q),V=V.panel;G+=j.x*p+j.offsetX-Q.x,$+=j.y*y+j.offsetY-Q.y,S.s(Q)}else G+=j.x*p+j.offsetX-(X.x*g.width+X.offsetX),$+=j.y*y+j.offsetY-(X.y*g.height+X.offsetY);M?(M=!1,n.e(G,$,x,P)):n.unionNoCheck(G,$,x,P)}switch(M?n.a(w):k?n.intersect(N.x,N.y,N.width,N.height):n.unionNoCheck(w.x,w.y,w.width,w.height),z.s(w),z.s(N),O=h.stretch,O===1&&(O=h.zs(!1)),O){case 0:return;case 2:if(!isFinite(t)&&!isFinite(i))return;break;case 5:if(!isFinite(t))return;break;case 4:if(!isFinite(i))return;break}g=h.measuredBounds,p=g.width,y=g.height,x=Math.max(p+d,0),P=Math.max(y+m,0),l=h.margin,N=z.X(-l.left,-l.top,x,P),this.S2(h,N,!0),p=N.width,y=N.height;for(let T=0;T<a;T++){const L=s[T];if(L===h||!L.visible&&L!==C)continue;l=L.margin,u=l.right+l.left,c=l.top+l.bottom,g=L.measuredBounds,x=Math.max(g.width+u,0),P=Math.max(g.height+c,0);let F=L.alignment;F.isDefault()&&(F=e.defaultAlignment),F.isSpot()||(F=B.Center);let D=L.alignmentFocus;D.isDefault()&&(D=B.Center),M?(M=!1,n.e(F.x*p+F.offsetX-(D.x*g.width+D.offsetX)-l.left,F.y*y+F.offsetY-(D.y*g.height+D.offsetY)-l.top,x,P)):n.unionNoCheck(F.x*p+F.offsetX-(D.x*g.width+D.offsetX)-l.left,F.y*y+F.offsetY-(D.y*g.height+D.offsetY)-l.top,x,P)}M?n.a(w):k?n.intersect(N.x,N.y,N.width,N.height):n.unionNoCheck(w.x,w.y,w.width,w.height),z.s(N)}arrange(e,t,i){const s=t.length;if(s===0)return;const n=e.findMainElement(),o=n.measuredBounds,r=o.width,a=o.height,h=e.padding,l=h.left,u=h.top;let c=l-i.x,d=u-i.y;n.zt(c,d,r,a);const m=z.X(0,0,r,a);this.S2(n,m,!1);for(let g=0;g<s;g++){const p=t[g];if(p===n)continue;const y=p.measuredBounds,x=y.width,P=y.height;let k=p.alignment;k.isDefault()&&(k=e.defaultAlignment),k.isSpot()||(k=B.Center);let w=p.alignmentFocus;w.isDefault()&&(w=B.Center);let N=null;if(p instanceof ct&&p.so!==""&&(N=p.findObject(p.so),N===p&&(N=null)),N!==null){const M=N.actualBounds,C=S.X(M.x+(w.x*M.width-w.offsetX),M.y+(w.y*M.height-w.offsetY));for(N=N.panel;N!==p;)N.D.xt(C),N=N.panel;c=k.x*m.width+k.offsetX-C.x,d=k.y*m.height+k.offsetY-C.y,S.s(C)}else c=k.x*m.width+k.offsetX-(w.x*x+w.offsetX),d=k.y*m.height+k.offsetY-(w.y*P+w.offsetY);c+=m.x-i.x,d+=m.y-i.y,p.visible&&p.zt(l+c,u+d,x,P)}z.s(m)}S2(e,t,i){let s=null;if(e instanceof ct&&e.so!==""&&(s=e.findObject(e.so),s===e&&(s=null)),s!==null)for(i&&e.zt(0,0,t.width,t.height),t.a(s.actualBounds),s=s.panel;s!==e;)s.D.xw(t),s=s.panel}};f(cs,"gA",!1);let Cs=cs;Rt.definePanelLayout("Spot",new Cs);class Kn extends Rt{constructor(){super()}measure(e,t,i,s,n,o,r){const a=s.length;if(a===0)return;const h=e.findMainElement();let l=h.margin,u=t,c=i;const d=l.right+l.left,m=l.top+l.bottom;h.ut(t,i,o,r);let g=h.measuredBounds,p=0,y=null;h instanceof bt&&(y=h,p=y.strokeWidth*y.scale);let x=Math.max(g.width+d,0),P=Math.max(g.height+m,0),k=e.M2(h);const w=k.x*x+k.offsetX,N=k.y*P+k.offsetY;let M=e.N2(h);const C=M.x*x+M.offsetX,O=M.y*P+M.offsetY;isFinite(t)&&(u=Math.max(Math.abs(w-C)-p,0)),isFinite(i)&&(c=Math.max(Math.abs(N-O)-p,0));let T=0,L=0;o>0&&(T=Math.max(Math.abs(k.x*o+k.offsetX-(M.x*o+M.offsetX))-p,0)),r>0&&(L=Math.max(Math.abs(k.y*r+k.offsetY-(M.y*r+M.offsetY))-p,0));const F=ut.l();F.e(0,0);const D=e.Ko();for(let X=0;X<a;X++){const V=s[X];if(V===h||!V.visible&&V!==D)continue;l=V.margin;const G=l.right+l.left,$=l.top+l.bottom;V.ut(u,c,T,L),g=V.measuredBounds,x=Math.max(g.width+G,0),P=Math.max(g.height+$,0),F.e(Math.max(x,F.width),Math.max(P,F.height))}if(a===1){g=h.measuredBounds,n.width=x,n.height=P,ut.s(F);return}k=e.M2(h),M=e.N2(h);let R=0,I=0;M.x!==k.x&&M.y!==k.y&&(R=F.width/Math.abs(M.x-k.x),I=F.height/Math.abs(M.y-k.y)),ut.s(F),p=0,y!==null&&(p=y.strokeWidth*y.scale,y._P()===6&&(R=I=Math.max(R,I))),R+=Math.abs(k.offsetX)+Math.abs(M.offsetX)+p,I+=Math.abs(k.offsetY)+Math.abs(M.offsetY)+p;let j=h.stretch;switch(j===1&&(j=h.zs(!1)),j){case 0:o=0,r=0;break;case 2:isFinite(t)&&(R=t),isFinite(i)&&(I=i);break;case 5:isFinite(t)&&(R=t),r=0;break;case 4:o=0,isFinite(i)&&(I=i);break}h.tf(),h.ut(R,I,o,r),n.width=h.measuredBounds.width+d,n.height=h.measuredBounds.height+m}arrange(e,t,i){const s=t.length;if(s===0)return;const n=e.findMainElement(),o=n.measuredBounds,r=z.l();r.e(0,0,1,1);let a=n.margin;const h=a.left,l=a.top,u=e.padding,c=u.left,d=u.top;let m=h,g=l,p=o.width,y=o.height;n.zt(c+m,d+g,p,y);const x=e.M2(n),P=e.N2(n),k=0+x.x*o.width+x.offsetX,w=0+x.y*o.height+x.offsetY,N=0+P.x*o.width+P.offsetX,M=0+P.y*o.height+P.offsetY;r.x=k,r.y=w,r.unionNoCheck(N,M,0,0),r.x+=h+c,r.y+=l+d;for(let C=0;C<s;C++){const O=t[C];if(O===n)continue;const T=O.measuredBounds;a=O.margin;const L=Math.max(T.width+a.right+a.left,0),F=Math.max(T.height+a.top+a.bottom,0);let D=O.alignment;D.isDefault()&&(D=e.defaultAlignment),D.isSpot()||(D=B.Center),m=r.width*D.x+D.offsetX-L*D.x+a.left+r.x,g=r.height*D.y+D.offsetY-F*D.y+a.top+r.y,p=r.width,y=r.height,O.visible&&(z.contains(r.x,r.y,r.width,r.height,m,g,T.width,T.height)?O.zt(m,g,T.width,T.height):O.zt(m,g,T.width,T.height,new z(r.x,r.y,r.width,r.height)))}z.s(r)}}Rt.definePanelLayout("Auto",new Kn);class Xn extends Rt{constructor(){super(),this.name="Table"}measure(e,t,i,s,n,o,r){let a=s.length;const h=b.nt(),l=b.nt();for(let tt=0;tt<a;tt++){const W=s[tt],gt=W instanceof ct?W:null;if(gt!==null&&gt._r()&&W.visible){l.push(gt);const Dt=gt.L.r,Zt=Dt.length;for(let ie=0;ie<Zt;ie++){const re=Dt[ie];gt.type===ct.TableRow?re.row=W.row:gt.type===ct.TableColumn&&(re.column=W.column),h.push(re)}}else h.push(W)}a=h.length,a===0&&(e.getRowDefinition(0),e.getColumnDefinition(0));const u=[];for(let tt=0;tt<a;tt++){const W=h[tt];W.visible&&(W.ue(!0),W._n(!0),u[W.row]||(u[W.row]=[]),u[W.row][W.column]||(u[W.row][W.column]=[]),u[W.row][W.column].push(W))}b.tt(h);const c=b.nt(),d=b.nt(),m=b.nt(),g={count:0},p={count:0};let y=t,x=i;const P=e.Ye,k=e.Ge;let w=null;a=P.length;for(let tt=0;tt<a;tt++)w=P[tt],w!==void 0&&(w.actual=0);a=k.length;for(let tt=0;tt<a;tt++)w=k[tt],w!==void 0&&(w.actual=0);let N=u.length,M=0;for(let tt=0;tt<N;tt++)u[tt]&&(M=Math.max(M,u[tt].length));const C=Math.min(e.topIndex,N-1),O=Math.min(e.leftIndex,M-1);let T=0,L;N=u.length;const F=e.Ko();for(let tt=0;tt<N;tt++){if(!u[tt])continue;M=u[tt].length;const W=e.getRowDefinition(tt);W.actual=0,W.ji=0;for(let gt=0;gt<M;gt++){if(!u[tt][gt])continue;const Dt=e.getColumnDefinition(gt);c[gt]===void 0&&(Dt.actual=0,Dt.ji=0,c[gt]=!0);const Zt=u[tt][gt],ie=Zt.length;for(let re=0;re<ie;re++){const ue=Zt[re];if(!ue.visible&&ue!==F)continue;const ri=ue.rowSpan>1,Ke=ue.columnSpan>1;(ri||Ke)&&!(tt<C)&&!(gt<O)&&d.push(ue);const He=ue.margin,de=He.right+He.left,xe=He.top+He.bottom;L=ue.N0(W,Dt,!1);const Qe=ue.desiredSize,Vt=!isNaN(Qe.width),gi=!isNaN(Qe.height);if(L!==0&&!(Vt&&gi)&&!(tt<C)&&!(gt<O)&&(!Ke&&g[gt]===void 0&&(L===2||L===5)&&(g[gt]=-1,g.count++),!ri&&p[tt]===void 0&&(L===2||L===4)&&(p[tt]=-1,p.count++),!ri&&!Ke&&m.push(ue)),ue.ut(1/0,1/0,0,0),tt<C||gt<O)continue;const Ae=ue.measuredBounds,ai=Math.max(Ae.width+de,0),wi=Math.max(Ae.height+xe,0);if(ue.rowSpan===1&&(L===0||L===5)){w=e.getRowDefinition(tt);const hi=w.computeEffectiveSpacing(),ds=w.st===0;T=Math.max(wi-w.actual,0),T+(ds?hi:0)>x&&(T=Math.max(x-hi,0)),w.ji=w.ji+T,w.actual=w.st+T,x=Math.max(x-(T+(ds?hi:0)),0)}if(ue.columnSpan===1&&(L===0||L===4)){w=e.getColumnDefinition(gt);const hi=w.computeEffectiveSpacing(),ds=w.st===0;T=Math.max(ai-w.actual,0),T+(ds?hi:0)>y&&(T=Math.max(y-hi,0)),w.ji=w.ji+T,w.actual=w.st+T,y=Math.max(y-(T+(ds?hi:0)),0)}(ri||Ke)&&ue.tf()}}}b.tt(c);let D=0,R=0;a=e.columnCount;for(let tt=0;tt<a;tt++){const W=k[tt];W!==void 0&&(D+=isNaN(W.ge)?W.ji:W.ge,W.ji!==0&&(D+=W.computeEffectiveSpacing()))}a=e.rowCount;for(let tt=0;tt<a;tt++){const W=P[tt];W!==void 0&&(R+=isNaN(W.ge)?W.ji:W.ge,W.ji!==0&&(R+=W.computeEffectiveSpacing()))}y=Math.max(t-D,0),x=Math.max(i-R,0);let I=x,j=y;a=m.length;for(let tt=0;tt<a;tt++){const W=m[tt],gt=e.getRowDefinition(W.row),Dt=e.getColumnDefinition(W.column),Zt=W.measuredBounds,ie=W.margin,re=ie.right+ie.left,ue=ie.top+ie.bottom;Dt.ji===0&&g[W.column]!==void 0?g[W.column]=Math.max(Zt.width+re,g[W.column]):g[W.column]=null,gt.ji===0&&p[W.row]!==void 0?p[W.row]=Math.max(Zt.height+ue,p[W.row]):p[W.row]=null}let X=0,V=0,G;for(G in p)G!=="count"&&(X+=p[G]);for(G in g)G!=="count"&&(V+=g[G]);const $=ut.l();for(let tt=0;tt<a;tt++){const W=m[tt];if(!W.visible&&W!==F)continue;const gt=e.getRowDefinition(W.row),Dt=e.getColumnDefinition(W.column);let Zt=0;isFinite(Dt.width)?Zt=Dt.width:(isFinite(y)&&g[W.column]!==null?V===0?Zt=Dt.actual+y:Zt=g[W.column]/V*j:g[W.column]!==null?Zt=y:Zt=Dt.actual||y,Zt=Math.max(0,Zt-Dt.computeEffectiveSpacing()));let ie=0;switch(isFinite(gt.height)?ie=gt.height:(isFinite(x)&&p[W.row]!==null?X===0?ie=gt.actual+x:ie=p[W.row]/X*I:p[W.row]!==null?ie=x:ie=gt.actual||x,ie=Math.max(0,ie-gt.computeEffectiveSpacing())),$.e(Math.max(Dt.minimum,Math.min(Zt,Dt.maximum)),Math.max(gt.minimum,Math.min(ie,gt.maximum))),L=W.N0(gt,Dt,!1),L){case 5:$.height=Math.max($.height,gt.actual+x);break;case 4:$.width=Math.max($.width,Dt.actual+y);break}const re=W.margin,ue=re.right+re.left,ri=re.top+re.bottom;W.tf();let Ke=Dt.minimum,He=gt.minimum;const de=W.measuredBounds;de.width===0&&g[W.column]!==null&&(Ke=Math.max(Ke,g[W.column])),de.height===0&&p[W.row]!==null&&(He=Math.max(Ke,p[W.row])),W.ut($.width,$.height,Ke,He);const xe=W.measuredBounds;let Qe=Math.max(xe.width+ue,0),Vt=Math.max(xe.height+ri,0);isFinite(y)&&(Qe=Math.min(Qe,$.width)),isFinite(x)&&(Vt=Math.min(Vt,$.height));let gi=0;gi=gt.actual,gt.actual=Math.max(gt.actual,Vt),gt.ji=Math.max(gt.ji,Vt),T=gt.actual-gi,x=Math.max(x-T,0),p[W.row]===null&&(I=Math.max(I-T,0)),gi=Dt.actual,Dt.actual=Math.max(Dt.actual,Qe),Dt.ji=Math.max(Dt.ji,Qe),T=Dt.actual-gi,y=Math.max(y-T,0),g[W.column]===null&&(j=Math.max(j-T,0))}b.tt(m);const pt=ut.l(),Q=b.nt(),it=b.nt();if(a=d.length,a!==0)for(let tt=0;tt<N;tt++){if(!u[tt])continue;M=u[tt].length;const W=e.getRowDefinition(tt);Q[tt]=W.actual;for(let gt=0;gt<M;gt++){if(!u[tt][gt])continue;const Dt=e.getColumnDefinition(gt);it[gt]=Dt.actual}}for(let tt=0;tt<a;tt++){const W=d[tt];if(!W.visible&&W!==F)continue;const gt=e.getRowDefinition(W.row),Dt=e.getColumnDefinition(W.column);switch($.e(Math.max(Dt.minimum,Math.min(t,Dt.maximum)),Math.max(gt.minimum,Math.min(i,gt.maximum))),L=W.N0(gt,Dt,!1),L){case 2:it[Dt.index]!==0&&($.width=Math.min($.width,it[Dt.index])),Q[gt.index]!==0&&($.height=Math.min($.height,Q[gt.index]));break;case 5:it[Dt.index]!==0&&($.width=Math.min($.width,it[Dt.index]));break;case 4:Q[gt.index]!==0&&($.height=Math.min($.height,Q[gt.index]));break}isFinite(Dt.width)&&($.width=Dt.width),isFinite(gt.height)&&($.height=gt.height),pt.e(0,0);let Zt=Dt.minimum,ie=gt.minimum;for(let Vt=1;Vt<W.rowSpan&&!(W.row+Vt>=e.rowCount);Vt++)w=e.getRowDefinition(W.row+Vt),T=0,L===2||L===4?T=Math.max(w.minimum,Q[W.row+Vt]===0?w.maximum:Math.min(Q[W.row+Vt],w.maximum)):T=Math.max(w.minimum,isNaN(w.ge)?w.maximum:Math.min(w.ge,w.maximum)),pt.height+=T,ie+=w.minimum;for(let Vt=1;Vt<W.columnSpan&&!(W.column+Vt>=e.columnCount);Vt++)w=e.getColumnDefinition(W.column+Vt),T=0,L===2||L===5?T=Math.max(w.minimum,it[W.column+Vt]===0?w.maximum:Math.min(it[W.column+Vt],w.maximum)):T=Math.max(w.minimum,isNaN(w.ge)?w.maximum:Math.min(w.ge,w.maximum)),pt.width+=T,Zt+=w.minimum;$.width+=pt.width,$.height+=pt.height;const re=W.margin,ue=re.right+re.left,ri=re.top+re.bottom;W.ut($.width,$.height,Zt,ie);const Ke=W.measuredBounds,He=Math.max(Ke.width+ue,0),de=Math.max(Ke.height+ri,0);let xe=0;for(let Vt=0;Vt<W.rowSpan&&!(W.row+Vt>=e.rowCount);Vt++)w=e.getRowDefinition(W.row+Vt),xe+=w.total||0;if(xe<de){let Vt=de-xe;const gi=de-xe;if(W.spanAllocation!==null){const Ae=W.spanAllocation;for(let ai=0;ai<W.rowSpan&&!(Vt<=0||W.row+ai>=e.rowCount);ai++){w=e.getRowDefinition(W.row+ai);const wi=w.st||0,hi=Ae(W,w,gi);w.actual=Math.min(w.maximum,wi+hi),w.st!==wi&&(Vt-=w.st-wi)}}for(;Vt>0;){const Ae=w.st||0;if(isNaN(w.height)&&w.maximum>Ae&&(w.actual=Math.min(w.maximum,Ae+Vt),w.st!==Ae&&(Vt-=w.st-Ae)),w.index===0)break;w=e.getRowDefinition(w.index-1)}}let Qe=0;for(let Vt=0;Vt<W.columnSpan&&!(W.column+Vt>=e.columnCount);Vt++)w=e.getColumnDefinition(W.column+Vt),Qe+=w.total||0;if(Qe<He){let Vt=He-Qe;const gi=He-Qe;if(W.spanAllocation!==null){const Ae=W.spanAllocation;for(let ai=0;ai<W.columnSpan&&!(Vt<=0||W.column+ai>=e.columnCount);ai++){w=e.getColumnDefinition(W.column+ai);const wi=w.st||0,hi=Ae(W,w,gi);w.actual=Math.min(w.maximum,wi+hi),w.st!==wi&&(Vt-=w.st-wi)}}for(;Vt>0;){const Ae=w.st||0;if(isNaN(w.width)&&w.maximum>Ae&&(w.actual=Math.min(w.maximum,Ae+Vt),w.st!==Ae&&(Vt-=w.st-Ae)),w.index===0)break;w=e.getColumnDefinition(w.index-1)}}}b.tt(d),ut.s(pt),ut.s($),Q!==void 0&&b.tt(Q),it!==void 0&&b.tt(it);let et=0,st=0;const Pt=e.desiredSize,wt=e.maxSize;L=e.zs(!0),D=0,R=0;let _=0,ft=0;a=e.columnCount;for(let tt=0;tt<a;tt++)if(k[tt]!==void 0){if(w=e.getColumnDefinition(tt),isFinite(w.width)){_+=w.width,_+=w.computeEffectiveSpacing();continue}else if(w.Gb()===2){_+=w.st,_+=w.computeEffectiveSpacing();continue}w.st!==0&&(D+=w.st,D+=w.computeEffectiveSpacing())}isFinite(Pt.width)?et=Math.min(Pt.width,wt.width):L!==0&&isFinite(t)?et=t:et=D,et=Math.max(et,isFinite(t)?Math.min(o,t):o),et=Math.max(et-_,0);const qt=D===0?1:Math.max(et/D,1);for(let tt=0;tt<a;tt++)k[tt]!==void 0&&(w=e.getColumnDefinition(tt),!isFinite(w.width)&&w.Gb()!==2&&(w.actual=w.st*qt),w.position=n.width,w.st!==0&&(n.width+=w.st,n.width+=w.computeEffectiveSpacing()));a=e.rowCount;for(let tt=0;tt<a;tt++)if(P[tt]!==void 0){if(w=e.getRowDefinition(tt),isFinite(w.height)){ft+=w.height,ft+=w.computeEffectiveSpacing();continue}else if(w.Gb()===2){ft+=w.st,ft+=w.computeEffectiveSpacing();continue}w.st!==0&&(R+=w.st,R+=w.computeEffectiveSpacing())}isFinite(Pt.height)?st=Math.min(Pt.height,wt.height):L!==0&&isFinite(i)?st=i:st=R,st=Math.max(st,isFinite(i)?Math.min(r,i):r),st=Math.max(st-ft,0);const Ct=R===0?1:Math.max(st/R,1);for(let tt=0;tt<a;tt++)P[tt]!==void 0&&(w=e.getRowDefinition(tt),!isFinite(w.height)&&w.Gb()!==2&&(w.actual=w.st*Ct),w.position=n.height,w.st!==0&&(n.height+=w.st,n.height+=w.computeEffectiveSpacing()));a=l.length;for(let tt=0;tt<a;tt++){const W=l[tt];let gt=0,Dt=0;W.type===ct.TableRow?(gt=n.width,w=e.getRowDefinition(W.row),Dt=w.actual):(w=e.getColumnDefinition(W.column),gt=w.actual,Dt=n.height),W.measuredBounds.e(0,0,gt,Dt),W.ue(!1)}b.tt(l),e.gh=u}arrange(e,t,i){const s=t.length,n=e.padding,o=n.left,r=n.top,a=e.gh;if(a===null)return;let h=0,l=0;const u=a.length;let c=0;for(let O=0;O<u;O++)a[O]&&(c=Math.max(c,a[O].length));const d=e.Ye,m=e.Ge;let g=0,p=0,y=Math.min(e.topIndex,u-1);if(d.length>0){for(;y!==u&&(d[y]===void 0||d[y].st===0);)y++;y=Math.max(Math.min(y,u-1),0),g=-d[y].position}let x=Math.min(e.leftIndex,c-1);if(m.length>0){for(;x!==c&&(m[x]===void 0||m[x].st===0);)x++;x=Math.max(Math.min(x,c-1),0),p=-m[x].position}let P=0,k=0;for(;P!==u&&d[P]===void 0;)P++;for(;k!==u&&m[k]===void 0;)k++;const w=e.part;let N=e.getRowDefinition(P),M=e.getColumnDefinition(k);for(let O=0;O<t.length;O++){const T=t[O];if(!(T instanceof ct&&T.visible&&T._r()))continue;T.type===ct.TableRow?(N=e.getRowDefinition(T.row),M=e.getColumnDefinition(k)):(N=e.getRowDefinition(P),M=e.getColumnDefinition(T.column)),l=N.position+g+r,N.st!==0&&(l+=N.computeEffectiveSpacingTop(Math.max(P,y))),h=M.position+p+o,M.st!==0&&(h+=M.computeEffectiveSpacingTop(Math.max(k,x)));const L=T.measuredBounds;T._u(),T.actualBounds.ot();const F=T.actualBounds,D=z.X(F.x,F.y,F.width,F.height);if(F.x=T.type===ct.TableRow?o:h,F.y=T.type===ct.TableColumn?r:l,F.width=L.width,F.height=L.height,T.actualBounds.g(),T._n(!1),D.equalsApproxClose(F)){z.s(D);continue}w!==null&&(w.ch(),T.b0(w)),z.s(D)}const C=ut.l();for(let O=0;O<u;O++){if(!a[O])continue;c=a[O].length;const T=e.getRowDefinition(O);l=T.position+g+r,T.st!==0&&(l+=T.computeEffectiveSpacingTop(Math.max(P,y)));for(let L=0;L<c;L++){if(!a[O][L])continue;const F=e.getColumnDefinition(L);h=F.position+p+o,F.st!==0&&(h+=F.computeEffectiveSpacingTop(Math.max(k,x)));const D=a[O][L],R=D.length;for(let I=0;I<R;I++){const j=D[I],X=j.measuredBounds;C.e(0,0);for(let de=1;de<j.rowSpan&&!(O+de>=e.rowCount);de++){const xe=e.getRowDefinition(O+de);xe.st!==0&&(C.height+=xe.total)}for(let de=1;de<j.columnSpan&&!(L+de>=e.columnCount);de++){const xe=e.getColumnDefinition(L+de);xe.st!==0&&(C.width+=xe.total)}const V=F.st+C.width,G=T.st+C.height;let $=h,pt=l;const Q=V,it=G,et=h,st=l;let Pt=V,wt=G;h+V>i.width&&(Pt=Math.max(i.width-h,0)),l+G>i.height&&(wt=Math.max(i.height-l,0));let _=j.alignment,ft=0,qt=0,Ct=0,tt=0;if(_.isDefault()){_=e.defaultAlignment,_.isSpot()||(_=B.Center),ft=_.x,qt=_.y,Ct=_.offsetX,tt=_.offsetY;const de=F.alignment,xe=T.alignment;de.isSpot()&&(ft=de.x,Ct=de.offsetX),xe.isSpot()&&(qt=xe.y,tt=xe.offsetY)}else ft=_.x,qt=_.y,Ct=_.offsetX,tt=_.offsetY;(isNaN(ft)||isNaN(qt))&&(ft=.5,qt=.5,Ct=0,tt=0);let W=X.width,gt=X.height;const Dt=j.margin,Zt=Dt.left+Dt.right,ie=Dt.top+Dt.bottom,re=j.N0(T,F,!1);isNaN(j.desiredSize.width)&&(re===2||re===5)&&(W=Math.max(V-Zt,0)),isNaN(j.desiredSize.height)&&(re===2||re===4)&&(gt=Math.max(G-ie,0));const ue=j.maxSize,ri=j.minSize;W=Math.min(ue.width,W),gt=Math.min(ue.height,gt),W=Math.max(ri.width,W),gt=Math.max(ri.height,gt);const Ke=W+Zt,He=gt+ie;$+=Q*ft-Ke*ft+Ct+Dt.left,pt+=it*qt-He*qt+tt+Dt.top,j.visible&&(z.contains(et,st,Pt,wt,$,pt,X.width,X.height)?j.zt($,pt,W,gt):j.zt($,pt,W,gt,new z(et,st,Pt,wt)))}}}ut.s(C);for(let O=0;O<s;O++){const T=t[O],L=T instanceof ct?T:null;if(L!==null&&L._r()){const F=T.actualBounds;T.naturalBounds.ot(),T.naturalBounds.e(0,0,F.width,F.height),T.naturalBounds.g()}}}}Rt.definePanelLayout("Table",new Xn);class Yn extends Rt{constructor(){super()}measure(e,t,i,s,n,o,r){}arrange(e,t,i){}}Rt.definePanelLayout("TableRow",new Yn);class Gn extends Rt{constructor(){super()}measure(e,t,i,s,n,o,r){}arrange(e,t,i){}}Rt.definePanelLayout("TableColumn",new Gn);class Un extends Rt{constructor(){super()}measure(e,t,i,s,n,o,r){s.length!==1&&b.o("Viewbox Panel must contain exactly one GraphObject.");const a=s[0];a.et=1,a.tf(),a.ut(1/0,1/0,o,r);let h=a.measuredBounds;const l=a.margin,u=l.right+l.left,c=l.top+l.bottom;if(isFinite(t)||isFinite(i)){const d=a.scale,m=h.width,g=h.height,p=Math.max(t-u,0),y=Math.max(i-c,0);let x=1;e.viewboxStretch===6?(m!==0&&g!==0&&(x=Math.min(p/m,y/g)),x===0&&(x=1e-4),a.et*=x):(m!==0&&g!==0&&(x=Math.max(p/m,y/g)),x===0&&(x=1e-4),a.et*=x),d!==a.scale&&(a.ue(!0),a.ut(1/0,1/0,o,r))}h=a.measuredBounds,n.width=isFinite(t)?t:Math.max(h.width+u,0),n.height=isFinite(i)?i:Math.max(h.height+c,0)}arrange(e,t,i){const s=t[0],n=s.measuredBounds,o=s.margin,r=o.right+o.left,a=o.top+o.bottom,h=Math.max(n.width+r,0),l=Math.max(n.height+a,0);let u=s.alignment;u.isDefault()&&(u=e.defaultAlignment),u.isSpot()||(u=B.Center),s.zt(i.width*u.x-h*u.x+u.offsetX,i.height*u.y-l*u.y+u.offsetY,n.width,n.height)}}Rt.definePanelLayout("Viewbox",new Un);class qn extends Rt{constructor(){super()}measure(e,t,i,s,n,o,r){e.xi===null&&(e.xi=new Gi),this.JR(e),this.$R(e)}arrange(e,t,i){}Gi(e,t,i){const s=e.naturalBounds,n=s.width,o=s.height;t.save(),t.beginPath(),t.rect(0,0,n,o),t.clip(),t.endPath(),this.ZR(e,t,i),t.restore(),t.clearContextCache(!1)}ZR(e,t,i){let s=e.getDocumentScale()*i.scale;s<=0&&(s=1);const n=e.gridCellSize,o=n.width,r=n.height,a=e.naturalBounds,h=e.actualBounds,l=a.width,u=a.height,c=Math.ceil(l/o),d=Math.ceil(u/r),m=e.gridOrigin,g=m.x,p=m.y,y=e.xi.Z0,x=e.L.r,P=x.length;for(let k=0;k<P;k++){const w=x[k];if(!w.visible)continue;const N=w.interval||1,M=Math.abs(N);if(o*M*s<2)continue;let C=w.segmentIndex;(!isFinite(C)||isNaN(C))&&(C=0),C<0&&(C=M-Math.min(-C,M)),C=Math.round(C%M);const O=w.opacity;let T=1;if(O!==1){if(O===0)continue;T=t.globalAlpha,t.globalAlpha=T*O}const L=y[k];let F=!1;const D=w.strokeDashArray;if(D!==null&&(F=!0,t.enableDash(D,w.strokeDashOffset)),w.stroke!==null&&w.strokeWidth>0&&(w.figure==="LineV"||w.figure==="LineH")){if(t.lineWidth=w.strokeWidth,e.dn(t,w.stroke,!1,!1,a,h),t.beginPath(),w.figure==="LineV"){const R=Math.floor((g-o)/o);for(let I=R;I<=R+c;I++){const j=I*o+g;0<=j&&j<=l&&this.jb(I,N,C,L)&&(t.moveTo(j,0),t.lineTo(j,u))}}else if(w.figure==="LineH"){const R=Math.floor((p-r)/r);for(let I=R;I<=R+d;I++){const j=I*r+p;0<=j&&j<=u&&this.jb(I,N,C,L)&&(t.moveTo(0,j),t.lineTo(l,j))}}t.stroke(),t.endPath()}else if(w.fill!==null){if(e.dn(t,w.fill,!0,!1,a,h),w.figure==="BarV"){let R=w.width;isNaN(R)&&(R=o);const I=Math.floor((g-o)/o);for(let j=I;j<=I+c;j++){const X=j*o+g;0<=X+R&&X<=l&&this.jb(j,N,C,L)&&t.fillRect(X,0,R,u)}}else if(w.figure==="BarH"){let R=w.height;isNaN(R)&&(R=r);const I=Math.floor((p-r)/r);for(let j=I;j<=I+d;j++){const X=j*r+p;0<=X+R&&X<=u&&this.jb(j,N,C,L)&&t.fillRect(0,X,l,R)}}}F&&t.disableDash(),O!==1&&(t.globalAlpha=T)}}jb(e,t,i,s){if(t<0)return e%t===i;if(e%t!==i)return!1;const n=s.length;for(let o=0;o<n;o++){const r=s[o];if(e%r===i)return!1}return!0}$R(e){const t=[],i=e.L.r,s=i.length;for(let n=0;n<s;n++){const o=i[n],r=[];if(t.push(r),!o.visible)continue;const a=o.interval;if(a<0)continue;const h=o.figure,l=this.C2(h);for(let u=0;u<s;u++){if(u===n)continue;const c=i[u];if(!c.visible)continue;const d=c.figure;if(this.C2(d)!==l)continue;const m=c.interval;m>a&&r.push(m)}}e.xi.Z0=t}C2(e){return e==="LineV"||e==="BarV"}JR(e){let t=1,i=1;const s=e.L.r,n=s.length;for(let a=0;a<n;a++){const h=s[a],l=Math.abs(h.interval);l<2||(this.C2(h.figure)?i=i*l/A.dC(i,l):t=t*l/A.dC(t,l))}const o=e.gridCellSize,r=e.xi;r.Yc.isReal()?r.Yc.e(i*o.width,t*o.height):r.Yc=new ut(i*o.width,t*o.height)}}Rt.definePanelLayout("Grid",new qn);class Hn extends Rt{constructor(){super()}measure(e,t,i,s,n,o,r){const a=s.length;if(!(e instanceof Mt||e instanceof dt))return;let h=null,l=null;if(e instanceof dt&&(h=e),e instanceof Mt&&(l=e,h=l.adornedPart,e.hf===null&&(e.hf=[])),!(h instanceof dt))return;const u=h;if(a===0){e.naturalBounds.En(0,0),e.measuredBounds.e(0,0,0,0);return}const c=e instanceof Mt?null:h.path,d=h.routeBounds,m=e.Yo;m.e(0,0,d.width,d.height);const g=u.points,p=h.pointsCount;l!==null?l.hd(!1):h!==null&&h.hd(!1);const y=d.width,x=d.height,P=e.hf;if(P.length=0,c!==null){this.measureLinkPath(e,y,x,c);const M=c.measuredBounds;m.unionRect(M),P.push(M)}const k=Tt.l(),w=S.l(),N=S.l();for(let M=0;M<a;M++){const C=s[M];if(C===c)continue;let O=C.measuredBounds;if(C.isPanelMain&&C instanceof bt){this.measureLinkPath(e,y,x,C),O=C.measuredBounds,m.unionRect(O),P.push(O);continue}if(p<2){C.ut(1/0,1/0,0,0),O=C.measuredBounds,m.unionRect(O),P.push(O);continue}const T=C.segmentIndex,L=C.segmentFraction;let F=C.alignmentFocus;F.isNoSpot()&&(F=B.Center);const D=C.segmentOrientation,R=C.segmentOffset;let I=0,j=0,X=0,V=0;if(isNaN(T)){const _=u.ct,ft=b.nt();_.getPointAndAngleAlongPath(L,ft);const qt=S.X(ft[0],ft[1]);V=ft[2],D!==0&&(X=u.computeAngle(C,D,V),C.Xt=X,C.ue(!0),C._n(!0)),I=qt.x,j=qt.y,S.s(qt),b.tt(ft)}else if(T<-p||T>=p){const _=S.l();u.mA(_),V=u.midAngle,D!==0&&(X=u.computeAngle(C,D,V),C.Xt=X,C.ue(!0),C._n(!0)),I=_.x-d.x,j=_.y-d.y,S.s(_)}else{let _,ft,qt=0;if(T>=0?(_=g.elt(T),ft=T<p-1?g.elt(T+1):_):(qt=p+T,_=g.elt(qt),ft=qt>0?g.elt(qt-1):_),V=0,_.equalsApprox(ft)){let Ct,tt;T>=0?(Ct=T>0?g.elt(T-1):_,tt=T<p-2?g.elt(T+2):ft):(Ct=qt<p-1?g.elt(qt+1):_,tt=qt>1?g.elt(qt-2):ft);const W=Ct.distanceSquaredPoint(_),gt=ft.distanceSquaredPoint(tt);W>gt+10?V=T>=0?Ct.directionPoint(_):_.directionPoint(Ct):gt>W+10?V=T>=0?ft.directionPoint(tt):tt.directionPoint(ft):V=T>=0?Ct.directionPoint(tt):tt.directionPoint(Ct)}else V=T>=0?_.directionPoint(ft):ft.directionPoint(_);D!==0&&(X=u.computeAngle(C,D,V),C.Xt=X,C.ue(!0),C._n(!0)),I=_.x+(ft.x-_.x)*L-d.x,j=_.y+(ft.y-_.y)*L-d.y}C.ut(1/0,1/0,0,0),O=C.measuredBounds;const G=C.naturalBounds;let $=0;C instanceof bt&&($=C.strokeWidth);const pt=G.width+$,Q=G.height+$;k.Ri(),k.Ds(-O.x,-O.y),k.et(C.scale,C.scale),k.cs(D===0?C.angle:V,pt/2,Q/2),(D===22||D===26)&&k.cs(90,pt/2,Q/2),(D===23||D===27)&&k.cs(-90,pt/2,Q/2),D===28&&(V>45&&V<135||V>225&&V<315)&&k.cs(-V,pt/2,Q/2);const it=new z(0,0,pt,Q);w.setRectSpot(it,F),k.xt(w);const et=-w.x+$/2*C.scale,st=-w.y+$/2*C.scale;N.a(R);const Pt=isNaN(R.x),wt=isNaN(R.y);if(Pt||wt){const _=pt/2+3,ft=Q/2+3,qt=V>=45&&V<=135,Ct=V>=225&&V<=315;D===0&&(qt||Ct)?(N.x=wt?_:R.y,N.y=Pt?ft:R.x,qt?T>=0||isNaN(T)&&L<.5||Pt&&(N.y=-ft):Ct&&((T>=0||isNaN(T)&&L<.5)&&Pt&&(N.y=-ft),wt&&(N.x=-_))):(Pt&&(T>=0||isNaN(T)&&L<.5?N.x=_:N.x=-_),wt&&(N.y=-ft),N.rotate(V))}else N.rotate(V);I+=N.x,j+=N.y,it.e(I+et,j+st,O.width,O.height),P.push(it),m.unionRect(it)}if(h!==null){const M=h.labelNodes;for(;M.next();)M.value.ut(1/0,1/0)}e.Yo=m,e.position.e(d.x+m.x,d.y+m.y),n.En(m.width||0,m.height||0),Tt.s(k),S.s(w),S.s(N)}arrange(e,t,i){const s=t.length;if(!(e instanceof Mt||e instanceof dt))return;let n=e,o=null;e instanceof Mt&&(o=e,n=o.adornedPart);const r=e,a=e instanceof Mt?null:n.path,h=e.hf;if(h.length!==0){let d=0;if(a!==null&&d<h.length){const m=h[d];d++,a.zt(m.x-r.Yo.x,m.y-r.Yo.y,m.width,m.height)}for(let m=0;m<s;m++){const g=t[m];if(g!==a&&d<h.length){const p=h[d];d++,g.zt(p.x-r.Yo.x,p.y-r.Yo.y,p.width,p.height)}}}const l=n.points,u=l.count;if(u>=2&&r instanceof dt){const d=r.labelNodes;for(;d.next();){const m=d.value;r.QR(m,u,l)}}o!==null?o.hd(!1):n.hd(!1);const c=e.pA(S.l());e.location.e(e.position.x+c.x,e.position.y+c.y),S.s(c)}measureLinkPath(e,t,i,s){if(s.Oo()===!1)return;let n=s.strokeWidth;if(n===0&&e instanceof Mt&&e.type===ct.Link&&e.adornedObject instanceof bt&&(n=e.adornedObject.strokeWidth),n=n*s.et,e instanceof dt&&e.ct!==null){const o=e.geometry.bounds;s.Qn(o.x-n/2,o.y-n/2,o.width+n,o.height+n)}else if(e instanceof Mt&&e.adornedPart.ct!==null){const o=e.adornedPart.ct.bounds;s.Qn(o.x-n/2,o.y-n/2,o.width+n,o.height+n)}else s.Qn(-(n/2),-(n/2),t+n,i+n);s._R(),s.ue(!1)}}Rt.definePanelLayout("Link",new Hn);class Wn extends Rt{constructor(){super()}measure(e,t,i,s,n,o,r){const a=e.findMainElement();e.je=[];const h=a.margin,l=h.right+h.left,u=h.top+h.bottom;a.ut(t,i,o,r);const c=a.measuredBounds,d=c.width,m=c.height,g=Math.max(d+l,0),p=Math.max(m+u,0),y=new z(-h.left,-h.top,g,p);e.je.push(y),n.a(y),this.determineGraduatedMarks(e,a);const x=e.ws;if(x===null)return;const P=s.length;for(let k=0;k<P;k++){const w=s[k],N=x[k];!w.visible||w===a||N.length===0||(w instanceof bt?this.measureGraduatedTicks(e,w,N,n):w instanceof Qt&&this.measureGraduatedLabels(e,w,N,n),w.ue(!1))}}arrange(e,t,i){if(e.je===null)return;const s=e.findMainElement(),n=e.ws;if(n===null)return;const o=e.je;let r=0,a=o[r];r++,s!==null&&s.zt(a.x-i.x,a.y-i.y,a.width,a.height);const h=t.length;for(let l=0;l<h;l++){const u=t[l],c=n[l];!u.visible||u===s||c.length===0||(a=o[r],r++,u.zt(a.x-i.x,a.y-i.y,a.width,a.height))}e.je=null}measureGraduatedTicks(e,t,i,s){let n=t.alignmentFocus;n.isNoSpot()&&(n=B.TopCenter);const o=t.angle;t.Xt=0,t.ut(1/0,1/0,0,0),t.Xt=o;const r=t.measuredBounds,a=r.width,h=r.height,l=z.X(0,0,a,h),u=S.l();u.setRectSpot(l,n),z.s(l);const c=-u.x,d=-u.y,m=new z,g=i.length;for(let p=0;p<g;p++){const y=i[p],x=y.pt.x,P=y.pt.y,k=y.angle;for(let w=0;w<4;w++){switch(w){case 0:u.e(c,d);break;case 1:u.e(c+a,d);break;case 2:u.e(c,d+h);break;case 3:u.e(c+a,d+h);break}u.rotate(k+t.angle),u.offset(x,P),p===0&&w===0?m.e(u.x,u.y,0,0):m.unionPoint(u),u.offset(-x,-P),u.rotate(-k-t.angle)}}S.s(u),e.je!==null&&e.je.push(m),s.unionNoCheck(m.x,m.y,m.width,m.height)}measureGraduatedLabels(e,t,i,s){e.Se===null&&(e.Se=new Qt);const n=e.Se;this.yA(t,n);let o=t.alignmentFocus;o.isNoSpot()&&(o=B.TopCenter);const r=t.segmentOrientation,a=t.segmentOffset,h=new z;let l=0,u=0,c=0,d=0,m=0;const g=i.length;for(let p=0;p<g;p++){const y=i[p];l=y.pt.x,u=y.pt.y,c=y.angle,d=t.angle,m=t.angle,r!==0&&(r===21||r===25?m=c+t.angle:m=c,d=dt.computeAngle(r,m)),n.Xt=d,n.text=y.text||"",n.ut(1/0,1/0,0,0);const x=n.measuredBounds,P=n.naturalBounds,k=P.width,w=P.height,N=Tt.l();N.Ri(),N.Ds(-x.x,-x.y),N.et(n.scale,n.scale),N.cs(m,k/2,w/2),(r===22||r===26)&&N.cs(90,k/2,w/2),(r===23||r===27)&&N.cs(-90,k/2,w/2),r===28&&(c>45&&c<135||c>225&&c<315)&&N.cs(-c,k/2,w/2);const M=z.X(0,0,k,w),C=S.l();C.setRectSpot(M,o),N.xt(C);const O=-C.x,T=-C.y,L=S.l();L.a(a),isNaN(L.x)&&(L.x=k/2+3),isNaN(L.y)&&(L.y=-(w/2+3)),L.rotate(c),l+=L.x+O,u+=L.y+T;const F=new z(l,u,x.width,x.height),D=new z(x.x,x.y,x.width,x.height),R=new z(P.x,P.y,P.width,P.height);y.labelAngle=d,y.lineCount=n.lineCount,y.lines=n.getMetrics(),y.actualBounds=F,y.measuredBounds=D,y.naturalBounds=R,p===0?h.a(F):h.unionRect(F),S.s(L),S.s(C),z.s(M),Tt.s(N)}e.je!==null&&e.je.push(h),s.unionNoCheck(h.x,h.y,h.width,h.height)}determineGraduatedMarks(e,t){const i=t.geometry,s=t.strokeWidth,n=i.flattenedSegments,o=i.flattenedLengths,r=i.flattenedTotalLength,a=n.length;let h=0,l=0;const u=b.nt();for(let P=0;P<a;P++){const k=n[P],w=[];h=0,l=0;const N=k.length;for(let M=0;M<N;M+=2){const C=k[M],O=k[M+1];if(M===0){h=C,l=O;continue}let T=Math.atan2(O-l,C-h)*180/Math.PI;T<0&&(T+=360),w.push(T),h=C,l=O}u.push(w)}const c=this.tv(e),d=e.L.r,m=d.length;let g=0,p=0,y=r;e.ws=[];let x;for(let P=0;P<m;P++){const k=d[P];if(x=[],!k.visible||k===t){e.ws.push(x);continue}const w=Math.abs(k.interval),N=e.graduatedTickUnit;if(N*w*r/e.graduatedRange<2&&k.graduatedSkip===null){e.ws.push(x);continue}let M=o[0][0],C=0,O=0;p=r*k.graduatedStart-1e-4,y=r*k.graduatedEnd+1e-4;const T=N*w;let L=e.graduatedTickBase;if(L<e.graduatedMin){let I=(e.graduatedMin-L)/T;I=I%1===0?I:Math.floor(I+1),L+=I*T}else if(L>e.graduatedMin+T){const I=Math.floor((L-e.graduatedMin)/T);L-=I*T}const F=c[P],D=L,R=e.graduatedMax*1e-6;for(let I=1;L<=e.graduatedMax+R;I++){if(this.iv(e,L-e.graduatedTickBase,F)&&(L>e.graduatedMax&&(L=e.graduatedMax),(k.graduatedSkip===null||k instanceof Qt&&!k.graduatedSkip(L,k)||k instanceof bt&&!k.graduatedSkip(L,k))&&(g=(L-e.graduatedMin)*r/e.graduatedRange,g>r&&(g=r),p<=g&&g<=y))){let j=u[C][O],X=o[C][O];for(;C<o.length;){for(;g>M&&O<o[C].length-1;)O++,j=u[C][O],X=o[C][O],M+=X;if(g<=M)break;C++,O=0,j=u[C][O],X=o[C][O],M+=X}const V=n[C],G=V[O*2],$=V[O*2+1],pt=V[O*2+2],Q=V[O*2+3],it=(g-(M-X))/X,et=new S(G+(pt-G)*it+s/2-i.bounds.x,$+(Q-$)*it+s/2-i.bounds.y);if(et.scale(t.scale,t.scale),j=this.ev(j,it,V,u[C],O),k instanceof Qt){let st="";k.graduatedFunction!==null?(st=k.graduatedFunction(L,k),st=st!=null?st.toString():""):st=(+L.toFixed(2)).toString(),st!==""&&x.push({pt:et,angle:j,text:st})}else x.push({pt:et,angle:j})}L=D+I*T}e.ws.push(x)}b.tt(u)}ev(e,t,i,s,n){if(t<.5005&&t>.4995)return e;let o=e;if(t<.5?n>0?o=s[n-1]:A.K(i[0],i[i.length-2])&&A.K(i[1],i[i.length-1])&&(o=s[s.length-1]):t>.5&&(n+1<s.length?o=s[n+1]:A.K(i[0],i[i.length-2])&&A.K(i[1],i[i.length-1])&&(o=s[0])),e!==o){let r=Math.abs(e-o);if(r>180&&(e<o?e+=360:o+=360,r=Math.abs(e-o)),t<5e-4||t>.9995)return(e+o)/2%360;if(r<10){const a=1-Math.abs(.5-t);return(e*a+o*(1-a))%360}}return e}tv(e){if(e.ns===null){const t=[],i=e.L.r,s=i.length;for(let n=0;n<s;n++){const o=i[n],r=[];if(t.push(r),!o.visible)continue;const a=o.interval;if(!(a<0))for(let h=0;h<s;h++){if(h===n)continue;const l=i[h];if(!l.visible||o.constructor!==l.constructor)continue;const u=l.interval;u>a&&r.push(u)}}e.ns=t}return e.ns}iv(e,t,i){const s=i.length;for(let n=0;n<s;n++){const o=i[n]*e.graduatedTickUnit,r=t%o,a=e.graduatedTickUnit*1e-6;if(r<a&&r>-a)return!1}return!0}Gi(e,t,i){const s=i.Qh;i.Qh=!0;const n=e.naturalBounds,o=n.width,r=n.height,a=t instanceof ze;t.save(),t.beginPath(),t.rect(-1,-1,o+1,r+1),t.clip(),t.endPath();const h=e.findMainElement();h.Gi(t,i);let l=e.getDocumentScale()*i.scale;l<=0&&(l=1);const u=h.actualBounds,c=e.L.r,d=e.ws,m=c.length;for(let g=0;g<m;g++){const p=c[g],y=d[g],x=y.length;if(!(!p.visible||p===h||y.length===0)){if(p instanceof bt){if(e.graduatedTickUnit*p.interval*h.geometry.flattenedTotalLength/e.graduatedRange*l<2&&p.graduatedSkip===null)continue;const P=p.measuredBounds,k=p.strokeWidth*p.scale;let w=p.alignmentFocus;w.isNoSpot()&&(w=B.TopCenter);for(let N=0;N<x;N++){const M=y[N].pt,C=y[N].angle;this.sv(p,M,u,C,P,k,w),p.Gi(t,i),a&&(e.svg.appendChild(p.svg),p.svg=null),p.$r.Ri()}}else if(p instanceof Qt){e.Se===null&&(e.Se=new Qt);const P=e.Se;this.yA(p,P),P.L2=!0;for(let k=0;k<x;k++){const w=y[k];if(w.actualBounds&&w.measuredBounds&&w.naturalBounds){P.nv(w);const N=w.actualBounds;P.zt(N.x,N.y,N.width,N.height),this.ov(P,u,N,w.measuredBounds,w.naturalBounds),P.Qr=p.part,P.Vs=p.panel,P.Gi(t,i),P.Vs=null,P.Qr=null,a&&(e.svg.appendChild(P.svg),P.svg=null)}}}}}i.Qh=s,t.restore(),t.clearContextCache(!0)}sv(e,t,i,s,n,o,r){const a=e.$r;a.Ri(),a.Ds(t.x+i.x,t.y+i.y),a.cs(s+e.angle,0,0),a.Ds(-n.width*r.x+r.offsetX+o/2,-n.height*r.y+r.offsetY+o/2),a.et(e.scale,e.scale),e.sd(!1),e.oh.set(e.$r),e.ca=e.scale,e.wa(!1)}ov(e,t,i,s,n){const o=e.$r;o.Ri(),o.Ds(i.x+t.x,i.y+t.y),o.Ds(-s.x,-s.y),e.p0(o,n.x,n.y,n.width,n.height),e.sd(!1),e.oh.set(e.$r),e.ca=e.scale,e.wa(!1)}yA(e,t){t.rv(e)}}Rt.definePanelLayout("Graduated",new Wn);var cn=(v=>(v[v.Uniform=6]="Uniform",v[v.UniformToFill=7]="UniformToFill",v))(cn||{});const ot=class ot extends he{constructor(t,i){super();f(this,"$");f(this,"L");f(this,"$t");f(this,"ad");f(this,"Kn");f(this,"el");f(this,"so");f(this,"Yo");f(this,"A2");f(this,"O");f(this,"cd");f(this,"lt");f(this,"xi");f(this,"Qt");f(this,"fd");f(this,"mh");f(this,"Ys");if(this.$=null,t===void 0)this.$=ot.Position;else if(typeof t=="string"){const s=Rt.Layouts.get(t);s!==null&&(this.$=s)}else t instanceof Rt?this.$=t:t&&(this.$=ot.Position,i=t);this.$===null&&b.o("Panel type not specified or PanelLayout not loaded: "+t),this.n|=4194304|(this.$===ot.Grid?1048576:0),this.L=new J,this.$t=Kt.Eg,this.ad=B.Default,this.Kn=1,this.el=null,this.so="",this.Yo=new z(NaN,NaN,NaN,NaN),this.A2=null,this.O=null,this.cd=6,this.xi=null,this.lt=null,this.Qt=null,this.fd=NaN,this.mh=null,this.Ys=null,i&&Object.assign(this,i)}cloneProtected(t){super.cloneProtected(t),t.$=this.$,t.$t=this.$t.N(),t.ad=this.ad.N(),t.Kn=this.Kn,t.so=this.so,t.Yo.a(this.Yo),this.O!==null&&(t.O=this.O.copy(t)),t.cd=this.cd,this.lt!==null&&(t.lt=this.lt.copy()),this.xi!==null&&(t.xi=this.xi.copy()),t.Qt=this.Qt,t.fd=this.fd,t.mh=this.mh}Vo(t){super.Vo(t),t.L=this.L;const i=t.L.r,s=i.length;for(let n=0;n<s;n++){const o=i[n];o.Vs=t}t.el=null}copy(){const t=super.copy();if(t!==null){const i=this.L.r,s=i.length;for(let n=0;n<s;n++){const o=i[n].copy();t.lv(o)}return t}else return null}toString(){return"Panel("+this.type.name+")#"+K.as(this)}get type(){return this.$}set type(t){const i=this.$;i!==t&&(this.$=t,this.af=this.$===ot.Grid,this.c(),this.t("type",i,t))}get elements(){return this.L.iterator}get naturalBounds(){return this.Vi}get padding(){return this.$t}set padding(t){typeof t=="number"?(t<0&&b._(t,">= 0",ot,"padding"),t=new Kt(t)):(t.left<0&&b._(t.left,">= 0",ot,"padding:value.left"),t.right<0&&b._(t.right,">= 0",ot,"padding:value.right"),t.top<0&&b._(t.top,">= 0",ot,"padding:value.top"),t.bottom<0&&b._(t.bottom,">= 0",ot,"padding:value.bottom"));const i=this.$t;i.equals(t)||(t=t.N(),this.$t=t,this.c(),this.t("padding",i,t))}get defaultAlignment(){return this.ad}set defaultAlignment(t){const i=this.ad;i.equals(t)||(t=t.N(),this.ad=t,this.c(),this.t("defaultAlignment",i,t))}get defaultStretch(){return this.Kn}set defaultStretch(t){const i=this.Kn;i!==t&&(this.Kn=t,this.c(),this.t("defaultStretch",i,t))}get defaultSeparatorPadding(){return this.O!==null?this.O.Q0:Kt.Eg}set defaultSeparatorPadding(t){typeof t=="number"&&(t=new Kt(t));const i=this.defaultSeparatorPadding;i.equals(t)||(t=t.N(),this.O===null&&(this.O=new Ce),this.O.Q0=t,this.c(),this.t("defaultSeparatorPadding",i,t))}get defaultRowSeparatorStroke(){return this.O!==null?this.O._0:null}set defaultRowSeparatorStroke(t){const i=this.defaultRowSeparatorStroke;i!==t&&(t===null||typeof t=="string"||t instanceof jt)&&(t instanceof jt&&t.g(),this.O===null&&(this.O=new Ce),this.O._0=t,this.C(),this.t("defaultRowSeparatorStroke",i,t))}get defaultRowSeparatorStrokeWidth(){return this.O!==null?this.O.tp:1}set defaultRowSeparatorStrokeWidth(t){const i=this.defaultRowSeparatorStrokeWidth;i!==t&&isFinite(t)&&t>=0&&(this.O===null&&(this.O=new Ce),this.O.tp=t,this.c(),this.t("defaultRowSeparatorStrokeWidth",i,t))}get defaultRowSeparatorDashArray(){return this.O!==null?this.O.ip:null}set defaultRowSeparatorDashArray(t){const i=this.defaultRowSeparatorDashArray;if(i!==t){if(t!==null&&!Array.isArray(t)&&b.we(t,"Array",ot,"defaultRowSeparatorDashArray:value"),t!==null){const s=t.length;let n=0;for(let o=0;o<s;o++){const r=t[o];(typeof r!="number"||!(r>=0)||!isFinite(r))&&b.o("defaultRowSeparatorDashArray value "+r+" at index "+o+" must be a positive number or zero."),n+=r}if(n===0){if(i===null)return;t=null}}this.O===null&&(this.O=new Ce),this.O.ip=t,this.C(),this.t("defaultRowSeparatorDashArray",i,t)}}get defaultColumnSeparatorStroke(){return this.O!==null?this.O.ep:null}set defaultColumnSeparatorStroke(t){const i=this.defaultColumnSeparatorStroke;i!==t&&(t===null||typeof t=="string"||t instanceof jt)&&(t instanceof jt&&t.g(),this.O===null&&(this.O=new Ce),this.O.ep=t,this.C(),this.t("defaultColumnSeparatorStroke",i,t))}get defaultColumnSeparatorStrokeWidth(){return this.O!==null?this.O.sp:1}set defaultColumnSeparatorStrokeWidth(t){const i=this.defaultColumnSeparatorStrokeWidth;i!==t&&isFinite(t)&&t>=0&&(this.O===null&&(this.O=new Ce),this.O.sp=t,this.c(),this.t("defaultColumnSeparatorStrokeWidth",i,t))}get defaultColumnSeparatorDashArray(){return this.O!==null?this.O.np:null}set defaultColumnSeparatorDashArray(t){const i=this.defaultColumnSeparatorDashArray;if(i!==t){if(t!==null&&!Array.isArray(t)&&b.we(t,"Array",ot,"defaultColumnSeparatorDashArray:value"),t!==null){const s=t.length;let n=0;for(let o=0;o<s;o++){const r=t[o];(typeof r!="number"||!(r>=0)||!isFinite(r))&&b.o("defaultColumnSeparatorDashArray value "+r+" at index "+o+" must be a positive number or zero."),n+=r}if(n===0){if(i===null)return;t=null}}this.O===null&&(this.O=new Ce),this.O.np=t,this.C(),this.t("defaultColumnSeparatorDashArray",i,t)}}get gh(){return this.O!==null?this.O.gh:null}set gh(t){this.O===null&&(this.O=new Ce),this.O.gh=t}get viewboxStretch(){return this.cd}set viewboxStretch(t){const i=this.cd;i!==t&&(this.cd=t,this.c(),this.t("viewboxStretch",i,t))}get gridCellSize(){return this.xi!==null?this.xi.ud:ut.tC}set gridCellSize(t){this.xi===null&&(this.xi=new Gi);const i=this.xi.ud;if(!i.equals(t)){(!t.isReal()||t.width===0||t.height===0)&&b.o("Invalid Panel.gridCellSize: "+t),this.xi.ud=t.N();const s=this.diagram;s!==null&&this===s.grid&&s.jr(),this.C(),this.t("gridCellSize",i,t)}}get gridOrigin(){return this.xi!==null?this.xi.dd:S.Po}set gridOrigin(t){this.xi===null&&(this.xi=new Gi);const i=this.xi.dd;if(!i.equals(t)){t.isReal()||b.o("Invalid Panel.gridOrigin: "+t),this.xi.dd=t.N();const s=this.diagram;s!==null&&this===s.grid&&s.jr(),this.C(),this.t("gridOrigin",i,t)}}get graduatedMin(){return this.lt!==null?this.lt.op:0}set graduatedMin(t){const i=this.graduatedMin;if(i!==t&&(this.lt===null&&(this.lt=new fi),this.lt.op=t,this.c(),this.t("graduatedMin",i,t),this.$c())){const s=this.part;s!==null&&this.ya(s,"graduatedRange")}}get graduatedMax(){return this.lt!==null?this.lt.rp:100}set graduatedMax(t){const i=this.graduatedMax;if(i!==t&&(this.lt===null&&(this.lt=new fi),this.lt.rp=t,this.c(),this.t("graduatedMax",i,t),this.$c())){const s=this.part;s!==null&&this.ya(s,"graduatedRange")}}get graduatedRange(){return this.graduatedMax-this.graduatedMin}get graduatedTickUnit(){return this.lt!==null?this.lt.lp:10}set graduatedTickUnit(t){const i=this.graduatedTickUnit;i!==t&&t>0&&(this.lt===null&&(this.lt=new fi),this.lt.lp=t,this.c(),this.t("graduatedTickUnit",i,t))}get graduatedTickBase(){return this.lt!==null?this.lt.hp:0}set graduatedTickBase(t){const i=this.graduatedTickBase;i!==t&&(this.lt===null&&(this.lt=new fi),this.lt.hp=t,this.c(),this.t("graduatedTickBase",i,t))}get ws(){return this.lt!==null?this.lt.ws:null}set ws(t){this.lt!==null?this.lt.ws=t:t!==null&&(this.lt=new fi,this.lt.ws=t)}get je(){return this.lt!==null?this.lt.je:null}set je(t){this.lt!==null?this.lt.je=t:t!==null&&(this.lt=new fi,this.lt.je=t)}get ns(){return this.lt!==null?this.lt.ns:null}set ns(t){this.lt!==null?this.lt.ns=t:t!==null&&(this.lt=new fi,this.lt.ns=t)}get Se(){return this.lt!==null?this.lt.Se:null}set Se(t){this.lt!==null?this.lt.Se=t:t!==null&&(this.lt=new fi,this.lt.Se=t)}b0(t){super.b0(t);const i=this.L.r,s=i.length;for(let n=0;n<s;n++)i[n].b0(t)}fh(t,i){if(this.$===ot.Grid){t.commitTransform(),this.$.Gi(this,t,i);return}if(this.$===ot.Graduated){t.commitTransform(),this.$.Gi(this,t,i);return}if(this.$===ot.Table)if(t.commitTransform(),t instanceof ze){const a=t.currentElement;t.currentElement=t.newGroup2("gojs-ts"),this.T2(t,i),t.endGroup(),t.currentElement=a}else this.T2(t,i);const s=this.isClipping&&this.$===ot.Spot;s&&t.save();const n=this.findMainElement(),o=this.L.r,r=o.length;for(let a=0;a<r;a++){const h=o[a];s&&h===n&&(t.clipInsteadOfFill=!0),h.Gi(t,i),s&&h===n&&(t.clipInsteadOfFill=!1)}s&&(t.restore(),t.clearContextCache(!0))}T2(t,i){t.lineCap="butt";const s=this.rowCount>0?this.Ye:null,n=this.columnCount>0?this.Ge:null;s!==null&&this.Hb(t,i,!0,s,!0),n!==null&&this.Hb(t,i,!1,n,!0),s!==null&&this.wA(t,!0,s),n!==null&&this.wA(t,!1,n),s!==null&&this.Hb(t,i,!0,s,!1),n!==null&&this.Hb(t,i,!1,n,!1)}wA(t,i,s){const n=s.length,o=this.actualBounds,r=this.naturalBounds;let a=!0;for(let h=0;h<n;h++){const l=s[h];if(l===void 0||l.actual===0)continue;if(a){a=!1;continue}if(i){if(l.position>r.height)continue}else if(l.position>r.width)continue;let u=l.separatorStrokeWidth;isNaN(u)&&(u=i?this.defaultRowSeparatorStrokeWidth:this.defaultColumnSeparatorStrokeWidth);let c=l.separatorStroke;if(c===null&&(c=i?this.defaultRowSeparatorStroke:this.defaultColumnSeparatorStroke),u===0||c===null)continue;this.dn(t,c,!1,!1,r,o);let d=!1,m=l.separatorDashArray;m===null&&(m=i?this.defaultRowSeparatorDashArray:this.defaultColumnSeparatorDashArray),m!==null&&(d=!0,t.enableDash(m,0)),t.beginPath();const g=l.position+u;i?g>r.height&&(u-=g-r.height):g>r.width&&(u-=g-r.width);let p=l.position+u/2;t.lineWidth=u;const y=this.$t;if(i){p+=y.top;const x=y.left,P=r.width-y.right;t.moveTo(x,p),t.lineTo(P,p)}else{p+=y.left;const x=y.top,P=r.height-y.bottom;t.moveTo(p,x),t.lineTo(p,P)}t.stroke(),t.endPath(),d&&t.disableDash()}}Hb(t,i,s,n,o){const r=n.length,a=this.actualBounds,h=this.naturalBounds,l=this.xA(!0),u=this.xA(!1);for(let c=0;c<r;c++){const d=n[c];if(d===void 0||d.background===null||d.coversSeparators===o||d.actual===0)continue;const m=s?a.height:a.width;if(d.position>m)continue;let g=d.computeEffectiveSpacing(),p=d.separatorStrokeWidth;isNaN(p)&&(p=s?this.defaultRowSeparatorStrokeWidth:this.defaultColumnSeparatorStrokeWidth);let y=d.separatorStroke;y===null&&(y=s?this.defaultRowSeparatorStroke:this.defaultColumnSeparatorStroke),(y===null||d.index===(s?l:u))&&(p=0),g-=p;const x=d.position+p;let P=g+d.actual;if(x+P>m&&(P=m-x),P<=0)continue;const k=this.$t;this.dn(t,d.background,!0,!1,h,a),s?t.fillRect(k.left,x+k.top,a.width-(k.left+k.right),P):t.fillRect(x+k.left,k.top,P,a.height-(k.top+k.bottom))}}xA(t){const i=t?this.rowCount:this.columnCount;for(let s=0;s<i;s++){const n=t?this.Ye[s]:this.Ge[s];if(n!==void 0)return n.index}return 0}S0(){const t=this.L.r,i=t.length;for(let s=0;s<i;s++)t[s].S0();this.ss(!0)}Qc(t,i,s){const n=this.svg;if(n===null)return!1;if(this.type===ot.Table){const a=n.getElementsByClassName("gojs-ts"),h=a.length!==0?a[0]:null;h!==null&&(h.innerHTML=""),t.currentElement=h,this.T2(t,i),t.currentElement=null}else{if(this.$===ot.Grid||this.$===ot.Graduated)return n.innerHTML="",n.remove(),!1;if(this.$===ot.Spot&&this.isClipping)return n.innerHTML="",n.remove(),this.rh=null,this.S0(),!1}if(!super.Qc(t,i,s))return!1;const o=this.L.r,r=o.length;for(let a=0;a<r;a++)o[a].Gi(t,i);return!0}ed(t){return!0}P0(t,i,s,n){if(!this.isClipping){if(this.Xs()&&t.partClipRect!==null){const o=t.partClipRect,r=this.L.r;let a=0,h=0;for(let l=0;l<r.length;l++){if(!r[l].isVisibleObject())continue;const u=r[l].actualBounds;a=l===0?u.x:Math.min(u.x,a),h=l===0?u.y:Math.min(u.y,h)}n.setAttributeNS(null,"clip-path",`path('M ${o.x-s.x-a},${o.y-s.y-h} l ${o.width} 0 l 0 ${o.height} l -${o.width} 0 z')`);return}super.P0(t,i,s,n)}}Zc(t,i,s,n,o){const r=this.pn(),a=this.D,h=1/(a.m11*a.m22-a.m12*a.m21);let l=a.m22*h,u=-a.m12*h,c=-a.m21*h,d=a.m11*h,m=h*(a.m21*a.dy-a.m22*a.dx),g=h*(a.m12*a.dx-a.m11*a.dy);if(this.background!==null){const p=t*l+i*c+m,y=t*u+i*d+g,x=s*l+n*c+m,P=s*u+n*d+g;o.e(0,0);const k=this.naturalBounds,w=A.pl(0,0,k.width,k.height,p,y,x,P,o);return o.D(a),w}else{r||(l=1,u=0,c=0,d=1,m=0,g=0);const p=t*l+i*c+m,y=t*u+i*d+g,x=s*l+n*c+m,P=s*u+n*d+g;o.e(x,P);let k=(x-p)*(x-p)+(P-y)*(P-y),w=!1;const N=this.L.r,M=N.length,C=S.l();let O=null,T=1/0,L=null;const F=this.isClipping&&this.$===ot.Spot;F&&(L=S.l(),O=this.findMainElement(),w=O.Zc(p,y,x,P,L),w&&(T=(p-L.x)*(p-L.x)+(y-L.y)*(y-L.y)));for(let D=0;D<M;D++){const R=N[D];if(!R.visible||R===O||!R.Zc(p,y,x,P,C))continue;w=!0;const I=(p-C.x)*(p-C.x)+(y-C.y)*(y-C.y);I<k&&(k=I,o.set(C))}return F&&(T>k&&o.set(L),S.s(L)),S.s(C),r&&o.D(a),w}}Du(){const t=this.L.r,i=t.length;for(let s=0;s<i;s++)t[s].Du();super.Du()}c(t){if(this.Oo())return;super.c(t);let i=null;(this.$===ot.Auto||this.$===ot.Link)&&(i=this.findMainElement());const s=this.L.r,n=s.length;for(let o=0;o<n;o++){const r=s[o];if((r===i||r.isPanelMain)&&r.c(!0),r.desiredSize.isReal())continue;const a=r.zs(!1);!(r instanceof Ue)&&!(r instanceof ot)&&!(r instanceof Qt)&&a===0||r.c(!0)}}tf(){if(this.Oo())return;this.ue(!0),this._n(!0);const t=this.L.r,i=t.length;for(let s=0;s<i;s++)t[s].tf()}_u(){if(this.Bb()===!1){this.sd(!0),this.wa(!0);const t=this.L.r,i=t.length;for(let s=0;s<i;s++)t[s].h2()}}h2(){this.wa(!0);const t=this.L.r,i=t.length;for(let s=0;s<i;s++)t[s].h2()}Qu(t,i,s,n){const o=this.Yo;o.e(0,0,0,0);const r=this.desiredSize,a=this.minSize;s===void 0&&(s=a.width,n=a.height),s=Math.max(s,a.width),n=Math.max(n,a.height);const h=this.maxSize;isNaN(r.width)||(t=Math.min(r.width,h.width)),isNaN(r.height)||(i=Math.min(r.height,h.height)),t=Math.max(s,t),i=Math.max(n,i);const l=this.$t;t=Math.max(t-l.left-l.right,0),i=Math.max(i-l.top-l.bottom,0);const u=this.L.r;this.$.measure(this,t,i,u,o,s,n);let c=o.width+l.left+l.right,d=o.height+l.top+l.bottom;isFinite(r.width)&&(c=r.width),isFinite(r.height)&&(d=r.height),c=Math.min(h.width,c),d=Math.min(h.height,d),c=Math.max(a.width,c),d=Math.max(a.height,d),c=Math.max(s,c),d=Math.max(n,d),o.En(c,d),this.naturalBounds.En(c,d),this.Qn(0,0,c,d)}findMainElement(){if(this.el===null){const t=this.L.r,i=t.length;if(i===0)return null;for(let s=0;s<i;s++){const n=t[s];if(n.isPanelMain===!0)return this.el=n,n}this.el=t[0]}return this.el}Ko(){return this.part!==null?this.part.locationObject:null}get panelLayoutState(){return this.A2}set panelLayoutState(t){this.A2=t}ah(t,i,s,n){const o=this.L.r;if(this.actualBounds.e(t,i,s,n),!this.desiredSize.isReal()){let r=this.zs(!0);const a=this.measuredBounds,h=a.width,l=a.height,u=this.Zr,c=u.left+u.right,d=u.top+u.bottom;switch(h===s&&l===n&&(r=0),r){case 0:(h>s||l>n)&&(this.c(),this.ut(h>s?s:h,l>n?n:l,0,0));break;case 2:this.c(!0),this.ut(s+c,n+d,0,0);break;case 5:this.c(!0),this.ut(s+c,l+d,0,0);break;case 4:this.c(!0),this.ut(h+c,n+d,0,0);break}}this.$.arrange(this,o,this.Yo)}hh(t){const i=this.naturalBounds,s=this.Ko();if(z.contains(0,0,i.width,i.height,t.x,t.y)){const n=this.L.r,o=n.length,r=S.X(0,0);for(let a=o;a--;){const h=n[a];if(!(!h.visible&&h!==s)&&(r.set(t).Ie(h.D),h.containsPoint(r)))return S.s(r),!0}return S.s(r),this.Ct!==null}return!1}m0(t){if(this.$n===t)return this;const i=this.L.r,s=i.length;for(let n=0;n<s;n++){const o=i[n].m0(t);if(o!==null)return o}return null}walkVisualTreeFrom(t,i){if(i(this,t),t instanceof ot){const s=t.L.r,n=s.length;for(let o=0;o<n;o++)this.walkVisualTreeFrom(s[o],i)}}qr(t){this.bA(this,t)}bA(t,i){i(t);const s=t.L.r,n=s.length;for(let o=0;o<n;o++){const r=s[o];r instanceof ot&&this.bA(r,i)}}hv(t){this.kA(this,t)}kA(t,i){if(i(t),t instanceof ot){const s=t.L.r,n=s.length;for(let o=0;o<n;o++)this.kA(s[o],i)}}findInVisualTree(t){return this.PA(this,t)}PA(t,i){if(i(t))return t;if(t instanceof ot){const s=t.L.r,n=s.length;for(let o=0;o<n;o++){const r=this.PA(s[o],i);if(r!==null)return r}}return null}findObject(t){if(this.name===t)return this;const i=this.L.r;let s=i.length;this.av()&&(s=this.ap());for(let n=0;n<s;n++){const o=i[n];if(o instanceof ot){const r=o.findObject(t);if(r!==null)return r}if(o.name===t)return o}return null}SA(){const t=this.L.r,i=t.length;let s=0;for(let n=0;n<i;n++){const o=t[n];o instanceof ot?s=Math.max(s,o.SA()):o instanceof bt&&(s=Math.max(s,o.cv()))}return s}pn(){return!(this.type===ot.TableRow||this.type===ot.TableColumn)}_r(){return this.type===ot.TableRow||this.type===ot.TableColumn}tL(t,i,s){if(this.pickable===!1||(i===void 0&&(i=null),s===void 0&&(s=null),this.is()))return null;const n=this.naturalBounds,o=1/this.getDocumentScale(),r=this.pn(),a=r?t:S.X(t.x,t.y).Ie(this.D),h=this.diagram;let l=10,u=5;if(h!==null&&(l=h.getInputOption("extraTouchArea"),u=l/2),z.contains(-(u*o),-(u*o),n.width+l*o,n.height+l*o,a.x,a.y)){if(!this.af){const d=this.L.r,m=d.length,g=S.l(),p=this.isClipping&&this.$===ot.Spot,y=p?this.findMainElement():null;if(p&&(y.pn()?g.set(t).Ie(y.D):g.set(t),!y.containsPoint(g)))return S.s(g),r||S.s(a),null;const x=this.Ko();for(let P=m;P--;){const k=d[P];if(!k.visible&&k!==x||(k.pn()?g.set(t).Ie(k.D):g.set(t),p&&k===y))continue;let w=null;if(k instanceof ot?w=k.tL(g,i,s):k.pickable===!0&&k.containsPoint(g)&&(w=k),w!==null&&(i!==null&&(w=i(w)),w!==null&&(s===null||s(w))))return S.s(g),r||S.s(a),w}S.s(g)}if(this.background===null)return r||S.s(a),null;const c=z.contains(0,0,n.width,n.height,a.x,a.y)?this:null;return r||S.s(a),c}return r||S.s(a),null}iL(t,i,s,n){if(this.pickable===!1)return!1;i===void 0&&(i=null),s===void 0&&(s=null);const o=this.naturalBounds,r=this.pn(),a=r?t:S.X(t.x,t.y).Ie(this.D),h=this._r(),l=z.contains(0,0,o.width,o.height,a.x,a.y);if(h||l){if(!this.af){const u=this.L.r,c=u.length,d=S.l(),m=this.Ko();for(let g=c;g--;){const p=u[g];if(!p.visible&&p!==m)continue;p.pn()?d.set(t).Ie(p.D):d.set(t);let y=p;const x=p instanceof ot?p:null;if(x!==null?x.iL(d,i,s,n):y.containsPoint(d)){if(y.pickable===!1)continue;i!==null&&(y=i(y)),y!==null&&(s===null||s(y))&&n.add(y)}}S.s(d)}return r||S.s(a),l&&this.background!==null}return r||S.s(a),!1}vm(t,i,s,n,o,r){if(this.pickable===!1)return!1;i===void 0&&(i=null),s===void 0&&(s=null);let a=r;if(r===void 0&&(a=Tt.l(),a.Ri()),a.ic(this.D),this.containedInRect(t,a))return this.D2(i,s,o),r===void 0&&Tt.s(a),!0;if(this.intersectsRect(t,a)){if(!this.af){const h=this.Ko(),l=this.L.r,u=l.length;for(let c=u;c--;){const d=l[c];if(!d.visible&&d!==h)continue;const m=d.actualBounds,g=this.naturalBounds;if(m.x>g.width||m.y>g.height||m.x+m.width<0||m.y+m.height<0)continue;let p=d;const y=d instanceof ot?d:null,x=Tt.l();x.set(a),(y!==null?y.vm(t,i,s,n,o,x):p.QL(t,n,x))&&(i!==null&&(p=i(p)),p!==null&&(s===null||s(p))&&o.add(p)),Tt.s(x)}}return r===void 0&&Tt.s(a),n}return r===void 0&&Tt.s(a),!1}D2(t,i,s){const n=this.L.r,o=n.length;for(let r=o;r--;){const a=n[r];if(!a.visible)continue;const h=a.actualBounds,l=this.naturalBounds;if(h.x>l.width||h.y>l.height||h.x+h.width<0||h.y+h.height<0)continue;a instanceof ot&&a.D2(t,i,s);let u=a;t!==null&&(u=t(u)),u!==null&&(i===null||i(u))&&s.add(u)}}eL(t,i,s,n,o,r){if(this.pickable===!1)return!1;s===void 0&&(s=null),n===void 0&&(n=null);const a=this.naturalBounds,h=this.pn(),l=h?t:S.X(t.x,t.y).Ie(this.D),u=h?i:S.X(i.x,i.y).Ie(this.D),c=l.distanceSquaredPoint(u),d=l.x>0&&l.x<a.width&&l.y>0&&l.y<a.height||S.distanceLineSegmentSquared(l.x,l.y,0,0,0,a.height)<=c||S.distanceLineSegmentSquared(l.x,l.y,0,a.height,a.width,a.height)<=c||S.distanceLineSegmentSquared(l.x,l.y,a.width,a.height,a.width,0)<=c||S.distanceLineSegmentSquared(l.x,l.y,a.width,0,0,0)<=c,m=l.distanceSquared(0,0)<=c&&l.distanceSquared(0,a.height)<=c&&l.distanceSquared(a.width,0)<=c&&l.distanceSquared(a.width,a.height)<=c;if(h||(S.s(l),S.s(u)),d){if(!this.af){const g=S.l(),p=S.l(),y=this.Ko(),x=this.L.r,P=x.length;for(let k=P;k--;){const w=x[k];if(!w.visible&&w!==y)continue;const N=w.actualBounds,M=this.naturalBounds;if(h&&(N.x>M.width||N.y>M.height||N.x+N.width<0||N.y+N.height<0))continue;if(w.pn()){const T=w.D;g.set(t).Ie(T),p.set(i).Ie(T)}else g.set(t),p.set(i);let C=w;const O=w instanceof ot?w:null;(O!==null?O.eL(g,p,s,n,o,r):C._L(g,p,o))&&(s!==null&&(C=s(C)),C!==null&&(n===null||n(C))&&r.add(C))}S.s(g),S.s(p)}return o?d:m}return!1}M2(t){let i=null;if(t instanceof bt){i=t.spot1,i===B.Default&&(i=null);const s=t.geometry;s!==null&&i===null&&(i=s.spot1)}return i===null&&(i=B.TopLeft),i}N2(t){let i=null;if(t instanceof bt){i=t.spot2,i===B.Default&&(i=null);const s=t.geometry;s!==null&&i===null&&(i=s.spot2)}return i===null&&(i=B.BottomRight),i}add(...t){for(let i=0;i<t.length;i++)this.insertAt(this.L.count,t[i]);return this}elt(t){return this.L.elt(t)}insertAt(t,i){i instanceof Bt&&b.o("Cannot add a Part to a Panel: "+i+"; use a Panel instead"),(this===i||this.isContainedBy(i))&&(this===i&&b.o("Cannot make a Panel contain itself: "+this.toString()),b.o("Cannot make a Panel indirectly contain itself: "+this.toString()+" already contains "+i.toString()));const s=i.panel;if(s!==null&&s!==this&&b.o("Cannot add a GraphObject that already belongs to another Panel to this Panel: "+i.toString()+", already contained by "+s.toString()+", cannot be shared by this Panel: "+this.toString()),this.$===ot.Grid&&!(i instanceof bt)&&b.o("Can only add Shapes to a Grid Panel, not: "+i),this.$===ot.Graduated&&!(i instanceof bt||i instanceof Qt)&&b.o("Can only add Shapes or TextBlocks to a Graduated Panel, not: "+i),i.xa(this),i.Qr=null,this.itemArray!==null){const a=i.data;a!==null&&typeof a=="object"&&(this.Ys===null&&(this.Ys=new St),this.Ys.set(a,i))}const n=this.L;let o=-1;if(s===this){let a=-1;const h=this.L.r,l=h.length;for(let u=0;u<l;u++)if(h[u]===i){a=u;break}if(a!==-1){if(a===t||a+1>=n.count&&t>=n.count)return;n.removeAt(a),o=a}else b.o("element "+i.toString()+" has panel "+s.toString()+" but is not contained by it.")}(t<0||t>n.count)&&(t=n.count),n.insertAt(t,i),(t===0||i.isPanelMain)&&(this.el=null),this.Oo()||this.c(),i.c(!1),i.portId!==null?this.wn=!0:i instanceof ot&&i.wn===!0&&(this.wn=!0),this.ns=null,this.isEnabledObject()||this.qb(i,!1);const r=this.part;if(r!==null){r.D0(),r.cf(),this.wn&&r instanceof nt&&(r.wn=!0),r.wn&&r instanceof nt&&(r.ne=null);const a=this.diagram;if(a!==null&&a.undoManager.isUndoingRedoing)return;o!==-1&&r.raiseChangedEvent(4,"elements",this,i,null,o,null),r.raiseChangedEvent(3,"elements",this,null,i,null,t)}}get wn(){return(this.n&8388608)!==0}set wn(t){(this.n&8388608)!==0!==t&&(this.n=this.n^8388608)}e2(){return(this.n&16777216)!==0}F2(t){t?this.n|=16777216:this.n&=-16777217}lv(t){t.xa(this),t.Qr=null;const i=this.L,s=i.count;i.insertAt(s,t);const n=this.part;if(n!==null){n.D0(),t.portId!==null&&n instanceof nt&&(n.wn=!0);const o=this.diagram;if(o!==null&&o.undoManager.isUndoingRedoing)return;n.raiseChangedEvent(3,"elements",this,null,t,null,s)}}AR(t){const i=this.L.r,s=i.length;let n=-1;for(let o=0;o<s;o++)if(i[o]===t){n=o;break}return n}remove(t){const i=this.L.r,s=i.length;let n=-1;for(let o=0;o<s;o++)if(i[o]===t){n=o;break}n!==-1&&this.te(n,!0)}removeAt(t){t>=0&&this.te(t,!0)}te(t,i){const s=this.L,n=s.elt(t);if(n.Qr=null,n.xa(null),this.Ys!==null){const r=n.data;typeof r=="object"&&this.Ys.delete(r)}s.removeAt(t),this.ue(!1),this.c(),this.el===n&&(this.el=null),this.ns=null;const o=this.part;if(o!==null){o.D0(),o.cf(),o.invalidateAdornments(),o instanceof nt&&(n instanceof ot?n.walkVisualTreeFrom(n,(a,h)=>o.u2(h,i)):o.u2(n,i));const r=this.diagram;if(r!==null&&r.undoManager.isUndoingRedoing)return;o.raiseChangedEvent(4,"elements",this,n,null,t,null)}}get Ye(){return this.O===null&&(this.O=new Ce),this.O.Ye}get rowCount(){return this.O===null?0:this.Ye.length}getRowDefinition(t){t<0&&b._(t,">= 0",ot,"getRowDefinition:idx"),t=Math.round(t);const i=this.Ye;if(i[t]===void 0){const s=new Te;s.xa(this),s.isRow=!0,s.index=t,i[t]=s,this.raiseChangedEvent(3,"rowdefs",this,null,s,null,t)}return i[t]}removeRowDefinition(t){if(t<0&&b._(t,">= 0",ot,"removeRowDefinition:idx"),this.rowCount===0)return;t=Math.round(t);const i=this.Ye,s=i[t];if(s){i[t]=void 0;let n=i.length-1;for(;n>=0&&i[n--]===void 0;)i.length--;this.raiseChangedEvent(4,"rowdefs",this,s,null,t,null),this.c()}}DL(t,i){const s=this.Ye;if(!(t<0)){if(s[t]=i instanceof Te?i:void 0,!i){let n=s.length-1;for(;n>=0&&s[n--]===void 0;)s.length--}this.c()}}get Ge(){return this.O===null&&(this.O=new Ce),this.O.Ge}get columnCount(){return this.O===null?0:this.Ge.length}getColumnDefinition(t){t<0&&b._(t,">= 0",ot,"getColumnDefinition:idx"),t=Math.round(t);const i=this.Ge;if(i[t]===void 0){const s=new Te;s.xa(this),s.isRow=!1,s.index=t,i[t]=s,this.raiseChangedEvent(3,"coldefs",this,null,s,null,t)}return i[t]}removeColumnDefinition(t){if(t<0&&b._(t,">= 0",ot,"removeColumnDefinition:idx"),this.columnCount===0)return;t=Math.round(t);const i=this.Ge,s=i[t];if(s){i[t]=void 0;let n=i.length-1;for(;n>=0&&i[n--]===void 0;)i.length--;this.raiseChangedEvent(4,"coldefs",this,s,null,t,null),this.c()}}FL(t,i){const s=this.Ge;if(!(t<0)){if(s[t]=i instanceof Te?i:void 0,!i){let n=s.length-1;for(;n>=0&&s[n--]===void 0;)s.length--}this.c()}}addRowColumnDefinition(t){let i=null;return t.isRow?i=this.getRowDefinition(t.index):t.isRow||(i=this.getColumnDefinition(t.index)),i&&i.Ub(t),this}addRowDefinition(t,i){const s=this.getRowDefinition(t);return s&&s.Ub(new Te(i)),this}addColumnDefinition(t,i){const s=this.getColumnDefinition(t);return s&&s.Ub(new Te(i)),this}get rowSizing(){return this.O!==null?this.O.cp:3}set rowSizing(t){const i=this.rowSizing;i!==t&&(this.O===null&&(this.O=new Ce),this.O.cp=t,this.c(),this.t("rowSizing",i,t))}get columnSizing(){return this.O!==null?this.O.fp:3}set columnSizing(t){const i=this.columnSizing;i!==t&&(this.O===null&&(this.O=new Ce),this.O.fp=t,this.c(),this.t("columnSizing",i,t))}get topIndex(){return this.O!==null?this.O.dp:0}set topIndex(t){const i=this.topIndex;i!==t&&((!isFinite(t)||t<0)&&b.o("Panel.topIndex must be greater than zero and a real number, not: "+t),this.O===null&&(this.O=new Ce),this.O.dp=t,this.c(),this.t("topIndex",i,t))}get leftIndex(){return this.O!==null?this.O.gp:0}set leftIndex(t){const i=this.leftIndex;i!==t&&((!isFinite(t)||t<0)&&b.o("Panel.leftIndex must be greater than zero and a real number, not: "+t),this.O===null&&(this.O=new Ce),this.O.gp=t,this.c(),this.t("leftIndex",i,t))}findRowForLocalY(t){if(t<0||this.type!==ot.Table||this.rowCount===0)return-1;let i=0;const s=this.Ye,n=s.length;let o=this.topIndex;for(;o<n;o++){const r=s[o];if(r!==void 0&&(i+=r.total,t<i))return o}return o}findColumnForLocalX(t){if(t<0||this.type!==ot.Table||this.columnCount===0)return-1;let i=0;const s=this.Ge,n=s.length;let o=this.leftIndex;for(;o<n;o++){const r=s[o];if(r!==void 0&&(i+=r.total,t<i))return o}return o}graduatedPointForValue(t,i){if(i===void 0&&(i=new S(NaN,NaN)),this.type!==ot.Graduated)return i.e(NaN,NaN),i;t=Math.min(Math.max(t,this.graduatedMin),this.graduatedMax);const s=this.findMainElement();return s.geometry.getPointAlongPath((t-this.graduatedMin)/this.graduatedRange,i),s.D.xt(i)}graduatedValueForPoint(t){if(this.type!==ot.Graduated)return NaN;const i=this.findMainElement();return i.D._e(t),i.geometry.getFractionForPoint(t)*this.graduatedRange+this.graduatedMin}get data(){return this.Qt}set data(t){const i=this.Qt;if(i!==t){const s=this instanceof Bt&&!(this instanceof Mt);s&&b.i(t,"object",ot,"data"),this.li(),this.Qt=t;const n=this.diagram;if(n!==null)if(s)n.partManager.fv(this,i,t);else{const o=this.panel;o!==null&&o.Ys!==null&&(i!==null&&o.Ys.delete(i),t!==null&&o.Ys.set(t,this))}if(this.t("data",i,t),n!==null&&n.undoManager.isUndoingRedoing)return;t!==null&&this.updateTargetBindings()}}get itemIndex(){return this.fd}set itemIndex(t){const i=this.fd;i!==t&&(this.fd=t,this.t("itemIndex",i,t))}get Ks(){return this.f!==null?this.f.Ks:null}set Ks(t){this.Ai!==t&&(this.f===null&&(this.f=new Ri),this.f.Ks=t)}d2(){return this.Ks!==null}aA(){const t=this.Ks;return t!==null&&t.h}li(){let t=this.Ks;if(t===null)this.data!==null&&b.o("Template cannot have .data be non-null: "+this),this.Ks=t=new J;else if(t.h)return this;const i=new J;this.F2(!1),this.walkVisualTreeFrom(this,(o,r)=>{r.lh();const a=r.Ai;if(a!==null){r.a2(!1);const h=a.iterator;for(;h.next();){const l=h.value;l.mode===2&&r.a2(!0);const u=l.sourceName;if(l.isToObject){u==="/"&&o.F2(!0);const c=l.ZL(o,r);c!==null&&(i.add(c),c.Zn===null&&(c.Zn=new J),c.Zn.add(l))}t.add(l)}}if(r instanceof ot&&r.type===ot.Table){if(r.rowCount>0){const h=r.Ye,l=h.length;for(let u=0;u<l;u++){const c=h[u];if(c!==void 0&&c.Gs!==null){const d=c.Gs.iterator;for(;d.next();){const m=d.value;m.ke=c,m.gd=2,m.ff=c.index,t.add(m)}}}}if(r.columnCount>0){const h=r.Ge,l=h.length;for(let u=0;u<l;u++){const c=h[u];if(c!==void 0&&c.Gs!==null){const d=c.Gs.iterator;for(;d.next();){const m=d.value;m.ke=c,m.gd=1,m.ff=c.index,t.add(m)}}}}}});const s=i.iterator;for(;s.next();){const o=s.value;if(o.Zn!==null){o.a2(!0);const r=o.Zn.iterator;for(;r.next();){const a=r.value;o.Ai===null&&(o.Ai=new J),o.Ai.add(a)}}o.Zn=null}let n=t.iterator;for(;n.next();){const o=n.value;let r=o.ke;if(r!==null){o.ke=null;const a=o.targetProperty,h=a.indexOf(".");if(h>0&&r instanceof ot){const l=a.substring(0,h),u=a.substring(h+1),c=r.findObject(l);c!==null?(r=c,o.targetProperty=u):(b.ii('Warning: unable to find GraphObject named "'+l+'" for Binding: '+o.toString()),r=null)}if(r instanceof Te){const l=K.as(r.panel);o.targetId=l===void 0?-1:l,r.panel.$n=o.targetId}else if(r instanceof he){const l=K.as(r);o.targetId=l===void 0?-1:l,r.$n=o.targetId}else b.o("Unknown type of binding target: "+r);o.check(r)}}return t.g(),this instanceof Bt&&this.Pe()&&this.ensureBounds(),this}copyTemplate(t){t===void 0&&(t=!1);const i=this.copy();return i.hv(s=>{s instanceof ot&&(s.Ks=null,s.Qt=null);const n=s.Ai;n!==null&&(s.Ai=null,n.each(r=>s.bind(r.copy())));const o=s.ys;o!==null&&(s.ys=null,o.each(r=>s.trigger(r.value.copy())))}),t&&i.li(),i}updateTargetBindings(t){const i=this.Ks;if(i===null)return;t===void 0&&(t="");const s=i.iterator;for(;s.next();){const n=s.value,o=this.MA(n,t);if(o===null)continue;const{data:r,elt:a}=o;n.isToTheme&&this.diagram===null||a!==void 0&&n.updateTarget(a,r)}}Io(){if(this.diagram!==null)if(this.d2()){const t=this.Ks.iterator;for(;t.next();){const i=t.value;if(!i.isToTheme)continue;const s=this.MA(i);if(s===null)continue;const{data:n,elt:o}=s;o!==void 0&&i.updateTarget(o,n)}}else{const t=this.L.r,i=t.length;for(let s=0;s<i;s++)t[s].Io()}}MA(t,i=""){const s=t.sourceProperty;if(i!==""&&s!==""&&s!==i)return null;const n=t.targetProperty;if(t.converter===null&&n==="")return null;let o=this.data;const r=t.sourceName;if(t.isToObject){if(o=this.$L(r),o===null)return null}else if(t.isToModel){const u=this.diagram;if(u===null)return null;o=u.model.modelData}let a=this;const h=t.targetId;if(h!==-1){if(a=this.m0(h),a===null)return null}else t.ke!==null&&(a=t.ke);r==="/"?o=a.part:r==="."?o=a:r===".."&&(o=a.panel);const l=t.gd;if(l!==0){if(!(a instanceof ot))return null;l===1?a=a.getColumnDefinition(t.ff):l===2&&(a=a.getRowDefinition(t.ff))}return{data:o,elt:a}}get itemArray(){return this.mh}set itemArray(t){const i=this.mh;if(i!==t||t!==null&&this.uv(t)){const s=this.diagram;if(i!==t&&(s!==null&&i!==null&&s.partManager.MM(this,s),this.mh=t,s!==null&&t!==null&&s.partManager.SM(this,s)),this.t("itemArray",i,t),s!==null&&s.undoManager.isUndoingRedoing)return;this.NA(i,t)}}findItemPanelForData(t){return t==null||this.Ys===null?null:(b.i(t,"object",ot,"findItemPanelForData"),this.Ys.get(t))}uv(t){const i=this.L.r,s=i.length,n=t.length;let o=0,r=null;for(;o<s&&(r=i[o],!(r instanceof ot)||r.data===null);)o++,r=i[o];if(s-o!==n)return!0;if(r===null)return n>0;let a=0;for(;o<s&&a<n;){if(r=i[o],!(r instanceof ot)||r.data!==t[a])return!0;o++,a++}return!1}ap(){if(this.type===ot.Spot||this.type===ot.Auto)return Math.min(this.L.length,1);if(this.type===ot.Link){const t=this.L,i=t.length;let s=0;for(;s<i;s++){const n=t.elt(s);if(!(n instanceof bt)||!n.isPanelMain)return s}return s}if(this.type===ot.Table&&this.L.length>0){const t=this.L.elt(0);if(t.isPanelMain&&t instanceof ot&&t._r())return 1}return 0}rebuildItemElements(){const t=this.ap();for(;this.L.length>t;)this.te(this.L.length-1,!1);this.NA(null,this.itemArray)}NA(t,i){const s=this.ap(),n=i;if(n===null||n.length===0){for(;this.L.length>s;)this.te(this.L.length-1,!1);return}if(this.L.length<=s){const o=n.length;for(let r=0;r<o;r++)this.Wb(n[r],r,!0)}else{let o=s;for(let a=0;a<n.length;a++,o++){const h=n[a],l=o<this.L.length?this.L.elt(o):null;if(l instanceof ot){if(l.data!==h){const u=this.R2(l.data,a),c=this.R2(h,a);let d=c!==u;if(!d){const m=this.v2(l.data,a,u);d=this.v2(h,a,c)!==m}d?(this.te(o,!1),this.Wb(h,a,!1)):l.data=h}}else this.Wb(h,a,!1)}for(;o<this.L.length;)this.te(o,!1);this.el=null,this.O2(s,0),this.Oo()||this.c(),this.ns=null,this.isEnabledObject()||this.qb(this,!1);const r=this.part;r!==null&&(r.D0(),r.cf(),this.wn&&r instanceof nt&&(r.wn=!0),r.wn&&r instanceof nt&&(r.ne=null))}}Wb(t,i,s){if(t==null||i<0)return null;const n=this.R2(t,i),o=this.v2(t,i,n);if(o!==null){o.li();const r=o.copy();if(r.e2()){const h=this.findBindingPanel();h!==null&&h.F2(!0)}typeof t=="object"&&(this.Ys===null&&(this.Ys=new St),this.Ys.set(t,r));const a=i+this.ap();return this.insertAt(a,r),s&&(r.Qt=t,this.O2(a,i),r.Qt=null),r.data=t,r}return null}dv(t){if(t<0)return;const i=t+this.ap();this.te(i,!0),this.O2(i,t)}O2(t,i){const s=this.L;let n=t,o=i;for(;n<s.length;){const r=s.elt(n);r instanceof ot&&r.gv(n,o),n++,o++}}gv(t,i){this.type===ot.TableRow?this.row=t:this.type===ot.TableColumn&&(this.column=t),this.itemIndex=i}av(){return this.mh!==null||this.itemTemplateMap!==null}get itemTemplate(){return this.itemTemplateMap===null?null:this.itemTemplateMap.get("")}set itemTemplate(t){if(this.itemTemplateMap===null){if(t===null)return;this.itemTemplateMap=new St}const i=this.itemTemplateMap.get("");if(i!==t){(t instanceof Bt||t.isPanelMain)&&b.o("Panel.itemTemplate must not be a Part or be Panel.isPanelMain: "+t),this.itemTemplateMap.set("",t),this.t("itemTemplate",i,t);const s=this.diagram;if(s!==null&&s.undoManager.isUndoingRedoing)return;this.rebuildItemElements()}}get itemTemplateMap(){return this.f!==null?this.f.H0:null}set itemTemplateMap(t){const i=this.itemTemplateMap;if(i!==t){const s=t.iterator;for(;s.next();)s.value;this.jt(),this.f.H0=t,this.t("itemTemplateMap",i,t);const n=this.diagram;if(n!==null&&n.undoManager.isUndoingRedoing)return;this.rebuildItemElements()}}get itemCategoryProperty(){return this.f!==null?this.f.q0:"category"}set itemCategoryProperty(t){const i=this.itemCategoryProperty;i!==t&&(typeof t!="string"&&typeof t!="function"&&b.we(t,"string or function",ot,"itemCategoryProperty"),this.jt(),this.f.q0=t,this.t("itemCategoryProperty",i,t))}R2(t,i){if(t===null)return"";const s=this.itemCategoryProperty;let n="";if(typeof s=="function")n=s(t);else if(typeof s=="string"&&typeof t=="object"){if(s==="")return"";n=mt.vt(t,s)}else return"";if(n===void 0)return"";if(typeof n=="string")return n;b.o("Panel.getCategoryForItemData found a non-string category for "+t+": "+n)}v2(t,i,s){const n=this.itemTemplateMap;let o=null;return n!==null&&(o=n.get(s)),o===null&&(n!==null&&(o=n.get("")),o===null&&(ot.CA||(ot.CA=!0,b.ii('No item template Panel found for category "'+s+'" on '+this),b.ii("  Using default item template."),ot.LA=new ot().add(new Qt().bind("text","",b.toString).theme("stroke","text"))),o=ot.LA)),o}get af(){return(this.n&1048576)!==0}set af(t){const i=(this.n&1048576)!==0;i!==t&&(b.i(t,"boolean",ot,"isAtomic"),this.n=this.n^1048576,this.t("isAtomic",i,t))}get isClipping(){return(this.n&2097152)!==0}set isClipping(t){const i=(this.n&2097152)!==0;i!==t&&(this.S0(),this.n=this.n^2097152,this instanceof at&&(this.ni=null),this.c(),this.t("isClipping",i,t))}get isOpposite(){return(this.n&33554432)!==0}set isOpposite(t){const i=(this.n&33554432)!==0;i!==t&&(b.i(t,"boolean",ot,"isOpposite"),this.n=this.n^33554432,this.c(),this.t("isOpposite",i,t))}get isEnabled(){return(this.n&4194304)!==0}set isEnabled(t){const i=(this.n&4194304)!==0;if(i!==t){b.i(t,"boolean",ot,"isEnabled");const s=this.panel===null||this.panel.isEnabledObject();this.n=this.n^4194304,this.t("isEnabled",i,t);const n=this.diagram;if(n!==null&&n.undoManager.isUndoingRedoing)return;s&&this.qb(this,t)}}qb(t,i){const s=t.enabledChanged;if(s!==null&&s(t,i),t instanceof ot){const n=t.L.r,o=n.length;for(let r=0;r<o;r++){const a=n[r];i&&a instanceof ot&&!a.isEnabled||this.qb(a,i)}}}get alignmentFocusName(){return this.so}set alignmentFocusName(t){const i=this.so;i!==t&&(this.so=t,this.c(),this.t("alignmentFocusName",i,t))}static definePanelLayout(t,i){Rt.definePanelLayout(t,i)}};f(ot,"dE",!1),f(ot,"CA",!1),f(ot,"LA",null),f(ot,"Position",Rt.Layouts.get("Position")),f(ot,"Horizontal",Rt.Layouts.get("Horizontal")),f(ot,"Vertical",Rt.Layouts.get("Vertical")),f(ot,"Spot",Rt.Layouts.get("Spot")),f(ot,"Auto",Rt.Layouts.get("Auto")),f(ot,"Table",Rt.Layouts.get("Table")),f(ot,"Viewbox",Rt.Layouts.get("Viewbox")),f(ot,"TableRow",Rt.Layouts.get("TableRow")),f(ot,"TableColumn",Rt.Layouts.get("TableColumn")),f(ot,"Link",Rt.Layouts.get("Link")),f(ot,"Grid",Rt.Layouts.get("Grid")),f(ot,"Graduated",Rt.Layouts.get("Graduated"));let ct=ot;ct.definePanelLayout=ct.definePanelLayout;class fi{constructor(){f(this,"op");f(this,"rp");f(this,"lp");f(this,"hp");f(this,"ws");f(this,"je");f(this,"ns");f(this,"Se");this.op=0,this.rp=100,this.lp=10,this.hp=0,this.ws=null,this.je=null,this.ns=null,this.Se=null}copy(){const e=new fi;return e.op=this.op,e.rp=this.rp,e.lp=this.lp,e.hp=this.hp,e.ws=this.ws,e.je=this.je,e.ns=this.ns,e.Se=this.Se,e}}class Gi{constructor(){f(this,"ud");f(this,"dd");f(this,"Yc");f(this,"Z0");this.ud=ut.tC,this.dd=S.Po,this.Yc=ut.gw,this.Z0=[]}copy(){const e=new Gi;return e.ud=this.ud.copy(),e.dd=this.dd.copy(),e.Yc=this.Yc.copy(),e.Z0=this.Z0,e}}class Ce{constructor(){f(this,"Ye");f(this,"Ge");f(this,"cp");f(this,"fp");f(this,"dp");f(this,"gp");f(this,"Q0");f(this,"tp");f(this,"_0");f(this,"ip");f(this,"sp");f(this,"ep");f(this,"np");f(this,"gh");this.Ye=[],this.Ge=[],this.cp=3,this.fp=3,this.dp=0,this.gp=0,this.Q0=Kt.Eg,this.tp=1,this._0=null,this.ip=null,this.sp=1,this.ep=null,this.np=null,this.gh=null}copy(e){const t=new Ce,i=this.Ye,s=i.length,n=t.Ye;for(let h=0;h<s;h++){if(i[h]===void 0)continue;const l=i[h].copy();l.xa(e),n[h]=l}const o=this.Ge,r=o.length,a=t.Ge;for(let h=0;h<r;h++){if(o[h]===void 0)continue;const l=o[h].copy();l.xa(e),a[h]=l}return t.cp=this.cp,t.fp=this.fp,t.dp=this.dp,t.gp=this.gp,t.Q0=this.Q0.N(),t.tp=this.tp,t._0=this._0,t.ip=this.ip,t.sp=this.sp,t.ep=this.ep,t.np=this.np,t.gh=this.gh,t}}var Ts=(v=>(v[v.Default=1]="Default",v[v.None=2]="None",v[v.ProportionalExtra=3]="ProportionalExtra",v))(Ts||{});const Ze=class Ze{constructor(e){f(this,"Vs");f(this,"mp");f(this,"Dt");f(this,"Sa");f(this,"Ma");f(this,"oi");f(this,"at");f(this,"md");f(this,"to");f(this,"Go");f(this,"pd");f(this,"yd");f(this,"Na");f(this,"Ct");f(this,"wd");f(this,"Gs");f(this,"st");f(this,"ji");f(this,"ge");K.Yi(this),this.Vs=null,this.mp=!0,this.Dt=0,this.ge=NaN,this.Sa=0,this.Ma=1/0,this.oi=B.Default,this.st=0,this.ji=0,this.at=0,this.Gs=null,this.md=1,this.to=1,this.Go=null,this.pd=null,this.yd=NaN,this.Na=null,this.Ct=null,this.wd=!1,e&&(Object.assign(this,e),e.column!==void 0?(this.isRow=!1,this.index=e.column):e.row!==void 0&&(this.isRow=!0,this.index=e.row))}copy(){const e=new Ze;return e.mp=this.mp,e.Dt=this.Dt,e.ge=this.ge,e.Sa=this.Sa,e.Ma=this.Ma,e.oi=this.oi,e.st=this.st,e.ji=this.ji,e.at=this.at,e.to=this.to,e.md=this.md,this.Go===null?e.Go=null:e.Go=this.Go.N(),e.pd=this.pd,e.yd=this.yd,e.Na=null,this.Na!==null&&(e.separatorDashArray=this.separatorDashArray.slice()),e.Ct=this.Ct,e.wd=this.wd,e.Gs=this.Gs,e}Ub(e){e.isRow?this.height=e.height:this.width=e.width,this.minimum=e.minimum,this.maximum=e.maximum,this.alignment=e.alignment,this.stretch=e.stretch,this.sizing=e.sizing,this.Go=e.separatorPadding===null?null:e.separatorPadding.N(),this.separatorStroke=e.separatorStroke,this.separatorStrokeWidth=e.separatorStrokeWidth,this.Na=null,e.separatorDashArray&&(this.Na=e.separatorDashArray.slice()),this.background=e.background,this.coversSeparators=e.coversSeparators,this.Gs=e.Gs}ri(e){e in Ts?this.sizing=e:b.lr(this,e)}toString(){return"RowColumnDefinition "+(this.isRow?"(Row ":"(Column ")+this.index+") #"+K.as(this)}xa(e){this.Vs=e}computeEffectiveSpacingTop(e){let t=0;const i=this.Vs;if(this.index!==e){let n=this.separatorStroke;n===null&&i!==null&&(n=this.isRow?i.defaultRowSeparatorStroke:i.defaultColumnSeparatorStroke),n!==null&&(t=this.separatorStrokeWidth,isNaN(t)&&(i!==null?t=this.isRow?i.defaultRowSeparatorStrokeWidth:i.defaultColumnSeparatorStrokeWidth:t=0))}let s=this.Go;if(s===null)if(i!==null)s=i.defaultSeparatorPadding;else return t;return t+(this.isRow?s.top:s.left)}computeEffectiveSpacing(){let e=0;const t=this.Vs;let i=0;const s=this.isRow;if(t!==null&&t.type===ct.Table){const o=s?t.Ye.length:t.Ge.length;for(let r=0;r<o;r++){const a=s?t.Ye[r]:t.Ge[r];if(a!==void 0&&a.st!==0){i=a.index;break}}}if(this.index!==i){let o=this.separatorStroke;o===null&&t!==null&&(o=s?t.defaultRowSeparatorStroke:t.defaultColumnSeparatorStroke),o!==null&&(e=this.separatorStrokeWidth,isNaN(e)&&(t!==null?e=s?t.defaultRowSeparatorStrokeWidth:t.defaultColumnSeparatorStrokeWidth:e=0))}let n=this.Go;if(n===null)if(t!==null)n=t.defaultSeparatorPadding;else return e;return e+(this.isRow?n.top+n.bottom:n.left+n.right)}t(e,t,i,s,n){const o=this.Vs;if(o!==null&&(o.raiseChangedEvent(2,e,this,t,i,s,n),this.Gs!==null)){const r=o.diagram;if(r!==null&&!r.fe){const a=o.findBindingPanel();if(a!==null){const h=a.data;if(h!==null){const l=this.Gs.iterator;for(;l.next();)l.value.updateSource(this,h,e,a)}}}}}get panel(){return this.Vs}get isRow(){return this.mp}set isRow(e){this.mp=e}get index(){return this.Dt}set index(e){this.Dt=e}get height(){return this.ge}set height(e){const t=this.ge;t!==e&&(e<0&&b._(e,">= 0",Ze,"height"),this.ge=e,this.actual=this.st,this.panel!==null&&this.panel.c(),this.t("height",t,e))}get width(){return this.ge}set width(e){const t=this.ge;t!==e&&(e<0&&b._(e,">= 0",Ze,"width"),this.ge=e,this.actual=this.st,this.panel!==null&&this.panel.c(),this.t("width",t,e))}get minimum(){return this.Sa}set minimum(e){const t=this.Sa;t!==e&&((e<0||!isFinite(e))&&b._(e,">= 0",Ze,"minimum"),this.Sa=e,this.actual=this.st,this.panel!==null&&this.panel.c(),this.t("minimum",t,e))}get maximum(){return this.Ma}set maximum(e){const t=this.Ma;t!==e&&(e<0&&b._(e,">= 0",Ze,"maximum"),this.Ma=e,this.actual=this.st,this.panel!==null&&this.panel.c(),this.t("maximum",t,e))}get alignment(){return this.oi}set alignment(e){const t=this.oi;t.equals(e)||(this.oi=e.N(),this.panel!==null&&this.panel.c(),this.t("alignment",t,e))}get stretch(){return this.to}set stretch(e){const t=this.to;t!==e&&(this.to=e,this.panel!==null&&this.panel.c(),this.t("stretch",t,e))}get separatorPadding(){return this.Go}set separatorPadding(e){typeof e=="number"&&(e=new Kt(e));const t=this.Go;(e===null||t===null||!t.equals(e))&&(e!==null&&(e=e.N()),this.Go=e,this.panel!==null&&this.panel.c(),this.t("separatorPadding",t,e))}get separatorStroke(){return this.pd}set separatorStroke(e){const t=this.pd;t!==e&&(e!==null&&jt.nd(e,"RowColumnDefinition.separatorStroke"),e instanceof jt&&e.g(),this.pd=e,this.panel!==null&&this.panel.c(),this.t("separatorStroke",t,e))}get separatorStrokeWidth(){return this.yd}set separatorStrokeWidth(e){const t=this.yd;t!==e&&(this.yd=e,this.panel!==null&&this.panel.c(),this.t("separatorStrokeWidth",t,e))}get separatorDashArray(){return this.Na}set separatorDashArray(e){const t=this.Na;if(t!==e){if(e!==null&&!Array.isArray(e)&&b.we(e,"Array",Ze,"separatorDashArray:value"),e!==null){const i=e.length;let s=0;for(let n=0;n<i;n++){const o=e[n];(typeof o!="number"||!(o>=0)||!isFinite(o))&&b.o("separatorDashArray value "+o+" at index "+n+" must be a positive number or zero."),s+=o}if(s===0){if(t===null)return;e=null}}this.Na=e,this.panel!==null&&this.panel.C(),this.t("separatorDashArray",t,e)}}get background(){return this.Ct}set background(e){const t=this.Ct;t!==e&&(e!==null&&jt.nd(e,"RowColumnDefinition.background"),e instanceof jt&&e.g(),this.Ct=e,this.panel!==null&&this.panel.C(),this.t("background",t,e))}get coversSeparators(){return this.wd}set coversSeparators(e){const t=this.wd;t!==e&&(b.i(e,"boolean",Ze,"coversSeparators"),this.wd=e,this.panel!==null&&this.panel.C(),this.t("coversSeparators",t,e))}get sizing(){return this.md}set sizing(e){const t=this.md;t!==e&&(this.md=e,this.panel!==null&&this.panel.c(),this.t("sizing",t,e))}Gb(){if(this.sizing===1){const e=this.Vs;return this.isRow?e.rowSizing:e.columnSizing}return this.sizing}get actual(){return this.st}set actual(e){isNaN(this.ge)?this.st=Math.max(Math.min(this.Ma,e),this.Sa):this.st=Math.max(Math.min(this.Ma,this.ge),this.Sa)}get measured(){return this.ji}set measured(e){this.ji=e}get total(){return this.st+this.computeEffectiveSpacing()}get position(){return this.at}set position(e){this.at=e}bind(e,t,i,s){return this.sf(e,t,i,s),this}bindTwoWay(e,t,i,s){const n=this.sf(e,t,i,s);return s===void 0&&n.makeTwoWay(),this}theme(e,t,i,s,n){return this.uh(e,t,i,s,n),this}themeData(e,t,i,s,n){return this.uh(e,t,i,s,n).ofData(),this}themeObject(e,t,i,s,n,o){return this.uh(e,t,i,s,n).ofObject(o),this}themeModel(e,t,i,s,n){return this.uh(e,t,i,s,n).ofModel(),this}sf(e,t,i,s){let n=null;return typeof e=="string"?n=new bi(e,t,i,s):n=e,this.G0(n),n}uh(e,t,i,s,n){let o=null;return typeof e=="string"?o=new Hi(e,t,i,s,n):o=e,this.G0(o),o}G0(e){e.ke=this;const t=this.panel;if(t!==null){const i=t.findBindingPanel();i!==null&&i.aA()&&b.o("Cannot add a Binding to a RowColumnDefinition that is already frozen: "+e+" on "+t)}this.Gs===null&&(this.Gs=new J),this.Gs.add(e)}};f(Ze,"Default",1),f(Ze,"None",2),f(Ze,"ProportionalExtra",3);let Te=Ze;const Ut=class Ut extends he{constructor(t,i){super();f(this,"ct");f(this,"xs");f(this,"xd");f(this,"Ca");f(this,"Hi");f(this,"jo");f(this,"Xo");f(this,"Lt");f(this,"bd");f(this,"kd");f(this,"J");this.ct=null,this.xs=null,this.xd="None",this.Ca="black",this.Hi="black",this.jo=1,this.Xo=null,this.Lt=null,this.bd=NaN,this.kd=NaN,this.J=null,typeof t=="string"?this.figure=t:t&&Object.assign(this,t),i&&Object.assign(this,i)}cloneProtected(t){super.cloneProtected(t),t.ct=this.ct,t.xs=this.xs,t.xd=this.xd,t.Ca=this.Ca,t.Hi=this.Hi,t.jo=this.jo,this.Xo!==null&&(t.Xo=this.Xo.slice()),this.Lt!==null&&(this.Lt.gi?t.Lt=this.Lt:t.Lt=this.Lt.copy()),t.bd=this.bd,t.kd=this.kd,this.J!==null&&(t.J=this.J.copy())}La(){this.Lt===null?this.Lt=new Ls:this.Lt.gi&&(this.Lt=this.Lt.copy())}lh(){super.lh(),this.Lt!==null&&(this.Lt.gi=!0)}ri(t){t in ji?this.geometryStretch=t:super.ri(t)}toString(){return"Shape("+(this.figure!=="None"?this.figure:this.toArrow!=="None"?this.toArrow:this.fromArrow)+")#"+K.as(this)}mv(t,i){const s=this.pathPattern;s.ut(1/0,1/0);const n=s.measuredBounds;s.zt(0,0,n.width,n.height);const o=this.geometry;t.save(),t.beginPath();const r=b.nt();if(o.type===1)r.push(o.startX),r.push(o.startY),r.push(o.endX),r.push(o.endY),this.Pd(t,i,r,s);else if(o.type===4){const a=o.figures.iterator;for(;a.next();){const h=a.value;r.length=0,r.push(h.startX),r.push(h.startY);let l=h.startX,u=h.startY,c=l,d=u;const m=h.segments.r,g=m.length;for(let p=0;p<g;p++){const y=m[p];switch(y.type){case 1:this.Pd(t,i,r,s),r.length=0,r.push(y.endX),r.push(y.endY),l=y.endX,u=y.endY,c=l,d=u;break;case 2:r.push(y.endX),r.push(y.endY),l=y.endX,u=y.endY;break;case 3:A.Un(l,u,y.point1X,y.point1Y,y.point2X,y.point2Y,y.endX,y.endY,.5,r),l=y.endX,u=y.endY;break;case 4:A.Bg(l,u,y.point1X,y.point1Y,y.endX,y.endY,.5,r),l=y.endX,u=y.endY;break;case 5:{const x=y.Mo(h),P=x.length;if(P===0){r.push(y.centerX),r.push(y.centerY),l=y.centerX,u=y.centerY;break}for(let k=0;k<P;k++){const w=x[k];A.Un(l,u,w[2],w[3],w[4],w[5],w[6],w[7],.5,r),l=w[6],u=w[7]}break}case 6:{const x=y.Eh(h,l,u),P=x.length;if(P===0){r.push(y.endX),r.push(y.endY),l=y.endX,u=y.endY;break}for(let k=0;k<P;k++){const w=x[k];A.Un(l,u,w[2],w[3],w[4],w[5],w[6],w[7],.5,r),l=w[6],u=w[7]}break}default:b.o("Segment not of valid type: "+y.type)}y.isClosed&&(r.push(c),r.push(d),this.Pd(t,i,r,s))}this.Pd(t,i,r,s)}}else if(o.type===2)r.push(o.startX),r.push(o.startY),r.push(o.endX),r.push(o.startY),r.push(o.endX),r.push(o.endY),r.push(o.startX),r.push(o.endY),r.push(o.startX),r.push(o.startY),this.Pd(t,i,r,s);else if(o.type===3){const a=new _t;a.startX=o.endX,a.startY=(o.startY+o.endY)/2;const h=new kt(5);h.startAngle=0,h.sweepAngle=360,h.centerX=(o.startX+o.endX)/2,h.centerY=(o.startY+o.endY)/2,h.radiusX=Math.abs(o.startX-o.endX)/2,h.radiusY=Math.abs(o.startY-o.endY)/2,a.add(h);const l=h.Mo(a),u=l.length;if(u===0)r.push(h.centerX),r.push(h.centerY);else{let c=a.startX,d=a.startY;for(let m=0;m<u;m++){const g=l[m];A.Un(c,d,g[2],g[3],g[4],g[5],g[6],g[7],.5,r),c=g[6],d=g[7]}}this.Pd(t,i,r,s)}b.tt(r),t.restore(),t.clearContextCache(!1)}pv(t){let i=t.measuredBounds.width;return t instanceof Ut&&(i-=t.strokeWidth),i<1&&(i=1),i}Pd(t,i,s,n){const o=s.length;if(o<4)return;const r=n.measuredBounds,a=Math.max(1,r.width),h=r.height;let l=s[0],u=s[1],c=0,d=0,m=0,g=0,p=0,y=0,x=0,P=0;const k=b.nt();for(let F=2;F<o;F+=2)c=s[F],d=s[F+1],m=c-l,g=d-u,m===0&&(m=.001),p=g/m,y=Math.atan2(g,m),x=Math.sqrt(m*m+g*g),k.push([m,y,p,x]),P+=x,l=c,u=d;l=s[0],u=s[1];const w=this.pv(n);let N=w;const M=a/2;let C=M!==0,O=0,T=k[O];m=T[0],y=T[1],p=T[2],x=T[3];let L=0;for(;P>=.1;){if(L===0&&(C?(N=w,N-=M,P-=M,C=!1):N=w,N===0&&(N=1)),N>P){N=P,b.tt(k);return}N>x?(L=N-x,N=x):L=0;let F=Math.sqrt(N*N/(1+p*p));if(m<0&&(F=-F),l+=F,u+=p*F,t.translate(l,u),t.rotate(y),t.translate(-(a/2),-(h/2)),L===0&&n.fh(t,i),t.translate(a/2,h/2),t.rotate(-y),t.translate(-l,-u),P-=N,x-=N,L!==0){if(O++,O===k.length){b.tt(k);return}T=k[O],m=T[0],y=T[1],p=T[2],x=T[3],N=L}}b.tt(k)}fh(t,i){const s=t instanceof ze;let n=this.Hi;const o=this.Ca;if(n===null&&o===null)return;const r=this.ct;if(r===null)return;t.commitTransform();const a=this.actualBounds,h=this.naturalBounds;o!==null&&this.dn(t,o,!0,!1,h,a);const l=this.part;let u=this.jo;n!==null&&u===0&&l!==null&&(this.isPanelMain||l.findMainElement()===this)&&(u=l.yv()),u===0&&(n=null),n!==null&&u!==0&&(this.dn(t,n,!1,!1,h,a),t.lineWidth=u,t.lineJoin=this.strokeJoin,t.lineCap=this.strokeCap,t.miterLimit=this.strokeMiterLimit);let c=!1;l&&i.getRenderingHint("drawShadows")&&(c=l.isShadowed),t.tl===!1&&(c=!1);let d=!0;n!==null&&(o===null||o==="transparent")&&(d=!1);let m=!1;const g=this.strokeDashArray;if(g!==null&&(m=!0,t.enableDash(g,this.strokeDashOffset)),r.type===1)t.beginPath(),t.moveTo(r.startX,r.startY),t.lineTo(r.endX,r.endY),n!==null&&t.strokeContext(),t.endPath();else if(r.type===2){const p=r.startX,y=r.startY,x=r.endX,P=r.endY,k=Math.min(p,x),w=Math.min(y,P),N=Math.abs(x-p),M=Math.abs(P-y);t.beginPath(),t.rect(k,w,N,M),o!==null&&t.fillContext(o,!1,null),n!==null&&(d&&c&&t.shadowsOff(),t.strokeContext(),d&&c&&t.shadowsOn()),t.endPath()}else if(r.type===3){const p=r.startX,y=r.startY,x=r.endX,P=r.endY,k=Math.abs(x-p)/2,w=Math.abs(P-y)/2,N=Math.min(p,x)+k,M=Math.min(y,P)+w;t.beginPath(),t.moveTo(N,M-w),t.bezierCurveTo(N+A.Bn*k,M-w,N+k,M-A.Bn*w,N+k,M),t.bezierCurveTo(N+k,M+A.Bn*w,N+A.Bn*k,M+w,N,M+w),t.bezierCurveTo(N-A.Bn*k,M+w,N-k,M+A.Bn*w,N-k,M),t.bezierCurveTo(N-k,M-A.Bn*w,N-A.Bn*k,M-w,N,M-w),t.closePath(),o!==null&&t.fillContext(o,!1,null),n!==null&&(d&&c&&t.shadowsOff(),t.strokeContext(),d&&c&&t.shadowsOn()),t.endPath()}else if(r.type===4){const p=r.figures,y=p.length;for(let x=0;x<y;x++){const P=p.r[x];s?this.buildPath(t,P):P.Be===null&&(P.Be=new Path2D,this.buildPath(P.Be,P));const k=P.isFilled;c?P.isShadowed?(k===!0&&o!=="transparent"&&o!==null&&t.fillContext(o,P.isEvenOdd,P.Be),n!==null&&(k&&d&&t.shadowsOff(),t.stroke(P.Be),k&&d&&t.shadowsOn())):(t.shadowsOff(),k&&o!=="transparent"&&o!==null&&t.fillContext(o,P.isEvenOdd,P.Be),n!==null&&t.stroke(P.Be),t.shadowsOn()):(k&&o!==null&&t.fillContext(o,P.isEvenOdd,P.Be),n!==null&&t.stroke(P.Be)),t.endPath(x)}}m&&t.disableDash(),this.pathPattern!==null&&this.mv(t,i)}buildPath(t,i){t instanceof Path2D||t.beginPath(),t.moveTo(i.startX,i.startY);const s=i.segments.r,n=s.length;let o=null;for(let r=0;r<n;r++){const a=s[r];switch(a.type){case 1:t.moveTo(a.endX,a.endY);break;case 2:t.lineTo(a.endX,a.endY);break;case 3:t.bezierCurveTo(a.point1X,a.point1Y,a.point2X,a.point2Y,a.endX,a.endY);break;case 4:t.quadraticCurveTo(a.point1X,a.point1Y,a.endX,a.endY);break;case 5:if(a.radiusX===a.radiusY){const h=o!==null?o.endX:i.startX,l=o!==null?o.endY:i.startY,u=Math.PI/180;t.arc(a.point1X,a.point1Y,a.radiusX,a.startAngle*u,(a.startAngle+a.sweepAngle)*u,a.sweepAngle<0,h,l)}else{const h=a.Mo(i),l=h.length;if(l===0){t.lineTo(a.centerX,a.centerY);break}for(let u=0;u<l;u++){const c=h[u];u===0&&t.lineTo(c[0],c[1]),t.bezierCurveTo(c[2],c[3],c[4],c[5],c[6],c[7])}}break;case 6:{let h=0,l=0,u;if(o!==null&&o.type===5){u=o.Mo(i);const d=u.length;if(d===0){t.lineTo(a.endX,a.endY);break}const m=u[d-1]||null;m!==null&&(h=m[6],l=m[7])}else h=o!==null?o.endX:i.startX,l=o!==null?o.endY:i.startY;u=a.Eh(i,h,l);const c=u.length;if(c===0){t.lineTo(a.endX,a.endY);break}for(let d=0;d<c;d++){const m=u[d];t.bezierCurveTo(m[2],m[3],m[4],m[5],m[6],m[7])}break}}a.isClosed&&t.closePath(),o=a}}Qc(t,i,s){if(!super.Qc(t,i,s)||this.Hi===null&&this.Ca===null||this.ct===null||this.pathPattern!==null)return!1;const n=this.svg.getElementsByTagName("path");return this.geometry.figures.length!==n.length?!1:(t.currentPath=this.svg,this.fh(t,i),t.currentPath=null,!0)}ed(t){return this.geometry!==null&&this.geometry.figures.length>1||this.pathPattern!==null?!0:super.ed(t)}l2(t,i){if(t.nodeName!=="g")t.setAttributeNS(null,"filter",i);else{const s=t.getElementsByTagName("path");for(let n=0;n<s.length;n++)s[n].setAttributeNS(null,"filter",i)}}getDocumentPoint(t,i){if(i===void 0&&(i=new S),t instanceof B){const s=t;s.isNoSpot()&&b.o("getDocumentPoint Spot must be a real, specific Spot, not: "+s.toString());const n=this.naturalBounds,o=this.strokeWidth;return i.e(s.x*(n.width+o)-o/2+n.x+s.offsetX,s.y*(n.height+o)-o/2+n.y+s.offsetY),this.Es.xt(i),i}else return i.set(t),this.Es.xt(i),i}getDocumentBounds(t){t===void 0&&(t=new z);const i=this.naturalBounds,s=this.Es,n=z.X(i.x,i.y,i.width,i.height),o=this.strokeWidth;n.inflate(o/2,o/2);const r=S.X(n.x,n.y).D(s);return t.e(r.x,r.y,0,0),r.e(n.right,n.y).D(s),t.unionNoCheck(r.x,r.y,0,0),r.e(n.right,n.bottom).D(s),t.unionNoCheck(r.x,r.y,0,0),r.e(n.x,n.bottom).D(s),t.unionNoCheck(r.x,r.y,0,0),z.s(n),S.s(r),t}hh(t,i){const s=this.geometry;if(s===null||this.fill===null&&this.stroke===null)return!1;const n=s.bounds;let o=this.strokeWidth/2;s.type===1&&!i&&(o+=2);const r=z.l();if(r.a(n),r.inflate(o+2,o+2),!r.containsPoint(t))return z.s(r),!1;const a=o+1e-4;if(s.type===1){if(this.stroke===null)return!1;const h=(s.startX-s.endX)*(t.x-s.endX)+(s.startY-s.endY)*(t.y-s.endY),l=(s.endX-s.startX)*(t.x-s.startX)+(s.endY-s.startY)*(t.y-s.startY);return h<0||l<0?!1:(z.s(r),A.vi(s.startX,s.startY,s.endX,s.endY,o,t.x,t.y))}else if(s.type===2){const h=s.startX,l=s.startY,u=s.endX,c=s.endY;if(r.x=Math.min(h,u),r.y=Math.min(l,c),r.width=Math.abs(u-h),r.height=Math.abs(c-l),this.fill===null){if(r.inflate(-a,-a),r.containsPoint(t))return z.s(r),!1;r.inflate(a,a)}this.stroke!==null&&r.inflate(o,o);const d=r.containsPoint(t);return z.s(r),d}else if(s.type===3){const h=s.startX,l=s.startY,u=s.endX,c=s.endY;let d=Math.min(h,u),m=Math.min(l,c);const g=Math.abs(u-h),p=Math.abs(c-l);let y=g/2,x=p/2;if(d=t.x-(d+y),m=t.y-(m+x),this.fill===null){if(y-=a,x-=a,y<=0||x<=0||d*d/(y*y)+m*m/(x*x)<=1)return z.s(r),!1;y+=a,x+=a}return this.stroke!==null&&(y+=a,x+=a),z.s(r),y<=0||x<=0?!1:d*d/(y*y)+m*m/(x*x)<=1}else{if(s.type===4)return z.s(r),this.fill===null?s.xC(t.x,t.y,o):s.Vk(t,o,this.strokeWidth>1,i);b.o("Unknown Geometry type: "+s.type)}}Qu(t,i,s,n){const o=this.desiredSize,r=this.jo;t=Math.max(t,0),i=Math.max(i,0);let a;if(this.xs!==null)a=this.geometry.bounds;else{const p=this.figure;let y=Ut.I2[p];if(y===void 0){let x=A.So[p];typeof x=="string"&&(x=A.So[x]),typeof x=="function"?(y=x(null,100,100),Ut.I2[p]=y):b.o("Unsupported Figure: "+p)}a=y.bounds}let h=a.width,l=a.height,u=a.width,c=a.height;switch(this.zs(!0)){case 0:s=0,n=0;break;case 2:u=Math.max(t-r,0),c=Math.max(i-r,0);break;case 5:u=Math.max(t-r,0),n=0;break;case 4:s=0,c=Math.max(i-r,0);break}isFinite(o.width)&&(u=o.width),isFinite(o.height)&&(c=o.height);const d=this.maxSize,m=this.minSize;s=Math.max(s-r,m.width),n=Math.max(n-r,m.height),u=Math.min(d.width,u),c=Math.min(d.height,c),u=isFinite(u)?Math.max(s,u):Math.max(h,s),c=isFinite(c)?Math.max(n,c):Math.max(l,n);const g=this._P();switch(g){case 0:break;case 2:h=u,l=c;break;case 6:{let p=Math.min(u/h,c/l);isFinite(p)||(p=1),h=h*p,l=l*p;break}default:b.o(g+" is not a valid geometryStretch.")}if(this.xs!==null){h===0&&(h=.001),l===0&&(l=.001);const p=(this.xs!==null?this.xs:this.ct).KD(h,l);this.ct=p}else(this.ct===null||!A.K(this.ct.sc,t-r)||!A.K(this.ct.nc,i-r))&&(this.ct=Ut.wv(this,h,l));a=this.ct.bounds,t===1/0||i===1/0?this.Qn(a.x-r/2,a.y-r/2,t===0&&h===0?0:a.width+r,i===0&&l===0?0:a.height+r):this.Qn(-(r/2),-(r/2),u+r,c+r),o.isReal()?(u=o.width,c=o.height,u=Math.min(d.width,u),c=Math.min(d.height,c),u=Math.max(m.width,u),c=Math.max(m.height,c),this.Vi.e(0,0,u,c)):this.Vi.a(a)}_P(){const t=this.geometryStretch;return this.xs!==null?t===1?2:t:t===1?Ut.I2[this.figure].defaultStretch:t}ah(t,i,s,n){this.commonArrange(t,i,s,n)}getNearestIntersectionPoint(t,i,s){return this.Zc(t.x,t.y,i.x,i.y,s)}Zc(t,i,s,n,o){const r=this.D,a=1/(r.m11*r.m22-r.m12*r.m21),h=r.m22*a,l=-r.m12*a,u=-r.m21*a,c=r.m11*a,d=a*(r.m21*r.dy-r.m22*r.dx),m=a*(r.m12*r.dx-r.m11*r.dy),g=t*h+i*u+d,p=t*l+i*c+m,y=s*h+n*u+d,x=s*l+n*c+m,P=this.jo/2;let k=this.ct;k===null&&(this.ut(1/0,1/0),k=this.ct);const w=k.bounds;let N=!1;if(k.type===1)if(this.strokeWidth<=1.5)N=A.Vn(k.startX,k.startY,k.endX,k.endY,g,p,y,x,o);else{let M=0,C=0;if(k.startX===k.endX)M=P,C=0;else{const D=(k.endY-k.startY)/(k.endX-k.startX);C=P/Math.sqrt(1+D*D),M=C*D}const O=b.nt();let T=new S;A.Vn(k.startX+M,k.startY+C,k.endX+M,k.endY+C,g,p,y,x,T)&&O.push(T),T=new S,A.Vn(k.startX-M,k.startY-C,k.endX-M,k.endY-C,g,p,y,x,T)&&O.push(T),T=new S,A.Vn(k.startX+M,k.startY+C,k.startX-M,k.startY-C,g,p,y,x,T)&&O.push(T),T=new S,A.Vn(k.endX+M,k.endY+C,k.endX-M,k.endY-C,g,p,y,x,T)&&O.push(T);const L=O.length;if(L===0)return b.tt(O),!1;N=!0;let F=1/0;for(let D=0;D<L;D++){const R=O[D],I=(R.x-g)*(R.x-g)+(R.y-p)*(R.y-p);I<F&&(F=I,o.x=R.x,o.y=R.y)}b.tt(O)}else if(k.type===2)N=A.pl(w.x-P,w.y-P,w.x+w.width+P,w.y+w.height+P,g,p,y,x,o);else if(k.type===3){const M=z.X(w.x,w.y,w.width,w.height).inflate(P,P);N=this.xv(M,g,p,y,x,o),z.s(M)}else if(k.type===4){let M=0,C=0,O=0,T=0;const L=S.l();let F=y-g,D=x-p,R=F*F+D*D,I=g,j=p;if(R>0&&w.contains(I,j)&&(L.x=I,L.y=j,this.containsPoint(L)))for(F!==0&&Math.abs(F)<.5?(D*=.5/F,F=.5):D!==0&&Math.abs(D)<.5&&(F*=.5/D,D=.5),I-=F,j-=D;w.contains(I,j);)I-=F,j-=D;const X=.6;o.x=y,o.y=x;for(let pt=0;pt<k.figures.count;pt++){const Q=k.figures.r[pt],it=Q.isFilled?I:g,et=Q.isFilled?j:p,st=Q.segments;M=Q.startX,C=Q.startY;let Pt=M,wt=C;for(let _=0;_<st.count;_++){const ft=st.r[_],qt=ft.type;O=ft.endX,T=ft.endY;let Ct=!1;switch(qt){case 1:Pt=O,wt=T;break;case 2:Ct=this.Jb(M,C,O,T,it,et,y,x,L);break;case 3:{Ct=A.Ug(M,C,ft.point1X,ft.point1Y,ft.point2X,ft.point2Y,O,T,it,et,y,x,X,L);break}case 4:{Ct=A.Ug(M,C,M+2/3*(ft.point1X-M),C+2/3*(ft.point1Y-C),O+2/3*(ft.point1X-O),T+2/3*(ft.point1Y-T),O,T,it,et,y,x,X,L);break}case 5:case 6:{const tt=ft.type===5?ft.Mo(Q):ft.Eh(Q,M,C),W=tt.length;if(W===0){Ct=this.Jb(M,C,ft.type===5?ft.centerX:ft.endX,ft.type===5?ft.centerY:ft.endY,it,et,y,x,L);break}let gt=null;for(let Dt=0;Dt<W;Dt++){if(gt=tt[Dt],Dt===0&&this.Jb(M,C,gt[0],gt[1],it,et,y,x,L)){const Zt=this.$b(it,et,L,R,o);Zt<R&&(R=Zt,N=!0)}if(A.Ug(gt[0],gt[1],gt[2],gt[3],gt[4],gt[5],gt[6],gt[7],it,et,y,x,X,L)){const Zt=this.$b(it,et,L,R,o);Zt<R&&(R=Zt,N=!0)}}O=gt[6],T=gt[7];break}default:b.o("Unknown Segment type: "+qt)}if(M=O,C=T,Ct){const tt=this.$b(it,et,L,R,o);tt<R&&(R=tt,N=!0)}if(ft.isClosed&&(O=Pt,T=wt,this.Jb(M,C,O,T,it,et,y,x,L))){const tt=this.$b(it,et,L,R,o);tt<R&&(R=tt,N=!0)}}}let V=s-t,G=n-i;const $=Math.sqrt(V*V+G*G);$!==0&&(V/=$,G/=$),o.x-=V*P,o.y-=G*P,S.s(L)}else b.o("Unknown Geometry type: "+k.type);return N?(this.D.xt(o),!0):!1}$b(t,i,s,n,o){const r=s.x-t,a=s.y-i,h=r*r+a*a;return h<n?(o.x=s.x,o.y=s.y,h):n}Jb(t,i,s,n,o,r,a,h,l){if(A.K(t,s)&&A.K(i,n)||A.K(o,a)&&A.K(r,h))return!1;let u=!1;const c=(o-a)*(i-n)-(r-h)*(t-s);if(c===0)return!1;if(l.x=((o*h-r*a)*(t-s)-(o-a)*(t*n-i*s))/c,l.y=((o*h-r*a)*(i-n)-(r-h)*(t*n-i*s))/c,(t>s?t-s:s-t)<(i>n?i-n:n-i)){const d=i<n?i:n,m=i<n?n:i;(l.y>d||A.K(l.y,d))&&(l.y<m||A.K(l.y,m))&&(u=!0)}else{const d=t<s?t:s,m=t<s?s:t;(l.x>d||A.K(l.x,d))&&(l.x<m||A.K(l.x,m))&&(u=!0)}return u}bv(t,i,s){return this.pickable===!1?!1:(s.ic(this.D),i?this.kv(t,s):this.containedInRect(t,s))}containedInRect(t,i){if(i===void 0)return t.containsRect(this.actualBounds);let s=this.ct;s===null&&(this.ut(1/0,1/0),s=this.ct);const n=s.bounds,o=this.strokeWidth/2;let r=!1;const a=S.l();return a.e(n.x-o,n.y-o),t.containsPoint(i.xt(a))&&(a.e(n.x-o,n.bottom+o),t.containsPoint(i.xt(a))&&(a.e(n.right+o,n.bottom+o),t.containsPoint(i.xt(a))&&(a.e(n.right+o,n.y-o),t.containsPoint(i.xt(a))&&(r=!0)))),S.s(a),r}intersectsRect(t,i){if(this.containedInRect(t,i)||i===void 0&&(i=this.D,t.containsRect(this.actualBounds)))return!0;const s=Tt.l();s.set(i),s.yw();const n=t.left,o=t.right,r=t.top,a=t.bottom,h=S.l();if(h.e(n,r),s.xt(h),this.hh(h,!0)||(h.e(o,r),s.xt(h),this.hh(h,!0))||(h.e(n,a),s.xt(h),this.hh(h,!0))||(h.e(o,a),s.xt(h),this.hh(h,!0)))return S.s(h),!0;const l=S.l(),u=S.l();s.set(i),s.hC(this.D),s.yw(),l.x=o,l.y=r,l.D(s),h.x=n,h.y=r,h.D(s);let c=!1;return this.Aa(h,l,u)?c=!0:(h.x=o,h.y=a,h.D(s),this.Aa(h,l,u)?c=!0:(l.x=n,l.y=a,l.D(s),this.Aa(h,l,u)?c=!0:(h.x=n,h.y=r,h.D(s),this.Aa(h,l,u)&&(c=!0)))),S.s(h),Tt.s(s),S.s(l),S.s(u),c}Aa(t,i,s){if(!this.getNearestIntersectionPoint(t,i,s))return!1;const n=t.x,o=t.y,r=i.x,a=i.y,h=s.x,l=s.y;if(n===r){let u=0,c=0;return o<a?(u=o,c=a):(u=a,c=o),l>=u&&l<=c}else{let u=0,c=0;return n<r?(u=n,c=r):(u=r,c=n),h>=u&&h<=c}}kv(t,i){if(this.containedInRect(t,i)||i===void 0&&(i=this.D,t.containsRect(this.actualBounds)))return!0;const s=t.left,n=t.right,o=t.top,r=t.bottom,a=S.l(),h=S.l(),l=S.l(),u=Tt.l();u.set(i),u.hC(this.D),u.yw(),h.x=n,h.y=o,h.D(u),a.x=s,a.y=o,a.D(u);let c=!1;return this.Aa(a,h,l)?c=!0:(a.x=n,a.y=r,a.D(u),this.Aa(a,h,l)?c=!0:(h.x=s,h.y=r,h.D(u),this.Aa(a,h,l)?c=!0:(a.x=s,a.y=o,a.D(u),this.Aa(a,h,l)&&(c=!0)))),Tt.s(u),S.s(a),S.s(h),S.s(l),c}_L(t,i,s){if(s&&this.fill!==null&&this.hh(t,!0))return!0;let n=t.distanceSquaredPoint(i);const o=n;this.strokeWidth>1.5&&(n=this.strokeWidth/2+Math.sqrt(n),n*=n);let r=this.ct;if(r===null&&(this.ut(1/0,1/0),r=this.ct,r===null))return!1;if(!s){const d=r.bounds,m=d.x,g=d.y,p=d.x+d.width,y=d.y+d.height;if(S.distanceSquared(t.x,t.y,m,g)<=n&&S.distanceSquared(t.x,t.y,p,g)<=n&&S.distanceSquared(t.x,t.y,m,y)<=n&&S.distanceSquared(t.x,t.y,p,y)<=n)return!0}function a(d,m){const g=d.length;for(let p=0;p<g;p+=2)if(m.distanceSquared(d[p],d[p+1])>n)return!0;return!1}const h=r.startX,l=r.startY,u=r.endX,c=r.endY;if(r.type===1){const d=S.distanceLineSegmentSquared(t.x,t.y,h,l,u,c),m=(u-h)*(t.x-h)+(c-l)*(t.y-l),g=(h-u)*(t.x-u)+(l-c)*(t.y-c),p=m>=0&&g>=0?n:o;return d<=p}else if(r.type===2){let d=!1;return s&&(d=S.distanceLineSegmentSquared(t.x,t.y,h,l,h,c)<=n||S.distanceLineSegmentSquared(t.x,t.y,h,l,u,l)<=n||S.distanceLineSegmentSquared(t.x,t.y,u,l,u,c)<=n||S.distanceLineSegmentSquared(t.x,t.y,h,c,u,c)<=n),d}else if(r.type===3){const d=(h+u)/2,m=(l+c)/2,g=t.x-d,p=t.y-m,y=Math.abs(u-h)/2,x=Math.abs(c-l)/2;if(y===0||x===0)return S.distanceLineSegmentSquared(t.x,t.y,h,l,u,c)<=n;if(s){const P=A.vD(y,x,g,p);return P*P<=n}else return!(S.distanceSquared(g,p,-y,0)>=n||S.distanceSquared(g,p,0,-x)>=n||S.distanceSquared(g,p,0,x)>=n||S.distanceSquared(g,p,y,0)>=n)}else if(r.type===4){const d=r.bounds,m=d.x,g=d.y,p=d.x+d.width,y=d.y+d.height;if(t.x>p&&t.x<m&&t.y>y&&t.y<g&&S.distanceLineSegmentSquared(t.x,t.y,m,g,m,y)>n&&S.distanceLineSegmentSquared(t.x,t.y,m,g,p,g)>n&&S.distanceLineSegmentSquared(t.x,t.y,p,y,m,y)>n&&S.distanceLineSegmentSquared(t.x,t.y,p,y,p,g)>n)return!1;const x=Math.sqrt(n);if(s){if(this.fill===null?r.xC(t.x,t.y,x):r.Vk(t,x,!0,!1))return!0}else{const P=r.figures;for(let k=0;k<P.count;k++){const w=P.r[k];let N=w.startX,M=w.startY;if(t.distanceSquared(N,M)>n)return!1;const C=w.segments.r,O=C.length;for(let T=0;T<O;T++){const L=C[T];switch(L.type){case 1:case 2:if(N=L.endX,M=L.endY,t.distanceSquared(N,M)>n)return!1;break;case 3:{const F=b.nt();A.Un(N,M,L.point1X,L.point1Y,L.point2X,L.point2Y,L.endX,L.endY,.8,F);const D=a(F,t);if(b.tt(F),D||(N=L.endX,M=L.endY,t.distanceSquared(N,M)>n))return!1;break}case 4:{const F=b.nt();A.Bg(N,M,L.point1X,L.point1Y,L.endX,L.endY,.8,F);const D=a(F,t);if(b.tt(F),D||(N=L.endX,M=L.endY,t.distanceSquared(N,M)>n))return!1;break}case 5:case 6:{const F=L.type===5?L.Mo(w):L.Eh(w,N,M),D=F.length;if(D===0){if(N=L.type===5?L.centerX:L.endX,M=L.type===5?L.centerY:L.endY,t.distanceSquared(N,M)>n)return!1;break}let R=null;const I=b.nt();for(let j=0;j<D;j++)if(R=F[j],I.length=0,A.Un(R[0],R[1],R[2],R[3],R[4],R[5],R[6],R[7],.8,I),a(I,t))return b.tt(I),!1;b.tt(I),R!==null&&(N=R[6],M=R[7]);break}default:b.o("Unknown Segment type: "+L.type)}}}return!0}}return!1}xv(t,i,s,n,o,r){if(t.width===0)return A.Vn(t.x,t.y,t.x,t.y+t.height,i,s,n,o,r);if(t.height===0)return A.Vn(t.x,t.y,t.x+t.width,t.y,i,s,n,o,r);{const a=t.width/2,h=t.height/2,l=t.x+a,u=t.y+h;let c=9999;if(i!==n&&(c=(s-o)/(i-n)),Math.abs(c)<9999){const d=s-u-c*(i-l);if(a*a*(c*c)+h*h-d*d<0)return r.x=NaN,r.y=NaN,!1;const m=Math.sqrt(a*a*(c*c)+h*h-d*d),g=(-(a*a*c*d)+a*h*m)/(h*h+a*a*(c*c))+l,p=(-(a*a*c*d)-a*h*m)/(h*h+a*a*(c*c))+l,y=c*(g-l)+d+u,x=c*(p-l)+d+u,P=Math.abs((i-g)*(i-g))+Math.abs((s-y)*(s-y)),k=Math.abs((i-p)*(i-p))+Math.abs((s-x)*(s-x));P<k?(r.x=g,r.y=y):(r.x=p,r.y=x)}else{const d=h*h,m=a*a,g=i-l,p=d-d/m*(g*g);if(p<0)return r.x=NaN,r.y=NaN,!1;const y=Math.sqrt(p),x=u+y,P=u-y,k=Math.abs(x-s),w=Math.abs(P-s);k<w?(r.x=i,r.y=x):(r.x=i,r.y=P)}return!0}}cv(){return this.jo/2*this.strokeMiterLimit*this.getDocumentScale()}get geometry(){return this.ct!==null?this.ct:this.xs}set geometry(t){const i=this.ct,s=this.xs;if(i===t)return;t!==null?(this.ct=t.g(),this.xs=this.ct):(this.ct=null,this.xs=null);const n=this.part;if(n!==null&&n.cf(),this.c(),this.t("geometry",i||s,t),this.$c()){const o=this.part;o!==null&&this.ya(o,"geometryString")}}get geometryString(){return this.geometry===null?"":this.geometry.toString()}set geometryString(t){const i=Ft.parse(t),s=i.normalize();this.geometry=i;const n=S.X(-s.x,-s.y);this.position=n,S.s(n)}get isGeometryPositioned(){return(this.n&1048576)!==0}set isGeometryPositioned(t){const i=(this.n&1048576)!==0;i!==t&&(this.n=this.n^1048576,this.c(),this.t("isGeometryPositioned",i,t))}ee(){this.ct=null}get fill(){return this.Ca}set fill(t){const i=this.Ca;i!==t&&(t!==null&&jt.nd(t,"Shape.fill"),t instanceof jt&&t.g(),this.Ca=t,this.C(),this.t("fill",i,t))}get stroke(){return this.Hi}set stroke(t){const i=this.Hi;i!==t&&(t!==null&&jt.nd(t,"Shape.stroke"),t instanceof jt&&t.g(),this.Hi=t,this.C(),this.t("stroke",i,t))}get strokeWidth(){return this.jo}set strokeWidth(t){const i=this.jo;if(i!==t)if(t>=0){this.jo=t,this.c();const s=this.part;s!==null&&s.cf(),this.t("strokeWidth",i,t)}else b._(t,"value >= 0",Ut,"strokeWidth:value")}w0(){return this.jo}get strokeCap(){return this.Lt!==null?this.Lt.pp:"butt"}set strokeCap(t){const i=this.strokeCap;i!==t&&(typeof t=="string"&&(t==="butt"||t==="round"||t==="square")?(this.La(),this.Lt.pp=t,this.C(),this.t("strokeCap",i,t)):b._(t,'"butt", "round", or "square"',Ut,"strokeCap"))}get strokeJoin(){return this.Lt!==null?this.Lt.yp:"miter"}set strokeJoin(t){const i=this.strokeJoin;i!==t&&(typeof t=="string"&&(t==="miter"||t==="bevel"||t==="round")?(this.La(),this.Lt.yp=t,this.C(),this.t("strokeJoin",i,t)):b._(t,'"miter", "bevel", or "round"',Ut,"strokeJoin"))}get strokeMiterLimit(){return this.Lt!==null?this.Lt.wp:10}set strokeMiterLimit(t){const i=this.strokeMiterLimit;if(i!==t&&t>=1){this.La(),this.Lt.wp=t,this.C();const s=this.part;s!==null&&s.cf(),this.t("strokeMiterLimit",i,t)}}get strokeDashArray(){return this.Xo}set strokeDashArray(t){const i=this.Xo;if(i!==t){if(t!==null&&!Array.isArray(t)&&b.we(t,"Array",Ut,"strokeDashArray:value"),t!==null){const s=t.length;let n=0;for(let o=0;o<s;o++){const r=t[o];(!(r>=0)||!isFinite(r))&&b.o("strokeDashArray:value "+r+" at index "+o+" must be a positive number or zero."),n+=r}if(n===0){if(i===null)return;t=null}}this.Xo=t,this.C(),this.t("strokeDashArray",i,t)}}get strokeDashOffset(){return this.Lt!==null?this.Lt.dh:0}set strokeDashOffset(t){const i=this.strokeDashOffset;i!==t&&t>=0&&(this.La(),this.Lt.dh=t,this.C(),this.t("strokeDashOffset",i,t))}get figure(){return this.xd}set figure(t){const i=this.xd;if(i!==t){let s=A.So[t];if(typeof s=="function"?s=t:(s=A.So[t.toLowerCase()],s||b.o("Unknown Shape.figure: "+t)),i!==s){const n=this.part;n!==null&&n.cf(),this.xd=s,this.xs=null,this.ee(),this.c(),this.t("figure",i,s)}}}get toArrow(){return this.Bt!==null?this.Bt.xp:"None"}set toArrow(t){const i=this.toArrow;if(t===!0?t="Standard":t===!1&&(t=""),i!==t){const s=Ut.AA(t);s===null?b.o("Unknown Shape.toArrow: "+t):i!==s&&(this.Bt===null&&(this.Bt=new Si),this.Bt.xp=s,this.xs=null,this.ee(),this.c(),this.TA(s),this.t("toArrow",i,s))}}get fromArrow(){return this.Bt!==null?this.Bt.bp:"None"}set fromArrow(t){const i=this.fromArrow;if(t===!0?t="Standard":t===!1&&(t=""),i!==t){const s=Ut.AA(t);s===null?b.o("Unknown Shape.fromArrow: "+t):i!==s&&(this.Bt===null&&(this.Bt=new Si),this.Bt.bp=s,this.xs=null,this.ee(),this.c(),this.TA(s),this.t("fromArrow",i,s))}}TA(t){const i=this.diagram;if(i!==null&&i.undoManager.isUndoingRedoing)return;this.vR();const s=B.MiddleRight;this.toArrow!=="None"?(this.segmentIndex=-1,this.alignmentFocus=s):this.fromArrow!=="None"&&(this.segmentIndex=0,this.alignmentFocus=new B(1-s.x,s.y))}get spot1(){return this.Lt!==null?this.Lt.zn:B.Default}set spot1(t){const i=this.spot1;i.equals(t)||(t=t.N(),this.La(),this.Lt.zn=t,this.c(),this.t("spot1",i,t))}get spot2(){return this.Lt!==null?this.Lt.Xn:B.Default}set spot2(t){const i=this.spot2;i.equals(t)||(t=t.N(),this.La(),this.Lt.Xn=t,this.c(),this.t("spot2",i,t))}get parameter1(){return this.bd}set parameter1(t){const i=this.bd;i!==t&&(this.bd=t,this.ee(),this.c(),this.t("parameter1",i,t))}get parameter2(){return this.kd}set parameter2(t){const i=this.kd;i!==t&&(this.kd=t,this.ee(),this.c(),this.t("parameter2",i,t))}get naturalBounds(){return this.Vi}_R(){const t=this.desiredSize;if(!t.isReal()&&this.ct!==null){const i=this.ct.bounds;this.Vi.a(i)}else this.Vi.e(0,0,t.width,t.height)}get pathPattern(){return this.Lt!==null?this.Lt.kp:null}set pathPattern(t){const i=this.pathPattern;i!==t&&(this.La(),this.Lt.kp=t,this.C(),this.t("pathPattern",i,t))}get geometryStretch(){return this.Lt!==null?this.Lt.Pp:1}set geometryStretch(t){const i=this.geometryStretch;i!==t&&(this.La(),this.Lt.Pp=t,this.c(),this.t("geometryStretch",i,t))}get interval(){return this.J!==null?this.J.uf:1}set interval(t){const i=this.interval;if(t=Math.round(t),i!==t&&t!==0&&isFinite(t)){this.J===null&&(this.J=new ii),this.J.uf=t;const s=this.diagram;s!==null&&this.panel===s.grid&&s.jr(),this.c();const n=this.panel;n!==null&&(n.ns=null),this.t("interval",i,t)}}get graduatedStart(){return this.J!==null?this.J.df:0}set graduatedStart(t){const i=this.graduatedStart;i!==t&&(t<0?t=0:t>1&&(t=1),this.J===null&&(this.J=new ii),this.J.df=t,this.c(),this.t("graduatedStart",i,t))}get graduatedEnd(){return this.J!==null?this.J.gf:1}set graduatedEnd(t){const i=this.graduatedEnd;i!==t&&(t<0?t=0:t>1&&(t=1),this.J===null&&(this.J=new ii),this.J.gf=t,this.c(),this.t("graduatedEnd",i,t))}get graduatedSkip(){return this.J!==null?this.J.mf:null}set graduatedSkip(t){const i=this.graduatedSkip;i!==t&&(t!==null&&b.i(t,"function",Ut,"graduatedSkip"),this.J===null&&(this.J=new ii),this.J.mf=t,this.c(),this.t("graduatedSkip",i,t))}static wv(t,i,s){let n=null;if(t.toArrow!=="None")n=Ut.no[t.toArrow];else if(t.fromArrow!=="None")n=Ut.no[t.fromArrow];else{let o=A.So[t.figure];typeof o=="string"&&(o=A.So[o]),o===void 0&&b.o("Unknown Shape.figure: "+t.figure),n=o(t,i,s),n.sc=i,n.nc=s}if(n===null){const o=A.So.Rectangle;typeof o=="function"&&(n=o(t,i,s))}return n}static getFigureGenerators(){const t=new St;for(const i in A.So){if(i===i.toLowerCase())continue;const s=A.So[i];t.set(i,s)}return t.g(),t}static defineFigureGenerator(t,i){b.i(t,"string",Ut,"defineFigureGenerator:name"),typeof i=="string"||b.i(i,"function",Ut,"defineFigureGenerator:func");const s=t.toLowerCase(),n=A.So;n[t]=i,n[s]=t}static getArrowheadGeometries(){const t=new St;for(const i in A.Xg)if(Ut.no[i]===void 0){const s=Ft.parse(A.Xg[i],!1);Ut.no[i]=s;const n=i.toLowerCase();n!==i&&(Ut.no[n]=i)}for(const i in Ut.no){if(i===i.toLowerCase())continue;const s=Ut.no[i];s instanceof Ft&&t.set(i,s)}return t.g(),t}static defineArrowheadGeometry(t,i){b.i(t,"string",Ut,"defineArrowheadGeometry:name");let s=null;typeof i=="string"?(b.i(i,"string",Ut,"defineArrowheadGeometry:pathstr"),s=Ft.parse(i,!1)):s=i;const n=t.toLowerCase();(n==="none"||t===n)&&b.o("Shape.defineArrowheadGeometry name must not be empty or None or all-lower-case: "+t);const o=Ut.no;o[t]=s,o[n]=t}static AA(t){let i=Ut.no[t];if(i===void 0){const s=t.toLowerCase();if(s==="none")return"None";if(i=Ut.no[s],i===void 0){let n=null;for(const o in A.Xg)if(o.toLowerCase()===s){n=o;break}if(n!==null){const o=Ft.parse(A.Xg[n],!1);return Ut.no[n]=o,s!==n&&(Ut.no[s]=n),n}}}return typeof i=="string"?i:i instanceof Ft?t:null}};f(Ut,"no",new fe),f(Ut,"I2",new fe);let bt=Ut;class Ls{constructor(){f(this,"gi");f(this,"pp");f(this,"yp");f(this,"wp");f(this,"dh");f(this,"kp");f(this,"Pp");f(this,"zn");f(this,"Xn");this.gi=!1,this.pp="butt",this.yp="miter",this.wp=10,this.dh=0,this.kp=null,this.Pp=1,this.zn=B.Default,this.Xn=B.Default}copy(){const e=new Ls;return e.pp=this.pp,e.yp=this.yp,e.wp=this.wp,e.dh=this.dh,e.kp=this.kp,e.Pp=this.Pp,e.zn=this.zn.N(),e.Xn=this.Xn.N(),e}}var As=(v=>(v[v.None=0]="None",v[v.Fit=1]="Fit",v[v.DesiredSize=2]="DesiredSize",v[v.BreakAll=3]="BreakAll",v))(As||{}),dn=(v=>(v[v.Clip=0]="Clip",v[v.Ellipsis=1]="Ellipsis",v))(dn||{}),fn=(v=>(v[v.Trim=0]="Trim",v[v.None=1]="None",v))(fn||{});const Nt=class Nt extends he{constructor(t,i){super();f(this,"hi");f(this,"Hi");f(this,"kn");f(this,"Ce");f(this,"mi");f(this,"x0");f(this,"Sd");f(this,"J");f(this,"W");f(this,"Dl");f(this,"oo");f(this,"Pn");f(this,"Le");f(this,"Di");f(this,"Sn");return this.n|=2097152,this.hi="",this.Hi="black",this.kn="13px sans-serif",this.Ce=0,this.mi=0,this.x0=0,this.Sd=null,this.J=null,this.W=null,this.Dl=0,this.oo=null,this.Pn=0,this.Le=null,this.Di=null,this.Sn=null,typeof t=="string"?this.text=t:t&&Object.assign(this,t),i&&Object.assign(this,i),this}cloneProtected(t){super.cloneProtected(t),t.hi=this.hi,t.Hi=this.Hi,t.kn=this.kn,t.Ce=this.Ce,t.mi=this.mi,t.x0=this.x0,t.Sd=this.Sd,this.J!==null&&(t.J=this.J.copy()),this.W!==null&&(this.W.gi?t.W=this.W:t.W=this.W.copy()),t.Dl=this.Dl,t.oo=this.oo,t.Pn=this.Pn,t.Le=this.Le,t.Di=this.Di,t.Sn=this.Sn}Mn(){this.W===null?this.W=new Ds:this.W.gi&&(this.W=this.W.copy())}lh(){super.lh(),this.W!==null&&(this.W.gi=!0)}rv(t){this.n=t.n|2048|4096,this.Wt=t.opacity,this.Ct=t.background,this.ze=t.desiredSize.N(),this.minSize=t.minSize.N(),this.maxSize=t.maxSize.N(),t.bi!==null?this.bi=t.bi.copy():this.bi=null,this.et=t.scale,this.Xt=t.angle,this.stretch=t.stretch,this.Zr=t.margin.N(),this.oi=t.alignment.N(),this.Wc=t.alignmentFocus.N(),this.segmentFraction=t.segmentFraction,this.segmentOffset=t.segmentOffset.N(),this.segmentOrientation=t.segmentOrientation,t.ni!==null&&(this.ni=t.ni.copy()),this.shadowVisible=t.shadowVisible,this.hi=t.hi,this.Hi=t.Hi,this.kn=t.kn,this.J!==null&&(this.J=t.J.copy()),t.W!==null&&(t.W.gi?this.W=t.W:this.W=t.W.copy()),this.Dl=t.Dl}nv(t){if(this.hi=t.text||"",this.Xt=t.labelAngle||0,this.Ce=t.lineCount||0,this.Pv(t.lines),t.naturalBounds&&(this.Vi=t.naturalBounds),t.actualBounds){const i=t.actualBounds;this.zt(i.x,i.y,i.width,i.height)}}ri(t){t in As?this.wrap=t:super.ri(t)}toString(){return this.hi.length>22?'TextBlock("'+this.hi.substring(0,20)+'"...)':'TextBlock("'+this.hi+'")'}static getEllipsis(){return Nt.Sp}static setEllipsis(t){Nt.Sp=t,Nt.Zb=new fe,Nt.E2=0}static getBaseline(){return Nt.Qb}static setBaseline(t){Nt.Qb=t}static getUnderline(){return Nt._b}static setUnderline(t){Nt._b=t}c(){super.c()}get font(){return this.kn}set font(t){const i=this.kn;i!==t&&(this.kn=t,this.oo=null,this.c(),this.t("font",i,t))}static isValidFont(t){return Z.CSS?Z.CSS.supports("font",t):!0}get text(){return this.hi}set text(t){const i=this.hi;t!=null?t=t.toString():t="",i!==t&&(this.hi=t,this.c(),this.t("text",i,t),this.ss(!0))}get textAlign(){return this.W!==null?this.W.Mp:"start"}set textAlign(t){const i=this.textAlign;i!==t&&(t==="start"||t==="end"||t==="left"||t==="right"||t==="center")&&(this.Mn(),this.W.Mp=t,this.C(),this.t("textAlign",i,t))}get flip(){return this.W!==null?this.W.ro:0}set flip(t){const i=this.flip;i!==t&&(this.Mn(),this.W.ro=t,this.C(),this.t("flip",i,t))}get verticalAlignment(){return this.W!==null?this.W.sl:B.Top}set verticalAlignment(t){const i=this.verticalAlignment;i.equals(t)||(t=t.N(),this.Mn(),this.W.sl=t,this.ef(),this.t("verticalAlignment",i,t))}get naturalBounds(){if(!this.Vi.isReal()){const t=ut.l();this.B2(this.hi,999999,t);let i=t.width;ut.s(t);let s=this.DA(i);const n=this.desiredSize;isNaN(n.width)||(i=n.width),isNaN(n.height)||(s=n.height),this.Vi.En(i,s)}return this.Vi}get isMultiline(){return(this.n&2097152)!==0}set isMultiline(t){const i=(this.n&2097152)!==0;i!==t&&(this.n=this.n^2097152,this.c(),this.t("isMultiline",i,t))}get isUnderline(){return(this.n&4194304)!==0}set isUnderline(t){const i=(this.n&4194304)!==0;i!==t&&(this.n=this.n^4194304,this.ss(!0),this.C(),this.t("isUnderline",i,t))}get isStrikethrough(){return(this.n&8388608)!==0}set isStrikethrough(t){const i=(this.n&8388608)!==0;i!==t&&(this.n=this.n^8388608,this.ss(!0),this.C(),this.t("isStrikethrough",i,t))}get wrap(){return this.W!==null?this.W.Np:2}set wrap(t){const i=this.wrap;i!==t&&(this.Mn(),this.W.Np=t,this.c(),this.t("wrap",i,t))}get overflow(){return this.W!==null?this.W.Cp:0}set overflow(t){const i=this.overflow;i!==t&&(this.Mn(),this.W.Cp=t,this.c(),this.t("overflow",i,t))}get isOverflowed(){return(this.n&16777216)!==0}U2(t){t?this.n|=16777216:this.n&=-16777217}get stroke(){return this.Hi}set stroke(t){const i=this.Hi;i!==t&&(t!==null&&jt.nd(t,"TextBlock.stroke"),t instanceof jt&&t.g(),this.Hi=t,this.C(),this.t("stroke",i,t))}get lineCount(){return this.Ce}get lineHeight(){return this.Lp()}get editable(){return(this.n&1048576)!==0}set editable(t){const i=(this.n&1048576)!==0;i!==t&&(this.n=this.n^1048576,this.t("editable",i,t))}get L2(){return(this.n&33554432)!==0}set L2(t){this.n=this.n^33554432}get textEditor(){return this.W!==null?this.W.Ap:null}set textEditor(t){const i=this.textEditor;i!==t&&(this.Mn(),this.W.Ap=t,this.t("textEditor",i,t))}get errorFunction(){return this.W!==null?this.W.os:null}set errorFunction(t){const i=this.errorFunction;i!==t&&(t!==null&&b.i(t,"function",Nt,"errorFunction"),this.Mn(),this.W.os=t,this.t("errorFunction",i,t))}get interval(){return this.J!==null?this.J.uf:1}set interval(t){const i=this.interval;if(t=Math.round(t),i!==t&&t!==0&&isFinite(t)){this.J===null&&(this.J=new ii),this.J.uf=t,this.c();const s=this.panel;s!==null&&(s.ns=null),this.t("interval",i,t)}}get graduatedStart(){return this.J!==null?this.J.df:0}set graduatedStart(t){const i=this.graduatedStart;i!==t&&(t<0?t=0:t>1&&(t=1),this.J===null&&(this.J=new ii),this.J.df=t,this.c(),this.t("graduatedStart",i,t))}get graduatedEnd(){return this.J!==null?this.J.gf:1}set graduatedEnd(t){const i=this.graduatedEnd;i!==t&&(t<0?t=0:t>1&&(t=1),this.J===null&&(this.J=new ii),this.J.gf=t,this.c(),this.t("graduatedEnd",i,t))}get graduatedFunction(){return this.J!==null?this.J.Tp:null}set graduatedFunction(t){const i=this.graduatedFunction;i!==t&&(t!==null&&b.i(t,"function",Nt,"graduatedFunction"),this.J===null&&(this.J=new ii),this.J.Tp=t,this.c(),this.t("graduatedFunction",i,t))}get graduatedSkip(){return this.J!==null?this.J.mf:null}set graduatedSkip(t){const i=this.graduatedSkip;i!==t&&(t!==null&&b.i(t,"function",Nt,"graduatedSkip"),this.J===null&&(this.J=new ii),this.J.mf=t,this.c(),this.t("graduatedSkip",i,t))}fh(t,i){if(this.Hi===null||this.hi.length===0||this.kn===null)return;const s=this.naturalBounds,n=this.actualBounds,o=s.width,r=s.height,a=this.Lp();let h=t.textAlign=this.textAlign;const l=i.Xu;h==="start"?h=l?"right":"left":h==="end"&&(h=l?"left":"right");const u=this.isUnderline,c=this.isStrikethrough;this.dn(t,this.Hi,!0,!1,s,n),(u||c)&&this.dn(t,this.Hi,!1,!1,s,n);const d=0;let m=0;const g=o;let p=!1;i.Zt===t&&!(i.Zt instanceof ze)&&!this.L2&&i.getRenderingHint("textGreeking")===!0&&a*this.ca*i.scale<3&&(p=!0);const y=this.spacingAbove,x=this.spacingBelow;switch(this.flip){case 0:break;case 2:t.translate(o,0),t.scale(-1,1);break;case 1:t.translate(0,r),t.scale(1,-1);break;case 3:t.translate(o,r),t.scale(-1,-1);break}t.commitTransform();const P=this.Ce,k=(y+a+x)*P;if(r>k){const w=this.verticalAlignment;m=w.y*r-w.y*k+w.offsetY}if(P===1&&this.Sn!==null){let w=this.mi;w>g&&(w=g),m+=y,this.FA(this.Sn,t,d,m,g,a,w,p,h,u,c)}else if(this.Le!==null&&this.Di!==null)for(let w=0;w<P;w++){let N=this.Le[w];N>g&&(N=g),m+=y,this.FA(this.Di[w],t,d,m,g,a,N,p,h,u,c),m+=a+x}switch(this.flip){case 0:break;case 2:t.scale(-1,1),t.translate(-o,0);break;case 1:t.scale(1,-1),t.translate(0,-r);break;case 3:t.scale(-1,-1),t.translate(-o,-r);break}}FA(t,i,s,n,o,r,a,h,l,u,c){let d=0;if(h){l==="left"?d=0:l==="right"?d=o-a:l==="center"&&(d=(o-a)/2);const p=i.globalAlpha;i.globalAlpha=p/2,i.fillRect(s+d,n+r/4,a,r/2),i.globalAlpha=p;return}l==="left"?d=0:l==="right"?d=o:l==="center"&&(d=o/2);const m=Nt.Qb!==null?Nt.Qb(this,r):r*.75;i.fillText(t,s+d,n+m);let g=r/20|0;if(g===0&&(g=1),l==="right"?d-=a:l==="center"&&(d-=a/2),u){const p=Nt._b!==null?Nt._b(this,r):r*.8;this.RA(s+d,n+p,s+d+a,n+p,g,i),i instanceof ze&&i.lastCreatedElement.classList.add("gojs-td")}if(c){let p=n+r-r/2.2|0;g%2!==0&&(p+=.5),this.RA(s+d,p,s+d+a,p,g,i),i instanceof ze&&i.lastCreatedElement.classList.add("gojs-td")}}RA(t,i,s,n,o,r){r.beginPath(),r.lineWidth=o,r.moveTo(t,i),r.lineTo(s,n),r.stroke(),r.endPath()}Qc(t,i,s){if(!super.Qc(t,i,s))return!1;if(this.dn(t,this.Hi,!0,!1,this.naturalBounds,this.actualBounds),s){if(this.svg.getElementsByTagName("text").length===0)return!0;const n=this.svg.getElementsByClassName("gojs-td");for(let o=0;o<n.length;o++)t.setFillOrStrokeInPlace(n[o],!1)}else this.Sv(this.svg,this.text,t);return!0}Sv(t,i,s){t.innerHTML=i,s.setFillOrStrokeInPlace(t,!0)}ed(t){return this.lineCount>1||this.isUnderline||this.isStrikethrough?!0:super.ed(t)}l2(t,i){if(t.nodeName!=="g")t.setAttributeNS(null,"filter",i);else{const s=t.getElementsByTagName("text");for(let n=0;n<s.length;n++)s[n].setAttributeNS(null,"filter",i)}}Mv(){this.Pn=0,this.mi=0,this.oo=null,this.Le=null,this.Di=null,this.Sn=null}Qu(t,i,s,n){const o=this.Ce;this.Dl=t,this.U2(!1);const r=this.kn;Nt.il!==null&&Nt.vA!==r&&(Nt.il.font=r,Nt.vA=r),this.Mv();let a=0,h=0;isNaN(this.desiredSize.width)?(a=this.Nv(),a=Math.min(a,t/this.scale)):a=this.desiredSize.width,this.panel!==null&&(a=Math.min(a,this.panel.maxSize.width)),h=this.DA(a),isNaN(this.desiredSize.height)?h=Math.min(h,i/this.scale):h=this.desiredSize.height,this.Cv(t,h),(this.wrap===1||isNaN(this.desiredSize.width))&&(a=isNaN(t)?this.mi:Math.min(t,this.mi)),a=Math.max(s,a),h=Math.max(n,h),this.Vi.En(a,h),this.Qn(0,0,a,h),this.svg!==null&&o!==this.Ce&&this.ss(!0)}ah(t,i,s,n){this.commonArrange(t,i,s,n)}Nn(t,i){this.Sn===null?(this.Sn=t,this.mi=i):((this.Di===null||this.Le===null)&&(this.Di=[],this.Le=[],this.Di.push(this.Sn),this.Le.push(this.mi)),this.Di.push(t),this.Le.push(i),this.Di.length>this.maxLines&&(this.n|=16777216))}B2(t,i,s){const n=this.formatting===0;n&&(t=t.trim());let o=0,r=0,a=0;const h=this.kn,l=this.spacingAbove+this.spacingBelow,u=Math.max(0,this.Lp()+l),c=this.overflow===1?this.OA(h):0;if(this.Ce>=this.maxLines){s!==null&&s.e(0,u);return}let d=t;if(this.wrap===0){if(this.Pn=1,r=this.getStringWidth(t),c===0||r<=i){this.mi=Math.max(this.mi,r),this.Nn(t,this.mi),s!==null&&s.e(r,u);return}let g=this.Md(d);d=d.substring(g.length);let p=this.Md(d);for(r=this.getStringWidth(g+p),a=0;p.length>0&&r<=i;){g+=p,d=d.substring(p.length),p=this.Md(d),a=r;let y=g+p;n&&(y=y.trim()),r=this.getStringWidth(y)}for(n&&(p=p.trim()),g+=p,i=Math.max(1,i-c);this.getStringWidth(g)>i&&g.length>1;)g=g.substring(0,g.length-1);this.U2(!0),g+=Nt.Sp,a=this.getStringWidth(g),this.mi=a,this.Nn(g,a),s!==null&&s.e(a,u);return}let m=0;for(d.length===0&&(m=1,this.Nn(d,0));d.length>0;){let g=this.Md(d);for(d=d.substring(g.length);this.getStringWidth(g)>i;){let x=1;for(r=this.getStringWidth(g.substring(0,x)),a=0;r<=i;)x++,a=r,r=this.getStringWidth(g.substring(0,x));let P=0;x===1?(P=r,o=Math.max(o,r)):(P=a,o=Math.max(o,a)),x--,x<1&&(x=1);const k=g.substring(0,x);if(this.Nn(k,P),m++,g=g.substring(x),this.Ce+m>this.maxLines)break}let p=this.Md(d);for(r=this.getStringWidth(g+p),a=0;p.length>0&&r<=i;){g+=p,d=d.substring(p.length),p=this.Md(d),a=r;let x=g+p;n&&(x=x.trim()),r=this.getStringWidth(x)}if(n&&(g=g.trim()),g==="")continue;g[g.length-1]==="­"&&(g=g.substring(0,g.length-1)+"‐");let y=0;if(p.length===0?(y=r,o=Math.max(o,r)):(a=this.getStringWidth(g),y=a,o=Math.max(o,a)),this.Nn(g,y),m++,this.Ce+m>this.maxLines)break}this.Pn=Math.min(this.maxLines,m),this.mi=Math.max(this.mi,o),s!==null&&s.e(this.mi,u*this.Pn)}Cv(t,i){if(this.mi===0||this.Le===null||this.Di===null||this.overflow!==1)return;const s=this.kn,n=this.overflow===1?this.OA(s):0,o=this.spacingAbove+this.spacingBelow,r=Math.max(0,this.Lp()+o),a=Math.min(this.maxLines-1,Math.max(Math.floor(i/r+.01)-1,0));if(a+1>=this.Di.length)return;this.U2(!0);let h=this.Di[a];const l=Math.max(1,t-n);for(;this.getStringWidth(h)>l&&h.length>1;)h=h.substring(0,h.length-1);h+=Nt.Sp;const u=this.getStringWidth(h);this.Di[a]=h,this.Di=this.Di.slice(0,a+1),this.Le[a]=u,this.Le=this.Le.slice(0,a+1),this.Pn=this.Di.length,this.mi=Math.max(this.mi,u),this.Ce=this.Pn,this.Ce===1&&(this.Sn=this.Di[0])}Md(t){if(this.wrap===3)return t.substring(0,1);let i=t.length,s=0;const n=Nt.Lv;for(;s<i&&!n.test(t.charAt(s));)s++;for(this.formatting===1&&(i=Math.min(i,s+1));s<i&&n.test(t.charAt(s));)s++;return s>=t.length?t:t.substring(0,s)}getStringWidth(t){return Nt.il===null?t.length*8:Nt.il.measureText(t).width}Lp(){if(this.oo!==null)return this.oo;const t=this.kn;let i=0;return Nt.il===null?(i=16,this.oo=i,i):(Nt.V2[t]!==void 0&&Nt.IA<5e3?i=Nt.V2[t]:(i=Nt.il.measureText("M").width*1.3,Nt.V2[t]=i,Nt.IA++),this.oo=i,i)}OA(t){if(Nt.il===null)return 6;let i=0;return Nt.Zb[t]!==void 0&&Nt.E2<5e3?i=Nt.Zb[t]:(i=Nt.il.measureText(Nt.Sp).width,Nt.Zb[t]=i,Nt.E2++),i}t1(t,i){return t.indexOf(`
`,i)}DA(t){let i=this.hi.replace(/\r\n/g,`
`).replace(/\r/g,`
`);const s=this.spacingAbove+this.spacingBelow,n=Math.max(0,this.Lp()+s);if(i.length===0)return this.mi=0,this.Ce=1,n;if(!this.isMultiline){const l=this.t1(i,0);l>=0&&(i=i.substring(0,l))}let o=0;this.Ce=0;let r=0,a=-1,h=!1;for(;!h;){if(a=this.t1(i,r),a===-1&&(a=i.length,h=!0),r<=a){const l=i.substring(r,a);if(this.wrap!==0){this.Pn=0;const u=ut.l();this.B2(l,t,u),o+=u.height,ut.s(u),this.Ce+=this.Pn}else this.B2(l,t,null),o+=n,this.Ce++;this.Ce===this.maxLines&&(h=!0)}r=a+1}return this.x0=o,o}Nv(){let t=this.hi.replace(/\r\n/g,`
`).replace(/\r/g,`
`);if(t.length===0)return 8;if(this.isMultiline){let i=0,s=0,n=!1;for(;!n;){let o=this.t1(t,s);o===-1&&(o=t.length,n=!0);let r=t.substring(s,o);this.formatting===0&&(r=r.trim()),i=Math.max(i,this.getStringWidth(r)),s=o+1}return i}else{const i=this.t1(t,0);return i>=0&&(t=t.substring(0,i)),this.getStringWidth(t)}}get textValidation(){return this.W!==null?this.W.Tl:null}set textValidation(t){const i=this.textValidation;i!==t&&(t!==null&&b.i(t,"function",Nt,"textValidation"),this.Mn(),this.W.Tl=t,this.t("textValidation",i,t))}get textEdited(){return this.W!==null?this.W.Dp:null}set textEdited(t){const i=this.textEdited;i!==t&&(t!==null&&b.i(t,"function",Nt,"textEdited"),this.Mn(),this.W.Dp=t,this.t("textEdited",i,t))}get spacingAbove(){return this.W!==null?this.W.Fp:0}set spacingAbove(t){const i=this.spacingAbove;i!==t&&(this.Mn(),this.W.Fp=t,this.c(),this.t("spacingAbove",i,t))}get spacingBelow(){return this.W!==null?this.W.Rp:0}set spacingBelow(t){const i=this.spacingBelow;i!==t&&(this.Mn(),this.W.Rp=t,this.c(),this.t("spacingBelow",i,t))}get formatting(){return this.W!==null?this.W.vp:0}set formatting(t){const i=this.formatting;i!==t&&(this.Mn(),this.W.vp=t,this.c(),this.t("formatting",i,t))}get maxLines(){return this.W!==null?this.W.Op:1/0}set maxLines(t){const i=this.maxLines;i!==t&&(t=Math.floor(t),t<=0&&b._(t,"> 0",Nt,"maxLines"),this.Mn(),this.W.Op=t,this.c(),this.t("maxLines",i,t))}getMetrics(){return[this.mi,this.Dl,this.oo,this.Pn,this.Le,this.Di,this.Sn]}Pv(t){t!==void 0&&(this.mi=t[0],this.Dl=t[1],this.oo=t[2],this.Pn=t[3],this.Le=t[4],this.Di=t[5],this.Sn=t[6])}get metrics(){return{arrSize:this.Le!==null?this.Le:[this.mi],arrText:this.Di!==null?this.Di:[this.Sn],maxLineWidth:this.mi,fontHeight:this.oo}}get choices(){return this.Sd}set choices(t){const i=this.Sd;i!==t&&(this.Sd=t,this.t("choices",i,t))}};f(Nt,"Qb",null),f(Nt,"_b",null),f(Nt,"None",0),f(Nt,"WrapFit",1),f(Nt,"WrapDesiredSize",2),f(Nt,"WrapBreakAll",3),f(Nt,"OverflowClip",0),f(Nt,"OverflowEllipsis",1),f(Nt,"FormatTrim",0),f(Nt,"FormatNone",1),f(Nt,"Lv",new RegExp("[ ​­]")),f(Nt,"V2",new fe),f(Nt,"IA",0),f(Nt,"Zb",new fe),f(Nt,"E2",0),f(Nt,"Sp","..."),f(Nt,"vA",""),f(Nt,"il",At.isUsingDOM()?new Pi(null).ai:null);let Qt=Nt;class Ds{constructor(){f(this,"gi");f(this,"os");f(this,"ro");f(this,"vp");f(this,"Op");f(this,"Cp");f(this,"Fp");f(this,"Rp");f(this,"Mp");f(this,"Dp");f(this,"Ap");f(this,"Tl");f(this,"sl");f(this,"Np");this.gi=!1,this.os=null,this.ro=0,this.vp=0,this.Op=1/0,this.Cp=0,this.Fp=0,this.Rp=0,this.Mp="start",this.Dp=null,this.Ap=null,this.Tl=null,this.sl=B.Top,this.Np=2}copy(){const e=new Ds;return e.os=this.os,e.ro=this.ro,e.vp=this.vp,e.Op=this.Op,e.Cp=this.Cp,e.Fp=this.Fp,e.Rp=this.Rp,e.Mp=this.Mp,e.Dp=this.Dp,e.Ap=this.Ap,e.Tl=this.Tl,e.sl=this.sl,e.Np=this.Np,e}}class ii{constructor(){f(this,"uf");f(this,"df");f(this,"gf");f(this,"Tp");f(this,"mf");this.uf=1,this.df=0,this.gf=1,this.Tp=null,this.mf=null}copy(){const e=new ii;return e.uf=this.uf,e.df=this.df,e.gf=this.gf,e.Tp=this.Tp,e.mf=this.mf,e}}var Fs=(v=>(v[v.None=0]="None",v[v.Fill=2]="Fill",v[v.Uniform=6]="Uniform",v[v.UniformToFill=7]="UniformToFill",v))(Fs||{});const ee=class ee extends he{constructor(t,i){super();f(this,"nl");f(this,"yt");f(this,"ol");f(this,"pf");f(this,"os");f(this,"rl");f(this,"yf");f(this,"ro");f(this,"wf");f(this,"xf");f(this,"Ib");this.n|=2097152,this.nl=null,this.yt="",this.ol=z.AD,this.pf=2,this.os=null,this.rl=null,this.yf=B.Center,this.ro=0,this.wf=null,this.xf=null,this.Ib=null,typeof t=="string"?this.source=t:t&&Object.assign(this,t),i&&Object.assign(this,i)}cloneProtected(t){super.cloneProtected(t),t.yt=this.yt,t.element=this.nl,t.ol=this.ol.N(),t.pf=this.pf,t.ro=this.ro,t.os=this.os,t.rl=this.rl,t.yf=this.yf.N(),t.xf=this.xf}ri(t){t in Fs?this.imageStretch=t:super.ri(t)}toString(){return"Picture("+this.source+")#"+K.as(this)}get bf(){return(this.n&1048576)!==0}set bf(t){this.bf!==t&&(this.n=this.n^1048576)}get Ip(){return(this.n&2097152)!==0}set Ip(t){this.Ip!==t&&(this.n=this.n^2097152)}get mn(){return(this.n&4194304)!==0}set mn(t){this.mn!==t&&(this.n=this.n^4194304)}static clearCache(t){t===void 0&&(t=""),b.i(t,"string",ee,"clearCache:url"),t!==""?ee.Ep[t]&&(delete ee.Ep[t],ee.i1--):(ee.Ep=new fe,ee.i1=0)}static OL(t,i){i.EA||(i.e1=s=>{ee.Av(i,s),t.desiredSize.isReal()||(t.ue(!1),t.c())},i.s1=s=>ee.Tv(i,s),i.addEventListener("load",i.e1),i.addEventListener("error",i.s1),i.EA=!0)}static mR(t){t.e1&&t.removeEventListener("load",t.e1),t.s1&&t.removeEventListener("error",t.s1),delete t.e1,delete t.s1,delete t.EA}get element(){return this.nl}set element(t){const i=this.nl;if(this.ss(!0),i!==t){this.bf=t instanceof HTMLCanvasElement;const s=t instanceof HTMLImageElement;t!==null&&!(s||t instanceof HTMLVideoElement||this.bf)&&b.o("Picture.element must be an instance of Image, Canvas, or Video, not: "+t);const n=this.diagram;n!==null&&n.DM(this),this.nl=t,t!==null&&s&&t.es===void 0&&(t.es=new K),n!==null&&s&&n.TM(this),this.t("element",i,t),this.C()}}dR(){const t=this.nl;if(t===null)return;const i=this.desiredSize.isReal();(this.bf||t.complete===!0)&&(t.c0&&(t.Bp instanceof Event&&this.os!==null?this.os(this,t.Bp):t.mn===!0&&!t.Bp&&this.rl!==null&&t.z2&&this.rl(this,t.z2)),t.mn=!0),t.mn&&i&&this.diagram!==null&&this.diagram.zu.add(this)}Dv(){if(this.nl===null){this.wf=!1;return}const t=new Pi(null).ai;try{t.drawImage(this.nl,0,0)}catch{this.Ip=!1}try{t.getImageData(0,0,1,1).data[3]&&(this.wf=!1),this.wf=!1}catch{this.wf=!0}}get source(){return this.yt}set source(t){const i=this.yt;if(i!==t){this.ss(!0),b.i(t,"string",ee,"source"),this.yt=t;let s=ee.Ep;if(!At.isUsingDOM()){this.t("source",i,t);return}let n=null;if(s[t]!==void 0)n=s[t];else if(t!==""){ee.i1>30&&(ee.clearCache(),s=ee.Ep),n=b.en("img"),n.c0=!0,ee.OL(this,n);const o=this.xf;o!==null&&(n.crossOrigin=o(this)),n.src=t,s[t]=n,ee.i1++}this.element=n,n!==null&&n.__goCache===void 0&&(n.__goCache=new $n),this.c(),this.C(),this.t("source",i,t)}}static Av(t,i){t.mn=!0,t.Bp=!1;let s;const n=t.es.copy();if(n==null)return;const o=n.iterator;for(;o.next();){const r=o.value;r.C();const a=t.getAttribute("src")||"",h=r.Jl.get(a);if(h===null)continue;const l=h.length;for(let u=0;u<l;u++)s=h[u],s.desiredSize.isReal()||r.zu.add(s),s.ss(!0),r.requestUpdate(),t.c0&&(t.z2===void 0&&(t.z2=i),s.rl!==null&&s.rl(s,i))}t.es.clear()}static Tv(t,i){t.Bp=i;let s;const n=t.es.copy();if(n==null)return;const o=n.iterator;for(;o.next();){const r=o.value,a=t.getAttribute("src")||"",h=r.Jl.get(a);if(h===null)continue;const l=h.length,u=b.nt();for(let c=0;c<l;c++)u.push(h[c]);if(t.c0)for(let c=0;c<l;c++)s=u[c],s.os!==null&&s.os(s,i);b.tt(u)}t.es.clear()}reloadSource(){if(this.source==="")return;ee.clearCache(this.source);const t=this.source;this.source="",this.source=t}redraw(){this.C(),this.ss(!0)}get sourceCrossOrigin(){return this.xf}set sourceCrossOrigin(t){if(this.xf!==t&&(t!==null&&b.i(t,"function",ee,"sourceCrossOrigin"),this.xf=t,this.element!==null)){const i=this.element.getAttribute("src");t===null&&typeof i=="string"?this.element.crossOrigin=null:t!==null&&(this.element.crossOrigin=t(this)),this.element.src=i}}get sourceRect(){return this.ol}set sourceRect(t){const i=this.ol;i.equals(t)||(t=t.N(),this.ol=t,this.C(),this.t("sourceRect",i,t))}get imageStretch(){return this.pf}set imageStretch(t){const i=this.pf;i!==t&&(this.pf=t,this.C(),this.t("imageStretch",i,t))}get flip(){return this.ro}set flip(t){const i=this.ro;i!==t&&(this.ro=t,this.C(),this.t("flip",i,t))}get imageAlignment(){return this.yf}set imageAlignment(t){const i=this.yf;i.equals(t)||(t=t.N(),this.yf=t,this.C(),this.t("imageAlignment",i,t))}get errorFunction(){return this.os}set errorFunction(t){const i=this.os;i!==t&&(t!==null&&b.i(t,"function",ee,"errorFunction"),this.os=t,this.t("errorFunction",i,t))}get successFunction(){return this.rl}set successFunction(t){const i=this.rl;i!==t&&(t!==null&&b.i(t,"function",ee,"successFunction"),this.rl=t,this.t("successFunction",i,t))}fh(t,i){const s=this.nl;if(s===null)return;const n=s.getAttribute("src");if(s instanceof HTMLImageElement&&(n===null||n==="")||s.Bp instanceof Event&&t instanceof hs)return;const o=t instanceof ze,r=this.naturalBounds;let a=0,h=0;const l=this.bf;let u=l?+s.width:s.naturalWidth,c=l?+s.height:s.naturalHeight;if(u===void 0&&s.videoWidth&&(u=s.videoWidth),c===void 0&&s.videoHeight&&(c=s.videoHeight),u===0||c===0)return;const d=u,m=c;this.sourceRect.isReal()&&(a=this.ol.x,h=this.ol.y,u=this.ol.width,c=this.ol.height);let g=u,p=c;const y=this.pf,x=this.yf;switch(y){case 0:if(this.sourceRect.isReal())break;g>=r.width&&(a=a+x.offsetX+(g*x.x-r.width*x.x)),p>=r.height&&(h=h+x.offsetY+(p*x.y-r.height*x.y)),u=Math.min(r.width,g),c=Math.min(r.height,p);break;case 2:g=r.width,p=r.height;break;case 6:case 7:let R=0;y===6?(R=Math.min(r.height/p,r.width/g),g*=R,p*=R):y===7&&(R=Math.max(r.height/p,r.width/g),g*=R,p*=R,g>=r.width&&(a=(a+x.offsetX+(g*x.x-r.width*x.x)/g)*u),p>=r.height&&(h=(h+x.offsetY+(p*x.y-r.height*x.y)/p)*c),u*=1/(g/r.width),c*=1/(p/r.height),g=r.width,p=r.height);break}const P=u*c,k=this.getDocumentScale()*i.scale,w=g*k,N=p*k,M=w*N,C=P/M,O=s.__goCache;let T=null;const L=ee.Fv;if(!o){if(s.mn&&O!==void 0&&M>4&&C>L*L){O.Ot===null&&(O.BA(4,d,m,s),O.BA(16,d,m,s));const R=O.Ot,I=R.length;for(let j=0;j<I&&R[j].Nd*R[j].Nd<C;j++)T=R[j]}if(!i.Vu&&(this.wf===null&&this.Dv(),this.wf))return}const F=g<r.width?x.offsetX+(r.width*x.x-g*x.x):0,D=p<r.height?x.offsetY+(r.height*x.y-p*x.y):0;switch(this.flip){case 0:break;case 2:t.translate(Math.min(r.width,g),0),t.scale(-1,1);break;case 1:t.translate(0,Math.min(r.height,p)),t.scale(1,-1);break;case 3:t.translate(Math.min(r.width,g),Math.min(r.height,p)),t.scale(-1,-1);break}if(t.commitTransform(),i.getRenderingHint("pictureRatioOptimization")&&!i.Qh&&O!==void 0&&T!==null&&T.Nd!==1){t.save();const R=T.Nd;try{t.drawImage(T.yt,a/R,h/R,Math.min(T.yt.width,u/R),Math.min(T.yt.height,c/R),F,D,Math.min(r.width,g),Math.min(r.height,p)),t instanceof ze&&(this.Ib=[a/R,h/R,Math.min(T.yt.width,u/R),Math.min(T.yt.height,c/R),F,D,Math.min(r.width,g),Math.min(r.height,p)])}catch{this.Ip=!1}t.restore()}else try{t.drawImage(s,a,h,u,c,F,D,Math.min(r.width,g),Math.min(r.height,p)),t instanceof ze&&(this.Ib=[a,h,u,c,F,D,Math.min(r.width,g),Math.min(r.height,p)])}catch{this.Ip=!1}switch(this.flip){case 0:break;case 2:t.scale(-1,1),t.translate(-Math.min(r.width,g),0);break;case 1:t.scale(1,-1),t.translate(0,-Math.min(r.height,p));break;case 3:t.scale(-1,-1),t.translate(-Math.min(r.width,g),-Math.min(r.height,p));break}}get naturalBounds(){return this.Vi}Qu(t,i,s,n){const o=this.desiredSize,r=this.zs(!0),a=this.nl,h=this.bf;let l=0,u=0;(h||!this.mn&&a&&a.complete)&&(this.mn=!0),a===null?(isFinite(o.width)||(t=s),isFinite(o.height)||(i=n)):(l=h?+a.width:a.naturalWidth,u=h?+a.height:a.naturalHeight),!isFinite(o.width)&&r!==2&&r!==5?a!==null&&this.mn!==!1&&(this.sourceRect.isReal()?t=this.sourceRect.width:t=l):(isFinite(t)||(this.sourceRect.isReal()?t=this.sourceRect.width:a!==null&&(t=l)),s=0),!isFinite(o.height)&&r!==2&&r!==4?a!==null&&this.mn!==!1&&(this.sourceRect.isReal()?i=this.sourceRect.height:i=u):(isFinite(i)||(this.sourceRect.isReal()?i=this.sourceRect.height:a!==null&&(i=u)),n=0),isFinite(o.width)&&(t=o.width),isFinite(o.height)&&(i=o.height);const c=this.maxSize,d=this.minSize;s=Math.max(s||0,d.width),n=Math.max(n||0,d.height),t=Math.min(c.width,t),i=Math.min(c.height,i),t=Math.max(s,t),i=Math.max(n,i),a!==null&&!a.complete&&(isFinite(t)||(t=0),isFinite(i)||(i=0)),this.Vi.En(t,i),this.Qn(0,0,t,i)}ah(t,i,s,n){this.commonArrange(t,i,s,n)}};f(ee,"Ep",new fe),f(ee,"i1",0),f(ee,"Fv",4);let Ge=ee;class $n{constructor(){f(this,"Ot");this.Ot=null}BA(e,t,i,s){this.Ot===null&&(this.Ot=[]);const n=new Pi(null),o=n.ai,r=1/e;if(n.width=t/e,n.height=i/e,n.width===0||n.height===0)return;const a=new Jn(n.Ft,e);let h=s,l=1;if(this.Ot.length>0){const u=this.Ot[this.Ot.length-1];h=u.yt,l=u.Nd}o.setTransform(r*l,0,0,r*l,0,0),o.commitTransform(),o.drawImage(h,0,0),this.Ot.push(a)}}class Jn{constructor(e,t){f(this,"yt");f(this,"Nd");this.yt=e,this.Nd=t}}const Vi=class Vi{constructor(){f(this,"Pi");f(this,"Hg");this.Hg=new Ft,this.Pi=null}Ri(e){e!==null?(e.ot(),this.Hg=e,e.figures.clear()):this.Hg=new Ft,this.Pi=null}fu(e,t,i,s,n,o){if(s!==void 0&&s===!0){const r=new kt(1);r.endX=e,r.endY=t,this.Pi.segments.add(r)}else this.Pi=new _t,this.Pi.startX=e,this.Pi.startY=t,this.Pi.isFilled=i,this.Pi.isEvenOdd=o||!1,this.Hg.figures.add(this.Pi);n!==void 0&&(this.Pi.isShadowed=n)}UD(){const e=this.Pi.segments.length;e>0&&this.Pi.segments.elt(e-1).close()}VD(){this.Pi.segments.length>0&&(this.Pi.isFilled=!0)}zD(e){this.Pi.isShadowed=e}gE(e){this.Pi.isEvenOdd=e}ID(e,t,i){i===void 0&&(i=!1);const s=new kt(1);s.endX=e,s.endY=t,i&&s.close(),this.Pi.segments.add(s)}ur(e,t,i){i===void 0&&(i=!1);const s=new kt(2);s.endX=e,s.endY=t,i&&s.close(),this.Pi.segments.add(s)}dr(e,t,i,s,n,o,r){r===void 0&&(r=!1);const a=new kt(3);a.point1X=e,a.point1Y=t,a.point2X=i,a.point2Y=s,a.endX=n,a.endY=o,r&&a.close(),this.Pi.segments.add(a)}Mw(e,t,i,s,n){n===void 0&&(n=!1);const o=new kt(4);o.point1X=e,o.point1Y=t,o.endX=i,o.endY=s,n&&o.close(),this.Pi.segments.add(o)}ED(e,t,i,s,n,o,r){o===void 0&&(o=0),r===void 0&&(r=!1);const a=new kt(5);a.startAngle=e,a.sweepAngle=t,a.centerX=i,a.centerY=s,a.radiusX=n,o!==0?a.radiusY=o:a.radiusY=n,r&&a.close(),this.Pi.segments.add(a)}BD(e,t,i,s,n,o,r,a){a===void 0&&(a=!1);const h=new kt(6,o,r,e,t,i,s,n);a&&h.close(),this.Pi.segments.add(h)}static mC(e){const t=Vi.X2;if(t!==null)return Vi.X2=null,t.Ri(e),t;{const i=new Vi;return i.Ri(e),i}}static pC(e){Vi.X2=e}};f(Vi,"X2",null);let Ui=Vi;{const v=function(n,o){const r=n.toLowerCase(),a=A.So;a[n]=o,a[r]=n};v("Rectangle",(n,o,r)=>{const a="r"+o+","+r;let h=A.cr[a];return h!==void 0||(h=new Ft(2),h.endX=o,h.endY=r,A.fr<A.Kg&&(A.cr[a]=h,A.fr++)),h}),v("Square",(n,o,r)=>{const a="s"+o+","+r;let h=A.cr[a];return h!==void 0||(h=new Ft(2),h.endX=o,h.endY=r,h.defaultStretch=6,A.fr<A.Kg&&(A.cr[a]=h,A.fr++)),h});const e=(n,o,r,a,h)=>{(isNaN(a)||a<0)&&(a=5),isNaN(h)&&(h=15);const l="rr"+o+","+r+","+a+","+h;let u=A.cr[l];if(u!==void 0)return u;let c=a;(h&1)===1?(c=Math.min(c,(h&2)===2?o/3:o),c=Math.min(c,(h&8)===8?r/3:r)):c=0;const d=new _t(c,0,!0);u=new Ft().add(d);const m=B.TopLeft.copy(),g=B.BottomRight.copy();if((h&2)===2){let p=a;p=Math.min(p,(h&1)===1?o/3:o),p=Math.min(p,(h&4)===4?r/3:r);const y=p*A.Bn;d.add(new kt(2,o-p,0)).add(new kt(3,o,p,o-y,0,o,y)),m.offsetY=y,g.offsetX=-y}else d.add(new kt(2,o,0));if((h&4)===4){let p=a;p=Math.min(p,(h&8)===8?o/3:o),p=Math.min(p,(h&2)===2?r/3:r);const y=p*A.Bn;d.add(new kt(2,o,r-p)).add(new kt(3,o-p,r,o,r-y,o-y,r)),g.offsetX=-y,g.offsetY=-y}else d.add(new kt(2,o,r));if((h&8)===8){let p=a;p=Math.min(p,(h&4)===4?o/3:o),p=Math.min(p,(h&1)===1?r/3:r);const y=p*A.Bn;d.add(new kt(2,p,r)).add(new kt(3,0,r-p,y,r,0,r-y)),m.offsetX=y,g.offsetY=-y}else d.add(new kt(2,0,r));if((h&1)===1){const p=c*A.Bn;d.add(new kt(2,0,c)).add(new kt(3,c,0,0,p,p,0).close()),m.offsetX=p,m.offsetY=p}else d.add(new kt(2,0,0).close());return u.spot1=m,u.spot2=g,A.fr<A.Kg&&(A.cr[l]=u,A.fr++),u};v("RoundedRectangle",(n,o,r)=>{const a=n?n.parameter1:NaN,h=n?n.parameter2:NaN;return e(n,o,r,a,h)}),v("Border","RoundedRectangle"),v("RoundedTopRectangle",(n,o,r)=>{const a=n?n.parameter1:NaN;return e(n,o,r,a,3)}),v("RoundedBottomRectangle",(n,o,r)=>{const a=n?n.parameter1:NaN;return e(n,o,r,a,12)}),v("RoundedLeftRectangle",(n,o,r)=>{const a=n?n.parameter1:NaN;return e(n,o,r,a,9)}),v("RoundedRightRectangle",(n,o,r)=>{const a=n?n.parameter1:NaN;return e(n,o,r,a,6)}),v("Ellipse",(n,o,r)=>{const a="e"+o+","+r;let h=A.cr[a];return h!==void 0||(h=new Ft(3),h.endX=o,h.endY=r,h.spot1=B.Rk,h.spot2=B.vk,A.fr<A.Kg&&(A.cr[a]=h,A.fr++)),h}),v("Circle",(n,o,r)=>{const a="c"+o+","+r;let h=A.cr[a];return h!==void 0||(h=new Ft(3),h.endX=o,h.endY=r,h.spot1=B.Rk,h.spot2=B.vk,h.defaultStretch=6,A.fr<A.Kg&&(A.cr[a]=h,A.fr++)),h}),v("TriangleRight",(n,o,r)=>new Ft().add(new _t(0,0).add(new kt(2,o,.5*r)).add(new kt(2,0,r).close())).setSpots(0,.25,.5,.75)),v("TriangleDown",(n,o,r)=>new Ft().add(new _t(0,0).add(new kt(2,o,0)).add(new kt(2,.5*o,r).close())).setSpots(.25,0,.75,.5)),v("TriangleLeft",(n,o,r)=>new Ft().add(new _t(o,r).add(new kt(2,0,.5*r)).add(new kt(2,o,0).close())).setSpots(.5,.25,1,.75)),v("TriangleUp",(n,o,r)=>new Ft().add(new _t(o,r).add(new kt(2,0,r)).add(new kt(2,.5*o,0).close())).setSpots(.25,.5,.75,1)),v("Triangle","TriangleUp"),v("Diamond",(n,o,r)=>new Ft().add(new _t(.5*o,0).add(new kt(2,0,.5*r)).add(new kt(2,.5*o,r)).add(new kt(2,o,.5*r).close())).setSpots(.25,.25,.75,.75)),v("LineH",(n,o,r)=>{const a=new Ft(1);return a.startX=0,a.startY=r/2,a.endX=o,a.endY=r/2,a}),v("LineV",(n,o,r)=>{const a=new Ft(1);return a.startX=o/2,a.startY=0,a.endX=o/2,a.endY=r,a}),v("None","Rectangle"),v("BarH","Rectangle"),v("BarV","Rectangle"),v("MinusLine","LineH"),v("PlusLine",(n,o,r)=>new Ft().add(new _t(0,r/2,!1).add(new kt(2,o,r/2)).add(new kt(1,o/2,0)).add(new kt(2,o/2,r)))),v("XLine",(n,o,r)=>new Ft().add(new _t(0,r,!1).add(new kt(2,o,0)).add(new kt(1,0,0)).add(new kt(2,o,r)))),v("LineRight",(n,o,r)=>new Ft().add(new _t(.25*o,0,!1).add(new kt(2,.75*o,.5*r)).add(new kt(2,.25*o,r)))),v("LineDown",(n,o,r)=>new Ft().add(new _t(0,.25*r,!1).add(new kt(2,.5*o,.75*r)).add(new kt(2,o,.25*r)))),v("LineLeft",(n,o,r)=>new Ft().add(new _t(.75*o,0,!1).add(new kt(2,.25*o,.5*r)).add(new kt(2,.75*o,r)))),v("LineUp",(n,o,r)=>new Ft().add(new _t(0,.75*r,!1).add(new kt(2,.5*o,.25*r)).add(new kt(2,o,.75*r)))),v("Capsule",(n,o,r)=>{const a=new Ft;if(o<r){const h=o/2,l=new _t(0,h,!0);a.add(l),l.add(new kt(5,180,180,h,h,h,h)),l.add(new kt(2,o,r-h)),l.add(new kt(5,0,180,h,r-h,h,h)),l.add(new kt(2,0,h));const u=isFinite(n.parameter1)?n.parameter1:o*.156;return a.spot1=new B(0,0,0,u),a.spot2=new B(1,1,0,-u),a}else if(o>r){const h=r/2,l=new _t(h,0,!0);a.add(l),l.add(new kt(2,o-h,0)),l.add(new kt(5,270,180,o-h,h,h,h)),l.add(new kt(2,h,r)),l.add(new kt(5,90,180,h,h,h,h));const u=isFinite(n.parameter1)?n.parameter1:r*.156;return a.spot1=new B(0,0,u,0),a.spot2=new B(1,1,-u,0),a}else return a.type=3,a.endX=o,a.endY=r,a.spot1=B.Rk,a.spot2=B.vk,a});const t=(n,o)=>new _t(n,o,!1,!1),i=(n,o,r)=>n.add(new kt(2,o,r)),s=(n,o,r)=>n.add(new kt(1,o,r));v("Borders",(n,o,r)=>{let a=n?n.parameter1:NaN;isNaN(a)?a=10:a=a&15;const h=new Ft;let l;return a===10?(l=t(o,0),i(l,o,r),s(l,0,r),i(l,0,0)):a===5?(l=t(0,0),i(l,o,0),s(l,o,r),i(l,0,r)):a===1?(l=t(0,0),i(l,o,0),s(l,o,r)):a===2?(l=t(o,0),i(l,o,r)):a===4?(l=t(o,r),i(l,0,r)):a===8?(l=t(0,r),i(l,0,0),s(l,o,r)):a===3?(l=t(0,0),i(l,o,0),i(l,o,r)):a===6?(l=t(o,0),i(l,o,r),i(l,0,r)):a===12?(l=t(o,r),i(l,0,r),i(l,0,0)):a===9?(l=t(0,r),i(l,0,0),i(l,o,0)):a===7?(l=t(0,0),i(l,o,0),i(l,o,r),i(l,0,r)):a===14?(l=t(o,0),i(l,o,r),i(l,0,r),i(l,0,0)):a===13?(l=t(o,r),i(l,0,r),i(l,0,0),i(l,o,0)):a===11?(l=t(0,r),i(l,0,0),i(l,o,0),i(l,o,r)):a===15?(l=t(0,0),i(l,o,0),i(l,o,r),i(l,0,r),l.add(new kt(2,0,0).close())):(l=t(0,0),s(l,o,r)),h.add(l),h})}A.Xg={"":"",Standard:"F1 m 0,0 l 8,4 -8,4 2,-4 z",Backward:"F1 m 8,0 l -2,4 2,4 -8,-4 z",Triangle:"F1 m 0,0 l 8,4.62 -8,4.62 z",BackwardTriangle:"F1 m 8,4 l 0,4 -8,-4 8,-4 0,4 z",Boomerang:"F1 m 0,0 l 8,4 -8,4 4,-4 -4,-4 z",BackwardBoomerang:"F1 m 8,0 l -8,4 8,4 -4,-4 4,-4 z",SidewaysV:"m 0,0 l 8,4 -8,4 0,-1 6,-3 -6,-3 0,-1 z",BackwardV:"m 8,0 l -8,4 8,4 0,-1 -6,-3 6,-3 0,-1 z",OpenTriangle:"m 0,0 l 8,4 -8,4",BackwardOpenTriangle:"m 8,0 l -8,4 8,4",OpenTriangleLine:"m 0,0 l 8,4 -8,4 m 8.5,0 l 0,-8",BackwardOpenTriangleLine:"m 8,0 l  -8,4 8,4 m -8.5,0 l 0,-8",OpenTriangleTop:"m 0,0 l 8,4 m 0,4",BackwardOpenTriangleTop:"m 8,0 l -8,4 m 0,4",OpenTriangleBottom:"m 0,8 l 8,-4",BackwardOpenTriangleBottom:"m 0,4 l 8,4",HalfTriangleTop:"F1 m 0,0 l 0,4 8,0 z m 0,8",BackwardHalfTriangleTop:"F1 m 8,0 l 0,4 -8,0 z m 0,8",HalfTriangleBottom:"F1 m 0,4 l 0,4 8,-4 z",BackwardHalfTriangleBottom:"F1 m 8,4 l 0,4 -8,-4 z",ForwardSemiCircle:"m 4,0 b 270 180 0 4 4",BackwardSemiCircle:"m 4,8 b 90 180 0 -4 4",Feather:"m 0,0 l 3,4 -3,4",BackwardFeather:"m 3,0 l -3,4 3,4",DoubleFeathers:"m 0,0 l 3,4 -3,4 m 3,-8 l 3,4 -3,4",BackwardDoubleFeathers:"m 3,0 l -3,4 3,4 m 3,-8 l -3,4 3,4",TripleFeathers:"m 0,0 l 3,4 -3,4 m 3,-8 l 3,4 -3,4 m 3,-8 l 3,4 -3,4",BackwardTripleFeathers:"m 3,0 l -3,4 3,4 m 3,-8 l -3,4 3,4 m 3,-8 l -3,4 3,4",ForwardSlash:"m 0,8 l 5,-8",BackSlash:"m 0,0 l 5,8",DoubleForwardSlash:"m 0,8 l 4,-8 m -2,8 l 4,-8",DoubleBackSlash:"m 0,0 l 4,8 m -2,-8 l 4,8",TripleForwardSlash:"m 0,8 l 4,-8 m -2,8 l 4,-8 m -2,8 l 4,-8",TripleBackSlash:"m 0,0 l 4,8 m -2,-8 l 4,8 m -2,-8 l 4,8",Fork:"m 0,4 l 8,0 m -8,0 l 8,-4 m -8,4 l 8,4",BackwardFork:"m 8,4 l -8,0 m 8,0 l -8,-4 m 8,4 l -8,4",LineFork:"m 0,0 l 0,8 m 0,-4 l 8,0 m -8,0 l 8,-4 m -8,4 l 8,4",BackwardLineFork:"m 8,4 l -8,0 m 8,0 l -8,-4 m 8,4 l -8,4 m 8,-8 l 0,8",CircleFork:"F1 m 6,4 b 0 360 -3 0 3 z m 0,0 l 6,0 m -6,0 l 6,-4 m -6,4 l 6,4",BackwardCircleFork:"F1 m 0,4 l 6,0 m -6,-4 l 6,4 m -6,4 l 6,-4 m 6,0 b 0 360 -3 0 3",CircleLineFork:"F1 m 6,4 b 0 360 -3 0 3 z m 1,-4 l 0,8 m 0,-4 l 6,0 m -6,0 l 6,-4 m -6,4 l 6,4",BackwardCircleLineFork:"F1 m 0,4 l 6,0 m -6,-4 l 6,4 m -6,4 l 6,-4 m 0,-4 l 0,8 m 7,-4 b 0 360 -3 0 3",Circle:"F1 m 8,4 b 0 360 -4 0 4 z",Block:"F1 m 0,0 l 0,8 8,0 0,-8 z",StretchedDiamond:"F1 m 0,3 l 5,-3 5,3 -5,3 -5,-3 z",Diamond:"F1 m 0,4 l 4,-4 4,4 -4,4 -4,-4 z",Chevron:"F1 m 0,0 l 5,0 3,4 -3,4 -5,0 3,-4 -3,-4 z",StretchedChevron:"F1 m 0,0 l 8,0 3,4 -3,4 -8,0 3,-4 -3,-4 z",NormalArrow:"F1 m 0,2 l 4,0 0,-2 4,4 -4,4 0,-2 -4,0 z",X:"m 0,0 l 8,8 m 0,-8 l -8,8",TailedNormalArrow:"F1 m 0,0 l 2,0 1,2 3,0 0,-2 2,4 -2,4 0,-2 -3,0 -1,2 -2,0 1,-4 -1,-4 z",DoubleTriangle:"F1 m 0,0 l 4,4 -4,4 0,-8 z  m 4,0 l 4,4 -4,4 0,-8 z",BigEndArrow:"F1 m 0,0 l 5,2 0,-2 3,4 -3,4 0,-2 -5,2 0,-8 z",ConcaveTailArrow:"F1 m 0,2 h 4 v -2 l 4,4 -4,4 v -2 h -4 l 2,-2 -2,-2 z",RoundedTriangle:"F1 m 0,1 a 1,1 0 0 1 1,-1 l 7,3 a 0.5,1 0 0 1 0,2 l -7,3 a 1,1 0 0 1 -1,-1 l 0,-6 z",SimpleArrow:"F1 m 1,2 l -1,-2 2,0 1,2 -1,2 -2,0 1,-2 5,0 0,-2 2,2 -2,2 0,-2 z",AccelerationArrow:"F1 m 0,0 l 0,8 0.2,0 0,-8 -0.2,0 z m 2,0 l 0,8 1,0 0,-8 -1,0 z m 3,0 l 2,0 2,4 -2,4 -2,0 0,-8 z",BoxArrow:"F1 m 0,0 l 4,0 0,2 2,0 0,-2 2,4 -2,4 0,-2 -2,0 0,2 -4,0 0,-8 z",TriangleLine:"F1 m 8,4 l -8,-4 0,8 8,-4 z m 0.5,4 l 0,-8",CircleEndedArrow:"F1 m 10,4 l -2,-3 0,2 -2,0 0,2 2,0 0,2 2,-3 z m -4,0 b 0 360 -3 0 3 z",DynamicWidthArrow:"F1 m 0,3 l 2,0 2,-1 2,-2 2,4 -2,4 -2,-2 -2,-1 -2,0 0,-2 z",EquilibriumArrow:"m 0,3 l 8,0 -3,-3 m 3,5 l -8,0 3,3",FastForward:"F1 m 0,0 l 3.5,4 0,-4 3.5,4 0,-4 1,0 0,8 -1,0 0,-4 -3.5,4 0,-4 -3.5,4 0,-8 z",Kite:"F1 m 0,4 l 2,-4 6,4 -6,4 -2,-4 z",HalfArrowTop:"F1 m 0,0 l 4,4 4,0 -8,-4 z m 0,8",HalfArrowBottom:"F1 m 0,8 l 4,-4 4,0 -8,4 z",OpposingDirectionDoubleArrow:"F1 m 0,4 l 2,-4 0,2 4,0 0,-2 2,4 -2,4 0,-2 -4,0 0,2 -2,-4 z",PartialDoubleTriangle:"F1 m 0,0 4,3 0,-3 4,4 -4,4 0,-3 -4,3 0,-8 z",LineCircle:"F1 m 0,0 l 0,8 m 7 -4 b 0 360 -3 0 3 z",DoubleLineCircle:"F1 m 0,0 l 0,8 m 2,-8 l 0,8 m 7 -4 b 0 360 -3 0 3 z",TripleLineCircle:"F1 m 0,0 l 0,8 m 2,-8 l 0,8 m 2,-8 l 0,8 m 7 -4 b 0 360 -3 0 3 z",CircleLine:"F1 m 6 4 b 0 360 -3 0 3 z m 1,-4 l 0,8",DiamondCircle:"F1 m 8,4 l -4,4 -4,-4 4,-4 4,4 m 8,0 b 0 360 -4 0 4 z",PlusCircle:"F1 m 8,4 b 0 360 -4 0 4 l -8 0 z m -4 -4 l 0 8",OpenRightTriangleTop:"m 8,0 l 0,4 -8,0 m 0,4",OpenRightTriangleBottom:"m 8,8 l 0,-4 -8,0",Line:"m 0,0 l 0,8",DoubleLine:"m 0,0 l 0,8 m 2,0 l 0,-8",TripleLine:"m 0,0 l 0,8 m 2,0 l 0,-8 m 2,0 l 0,8",PentagonArrow:"F1 m 8,4 l -4,-4 -4,0 0,8 4,0 4,-4 z"};var gn=(v=>(v[v.None=0]="None",v[v.Added=1]="Added",v[v.Removed=2]="Removed",v[v.Shown=4]="Shown",v[v.Hidden=8]="Hidden",v[v.NodeSized=16]="NodeSized",v[v.GroupLayout=32]="GroupLayout",v[v.NodeReplaced=64]="NodeReplaced",v[v.Standard=127]="Standard",v[v.All=16777215]="All",v))(gn||{});const Jt=class Jt extends ct{constructor(t,i){let s;t===void 0||t instanceof Rt||typeof t=="string"?s=t:t&&(i=t);super(s);f(this,"P");f(this,"Ho");f(this,"F");f(this,"ll");f(this,"hl");f(this,"qo");f(this,"hi");f(this,"Wo");f(this,"ph");f(this,"js");f(this,"Jo");f(this,"Cd");f(this,"BS");f(this,"UA");f(this,"Up");f(this,"Vp");this.P=2408959,this.Ho="",this.F=null,this.ll="",this.hl=null,this.qo=null,this.hi="",this.Wo=null,this.ph=null,this.js=new S(NaN,NaN).g(),this.Jo=null,this.Cd=NaN,this.BS=-1,this.UA=new z,this.Up=null,this.Vp=NaN,i&&Object.assign(this,i)}cloneProtected(t){super.cloneProtected(t),t.P=this.P&-4097|16384|32768,t.Ho=this.Ho,this.F!==null&&(this.F.gi?t.F=this.F:t.F=this.F.copy()),t.ll=this.ll,t.qo=null,t.hi=this.hi,t.js.a(this.js),t.Cd=this.Cd}Vo(t){super.Vo(t),t.ch(),t.hl=null,t.Jo=null,t.Up=null}toString(){let t=b.sn(this.constructor)+"#"+K.as(this);return this.data!==null&&(t+="("+b.toString(this.data)+")"),t}qi(){this.F===null?this.F=new Os:this.F.gi&&(this.F=this.F.copy())}lh(){super.lh(),this.F!==null&&(this.F.gi=!0)}Jc(t,i,s,n,o,r,a){const h=this.diagram;h!==null&&(t===3&&i==="elements"?o instanceof ct?o.qr(l=>{h.partManager.SM(l,h)}):o instanceof Ge&&h.TM(o):t===4&&i==="elements"&&(o instanceof ct?o.qr(l=>h.partManager.MM(l,h)):o instanceof Ge&&h.DM(o)),h.raiseChangedEvent(t,i,s,n,o,r,a))}updateTargetBindings(t){if(super.updateTargetBindings(t),this.data===null)return;const i=this.L.r,s=i.length;for(let o=0;o<s;o++){const r=i[o];r instanceof ct&&r.qr(a=>{a.data!==null&&a.updateTargetBindings()})}const n=this.adornments;for(;n.next();)n.value.updateTargetBindings(t)}Io(){if(super.Io(),this.d2()){const i=this.L.r,s=i.length;for(let n=0;n<s;n++){const o=i[n];o instanceof ct&&o.qr(r=>r.Io())}}const t=this.adornments;for(;t.next();)t.value.Io()}updateRelationshipsFromData(){var t;this.data!==null&&((t=this.diagram)==null||t.partManager.updateRelationshipsFromData(this))}get key(){const t=this.diagram;if(t!==null)return t.model.getKeyForNodeData(this.data)}get adornments(){return this.qo===null?Ht.instance:this.qo.iteratorValues}findAdornment(t){const i=this.qo;return i===null?null:i.get(t)}addAdornment(t,i){if(i===null)return;let s=null,n=this.qo;if(n!==null&&(s=n.get(t)),s!==i){if(s!==null){const r=s.diagram;r!==null&&r.remove(s)}n===null&&(n=new St,this.qo=n),i.Ho!==t&&(i.category=t),n.set(t,i);const o=this.diagram;if(o!==null){o.add(i);const r=i.adornedObject;if(r!==null){const a=r.findBindingPanel();a!==null&&(i.data=a.data)}}}}removeAdornment(t){const i=this.qo;if(i===null)return;const s=i.get(t);if(s!==null){const n=s.diagram;n!==null&&(n.remove(s),s.data=null)}i.delete(t),i.count===0&&(this.qo=null)}clearAdornments(){const t=this.qo;if(t===null)return;const i=b.nt(),s=t.iterator;for(;s.next();){const o=s.key;i.push(o)}const n=i.length;for(let o=0;o<n;o++)this.removeAdornment(i[o]);b.tt(i)}updateAdornments(){const t=this.diagram;if(t===null)return;this.Rv(t),this.vv(t);let i=this.adornments;for(;i.next();){const s=i.value;s.c(),s.hasPlaceholder()&&s.placeholder.c()}for(i=this.adornments;i.next();)i.value.updateTargetBindings()}invalidateAdornments(){const t=this.diagram;t!==null&&(t._l(),this.VA()!==!0&&this.zA(!0))}US(){this.VA()!==!1&&(this.updateAdornments(),this.zA(!1))}Rv(t){const i="Selection";if(this.isSelected&&this.selectionAdorned){const s=this.selectionObject;if(s!==null&&this.actualBounds.isReal()&&this.isVisible()&&s.isVisibleObject()&&s.actualBounds.isReal()){let n=this.findAdornment(i);if(n===null){let o=this.selectionAdornmentTemplate;if(o===null&&(this.Cl()?o=t.linkSelectionAdornmentTemplate:this instanceof at?o=t.groupSelectionAdornmentTemplate:o=t.nodeSelectionAdornmentTemplate),!(o instanceof Mt))return;o.li(),n=o.copy(),n!==null&&(this.Cl()&&this.selectionObject===this.path&&(n.type=ct.Link),n.adornedObject=s)}if(n!==null){n.type===ct.Link&&n.c(),this.addAdornment(i,n);return}}}this.removeAdornment(i)}vv(t){const i=this;t.toolManager.mouseDownTools.each(s=>{s.isEnabled&&s.updateAdornments(i)}),t.toolManager.updateAdornments(i)}IS(t){this.Wo=t,t===null&&this.DR()}get layer(){return this.Wo}get diagram(){const t=this.Wo;return t==null?null:t.diagram}get layerName(){return this.ll}set layerName(t){const i=this.ll;if(i===t)return;b.i(t,"string",Jt,"layerName");let s=this.diagram;if(s!==null&&(s.findLayer(t)===null||s.partManager.addsToTemporaryLayer))return;this.ll=t,s!==null&&s.invalidateDocumentBounds(),this.t("layerName",i,t);const n=this.layer;if(n===null||n.name===t||(s=n.diagram,s===null))return;const o=s.findLayer(t);if(o===null||o===n)return;let r=n.te(-1,this,!0);r>=0&&s.raiseChangedEvent(4,"parts",n,this,null,r,!0),r=o.qh(99999999,this,!0),n.visible!==o.visible&&this.Ei(o.visible),r>=0&&s.raiseChangedEvent(3,"parts",o,null,this,!0,r);const a=this.layerChanged;if(a===null)return;const h=s.Y;s.Y=!0,a(this,n,o),s.Y=h}get layerChanged(){return this.F!==null?this.F.zp:null}set layerChanged(t){const i=this.layerChanged;i!==t&&(t!==null&&b.i(t,"function",Jt,"layerChanged"),this.qi(),this.F.zp=t,this.t("layerChanged",i,t))}get zOrder(){return this.Cd}set zOrder(t){const i=this.Cd;if(i===t)return;b.i(t,"number",Jt,"zOrder"),this.Cd=t;const s=this.layer;s!==null&&s.yx(-1,this),this.t("zOrder",i,t);const n=this.diagram;n!==null&&n.C()}Ov(){const t=this.layer;t!==null&&t.yx(-1,this)}o1(){if(this.th()!==!1)return;this.K2(!0),this._u();const t=this.diagram;t!==null&&(t.o0(this),t.requestUpdate())}XA(){if(this.P|=2097152,this.th()===!1)return;const t=this.position,i=this.location;(!i.isReal()||!t.isReal())&&this.KA(t,i);const s=this.Li,n=z.l().a(s);s.ot(),s.x=t.x,s.y=t.y,s.g(),this.td(n,s),z.s(n),this.K2(!1)}Qn(t,i,s,n){const o=this.se;o.e(t,i,s,n),this.bi===null&&(this.bi=new Tt);const r=this.bi;r.Ri(),this.p0(r,t,i,s,n),this.bi=r,r.Ok()||r.xw(o)}p0(t,i,s,n,o){if(this.et!==1&&t.et(this.et),this.Xt===0)return;let r=B.Center;this.locationSpot.isSpot()&&(r=this.locationSpot);const a=S.l();if(this.locationObject!==this){const h=this.locationObject,l=h.naturalBounds;a.setSpot(l.x,l.y,l.width,l.height,r),h.bi!==null&&h.bi.xt(a),a.offset(-h.measuredBounds.x,-h.measuredBounds.y);let u=h.panel;for(;u!==null&&u!==this;)u.bi!==null&&u.bi.xt(a),a.offset(-u.measuredBounds.x,-u.measuredBounds.y),u=u.panel}else a.setSpot(i,s,n,o,r);t.cs(this.Xt,a.x,a.y),S.s(a)}get locationObject(){if(this.Jo===null)if(this instanceof Mt&&this.type!==ct.Link&&this.hasPlaceholder())this.Jo=this.placeholder;else{const t=this.locationObjectName;if(t!==""){const i=this.findObject(t);i!==null?this.Jo=i:this.Jo=this}else this.Jo=this}return this.Jo.visible?this.Jo:this}get minLocation(){return this.F!==null?this.F.Xp:S.$N}set minLocation(t){const i=this.minLocation;i.equals(t)||(t=t.N(),this.qi(),this.F.Xp=t,this.t("minLocation",i,t))}get maxLocation(){return this.F!==null?this.F.Kp:S.ZN}set maxLocation(t){const i=this.maxLocation;i.equals(t)||(t=t.N(),this.qi(),this.F.Kp=t,this.t("maxLocation",i,t))}get locationObjectName(){return this.F!==null?this.F.Yp:""}set locationObjectName(t){const i=this.locationObjectName;i!==t&&(this.qi(),this.F.Yp=t,this.Jo=null,this.c(),this.t("locationObjectName",i,t))}get locationSpot(){return this.F!==null?this.F.Gp:B.TopLeft}set locationSpot(t){const i=this.locationSpot;i.equals(t)||(t=t.N(),this.qi(),this.F.Gp=t,this.c(),this.t("locationSpot",i,t))}move(t,i){i===!0?this.location=t:this.position=t}moveTo(t,i,s){const n=S.X(t,i);this.move(n,s),S.s(n)}isVisible(){if(!this.visible)return!1;const t=this.layer;if(t!==null){if(!t.visible)return!1;const s=t.diagram;if(s!==null&&s.animationManager.nx(this))return!0}const i=this.containingGroup;return!(i!==null&&(!i.isSubGraphExpanded||!i.isVisible()))}Ei(t){const i=this.diagram;t?(this.invalidateLayout(4),this.invalidateAdornments(),i!==null&&i.o0(this)):(this.invalidateLayout(8),this.clearAdornments()),this.ch(),i!==null&&(i.invalidateDocumentBounds(),i.C())}findObject(t){if(this.name===t)return this;let i=this.Up;if(i===null&&(this.Up=i=new St),i.get(t)!==null)return i.get(t);const s=super.findObject(t);return s!==null?(i.set(t,s),s):(i.set(t,null),null)}D0(){this.Up=null}getRelativePoint(t,i,s){s===void 0&&(s=new S);const n=i.isNoSpot()?B.Center:i,o=t.naturalBounds;if(s.e(o.width*n.x+n.offsetX,o.height*n.y+n.offsetY),t===null||t===this)return s;t.D.xt(s);let r=t.panel;for(;r!==null&&r!==this;)r.D.xt(s),r=r.panel;return this.bi!==null&&this.bi.xt(s),s.offset(-this.se.x,-this.se.y),s}getDocumentBounds(t){return t===void 0&&(t=new z),t.a(this.actualBounds)}ensureBounds(){this.ut(1/0,1/0),this.zt()}pA(t){const i=this.locationSpot,s=this.locationObject;let n=s.naturalBounds;n.isReal()||(n=z.pw);const o=s instanceof bt?s.strokeWidth:0;if(t.setSpot(0,0,n.width+o,n.height+o,i),s!==this){t.offset(-o/2,-o/2),s.D.xt(t);let r=s.panel;for(;r!==null&&r!==this;)r.D.xt(t),r=r.panel}return this.bi!==null&&this.bi.xt(t),t.offset(-this.se.x,-this.se.y),t}Hh(t,i){const s=i===void 0?this.UA:i,n=this.Iv(),o=n*2;if(!this.isShadowed)return s.e(t.x-1-n,t.y-1-n,t.width+2+o,t.height+2+o),s;let r=t.x,a=t.y,h=t.width,l=t.height;const u=this.shadowBlur,c=this.shadowOffset;return h+=u,l+=u,r-=u/2,a-=u/2,c.x>0?h+=c.x:(r+=c.x,h-=c.x),c.y>0?l+=c.y:(a+=c.y,l-=c.y),s.e(r-1,a-1,h+2,l+2),s}yv(){return this.type===ct.Link&&this instanceof Mt&&this.category==="Selection"&&this.adornedObject instanceof bt&&this.adornedPart.findMainElement()===this.adornedObject?this.adornedObject.strokeWidth:0}Iv(){return isNaN(this.Vp)&&(this.Vp=this.SA()),this.Vp}cf(){this.Vp=NaN}zt(){if(this.is()===!1){this.XA();return}this._n(!1);const t=this.Li,i=z.l();i.a(t);const s=this.Nl();this.ah(0,0,this.se.width,this.se.height);const n=this.position;this.KA(n,this.location),t.ot(),t.x=n.x,t.y=n.y,t.g(),this.td(i,t),i.equals(t)?this.Bs(s):this.Pe()&&(!A.u(i.width,t.width)||!A.u(i.height,t.height))&&this.BS>=0&&this.invalidateLayout(16),z.s(i),this.K2(!1)}td(t,i){const s=this.diagram;if(s===null)return;let n=!1;if(s.Zh===!1&&t.isReal()){const o=z.l();o.a(s.documentBounds),o.subtractMargin(s.padding),t.x>o.x&&t.y>o.y&&t.right<o.right&&t.bottom<o.bottom&&i.x>o.x&&i.y>o.y&&i.right<o.right&&i.bottom<o.bottom&&(n=!0),z.s(o)}(this.Ev()===!0||!t.equals(i))&&this.ML(n,s),s.C(),!(!t.isReal()&&!i.isReal()||t.equalsApproxClose(i))&&(this instanceof nt&&!s.undoManager.isUndoingRedoing&&this.invalidateConnectedLinks(),this.ch())}get location(){return this.js}set location(t){const i=t.x,s=t.y,n=this.js;(n.x!==i&&(!isNaN(n.x)||!isNaN(i))||n.y!==s&&(!isNaN(n.y)||!isNaN(s)))&&(t=t.copy(),this.Bv(t,n)&&this.t("location",n,t.copy()))}Bv(t,i){if(this.Cl())return!1;if(this.js=t,this.P|=2097152,this.is()===!1){this.o1();const s=this.at;if(s.isReal()){const n=this.diagram;if(n===null||n.animationManager.isTicking||!n.undoManager.isUndoingRedoing){const o=s.copy();s.e(s.x+(t.x-i.x),s.y+(t.y-i.y)),this.YA(n,s,o.x,o.y),this.t("position",o,s.copy())}}}return!0}c2(t,i,s){if(this.Cl()||!t.isReal())return!1;const n=this.diagram;if(n!==null&&this.YA(n,t,i,s),this.at=t,this.P&=-2097153,this.js.isReal()&&(n===null||n.animationManager.isTicking||!n.undoManager.isUndoingRedoing)){const o=this.js;this.js=new S(o.x+(t.x-i),o.y+(t.y-s)),this.t("location",o,this.js.copy())}return this.th()===!1&&this.is()===!1&&(this.o1(),this.XA()),!0}YA(t,i,s,n){if(t===null||this instanceof Mt)return;const o=t.animationManager;o.wi&&o.qC(this,new S(s,n),i,!1)}bc(t,i,s){const n=this.js,o=this.at;if(s){if(n.x===t&&n.y===i)return;this.th()||this.is()?o.e(NaN,NaN):o.e(o.x+t-n.x,o.y+i-n.y),n.e(t,i)}else{if(o.x===t&&o.y===i)return;n.e(n.x+t-o.x,n.y+i-o.y),o.e(t,i)}this.o1()}f2(){this.P&=-2097153,this.o1()}KA(t,i){const s=this.pA(S.l()),n=this.diagram,o=i.isReal(),r=t.isReal();o&&r?this.P&2097152?this.GA(t,i,n,s):this.jA(t,i,n,s):o?this.GA(t,i,n,s):r&&this.jA(t,i,n,s),this.P|=2097152,S.s(s),this._u()}GA(t,i,s,n){const o=t.x,r=t.y;if(t.e(i.x-n.x,i.y-n.y),s!==null){const a=s.animationManager,h=a.defaultAnimation.isAnimating;!h&&a.wi&&!(this instanceof Mt)&&a.qC(this,new S(o,r),t,!1),!h&&!(t.x===o&&t.y===r)&&this.t("position",new S(o,r),t.copy())}}jA(t,i,s,n){const o=i.copy();i.e(t.x+n.x,t.y+n.y),!i.equals(o)&&s!==null&&this.t("location",o,i.copy())}ML(t,i){this.s2(!1),this instanceof nt&&i.EM(this),!this.layer.isTemporary&&!t&&i.invalidateDocumentBounds();const s=this.Li,n=i.viewportBounds;n.isReal()?this.Nl()?(s.intersectsRectPlus(n,10)||this.Bs(!1),this.updateAdornments()):this.isVisible()&&s.intersectsRect(n)?(this.Bs(!0),this.updateAdornments()):this.invalidateAdornments():i.Ec=!0}Hr(){return!0}Pe(){return!0}Cl(){return!1}Xs(){return!0}hasPlaceholder(){return!1}get category(){return this.Ho}set category(t){const i=this.Ho;if(i===t)return;this.svg!==null&&(this.svg.remove(),this.ss(!0)),b.i(t,"string",Jt,"category");const s=this.diagram,n=this.data;let o=null;if(s!==null&&n!==null&&!(this instanceof Mt)){const r=s.model.undoManager;r.isEnabled&&!r.isUndoingRedoing&&(o=this.clone(),o.L.addAll(this.L))}if(this.Ho=t,this.t("category",i,t),s!==null&&n!==null&&!(this instanceof Mt)){const r=s.model;if(r.undoManager.isUndoingRedoing)return;if(this.Cl()){s.partManager.setLinkCategoryForData(n,t);const a=s.partManager.findLinkTemplateForCategory(t);if(a!==null){a.li();const h=a.copy();h!==null&&this.Y2(h,i,t)}}else{r!==null&&r.setCategoryForNodeData(n,t);const a=s.partManager.findTemplateForNodeData(n,t);if(a!==null){a.li();const h=a.copy();if(h!==null&&!(h instanceof dt)){const l=this.location.copy();this.Y2(h,i,t),this.location.isReal()||(this.location=l)}}}if(o!==null){const a=this.clone();a.L.addAll(this.L),this.t("self",o,a)}}else if(this instanceof Mt){const r=this.adornedPart;if(r!==null){const a=r.qo;a!==null&&a.delete(i),r.addAdornment(this.category,this)}}}get self(){return this}set self(t){this.Y2(t,this.category,t.category)}Y2(t,i,s){t.constructor!==this.constructor&&(Jt.HA||(Jt.HA=!0,b.ii('Should not change the class of the Part when changing category from "'+i+'" to "'+s+'"'),b.ii("  Old class: "+b.sn(this.constructor)+", new class: "+b.sn(t.constructor)+", part: "+this.toString()))),this.clearAdornments();const n=this.data,o=this.layerName,r=this.isSelected,a=this.isHighlighted;let h=!0,l=!0,u=!1;this instanceof nt&&(h=this.isTreeLeaf,l=this.isTreeExpanded,u=this.wasTreeExpanded),t.Vo(this),t.cloneProtected(this),this.Ho=s,this.svg!==null&&(this.svg.remove(),this.svg=null,this.ss(!0)),this.c(),this.C();const c=this.diagram;let d=!0;c!==null&&(d=c.skipsUndoManager,c.skipsUndoManager=!0),this.Qt=n,this.P=r?this.P|4096:this.P&-4097,this.P=a?this.P|524288:this.P&-524289,this instanceof nt&&(this.E=h?this.E|4:this.E&-5,this.E=l?this.E|1:this.E&-2,this.E=u?this.E|2:this.E&-3),n!==null&&this.updateTargetBindings();const m=this.layerName;m!==o&&(this.ll=o,this.layerName=m),c!==null&&(c.skipsUndoManager=d),this.Pe()&&this.invalidateLayout(64)}canCopy(){if(!this.copyable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowCopy)return!1;const i=t.diagram;return i===null?!0:!!i.allowCopy}canDelete(){if(!this.deletable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowDelete)return!1;const i=t.diagram;return i===null?!0:!!i.allowDelete}canEdit(){if(!this.textEditable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowTextEdit)return!1;const i=t.diagram;return i===null?!0:!!i.allowTextEdit}canGroup(){if(!this.groupable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowGroup)return!1;const i=t.diagram;return i===null?!0:!!i.allowGroup}canMove(){if(!this.movable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowMove)return!1;const i=t.diagram;return i===null?!0:!!i.allowMove}canReshape(){if(!this.reshapable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowReshape)return!1;const i=t.diagram;return i===null?!0:!!i.allowReshape}canResize(){if(!this.resizable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowResize)return!1;const i=t.diagram;return i===null?!0:!!i.allowResize}canRotate(){if(!this.rotatable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowRotate)return!1;const i=t.diagram;return i===null?!0:!!i.allowRotate}canSelect(){if(!this.selectable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowSelect)return!1;const i=t.diagram;return i===null?!0:!!i.allowSelect}get copyable(){return(this.P&1)!==0}set copyable(t){const i=(this.P&1)!==0;i!==t&&(this.P=this.P^1,this.t("copyable",i,t))}get deletable(){return(this.P&2)!==0}set deletable(t){const i=(this.P&2)!==0;i!==t&&(this.P=this.P^2,this.t("deletable",i,t))}get textEditable(){return(this.P&4)!==0}set textEditable(t){const i=(this.P&4)!==0;i!==t&&(this.P=this.P^4,this.t("textEditable",i,t),this.invalidateAdornments())}get groupable(){return(this.P&8)!==0}set groupable(t){const i=(this.P&8)!==0;i!==t&&(this.P=this.P^8,this.t("groupable",i,t))}get movable(){return(this.P&16)!==0}set movable(t){const i=(this.P&16)!==0;i!==t&&(this.P=this.P^16,this.t("movable",i,t))}get selectionAdorned(){return(this.P&32)!==0}set selectionAdorned(t){const i=(this.P&32)!==0;i!==t&&(this.P=this.P^32,this.t("selectionAdorned",i,t),this.invalidateAdornments())}get isInDocumentBounds(){return(this.P&64)!==0}set isInDocumentBounds(t){const i=(this.P&64)!==0;if(i!==t){this.P=this.P^64;const s=this.diagram;s!==null&&s.invalidateDocumentBounds(),this.t("isInDocumentBounds",i,t)}}get isLayoutPositioned(){return(this.P&128)!==0}set isLayoutPositioned(t){const i=(this.P&128)!==0;i!==t&&(this.P=this.P^128,this.t("isLayoutPositioned",i,t),this.invalidateLayout(t?4:8))}get selectable(){return(this.P&256)!==0}set selectable(t){const i=(this.P&256)!==0;i!==t&&(this.P=this.P^256,this.t("selectable",i,t),this.invalidateAdornments())}get reshapable(){return(this.P&512)!==0}set reshapable(t){const i=(this.P&512)!==0;i!==t&&(this.P=this.P^512,this.t("reshapable",i,t),this.invalidateAdornments())}get resizable(){return(this.P&1024)!==0}set resizable(t){const i=(this.P&1024)!==0;i!==t&&(this.P=this.P^1024,this.t("resizable",i,t),this.invalidateAdornments())}get rotatable(){return(this.P&2048)!==0}set rotatable(t){const i=(this.P&2048)!==0;i!==t&&(this.P=this.P^2048,this.t("rotatable",i,t),this.invalidateAdornments())}get isSelected(){return(this.P&4096)!==0}set isSelected(t){const i=(this.P&4096)!==0;if(i!==t){const s=this.diagram;if(t){if(!this.canSelect())return;if(s!==null){const r=s.maxSelectionCount;if(s.selection.count>=r)return}}this.P=this.P^4096;let n=!1;if(s!==null){n=s.skipsUndoManager,s.skipsUndoManager=!0;const r=s.selection;r.ot(),t?r.add(this):r.delete(this),r.g()}this.t("isSelected",i,t),this.invalidateAdornments();const o=this.selectionChanged;o!==null&&o(this),s!==null&&(s.requestUpdate(),s.skipsUndoManager=n)}}get isHighlighted(){return(this.P&524288)!==0}set isHighlighted(t){const i=(this.P&524288)!==0;if(i!==t){this.P=this.P^524288;const s=this.diagram;if(s!==null){const o=s.highlighteds;o.ot(),t?o.add(this):o.delete(this),o.g()}this.t("isHighlighted",i,t),this.C();const n=this.highlightedChanged;n!==null&&n(this)}}get isShadowed(){return(this.P&8192)!==0}set isShadowed(t){const i=(this.P&8192)!==0;i!==t&&(this.P=this.P^8192,this.ss(!0),this.t("isShadowed",i,t),this.C())}VA(){return(this.P&16384)!==0}zA(t){t?this.P|=16384:this.P&=-16385}th(){return(this.P&32768)!==0}K2(t){t?this.P|=32768:this.P&=-32769}Ev(){return(this.P&65536)!==0}s2(t){t?this.P|=65536:this.P&=-65537}Nl(){return(this.P&131072)!==0}Bs(t){t?this.P|=131072:this.P&=-131073}qA(){return(this.P&1048576)!==0}l1(t){t?this.P|=1048576:this.P&=-1048577}get isAnimated(){return(this.P&262144)!==0}set isAnimated(t){const i=(this.P&262144)!==0;i!==t&&(this.P=this.P^262144,this.t("isAnimated",i,t))}get highlightedChanged(){return this.F!==null?this.F.jp:null}set highlightedChanged(t){const i=this.highlightedChanged;i!==t&&(t!==null&&b.i(t,"function",Jt,"highlightedChanged"),this.qi(),this.F.jp=t,this.t("highlightedChanged",i,t))}get selectionObjectName(){return this.F!==null?this.F.Hp:""}set selectionObjectName(t){const i=this.selectionObjectName;i!==t&&(this.qi(),this.F.Hp=t,this.hl=null,this.t("selectionObjectName",i,t))}get selectionAdornmentTemplate(){return this.F!==null?this.F.qp:null}set selectionAdornmentTemplate(t){const i=this.selectionAdornmentTemplate;i!==t&&(this.qi(),this.F.qp=t,this.t("selectionAdornmentTemplate",i,t))}get selectionObject(){if(this.hl===null){const t=this.selectionObjectName;if(t!==null&&t!==""){const i=this.findObject(t);i!==null?this.hl=i:this.hl=this}else if(this instanceof dt){const i=this.path;i!==null?this.hl=i:this.hl=this}else this.hl=this}return this.hl}get selectionChanged(){return this.F!==null?this.F.Wp:null}set selectionChanged(t){const i=this.selectionChanged;i!==t&&(t!==null&&b.i(t,"function",Jt,"selectionChanged"),this.qi(),this.F.Wp=t,this.t("selectionChanged",i,t))}get resizeAdornmentTemplate(){return this.F!==null?this.F.Jp:null}set resizeAdornmentTemplate(t){const i=this.resizeAdornmentTemplate;i!==t&&(this.qi(),this.F.Jp=t,this.t("resizeAdornmentTemplate",i,t))}get resizeObjectName(){return this.F!==null?this.F.$p:""}set resizeObjectName(t){const i=this.resizeObjectName;i!==t&&(this.qi(),this.F.$p=t,this.t("resizeObjectName",i,t))}get resizeObject(){const t=this.resizeObjectName;if(t!==""){const i=this.findObject(t);if(i!==null)return i}return this}get resizeCellSize(){return this.F!==null?this.F.Zp:ut.gw}set resizeCellSize(t){const i=this.resizeCellSize;i.equals(t)||(t=t.N(),this.qi(),this.F.Zp=t,this.t("resizeCellSize",i,t))}get rotateAdornmentTemplate(){return this.F!==null?this.F.Qp:null}set rotateAdornmentTemplate(t){const i=this.rotateAdornmentTemplate;i!==t&&(this.qi(),this.F.Qp=t,this.t("rotateAdornmentTemplate",i,t))}get rotateObjectName(){return this.F!==null?this.F._p:""}set rotateObjectName(t){const i=this.rotateObjectName;i!==t&&(this.qi(),this.F._p=t,this.t("rotateObjectName",i,t))}get rotateObject(){const t=this.rotateObjectName;if(t!==""){const i=this.findObject(t);if(i!==null)return i}return this}get rotationSpot(){return this.F!==null?this.F.ty:B.Default}set rotationSpot(t){const i=this.rotationSpot;i.equals(t)||(t=t.N(),this.qi(),this.F.ty=t,this.t("rotationSpot",i,t))}get text(){return this.hi}set text(t){const i=this.hi;i!==t&&(this.hi=t,this.t("text",i,t))}get containingGroup(){return this.ph}set containingGroup(t){if(this.Pe()){const i=this.ph;if(i!==t){t!==null&&(this===t||t.isMemberOf(this))&&(this===t&&b.o("Cannot make a Group a member of itself: "+this.toString()),b.o("Cannot make a Group indirectly contain itself: "+this.toString()+" already contains "+t.toString())),this.invalidateLayout(2);const s=this.diagram;if(i!==null?i.G2(this):this instanceof at&&s!==null&&s.Yr.delete(this),this.ph=t,t!==null?t.j2(this):this instanceof at&&s!==null&&s.Yr.add(this),this.invalidateLayout(1),s!==null&&s.Y){const o=this.data,r=s.model;if(o!==null&&r.qc()){const a=t!==null?t.data:null;r.setGroupForData(o,r.getKeyForNodeData(a))}}const n=this.containingGroupChanged;if(n!==null){let o=!0;s!==null&&(o=s.Y,s.Y=!0),n(this,i,t),s!==null&&(s.Y=o)}if(this instanceof at){const o=new K;Jt.sh(o,this,!0,0,!0);const r=o.iterator;for(;r.next();){const a=r.value;if(a instanceof nt){const h=a.linksConnected;for(;h.next();)h.value.Ld()}}}if(this instanceof nt){const o=this.linksConnected;for(;o.next();)o.value.Ld();const r=this.labeledLink;r!==null&&r.Ld()}this.t("containingGroup",i,t),t!==null&&t.Ov()}}else b.o("cannot set the Part.containingGroup of a Link or Adornment")}ch(){const t=this.containingGroup;t!==null&&(t.hasPlaceholder()&&t.placeholder.c(),t.c(),t.invalidateConnectedLinks())}C(){const t=this.diagram;t!==null&&!this.is()&&!this.th()&&this.isVisible()&&this.Li.isReal()&&t.C(this.Hh(this.Li))}c(){if(this.Oo())return;super.c();const t=this.diagram;t!==null&&(t.o0(this),this instanceof nt&&this.labeledLink!==null&&this.labeledLink.ef(),t.requestUpdate(!0))}ef(t){if(this.is())return;const i=this.diagram;i!==null&&(i.o0(this),this instanceof nt&&this.invalidateConnectedLinks(),i.requestUpdate()),this._n(!0)}Em(t){if(!t){const i=this.ph;i!==null&&i.j2(this)}}Bm(t){if(!t){const i=this.ph;i!==null&&i.G2(this)}}Kc(){const t=this.data;if(t!==null){const i=this.diagram;if(i!==null){const s=i.model;s!==null&&s.removeNodeData(t)}}}get containingGroupChanged(){return this.F!==null?this.F.iy:null}set containingGroupChanged(t){const i=this.containingGroupChanged;i!==t&&(t!==null&&b.i(t,"function",Jt,"containingGroupChanged"),this.qi(),this.F.iy=t,this.t("containingGroupChanged",i,t))}findSubGraphLevel(){return this.H2(this)}H2(t){const i=t.containingGroup;if(i!==null)return 1+this.H2(i);if(t instanceof nt){const s=t.labeledLink;if(s!==null)return this.H2(s)}return 0}findTopLevelPart(){return this.q2(this)}q2(t){const i=t.containingGroup;if(i!==null)return this.q2(i);if(t instanceof nt){const s=t.labeledLink;if(s!==null)return this.q2(s)}return t}get isTopLevel(){return!(this.containingGroup!==null||this instanceof nt&&this.labeledLink!==null)}isMemberOf(t){return t instanceof at?this.W2(this,t):!1}W2(t,i){if(t===i||i===null)return!1;const s=t.containingGroup;if(s!==null&&(s===i||this.W2(s,i)))return!0;if(t instanceof nt){const n=t.labeledLink;if(n!==null)return this.W2(n,i)}return!1}findCommonContainingGroup(t){if(t===null)return null;if(this===t)return this.containingGroup;let i=this;for(;i!==null;){if(i instanceof at&&i.l1(!0),i instanceof nt){const n=i.labeledLink;n!==null&&(i=n)}i=i.containingGroup}let s=null;for(i=t;i!==null;){if(i.qA()){s=i;break}if(i instanceof nt){const n=i.labeledLink;n!==null&&(i=n)}i=i.containingGroup}for(i=this;i!==null;){if(i instanceof at&&i.l1(!1),i instanceof nt){const n=i.labeledLink;n!==null&&(i=n)}i=i.containingGroup}return s}get layoutConditions(){return this.F!==null?this.F.ey:127}set layoutConditions(t){const i=this.layoutConditions;i!==t&&(this.qi(),this.F.ey=t,this.t("layoutConditions",i,t))}canLayout(){if(!this.isLayoutPositioned||!this.isVisible())return!1;const t=this.layer;return!(t!==null&&t.isTemporary||this instanceof nt&&this.isLinkLabel)}Uv(t){if(!this.isLayoutPositioned||!(t&this.layoutConditions))return!1;const i=this.layer;if(i!==null&&i.isTemporary||this instanceof nt&&this.isLinkLabel)return!1;const s=this.diagram;return!(s!==null&&s.undoManager.isUndoingRedoing)}invalidateLayout(t){if(t===void 0&&(t=16777215),!this.Uv(t))return;const i=this.ph;if(i!==null){const s=i.layout;s!==null?s.invalidateLayout():i.invalidateLayout(t)}else{const s=this.diagram;if(s!==null){const n=s.layout;n!==null&&n.invalidateLayout()}}}NL(){if(!this.isVisible())return!1;const t=this.layer;return!(t!==null&&t.isTemporary)}static sh(t,i,s,n,o,r){if(r===void 0&&(r=null),!t.has(i)&&!(r!==null&&!r(i))&&!(i instanceof Mt)){if(t.add(i),i instanceof nt){if(s&&i instanceof at){const a=i.memberParts;for(;a.next();){const h=a.value;Jt.sh(t,h,s,n,o,r)}}if(o!==!1){const a=i.linksConnected;for(;a.next();){const h=a.value;if(t.has(h))continue;const l=h.fromNode,u=h.toNode,c=l===null||t.has(l),d=u===null||t.has(u);(o?c&&d:c||d)&&Jt.sh(t,h,s,n,o,r)}}if(n>1){const a=i.findTreeChildrenNodes();for(;a.next();){const h=a.value;Jt.sh(t,h,s,n-1,o,r)}}}else if(i instanceof dt){const a=i.labelNodes;for(;a.next();){const h=a.value;Jt.sh(t,h,s,n,o,r)}}}}get dragComputation(){return this.F!==null?this.F.sy:null}set dragComputation(t){const i=this.dragComputation;i!==t&&(t!==null&&b.i(t,"function",Jt,"dragComputation"),this.qi(),this.F.sy=t,this.t("dragComputation",i,t))}get shadowOffset(){return this.F!==null?this.F.ny:S.QN}set shadowOffset(t){const i=this.shadowOffset;i.equals(t)||(t=t.N(),this.qi(),this.F.ny=t,this.C(),this.t("shadowOffset",i,t))}get shadowColor(){return this.F!==null?this.F.oy:"gray"}set shadowColor(t){const i=this.shadowColor;i!==t&&(this.qi(),this.F.oy=t,this.C(),this.t("shadowColor",i,t))}get shadowBlur(){return this.F!==null?this.F.xn:4}set shadowBlur(t){const i=this.shadowBlur;i!==t&&(this.qi(),this.F.xn=t,this.C(),this.t("shadowBlur",i,t))}};f(Jt,"LayoutNone",0),f(Jt,"LayoutAdded",1),f(Jt,"LayoutRemoved",2),f(Jt,"LayoutShown",4),f(Jt,"LayoutHidden",8),f(Jt,"LayoutNodeSized",16),f(Jt,"LayoutGroupLayout",32),f(Jt,"LayoutNodeReplaced",64),f(Jt,"LayoutStandard",127),f(Jt,"LayoutAll",16777215),f(Jt,"HA",!1);let Bt=Jt;class Os{constructor(){f(this,"gi");f(this,"zp");f(this,"iy");f(this,"qp");f(this,"Hp");f(this,"Wp");f(this,"jp");f(this,"Jp");f(this,"$p");f(this,"Zp");f(this,"Qp");f(this,"_p");f(this,"ty");f(this,"Yp");f(this,"Gp");f(this,"Xp");f(this,"Kp");f(this,"sy");f(this,"ey");f(this,"ny");f(this,"oy");f(this,"xn");this.gi=!1,this.zp=null,this.iy=null,this.qp=null,this.Hp="",this.Wp=null,this.jp=null,this.Jp=null,this.$p="",this.Zp=ut.gw,this.Qp=null,this._p="",this.ty=B.Default,this.Yp="",this.Gp=B.TopLeft,this.Xp=S.$N,this.Kp=S.ZN,this.sy=null,this.ey=127,this.ny=S.QN,this.oy="gray",this.xn=4}copy(){const e=new Os;return e.zp=this.zp,e.iy=this.iy,e.qp=this.qp,e.Hp=this.Hp,e.Wp=this.Wp,e.jp=this.jp,e.Jp=this.Jp,e.$p=this.$p,e.Zp=this.Zp.N(),e.Qp=this.Qp,e._p=this._p,e.ty=this.ty.N(),e.Yp=this.Yp,e.Gp=this.Gp.N(),e.Xp=this.Xp.N(),e.Kp=this.Kp.N(),e.sy=this.sy,e.ey=this.ey,e.ny=this.ny.N(),e.oy=this.oy,e.xn=this.xn,e}}class Mt extends Bt{constructor(t,i){let s;t===void 0||t instanceof Rt||typeof t=="string"?s=t:t&&(i=t);super(s);f(this,"us");f(this,"It");f(this,"JP");f(this,"$P");f(this,"hf");this.P&=-257,this.ll="Adornment",this.us=null,this.JP=0,this.$P=!1,this.It=null,this.hf=null,i&&Object.assign(this,i)}toString(){const t=this.adornedPart;return"Adornment("+this.category+")"+(t!==null?t.toString():"")}updateRelationshipsFromData(){}hd(t){const i=this.adornedObject,s=i==null?void 0:i.part;if(!(s instanceof dt)||!(i instanceof bt))return;const n=s.path;let o=n.geometry;s.hd(t),o=n.geometry;const r=this.L.r,a=r.length;for(let h=0;h<a;h++){const l=r[h];l.isPanelMain&&l instanceof bt&&(l.ct=o)}}hasPlaceholder(){return this.It!==null&&this.It.isVisibleObject()}get placeholder(){return this.It}get adornedObject(){return this.us}set adornedObject(t){const i=this.adornedPart;let s=null;t!==null&&(s=t.part),i!==null&&(t===null||i!==s)&&i.removeAdornment(this.category),this.us=t,s!==null&&s.addAdornment(this.category,this)}get adornedPart(){const t=this.us;return t!==null?t.part:null}Hr(){const t=this.us;if(t===null)return!0;const i=t.part;return i===null||!i.is()}Pe(){return!1}get containingGroup(){return null}Jc(t,i,s,n,o,r,a){if(t===3&&i==="elements"){if(o instanceof Ue)this.It===null&&(this.It=o);else if(o instanceof ct){const h=o.findInVisualTree(l=>l instanceof Ue);h instanceof Ue&&this.It===null&&(this.It=h)}}else t===4&&i==="elements"&&this.It!==null&&(n===this.It?this.It=null:n instanceof ct&&this.It.isContainedBy(n)&&(this.It=null));super.Jc(t,i,s,n,o,r,a)}updateAdornments(){}Kc(){}}var mn=(v=>(v[v.None=0]="None",v[v.Evenly=1]="Evenly",v[v.Packed=2]="Packed",v))(mn||{});const si=class si extends Bt{constructor(t,i){let s;t===void 0||t instanceof Rt||typeof t=="string"?s=t:t&&(i=t);super(s);f(this,"E");f(this,"gt");f(this,"kf");f(this,"al");f(this,"yh");f(this,"ne");f(this,"_t");this.E=13,this.gt=null,this._t=new J,this.kf=null,this.al=null,this.ne=null,this.yh=!1,i&&Object.assign(this,i)}cloneProtected(t){super.cloneProtected(t),t.E=this.E,this.gt!==null&&(this.gt.gi?t.gt=this.gt:t.gt=this.gt.copy())}Vo(t){super.Vo(t),t.invalidateConnectedLinks(),t.al=this.al,t.ne=null}cl(){this.gt===null?this.gt=new Rs:this.gt.gi&&(this.gt=this.gt.copy())}lh(){super.lh(),this.gt!==null&&(this.gt.gi=!0)}WA(t){t!==null&&(this.al===null&&(this.al=new K),this.al.add(t))}JA(t){t!==null&&this.al!==null&&this.al.delete(t)}$A(t,i,s){if(t===null||this.al===null)return null;const n=this.al.iterator;for(;n.next();){const o=n.value;if(o.ry===this&&o.h1===t&&o.J2===i&&o.$2===s||o.ry===t&&o.h1===this&&o.J2===s&&o.$2===i)return o}return null}invalidateLinkBundle(t,i,s){i==null&&(i=""),s==null&&(s="");const n=this.$A(t,i,s);n!==null&&n.Ad()}Jc(t,i,s,n,o,r,a){t===3&&i==="elements"?this.ne=null:t===4&&i==="elements"&&(this.ne=null),super.Jc(t,i,s,n,o,r,a)}invalidateConnectedLinks(t){const i=this.linksConnected;for(;i.next();){const s=i.value;t!==void 0&&t.has(s)||(this.Wi(s.fromPort),this.Wi(s.toPort),s.invalidateRoute())}}tA(t){const i=this.linksConnected;for(;i.next();){const s=i.value;s.fromPort!==t&&s.toPort!==t||(this.Wi(s.fromPort),this.Wi(s.toPort),s.invalidateRoute())}}Wi(t){if(t===null)return;const i=t.Ju;i!==null&&i.Ad();const s=t.part,n=s.containingGroup;n!==null&&!s.isVisible()&&n.Wi(n.port)}Hr(){return!0}get portSpreading(){return this.gt!==null?this.gt.ly:1}set portSpreading(t){const i=this.portSpreading;if(i!==t){this.cl(),this.gt.ly=t,this.t("portSpreading",i,t);const s=this.diagram;if(s!==null&&s.undoManager.isUndoingRedoing)return;this.invalidateConnectedLinks()}}get avoidable(){return(this.E&8)!==0}set avoidable(t){const i=(this.E&8)!==0;if(i!==t){this.E=this.E^8;const s=this.diagram;s!==null&&s.EM(this),this.t("avoidable",i,t)}}get avoidableMargin(){return this.gt!==null?this.gt.hy:Kt.oC}set avoidableMargin(t){typeof t=="number"&&(t=new Kt(t));const i=this.avoidableMargin;if(!i.equals(t)){t=t.N(),this.cl(),this.gt.hy=t;const s=this.diagram;s!==null&&s.EM(this),this.t("avoidableMargin",i,t)}}canAvoid(){return this.avoidable&&!this.isLinkLabel}getAvoidableRect(t){return t.set(this.actualBounds),t.addMargin(this.avoidableMargin),t}findVisibleNode(){let t=this;for(;t!==null&&!t.isVisible();)t=t.containingGroup;return t}isVisible(){if(!super.isVisible())return!1;let t=!0,i=1;const s=this.diagram;if(s!==null){if(s.animationManager.nx(this))return!0;t=s.isTreePathToChildren,i=s.treeCollapsePolicy}if(i===1){const o=this.findTreeParentNode();if(o!==null&&!o.isTreeExpanded)return!1}else if(i===2){const o=t?this.findLinksInto():this.findLinksOutOf();let r=!1,a=!1;for(;o.next();){const h=o.value;if(h.isTreeLink){r=!0;const l=t?h.fromNode:h.toNode;if(l&&l.isTreeExpanded){a=!0;break}}}if(r&&!a)return!1}else if(i===3){const o=t?this.findLinksInto():this.findLinksOutOf();let r=!1,a=!1;for(;o.next();){const h=o.value;if(h.isTreeLink){r=!0;const l=t?h.fromNode:h.toNode;if(l&&!l.isTreeExpanded){a=!0;break}}}if(r&&a)return!1}const n=this.labeledLink;return n!==null?n.isVisible():!0}Ei(t){super.Ei(t);const i=this.linksConnected;for(;i.next();){const s=i.value;if(t&&this.containingGroup!==null){const n=s.getOtherNode(this);n!==null&&!n.isMemberOf(this.containingGroup)&&s.invalidateRoute()}s.Ei(t)}}get linksConnected(){return this._t.iterator}findExternalTreeLinksConnected(){const t=new K,i=new K;return this.ZA(this,t,i),i.iterator}ZA(t,i,s){if(t===null||i.has(t))return;i.add(t);let n=!0;const o=this.diagram;o!==null&&(n=o.isTreePathToChildren),t.linksConnected.each(r=>{r.isTreeLink?(n?r.fromNode===t:r.toNode===t)&&this.ZA(n?r.toNode:r.fromNode,i,s):s.add(r)})}findLinksConnected(t){if(t===void 0&&(t=null),t===null)return this._t.iterator;const i=new li(this._t),s=this;return i.predicate=n=>n.fromNode===s&&n.fromPortId===t||n.toNode===s&&n.toPortId===t,i}findLinksOutOf(t){t===void 0&&(t=null);const i=new li(this._t),s=this;return i.predicate=n=>n.fromNode!==s?!1:t===null?!0:n.fromPortId===t,i}findLinksInto(t){t===void 0&&(t=null);const i=new li(this._t),s=this;return i.predicate=n=>n.toNode!==s?!1:t===null?!0:n.toPortId===t,i}findNodesConnected(t){t===void 0&&(t=null);let i=null,s=null;const n=this._t.iterator;for(;n.next();){const o=n.value;if(o.fromNode===this){if(t===null||o.fromPortId===t){const r=o.toNode;i!==null?i.add(r):s!==null&&s!==r?(i=new K,i.add(s),i.add(r)):s=r}}else if(o.toNode===this&&(t===null||o.toPortId===t)){const r=o.fromNode;i!==null?i.add(r):s!==null&&s!==r?(i=new K,i.add(s),i.add(r)):s=r}}return i!==null?i.iterator:s!==null?new Xt(s):Ht.instance}findNodesOutOf(t){t===void 0&&(t=null);let i=null,s=null;const n=this._t.iterator;for(;n.next();){const o=n.value;if(o.fromNode===this&&(t===null||o.fromPortId===t)){const r=o.toNode;i!==null?i.add(r):s!==null&&s!==r?(i=new K,i.add(s),i.add(r)):s=r}}return i!==null?i.iterator:s!==null?new Xt(s):Ht.instance}findNodesInto(t){t===void 0&&(t=null);let i=null,s=null;const n=this._t.iterator;for(;n.next();){const o=n.value;if(o.toNode===this&&(t===null||o.toPortId===t)){const r=o.fromNode;i!==null?i.add(r):s!==null&&s!==r?(i=new K,i.add(s),i.add(r)):s=r}}return i!==null?i.iterator:s!==null?new Xt(s):Ht.instance}findLinksBetween(t,i,s){i===void 0&&(i=null),s===void 0&&(s=null);const n=new li(this._t),o=this;return n.predicate=r=>r.fromNode===o&&r.toNode===t&&(i===null||r.fromPortId===i)&&(s===null||r.toPortId===s)||r.fromNode===t&&r.toNode===o&&(s===null||r.fromPortId===s)&&(i===null||r.toPortId===i),n}findLinksTo(t,i,s){i===void 0&&(i=null),s===void 0&&(s=null);const n=new li(this._t),o=this;return n.predicate=r=>!(r.fromNode!==o||r.toNode!==t||i!==null&&r.fromPortId!==i||s!==null&&r.toPortId!==s),n}get linkConnected(){return this.gt!==null?this.gt.ay:null}set linkConnected(t){const i=this.linkConnected;i!==t&&(t!==null&&b.i(t,"function",si,"linkConnected"),this.cl(),this.gt.ay=t,this.t("linkConnected",i,t))}get linkDisconnected(){return this.gt!==null?this.gt.cy:null}set linkDisconnected(t){const i=this.linkDisconnected;i!==t&&(t!==null&&b.i(t,"function",si,"linkDisconnected"),this.cl(),this.gt.cy=t,this.t("linkDisconnected",i,t))}get linkValidation(){return this.gt!==null?this.gt.Ml:null}set linkValidation(t){const i=this.linkValidation;i!==t&&(t!==null&&b.i(t,"function",si,"linkValidation"),this.cl(),this.gt.Ml=t,this.t("linkValidation",i,t))}a1(t,i){this.Wi(i);const s=this._t.has(t);if(s||this._t.add(t),!s||t.fromNode===t.toNode){const n=this.linkConnected;if(n!==null){let o=!0;const r=this.diagram;r!==null&&(o=r.Y,r.Y=!0),n(this,t,i),r!==null&&(r.Y=o)}}if(!s){if(!t.isTreeLink)return;const n=t.fromNode,o=t.toNode;if(n!==null&&o!==null&&n!==o){let r=!0;const a=this.diagram;a!==null&&(r=a.isTreePathToChildren);const h=r?o:n,l=r?n:o;if(h.yh||(h.yh=l),l.isTreeLeaf){if(a!==null&&a.undoManager.isUndoingRedoing)return;r?n===l&&(l.isTreeLeaf=!1):o===l&&(l.isTreeLeaf=!1)}}}}c1(t,i){this.Wi(i);const s=this._t.delete(t);let n=null;if(s||t.toNode===t.fromNode){const o=this.linkDisconnected;if(n=this.diagram,o!==null){let r=!0;n!==null&&(r=n.Y,n.Y=!0),o(this,t,i),n!==null&&(n.Y=r)}}if(s){if(!t.isTreeLink)return;let o=!0;n!==null&&(o=n.isTreePathToChildren);const r=o?t.toNode:t.fromNode,a=o?t.fromNode:t.toNode;if(r!==null&&(r.yh=!1),a!==null&&!a.isTreeLeaf)if(a._t.count===0){if(a.yh=null,n!==null&&n.undoManager.isUndoingRedoing)return;a.isTreeLeaf=!0}else a.f0()}}f0(){if(this.yh=!1,this._t.count===0)return;let t=!0;const i=this.diagram;if(i!==null&&i.undoManager.isUndoingRedoing)return;i!==null&&(t=i.isTreePathToChildren);const s=this._t.iterator;for(;s.next();){const n=s.value;if(n.isTreeLink){if(t){if(n.fromNode===this){this.isTreeLeaf=!1;return}}else if(n.toNode===this){this.isTreeLeaf=!1;return}}}this.isTreeLeaf=!0}updateRelationshipsFromData(){const t=this.diagram;t!==null&&t.partManager.updateRelationshipsFromData(this)}Em(t){if(super.Em(t),!t){this.f0();const i=this.kf;i!==null&&i.QA(this)}}Bm(t){if(super.Bm(t),!t){const i=this.kf;i!==null&&i._A(this)}}Kc(){if(this._t.count>0){const t=this.diagram;if(t!==null){const i=t.commandHandler!==null?t.commandHandler.deletesConnectedLinks:!0,s=this._t.copy().iterator;for(;s.next();){const n=s.value;i?t.remove(n):(n.fromNode===this&&(n.fromNode=null),n.toNode===this&&(n.toNode=null))}}}this.labeledLink=null,super.Kc()}get isLinkLabel(){return this.kf!==null}get labeledLink(){return this.kf}set labeledLink(t){const i=this.kf;if(i!==t){const s=this.diagram,n=this.data;if(i!==null){if(i._A(this),s!==null&&n!==null&&!s.undoManager.isUndoingRedoing){const o=i.data,r=s.model;if(o!==null&&r.Ta()){const a=r.getKeyForNodeData(n);a!==void 0&&r.removeLabelKeyForLinkData(o,a)}}this.containingGroup=null}if(this.kf=t,t!==null){if(t.QA(this),s!==null&&n!==null&&!s.undoManager.isUndoingRedoing){const o=t.data,r=s.model;if(o!==null&&r.Ta()){const a=r.getKeyForNodeData(n);a!==void 0&&r.addLabelKeyForLinkData(o,a)}}this.containingGroup=t.containingGroup}this.ef(),this.t("labeledLink",i,t)}}findVisiblePort(t){let i=t;for(;i!==null&&(!i.actualBounds.isReal()||!i.isVisibleObject());)i=i.panel;return i===null?this.port:i}findPort(t){if(this.ne===null){if(t===""&&this.wn===!1)return this;this.tT()}let i=this.ne.get(t);return i!==null||t!==""&&(i=this.ne.get(""),i!==null)?i:this}get port(){return this.findPort("")}get ports(){return this.ne===null&&this.tT(),this.ne.iteratorValues}tT(){this.ne===null?this.ne=new St:this.ne.clear(),this.walkVisualTreeFrom(this,(t,i)=>t.hA(i)),this.ne.count===0&&this.ne.set("",this)}hA(t){const i=t.portId;i!==null&&this.ne!==null&&this.ne.set(i,t)}u2(t,i){const s=t.portId;if(s!==null){this.ne!==null&&this.ne.delete(s);const n=this.diagram;if(n!==null&&i){let o=null;const r=this.findLinksConnected(s);for(;r.next();){const a=r.value;o===null&&(o=b.nt()),o.push(a)}if(o!==null){for(let a=0;a<o.length;a++){const h=o[a];n.remove(h)}b.tt(o)}}}}isInTreeOf(t){if(t===null||t===this)return!1;let i=!0;const s=this.diagram;s!==null&&(i=s.isTreePathToChildren);let n=this;const o=t;let r;if(i)for(;n!==o;){r=null;const a=n._t.iterator;for(;a.next();){const h=a.value;if(h.isTreeLink&&(r=h.fromNode,r!==n&&r!==this))break}if(r===this||r===null||r===n)return!1;n=r}else for(;n!==o;){r=null;const a=n._t.iterator;for(;a.next();){const h=a.value;if(h.isTreeLink&&(r=h.toNode,r!==n&&r!==this))break}if(r===this||r===null||r===n)return!1;n=r}return!0}findTreeRoot(){let t=!0;const i=this.diagram;i!==null&&(t=i.isTreePathToChildren);let s=this,n;if(t)for(;;){n=null;const o=s._t.iterator;for(;o.next();){const r=o.value;if(r.isTreeLink&&(n=r.fromNode,n!==s&&n!==this))break}if(n===this)return this;if(n===null||n===s)return s;s=n}else for(;;){n=null;const o=s._t.iterator;for(;o.next();){const r=o.value;if(r.isTreeLink&&(n=r.toNode,n!==s&&n!==this))break}if(n===this)return this;if(n===null||n===s)return s;s=n}}findCommonTreeParent(t){if(t===null)return null;if(this===t)return this;let i=this;for(;i!==null;)i.l1(!0),i=i.findTreeParentNode();let s=null;for(i=t;i!==null;){if(i.qA()){s=i;break}i=i.findTreeParentNode()}for(i=this;i!==null;)i.l1(!1),i=i.findTreeParentNode();return s}findTreeParentLink(){let t=!0;const i=this.diagram;i!==null&&(t=i.isTreePathToChildren);const s=this._t.iterator;if(t)for(;s.next();){const n=s.value;if(n.isTreeLink&&n.fromNode!==this)return n}else for(;s.next();){const n=s.value;if(n.isTreeLink&&n.toNode!==this)return n}return null}findTreeParentNode(){const t=this.yh;if(t===null)return null;if(t instanceof si)return t;const i=this.diagram,s=i!==null?i.isTreePathToChildren:!0,n=this._t.iterator;for(;n.next();){const o=n.value;if(!o.isTreeLink)continue;const r=s?o.fromNode:o.toNode;if(r!==this)return this.yh=r,r}return this.yh=null,null}findTreeParentChain(){function t(s,n){n.add(s);const o=s.findTreeParentLink();if(o!==null){n.add(o);const r=s.findTreeParentNode();if(r===null)return;t(r,n)}}const i=new K;return t(this,i),i}findTreeLevel(){return this.Vv(this)}Vv(t){let i=0,s=t.findTreeParentNode();for(;s!==null&&s!==t;)s=s.findTreeParentNode(),i++;return i}findTreeChildrenLinks(){let t=!0;const i=this.diagram;i!==null&&(t=i.isTreePathToChildren);const s=new li(this._t),n=this;return t?s.predicate=o=>!(!o.isTreeLink||o.fromNode!==n):s.predicate=o=>!(!o.isTreeLink||o.toNode!==n),s}findTreeChildrenNodes(){let t=!0;const i=this.diagram;i!==null&&(t=i.isTreePathToChildren);let s=null,n=null;const o=this._t.iterator;if(t)for(;o.next();){const r=o.value;if(r.isTreeLink&&r.fromNode===this){const a=r.toNode;s!==null?s.add(a):n!==null&&n!==a?(s=new J,s.add(n),s.add(a)):n=a}}else for(;o.next();){const r=o.value;if(r.isTreeLink&&r.toNode===this){const a=r.fromNode;s!==null?s.add(a):n!==null&&n!==a?(s=new J,s.add(n),s.add(a)):n=a}}return s!==null?s.iterator:n!==null?new Xt(n):Ht.instance}findTreeParts(t){t===void 0&&(t=1/0),b.i(t,"number",si,"findTreeParts:level");const i=new K;return Bt.sh(i,this,!1,t,!0),i}collapseTree(t){t===void 0&&(t=1),t<1&&(t=1);const i=this.diagram;if(i===null||i.isCollapsingExpanding)return;i.isCollapsingExpanding=!0;const s=new K;s.add(this),this.iT(s,i.isTreePathToChildren,t,i,this,i.treeCollapsePolicy===1),i.isCollapsingExpanding=!1}iT(t,i,s,n,o,r){if(s>1){const a=i?this.findLinksOutOf():this.findLinksInto();for(;a.next();){const h=a.value;if(!h.isTreeLink)continue;const l=h.getOtherNode(this);l!==null&&l!==this&&!t.has(l)&&(t.add(l),l.iT(t,i,s-1,n,o,r))}}else this.eT(t,i,n,o,r)}eT(t,i,s,n,o){const r=n===this?!0:this.isTreeExpanded,a=i?this.findLinksOutOf():this.findLinksInto();for(;a.next();){const h=a.value;if(!h.isTreeLink)continue;const l=h.getOtherNode(this);if(l!==null&&l!==this){const u=t.has(l);if(u||t.add(l),r){const c=i?l.findNodesInto():l.findNodesOutOf(),d=this;c.all(m=>m===d||!m.isTreeExpanded)&&s.Lc(l,n),l.ch(),l.Ei(!1)}l.isTreeExpanded&&(l.wasTreeExpanded=l.isTreeExpanded,u||l.eT(t,i,s,n,o))}}this.isTreeExpanded=!1}expandTree(t){t===void 0&&(t=2),t<2&&(t=2);const i=this.diagram;if(i===null||i.isCollapsingExpanding)return;i.isCollapsingExpanding=!0;const s=new K;s.add(this),this.sT(s,i.isTreePathToChildren,t,i,this,i.treeCollapsePolicy===1),i.isCollapsingExpanding=!1}sT(t,i,s,n,o,r){const a=o===this?!1:this.isTreeExpanded,h=i?this.findLinksOutOf():this.findLinksInto();for(;h.next();){const l=h.value;if(!l.isTreeLink)continue;a||l.Me||l.invalidateRoute();const u=l.getOtherNode(this);if(u!==null&&u!==this&&!t.has(u)){if(t.add(u),!a){u.Ei(!0),u.ch();const c=i?u.findNodesInto():u.findNodesOutOf(),d=this;c.all(m=>m===d||!m.isTreeExpanded)&&n.Cc(u,o)}(s>2||u.wasTreeExpanded)&&(u.wasTreeExpanded=!1,u.sT(t,i,s-1,n,o,r))}}this.isTreeExpanded=!0}get isTreeExpanded(){return(this.E&1)!==0}set isTreeExpanded(t){const i=(this.E&1)!==0;if(i!==t){this.E=this.E^1;const s=this.diagram;this.t("isTreeExpanded",i,t);const n=this.treeExpandedChanged;if(n!==null){let o=!0;s!==null&&(o=s.Y,s.Y=!0),n(this),s!==null&&(s.Y=o)}if(s!==null&&s.undoManager.isUndoingRedoing){this.Ei(t);return}t?this.expandTree():this.collapseTree()}}get wasTreeExpanded(){return(this.E&2)!==0}set wasTreeExpanded(t){const i=(this.E&2)!==0;i!==t&&(this.E=this.E^2,this.t("wasTreeExpanded",i,t))}get treeExpandedChanged(){return this.gt!==null?this.gt.fy:null}set treeExpandedChanged(t){const i=this.treeExpandedChanged;i!==t&&(t!==null&&b.i(t,"function",si,"treeExpandedChanged"),this.cl(),this.gt.fy=t,this.t("treeExpandedChanged",i,t))}get isTreeLeaf(){return(this.E&4)!==0}set isTreeLeaf(t){const i=(this.E&4)!==0;i!==t&&(this.E=this.E^4,this.t("isTreeLeaf",i,t))}get isTreeRoot(){return this.findTreeParentLink()===null}};f(si,"SpreadingNone",0),f(si,"SpreadingEvenly",1),f(si,"SpreadingPacked",2);let nt=si;class Rs{constructor(){f(this,"gi");f(this,"ay");f(this,"cy");f(this,"Ml");f(this,"fy");f(this,"hy");f(this,"ly");f(this,"uy");f(this,"gy");f(this,"eh");f(this,"my");this.gi=!1,this.ay=null,this.cy=null,this.Ml=null,this.fy=null,this.hy=Kt.oC,this.ly=1,this.uy=null,this.gy=null,this.eh=null,this.my=null}copy(){const e=new Rs;return e.ay=this.ay,e.cy=this.cy,e.Ml=this.Ml,e.fy=this.fy,e.hy=this.hy.N(),e.ly=this.ly,e.uy=this.uy,e.gy=this.gy,e.eh=this.eh,e.my=this.my,e}}var Bs=(v=>(v[v.None=0]="None",v[v.End=17]="End",v[v.Scale=18]="Scale",v[v.Stretch=19]="Stretch",v))(Bs||{}),Es=(v=>(v[v.Normal=1]="Normal",v[v.Orthogonal=2]="Orthogonal",v[v.AvoidsNodes=6]="AvoidsNodes",v[v.AvoidsNodesStraight=7]="AvoidsNodesStraight",v))(Es||{}),Is=(v=>(v[v.None=0]="None",v[v.Bezier=9]="Bezier",v[v.JumpGap=10]="JumpGap",v[v.JumpOver=11]="JumpOver",v))(Is||{});const Lt=class Lt extends Bt{constructor(t){super(ct.Link);f(this,"Nt");f(this,"lo");f(this,"ho");f(this,"Td");f(this,"ao");f(this,"co");f(this,"Dd");f(this,"Pf");f(this,"Fd");f(this,"Rd");f(this,"vd");f(this,"Da");f(this,"Od");f(this,"Hs");f(this,"ki");f(this,"fl");f(this,"Sr");f(this,"Sf");f(this,"$o");f(this,"Z2");f(this,"Q2");f(this,"f1");f(this,"_2");f(this,"tN");f(this,"py");f(this,"u1");f(this,"ct");f(this,"Zo");f(this,"hf");f(this,"iN");f(this,"eN");this.Nt=8,this.lo=null,this.ho="",this.Td=null,this.ao=null,this.co="",this.Dd=null,this.Pf=0,this.Fd=0,this.Rd=0,this.vd=NaN,this.Da=1,this.Od=.5,this.Hs=null,this.ki=new J().g(),this.fl=null,this.Sr=null,this.Sf=new z,this.ct=new Ft,this.$o=null,this.Zo=null,this.Z2=null,this.Q2=null,this.iN=0,this.eN=0,this.f1=new S,this._2=null,this.tN=null,this.py=null,this.u1=NaN,this.q=null,this.hf=[],t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Nt=this.Nt&-113,t.ho=this.ho,t.Td=this.Td,t.co=this.co,t.Dd=this.Dd,t.Pf=this.Pf,t.Fd=this.Fd,t.Rd=this.Rd,t.vd=this.vd,t.Da=this.Da,t.Od=this.Od,this.q!==null&&(t.q=this.q.copy())}Vo(t){super.Vo(t),this.ho=t.ho,this.co=t.co,t.fl=null,t.invalidateRoute(),t.Zo=this.Zo;const i=t.fromPort;i!==null&&t.fromNode.Wi(i);const s=t.toPort;s!==null&&t.toNode.Wi(s)}ri(t){t in Es||t in Is||t in Bs?Lt.sN(t)?this.routing=t:t===9||t===10||t===11?this.curve=t:t===17||t===18||t===19?this.adjusting=t:t===1||t===0||b.o("Unknown Link enum value for a Link property: "+t):super.ri(t)}Xe(){this.q===null&&(this.q=new ys)}QR(t,i,s){const n=t.segmentIndex,o=t.segmentFraction;let r=t.alignmentFocus;const a=t.segmentOrientation,h=t.segmentOffset;let l=0,u=0,c=0,d=0;if(isNaN(n)){const T=this.ct,L=b.nt();T.getPointAndAngleAlongPath(o,L);const F=S.X(L[0],L[1]);if(F.add(this.getPoint(0)),T.type===1)F.offset(-T.startX,-T.startY);else{const D=T.figures.first();F.offset(-D.startX,-D.startY)}d=L[2],a!==0&&(c=this.computeAngle(t,a,d),t.angle=c),l=F.x,u=F.y,S.s(F),b.tt(L)}else if(n<-i||n>=i){const T=S.l();this.mA(T),d=this.midAngle,a!==0&&(c=this.computeAngle(t,a,d),t.angle=c),l=T.x,u=T.y,S.s(T)}else{let T,L,F=0;if(n>=0?(T=s.r[n],L=n<i-1?s.r[n+1]:T):(F=i+n,T=s.r[F],L=F>0?s.r[F-1]:T),T.equalsApprox(L)){let D,R;n>=0?(D=n>0?s.r[n-1]:T,R=n<i-2?s.r[n+2]:L):(D=F<i-1?s.r[F+1]:T,R=F>1?s.r[F-2]:L);const I=D.distanceSquaredPoint(T),j=L.distanceSquaredPoint(R);I>j+10?d=n>=0?D.directionPoint(T):T.directionPoint(D):j>I+10?d=n>=0?L.directionPoint(R):R.directionPoint(L):d=n>=0?D.directionPoint(R):R.directionPoint(D)}else d=n>=0?T.directionPoint(L):L.directionPoint(T);a!==0&&(c=this.computeAngle(t,a,d),t.angle=c),l=T.x+(L.x-T.x)*o,u=T.y+(L.y-T.y)*o}if(r.isNone()){t.location=new S(l,u);return}else r.isNoSpot()&&(r=B.Center);const m=Tt.l();m.Ri(),m.et(t.scale,t.scale),m.cs(t.angle,0,0);const g=t.naturalBounds,p=z.X(0,0,g.width,g.height),y=S.l();y.setRectSpot(p,r),m.xt(y);let x=-y.x,P=-y.y;const k=g.width,w=g.height,N=S.l();N.a(h);const M=isNaN(h.x),C=isNaN(h.y);if(M||C){const T=k/2+3,L=w/2+3,F=d>=45&&d<=135,D=d>=225&&d<=315;a===0&&(F||D)?(N.x=C?T:h.y,N.y=M?L:h.x,F?n>=0||isNaN(n)&&o<.5||M&&(N.y=-L):D&&((n>=0||isNaN(n)&&o<.5)&&M&&(N.y=-L),C&&(N.x=-T))):(M&&(n>=0||isNaN(n)&&o<.5?N.x=T:N.x=-T),C&&(N.y=-L),N.rotate(d))}else N.rotate(d);l+=N.x,u+=N.y,m.xw(p),x+=p.x,P+=p.y;const O=S.X(l+x,u+P);t.move(O),S.s(O),S.s(N),S.s(y),z.s(p),Tt.s(m)}Hr(){let t=this.fromNode;if(t!==null){const s=t.findVisibleNode();if(s!==null&&(t=s),t.is()||t.th())return!1}let i=this.toNode;if(i!==null){const s=i.findVisibleNode();if(s!==null&&(i=s),i.is()||i.th())return!1}return!0}c2(t,i,s){return!1}f2(){}Pe(){return!1}computeAngle(t,i,s){return Lt.computeAngle(i,s)}static computeAngle(t,i){let s=0;switch(t){default:case 0:s=0;break;case 21:s=i;break;case 22:s=i+90;break;case 23:s=i-90;break;case 24:s=i+180;break;case 25:s=A.zg(i),s>90&&s<270&&(s-=180);break;case 26:s=A.zg(i+90),s>90&&s<270&&(s-=180);break;case 27:s=A.zg(i-90),s>90&&s<270&&(s-=180);break;case 28:if(s=A.zg(i),s>45&&s<135||s>225&&s<315)return 0;s>90&&s<270&&(s-=180);break}return A.zg(s)}get fromNode(){return this.lo}set fromNode(t){const i=this.lo;if(i!==t){const s=this.fromPort;i!==null&&(this.ao!==i&&i.c1(this,s),this.yy(),this.invalidateLayout(2)),this.lo=t,t!==null&&this.Ei(t.isVisible()),this.$o=null,this.invalidateRoute();const n=this.diagram;n!==null&&n.Y&&n.partManager.setFromNodeForLink(this,t,i);const o=this.fromPort,r=this.fromPortChanged;if(r!==null){let a=!0;n!==null&&(a=n.Y,n.Y=!0),r(this,s,o),n!==null&&(n.Y=a)}t!==null&&(this.ao!==t&&t.a1(this,o),this.wy(),this.invalidateLayout(1)),this.t("fromNode",i,t),this.Ld()}}get fromPortId(){return this.ho}set fromPortId(t){const i=this.ho;if(i!==t){const s=this.fromPort;s!==null&&this.fromNode.Wi(s),this.yy(),this.ho=t;const n=this.fromPort;n!==null&&this.fromNode.Wi(n);const o=this.diagram;if(o!==null){const r=this.data,a=o.model;r!==null&&a.Ta()&&a.setFromPortIdForLinkData(r,t)}if(s!==n){this.$o=null,this.invalidateRoute();const r=this.fromPortChanged;if(r!==null){let a=!0;o!==null&&(a=o.Y,o.Y=!0),r(this,s,n),o!==null&&(o.Y=a)}}this.wy(),this.t("fromPortId",i,t)}}get fromPort(){const t=this.lo;if(t===null)return null;const i=this.ho;return t.findPort(i)}get fromPortChanged(){return this.Td}set fromPortChanged(t){const i=this.Td;i!==t&&(t!==null&&b.i(t,"function",Lt,"fromPortChanged"),this.Td=t,this.t("fromPortChanged",i,t))}get toNode(){return this.ao}set toNode(t){const i=this.ao;if(i!==t){const s=this.toPort;i!==null&&(this.lo!==i&&i.c1(this,s),this.yy(),this.invalidateLayout(2)),this.ao=t,t!==null&&this.Ei(t.isVisible()),this.$o=null,this.invalidateRoute();const n=this.diagram;n!==null&&n.Y&&n.partManager.setToNodeForLink(this,t,i);const o=this.toPort,r=this.toPortChanged;if(r!==null){let a=!0;n!==null&&(a=n.Y,n.Y=!0),r(this,s,o),n!==null&&(n.Y=a)}t!==null&&(this.lo!==t&&t.a1(this,o),this.wy(),this.invalidateLayout(1)),this.t("toNode",i,t),this.Ld()}}get toPortId(){return this.co}set toPortId(t){const i=this.co;if(i!==t){const s=this.toPort;s!==null&&this.toNode.Wi(s),this.yy(),this.co=t;const n=this.toPort;n!==null&&this.toNode.Wi(n);const o=this.diagram;if(o!==null){const r=this.data,a=o.model;r!==null&&a.Ta()&&a.setToPortIdForLinkData(r,t)}if(s!==n){this.$o=null,this.invalidateRoute();const r=this.toPortChanged;if(r!==null){let a=!0;o!==null&&(a=o.Y,o.Y=!0),r(this,s,n),o!==null&&(o.Y=a)}}this.wy(),this.t("toPortId",i,t)}}get toPort(){const t=this.ao;if(t===null)return null;const i=this.co;return t.findPort(i)}get toPortChanged(){return this.Dd}set toPortChanged(t){const i=this.Dd;i!==t&&(t!==null&&b.i(t,"function",Lt,"toPortChanged"),this.Dd=t,this.t("toPortChanged",i,t))}get fromSpot(){return this.q!==null?this.q.fa:B.Default}set fromSpot(t){const i=this.fromSpot;if(!i.equals(t)){if(t=t.N(),this.Xe(),this.q.fa=t,this.t("fromSpot",i,t),i.isSide()||t.isSide()){const s=this.fromNode;s!==null&&s.Wi(this.fromPort)}this.invalidateRoute()}}get fromEndSegmentLength(){return this.q!==null?this.q.da:NaN}set fromEndSegmentLength(t){const i=this.fromEndSegmentLength;if(i!==t){if(t<0&&b._(t,">= 0",Lt,"fromEndSegmentLength"),this.Xe(),this.q.da=t,this.t("fromEndSegmentLength",i,t),this.computeSpot(!0,this.fromPort).isSide()){const s=this.fromNode;s!==null&&s.Wi(this.fromPort)}this.invalidateRoute()}}get fromShortLength(){return this.q!==null?this.q.ma:NaN}set fromShortLength(t){const i=this.fromShortLength;i!==t&&(this.Xe(),this.q.ma=t,this.ee(),this.t("fromShortLength",i,t))}get toSpot(){return this.q!==null?this.q.ua:B.Default}set toSpot(t){const i=this.toSpot;if(!i.equals(t)){if(t=t.N(),this.Xe(),this.q.ua=t,this.t("toSpot",i,t),i.isSide()||t.isSide()){const s=this.toNode;s!==null&&s.Wi(this.toPort)}this.invalidateRoute()}}get toEndSegmentLength(){return this.q!==null?this.q.ga:NaN}set toEndSegmentLength(t){const i=this.toEndSegmentLength;if(i!==t){if(t<0&&b._(t,">= 0",Lt,"toEndSegmentLength"),this.Xe(),this.q.ga=t,this.t("toEndSegmentLength",i,t),this.computeSpot(!1,this.toPort).isSide()){const s=this.toNode;s!==null&&s.Wi(this.toPort)}this.invalidateRoute()}}get toShortLength(){return this.q!==null?this.q.pa:NaN}set toShortLength(t){const i=this.toShortLength;i!==t&&(this.Xe(),this.q.pa=t,this.ee(),this.t("toShortLength",i,t))}Ld(){const t=this.fromNode,i=this.toNode;let s=null;if(t!==null?i!==null?s=t.findCommonContainingGroup(i):s=t.containingGroup:i!==null?s=i.containingGroup:s=null,this.Yv(s),this.isLabeledLink){const n=this.labelNodes;for(;n.next();){const o=n.value;o.containingGroup=s}}}Yv(t){const i=this.ph;if(i!==t){i!==null&&i.G2(this),this.ph=t,t!==null&&t.j2(this);const s=this.containingGroupChanged;if(s!==null){let n=!0;const o=this.diagram;o!==null&&(n=o.Y,o.Y=!0),s(this,i,t),o!==null&&(o.Y=n)}this.Me&&(this._2===i||this.tN===i)&&this.invalidateRoute()}}ch(){const t=this.containingGroup;t!==null&&this.fromNode!==t&&this.toNode!==t&&t.computesBoundsIncludingLinks&&super.ch()}getOtherNode(t){const i=this.fromNode;return t===i?this.toNode:i}getOtherPort(t){const i=this.fromPort;return t===i?this.toPort:i}get isLabeledLink(){return this.Hs===null?!1:this.Hs.count>0}get labelNodes(){return this.Hs===null?Ht.instance:this.Hs.iterator}QA(t){this.Hs===null&&(this.Hs=new K),this.Hs.add(t),this.c()}_A(t){this.Hs!==null&&(this.Hs.delete(t),this.c())}Em(t){if(super.Em(t),this.Oa()&&this.invalidateOtherJumpOvers(this.actualBounds),!t){const i=this.lo;let s=null;i!==null&&(s=this.fromPort,i.a1(this,s));const n=this.ao;let o=null;n!==null&&(o=this.toPort,(n!==i||o!==s)&&n.a1(this,o)),this.wy()}}Bm(t){if(super.Bm(t),this.Oa()&&this.invalidateOtherJumpOvers(this.actualBounds),!t){const i=this.lo;let s=null;i!==null&&(s=this.fromPort,i.c1(this,s));const n=this.ao;let o=null;n!==null&&(o=this.toPort,(n!==i||o!==s)&&n.c1(this,o)),this.yy()}}Kc(){if(this.Me=!0,this.Hs!==null){const t=this.diagram;if(t!==null){const i=this.Hs.copy().iterator;for(;i.next();){const s=i.value;t.remove(s)}}}if(this.data!==null){const t=this.diagram;t!==null&&t.partManager.nN(this)}}updateRelationshipsFromData(){if(this.data===null)return;const t=this.diagram;t!==null&&t.partManager.updateRelationshipsFromData(this)}move(t,i){const s=i?this.location:this.position;let n=s.x;isNaN(n)&&(n=0);let o=s.y;isNaN(o)&&(o=0);const r=t.x-n,a=t.y-o;if(i===!0)super.move(t,!1);else{const l=S.X(s.x+r,s.y+a);super.move(l,!1),S.s(l)}this.pr(r,a);const h=this.labelNodes;for(;h.next();){const l=h.value,u=l.position;l.moveTo(u.x+r,u.y+a)}}get relinkableFrom(){return(this.Nt&1)!==0}set relinkableFrom(t){const i=(this.Nt&1)!==0;i!==t&&(this.Nt=this.Nt^1,this.t("relinkableFrom",i,t),this.invalidateAdornments())}get relinkableTo(){return(this.Nt&2)!==0}set relinkableTo(t){const i=(this.Nt&2)!==0;i!==t&&(this.Nt=this.Nt^2,this.t("relinkableTo",i,t),this.invalidateAdornments())}canRelinkFrom(){if(!this.relinkableFrom)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowRelink)return!1;const i=t.diagram;return!(i!==null&&!i.allowRelink)}canRelinkTo(){if(!this.relinkableTo)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowRelink)return!1;const i=t.diagram;return!(i!==null&&!i.allowRelink)}get resegmentable(){return(this.Nt&4)!==0}set resegmentable(t){const i=(this.Nt&4)!==0;i!==t&&(this.Nt=this.Nt^4,this.t("resegmentable",i,t),this.invalidateAdornments())}get isTreeLink(){return(this.Nt&8)!==0}set isTreeLink(t){const i=(this.Nt&8)!==0;i!==t&&(this.Nt=this.Nt^8,this.t("isTreeLink",i,t),this.fromNode!==null&&this.fromNode.f0(),this.toNode!==null&&this.toNode.f0())}get path(){const t=this.findMainElement();return t instanceof bt?t:null}get routeBounds(){return this.updateRoute(),this.Gv(this.Sf)}Gv(t){let i=1/0,s=1/0;const n=this.pointsCount;if(n===0)return t.e(NaN,NaN,0,0),t;if(n===1){const o=this.getPoint(0);i=Math.min(o.x,i),s=Math.min(o.y,s),t.e(o.x,o.y,0,0)}else if(n===2){const o=this.getPoint(0),r=this.getPoint(1);i=Math.min(o.x,r.x),s=Math.min(o.y,r.y),t.e(o.x,o.y,0,0),t.unionPoint(r)}else if(this.computeCurve()===9&&n>=3&&!this.isOrthogonal){let o=this.getPoint(0);if(i=o.x,s=o.y,t.e(i,s,0,0),n===3){const r=this.getPoint(1);i=Math.min(r.x,i),s=Math.min(r.y,s);const a=this.getPoint(2);i=Math.min(a.x,i),s=Math.min(a.y,s),A.hu(o.x,o.y,r.x,r.y,r.x,r.y,a.x,a.y,.5,t)}else for(let r=3;r<n;r+=3){const a=this.getPoint(r-2);r+3>=n&&(r=n-1);const h=this.getPoint(r-1),l=this.getPoint(r);A.hu(o.x,o.y,a.x,a.y,h.x,h.y,l.x,l.y,.5,t),i=Math.min(l.x,i),s=Math.min(l.y,s),o=l}}else{const o=this.getPoint(0),r=this.getPoint(1);i=Math.min(o.x,r.x),s=Math.min(o.y,r.y),t.e(o.x,o.y,0,0),t.unionPoint(r);for(let a=2;a<n;a++){const h=this.getPoint(a);i=Math.min(h.x,i),s=Math.min(h.y,s),t.unionPoint(h)}}return this.f1.e(i-t.x,s-t.y),t}get midPoint(){return this.updateRoute(),this.computeMidPoint(new S)}mA(t){return this.updateRoute(),this.computeMidPoint(t)}computeMidPoint(t){const i=this.pointsCount;if(i===0)return t.a(S.Ak),t;if(i===1)return t.a(this.getPoint(0)),t;if(i===2){const u=this.getPoint(0),c=this.getPoint(1);return t.e((u.x+c.x)/2,(u.y+c.y)/2),t}if(this.isOrthogonal&&(this.computeCorner()>=15||this.computeCurve()===9)){this.ct.getPointAlongPath(.5,t),t.add(this.getPoint(0));const u=this.ct.figures.first();return t.offset(-u.startX,-u.startY),t}if(this.computeCurve()===9){if(i===3){const d=this.getPoint(0),m=this.getPoint(1),g=this.getPoint(2);return A.fC(d.x,d.y,m.x,m.y,m.x,m.y,g.x,g.y,t),t}const u=(i-1)/3|0,c=(u/2|0)*3;if(u%2===1){const d=this.getPoint(c),m=this.getPoint(c+1),g=this.getPoint(c+2),p=this.getPoint(c+3);return A.fC(d.x,d.y,m.x,m.y,g.x,g.y,p.x,p.y,t),t}else return t.a(this.getPoint(c)),t}const s=this.flattenedLengths,n=this.flattenedTotalLength;let o=0,r=0,a=0;for(;o<n/2&&r<i&&(a=s[r],!(o+a>n/2));)o+=a,r++;const h=this.getPoint(r),l=this.getPoint(r+1);if(Math.abs(h.x-l.x)<1)h.y>l.y?t.e(h.x,h.y-(n/2-o)):t.e(h.x,h.y+(n/2-o));else if(Math.abs(h.y-l.y)<1)h.x>l.x?t.e(h.x-(n/2-o),h.y):t.e(h.x+(n/2-o),h.y);else{const u=(n/2-o)/a,c=u*(l.x-h.x),d=u*(l.y-h.y);t.e(h.x+c,h.y+d)}return t}get midAngle(){return this.updateRoute(),this.computeMidAngle()}computeMidAngle(){const t=this.pointsCount;if(t<2)return NaN;if(t===2){const l=this.getPoint(0),u=this.getPoint(1);return l.directionPoint(u)}if(this.isOrthogonal&&(this.computeCorner()>=15||this.computeCurve()===9))return this.ct.getAngleAlongPath(.5);if(this.computeCurve()===9&&t>=4){const l=(t-1)/3|0;let u=(l/2|0)*3;if(l%2===1){u=Math.floor(u);const c=this.getPoint(u),d=this.getPoint(u+1),m=this.getPoint(u+2),g=this.getPoint(u+3);return A.FD(c.x,c.y,d.x,d.y,m.x,m.y,g.x,g.y)}else if(u>0&&u+1<t){const c=this.getPoint(u-1),d=this.getPoint(u+1);return c.directionPoint(d)}}const i=this.flattenedLengths,s=this.flattenedTotalLength;let n=0,o=0,r=0;for(;n<s/2&&o<t&&(r=i[o],!(n+r>s/2));)n+=r,o++;const a=this.getPoint(o),h=this.getPoint(o+1);if(Math.abs(a.x-h.x)<1&&Math.abs(a.y-h.y)<1){if(o>0&&o+2<t){const l=this.getPoint(o-1),u=this.getPoint(o+2);return l.directionPoint(u)}}else{if(Math.abs(a.x-h.x)<1)return a.y>h.y?270:90;if(Math.abs(a.y-h.y)<1)return a.x>h.x?180:0}return a.directionPoint(h)}jv(){if(this.py===null){this.Me||this.d1();const t=this.py=[];this.Hv(t)}}get flattenedLengths(){return this.jv(),this.py}get flattenedTotalLength(){let t=this.u1;if(isNaN(t)){const i=this.flattenedLengths,s=i.length;t=0;for(let n=0;n<s;n++)t+=i[n];this.u1=t}return t}Hv(t){const i=this.pointsCount;for(let s=0;s<i-1;s++){let n=0;const o=this.getPoint(s),r=this.getPoint(s+1);A.K(o.x,r.x)?(n=r.y-o.y,n<0&&(n=-n),t.push(n)):A.K(o.y,r.y)?(n=r.x-o.x,n<0&&(n=-n),t.push(n)):(n=Math.sqrt(o.distanceSquaredPoint(r)),t.push(n))}}get points(){return this.ki}set points(t){const i=this.ki;if(i===t)return;let s=null;if(Array.isArray(t)){const o=t;let r=o.length%2===0;if(r){for(let a=0;a<o.length;a++)if(typeof o[a]!="number"||isNaN(o[a])){r=!1;break}}if(r){s=new J;for(let a=0;a<o.length/2;a++){const h=new S(o[a*2],o[a*2+1]).g();s.add(h)}}else{let a=!0;for(let h=0;h<o.length;h++){const l=o[h];if(!b.wt(l)||typeof l.x!="number"||isNaN(l.x)||typeof l.y!="number"||isNaN(l.y)){a=!1;break}}if(a){s=new J;for(let h=0;h<o.length;h++){const l=o[h];s.add(new S(l.x,l.y).g())}}}}else if(t instanceof J){s=t.copy();const o=s.iterator;for(;o.next();)o.value.g()}else b.o("Link.points value is not an instance of List or Array: "+t);s.g(),this.ki=s,this.ee(),this.d1();const n=this.diagram;n!==null&&(!n.Bh&&!n.undoManager.isUndoingRedoing&&n.mx.add(this),n.animationManager.wi&&n.animationManager.AS(this,s)),this.t("points",i,s)}get pointsCount(){return this.ki.count}getPoint(t){return this.ki.r[t]}setPoint(t,i){this.ki.setElt(t,i)}setPointAt(t,i,s){this.ki.setElt(t,new S(i,s))}insertPoint(t,i){this.ki.insertAt(t,i)}insertPointAt(t,i,s){this.ki.insertAt(t,new S(i,s))}addPoint(t){this.ki.add(t)}addPointAt(t,i){this.ki.add(new S(t,i))}removePoint(t){this.ki.removeAt(t)}clearPoints(){this.ki.clear()}pr(t,i){if(t===0&&i===0)return;if(this.pointsCount===0){this.defaultFromPoint&&this.defaultFromPoint.offset(t,i),this.defaultToPoint&&this.defaultToPoint.offset(t,i);return}const s=this.Me,n=new J,o=this.ki.iterator;for(;o.next();){const h=o.value;n.add(new S(h.x+t,h.y+i).g())}n.g();const r=this.ki;this.ki=n;const a=this.diagram;isNaN(t)||isNaN(i)||a!==null&&a.animationManager.wi?this.c():(this.js.e(this.js.x+t,this.js.y+i),this.at.e(this.at.x+t,this.at.y+i),this.ef()),s?this.d1():(this.defaultFromPoint&&(this.defaultFromPoint=this.getPoint(0)),this.defaultToPoint&&(this.defaultToPoint=this.getPoint(this.pointsCount-1))),a!==null&&a.animationManager.wi&&a.animationManager.AS(this,n),this.t("points",r,n)}startRoute(){this.fl===null&&(this.fl=this.ki,this.ki=this.ki.copy())}commitRoute(){if(this.fl===null)return;const t=this.fl,i=this.ki;let s=1/0,n=1/0;const o=t.r,r=o.length;for(let d=0;d<r;d++){const m=o[d];s=Math.min(m.x,s),n=Math.min(m.y,n)}let a=1/0,h=1/0;const l=i.r,u=l.length;for(let d=0;d<u;d++){const m=l[d];a=Math.min(m.x,a),h=Math.min(m.y,h),m.g()}if(i.g(),u===r)for(let d=0;d<u;d++){const m=o[d],g=l[d];if(m.x-s!==g.x-a||m.y-n!==g.y-h){this.ee();break}}else this.ee();this.fl=null;const c=this.diagram;c!==null&&c.animationManager.wi&&c.animationManager.AS(this,i),this.d1(),this.t("points",t,i)}rollbackRoute(){this.fl!==null&&(this.ki=this.fl,this.fl=null)}mF(){this.Sr!==null&&(this.points=this.Sr,this.Sr=null)}d1(){if(this.ki.count===0){this.Me=!1;return}this.Me=!0,this.py=null,this.u1=NaN,this.defaultFromPoint=this.getPoint(0),this.defaultToPoint=this.getPoint(this.pointsCount-1),this.g1(!1)}invalidateRoute(){if(this.suspendsRouting)return;const t=this.path;if(t===null)return;const i=this.diagram;if(i){if(i.mx.has(this)||i.undoManager.isUndoingRedoing)return;const s=i.animationManager;if(s.isTicking&&!s.isAnimating)return;this.Sr!==null&&!s.isTicking&&(this.Sr=null)}this.Me=!1,this.c(),t.c()}get Me(){return(this.Nt&16)!==0}set Me(t){(this.Nt&16)!==0!==t&&(this.Nt=this.Nt^16)}get suspendsRouting(){return(this.Nt&32)!==0}set suspendsRouting(t){(this.Nt&32)!==0!==t&&(this.Nt=this.Nt^32)}get xy(){return(this.Nt&64)!==0}set xy(t){(this.Nt&64)!==0!==t&&(this.Nt=this.Nt^64)}get oN(){return(this.Nt&512)!==0}set oN(t){(this.Nt&512)!==0!==t&&(this.Nt=this.Nt^512)}get defaultFromPoint(){return this.Z2}set defaultFromPoint(t){this.Z2=t.copy()}get defaultToPoint(){return this.Q2}set defaultToPoint(t){this.Q2=t.copy()}updateRoute(){if(this.Me||this.xy)return;let t=!0;try{this.xy=!0,this.startRoute(),t=this.computePoints()}catch{this.xy=!1,this.rollbackRoute()}finally{this.xy=!1,t?this.commitRoute():this.rollbackRoute()}}computePoints(){const t=this.diagram;if(t===null)return!1;let i=this.fromNode,s=null;if(i===null?(Lt.Fa||(Lt.Fa=new nt,Lt.Fa.desiredSize=ut.ru,Lt.Fa.ensureBounds()),this.defaultFromPoint&&(Lt.Fa.location=this.defaultFromPoint,Lt.Fa.ensureBounds(),i=Lt.Fa,s=Lt.Fa)):s=this.fromPort,s!==null&&!i.isVisible()){const p=i.findVisibleNode();p!==null&&p!==i?(i=p,s=p.port):i=p}if(this._2=i,i===null||!i.location.isReal()||(s=i.findVisiblePort(s),s===null))return!1;let n=this.toNode,o=null;if(n===null?(Lt.Ra||(Lt.Ra=new nt,Lt.Ra.desiredSize=ut.ru,Lt.Ra.ensureBounds()),this.defaultToPoint&&(Lt.Ra.location=this.defaultToPoint,Lt.Ra.ensureBounds(),n=Lt.Ra,o=Lt.Ra)):o=this.toPort,o!==null&&!n.isVisible()){const p=n.findVisibleNode();p!==null&&p!==n?(n=p,o=p.port):n=p}if(this.tN=n,n===null||!n.location.isReal()||(o=n.findVisiblePort(o),o===null))return!1;const r=this.pointsCount,a=this.computeSpot(!0,s),h=this.computeSpot(!1,o),l=this.Id(a),u=this.Id(h),c=s===o&&s!==null,d=this.isOrthogonal;let m=this.curve===9;c&&!d?(m=!0,this.$o=!0):this.$o=!1;const g=this.computeAdjusting()===0||c;if(!d&&!c&&l&&u){let p=!1;if(!g&&r>=3){let y=this.getLinkPoint(i,s,a,!0,!1,n,o),x=this.getLinkPoint(n,o,h,!1,!1,i,s);p=this.adjustPoints(0,y,r-1,x),p&&(y=this.getLinkPoint(i,s,a,!0,!1,n,o),x=this.getLinkPoint(n,o,h,!1,!1,i,s),this.adjustPoints(0,y,r-1,x))}p||(this.clearPoints(),m?this.qv(i,s,a,n,o,h):this.Wv(i,s,a,n,o,h))}else{const p=this.isAvoiding;g&&(d&&p||c)&&this.clearPoints();const y=c?this.computeCurviness():0,x=this.getLinkPoint(i,s,a,!0,d,n,o);let P=0,k=0,w=0;if(d||!l||c){let F=this.computeEndSegmentLength(i,s,a,!0);if(w=this.getLinkDirection(i,s,x,a,!0,d,n,o),c&&(l||a.equals(h)||!d&&a.x+h.x===1&&a.y+h.y===1)&&(w-=d?90:30,y<0&&(w-=180)),w<0?w+=360:w>=360&&(w-=360),c&&(F+=Math.abs(y)*(d?1:2)),w===0?P=F:w===90?k=F:w===180?P=-F:w===270?k=-F:(P=F*Math.cos(w*Math.PI/180),k=F*Math.sin(w*Math.PI/180)),a.isNoSpot()&&c){const D=s.getDocumentPoint(B.Center,S.l()),R=S.X(D.x+P*1e3,D.y+k*1e3);this.getLinkPointFromPoint(i,s,D,R,!0,x),S.s(D),S.s(R)}}const N=this.getLinkPoint(n,o,h,!1,d,i,s);let M=0,C=0,O=0;if(d||!u||c){let F=this.computeEndSegmentLength(n,o,h,!1);if(O=this.getLinkDirection(n,o,N,h,!1,d,i,s),c&&(u||a.equals(h)||!d&&a.x+h.x===1&&a.y+h.y===1)&&(O+=d?0:30,y<0&&(O+=180)),O<0?O+=360:O>=360&&(O-=360),c&&(F+=Math.abs(y)*(d?1:2)),O===0?M=F:O===90?C=F:O===180?M=-F:O===270?C=-F:(M=F*Math.cos(O*Math.PI/180),C=F*Math.sin(O*Math.PI/180)),h.isNoSpot()&&c){const D=o.getDocumentPoint(B.Center,S.l()),R=S.X(D.x+M*1e3,D.y+C*1e3);this.getLinkPointFromPoint(n,o,D,R,!1,N),S.s(D),S.s(R)}}let T=x;(d||!l||c)&&(T=new S(x.x+P,x.y+k));let L=N;(d||!u||c)&&(L=new S(N.x+M,N.y+C)),!g&&!d&&l&&r>3&&this.adjustPoints(0,x,r-2,L)?this.setPoint(r-1,N):!g&&!d&&u&&r>3&&this.adjustPoints(1,T,r-1,N)?this.setPoint(0,x):!g&&(d?r>=6:r>4)&&this.adjustPoints(1,T,r-2,L)?(this.setPoint(0,x),this.setPoint(r-1,N)):(this.clearPoints(),this.addPoint(x),(d||!l||c)&&this.addPoint(T),d&&this.addOrthoPoints(T,w,L,O,i,n),(d||!u||c)&&this.addPoint(L),this.addPoint(N))}return t.addInvalidRoute(this),!0}rN(t,i){return Math.abs(i.x-t.x)>Math.abs(i.y-t.y)?(i.x>=t.x?i.x=t.x+9e9:i.x=t.x-9e9,i.y=t.y):(i.y>=t.y?i.y=t.y+9e9:i.y=t.y-9e9,i.x=t.x),i}getLinkPointFromPoint(t,i,s,n,o,r){if(r===void 0&&(r=new S),t===null||i===null)return r.a(s),r;if(!t.isVisible()){const m=t.findVisibleNode();m!==null&&m!==t&&(t=m,i=t.port)}let a=0,h=0,l=0,u=0,c=null,d=i.panel;if(d!==null&&!d.pn()&&(d=d.panel),d===null)a=n.x,h=n.y,l=s.x,u=s.y;else{c=d.Es;const m=1/(c.m11*c.m22-c.m12*c.m21),g=c.m22*m,p=-c.m12*m,y=-c.m21*m,x=c.m11*m,P=m*(c.m21*c.dy-c.m22*c.dx),k=m*(c.m12*c.dx-c.m11*c.dy);a=n.x*g+n.y*y+P,h=n.x*p+n.y*x+k,l=s.x*g+s.y*y+P,u=s.x*p+s.y*x+k}return i.Zc(a,h,l,u,r),c!==null&&r.D(c),r}Jv(t,i){const s=t.Ju;return s!==null?s.nT(i):null}m1(t){let i=t.Ju;return i===null&&(i=new Vs,i.Qo=t,i.de=t.part,t.Ju=i),i.nT(this)}getLinkPoint(t,i,s,n,o,r,a,h){if(h===void 0&&(h=new S),s.isSpot()&&!this.Id(s))return i.getDocumentPoint(s,h),h;if(s.isSide()){const c=this.m1(i);if(c!==null){const d=c.Ed;if(h.a(d),o&&this.routing===7){const m=this.m1(a);if(m!==null&&c.Mf<m.Mf){const g=S.l(),p=S.l(),y=new z(i.getDocumentPoint(B.TopLeft,g),i.getDocumentPoint(B.BottomRight,p)),x=this.computeSpot(!n,a),P=this.getLinkPoint(r,a,x,!n,o,t,i,p);(s.includesSide(B.LeftSide)||s.includesSide(B.RightSide))&&P.y>=y.y&&P.y<=y.y+y.height?h.y=P.y:(s.includesSide(B.TopSide)||s.includesSide(B.BottomSide))&&P.x>=y.x&&P.x<=y.x+y.width&&(h.x=P.x),S.s(g),S.s(p)}}return h}}const l=i.getDocumentPoint(this.p1(s,n),S.l());let u=null;if(this.pointsCount>(o?6:2))u=n?this.getPoint(1):this.getPoint(this.pointsCount-2),o&&(u=this.rN(l,u.copy()));else{const c=this.computeSpot(!n,a),d=S.l();u=a.getDocumentPoint(this.p1(c,!n),d),o&&(u=this.rN(l,u)),S.s(d)}return this.getLinkPointFromPoint(t,i,l,u,n,h),S.s(l),h}getLinkDirection(t,i,s,n,o,r,a,h){let l=this.$v(t,i,s,n,o,r,a,h);if(a&&n.isNoSpot()&&a.isMemberOf(t)&&(l+=180,l>=360&&(l-=360)),this.Id(n))return l;const u=i.getDocumentAngle();return u===0||(45<=u&&u<135?l+=90:135<=u&&u<225?l+=180:225<=u&&u<315&&(l+=270),l>=360&&(l-=360)),l}$v(t,i,s,n,o,r,a,h){if(n.isSpot())return n.x>n.y?n.x>1-n.y?0:n.x<1-n.y?270:315:n.x<n.y?n.x>1-n.y?90:n.x<1-n.y?180:135:n.x<.5?225:n.x>.5?45:0;if(n.isSide()){const d=this.m1(i);if(d!==null)switch(d.me){case 1:return 270;case 2:return 180;default:case 4:return 0;case 8:return 90}}const l=i.getDocumentPoint(B.Center,S.l());let u=null;if(this.pointsCount>(r?6:2))u=o?this.getPoint(1):this.getPoint(this.pointsCount-2),r?u=this.rN(l,u.copy()):u=s;else{const d=S.l();u=h.getDocumentPoint(B.Center,d),S.s(d)}let c=0;return Math.abs(u.x-l.x)>Math.abs(u.y-l.y)?u.x>=l.x?c=0:c=180:u.y>=l.y?c=90:c=270,S.s(l),c}computeEndSegmentLength(t,i,s,n){if(i!==null&&s.isSide()){const r=this.m1(i);if(r!==null)return r.w1}let o=NaN;return n?o=this.fromEndSegmentLength:o=this.toEndSegmentLength,i!==null&&isNaN(o)&&(n?o=i.fromEndSegmentLength:o=i.toEndSegmentLength),isNaN(o)&&(o=10),o}computeSpot(t,i){return i===void 0&&(i=null),t?this.Zv(i||this.fromPort):this.Qv(i||this.toPort)}Zv(t){if(t===null)return B.Center;let i=this.fromSpot;return i.isDefault()&&(i=t.fromSpot),i===B.Default?B.None:i}Qv(t){if(t===null)return B.Center;let i=this.toSpot;return i.isDefault()&&(i=t.toSpot),i===B.Default?B.None:i}Id(t){return t===B.None||t.x===.5&&t.y===.5}p1(t,i){return t.x===.5&&t.y===.5?t:B.Center}computeOtherPoint(t,i){if(this.computeAdjusting()!==0&&this.pointsCount>4)return this.computeMidPoint(new S);{const s=this.Jv(i,this);return s!==null?s.Ed:i.getDocumentPoint(B.Center)}}computeShortLength(t){if(t){let i=this.fromShortLength;if(isNaN(i)){const s=this.fromPort;s!==null&&(i=s.fromShortLength)}return isNaN(i)?0:i}else{let i=this.toShortLength;if(isNaN(i)){const s=this.toPort;s!==null&&(i=s.toShortLength)}return isNaN(i)?0:i}}vm(t,i,s,n,o,r){if(this.pickable===!1)return!1;i===void 0&&(i=null),s===void 0&&(s=null);let a=r;if(r===void 0&&(a=Tt.l(),a.Ri()),a.ic(this.D),this.containedInRect(t,a))return this.D2(i,s,o),r===void 0&&Tt.s(a),!0;if(this.intersectsRect(t,a)){let h=!1;if(!this.af){const l=this.L.r,u=l.length;for(let c=u;c--;){const d=l[c];if(!d.visible&&d!==this.locationObject)continue;const m=d.actualBounds,g=this.naturalBounds;if(m.x>g.width||m.y>g.height||m.x+m.width<0||m.y+m.height<0)continue;const p=d,y=Tt.l();if(y.set(a),p instanceof ct?h=p.vm(t,i,s,n,o,y):this.path===p?p instanceof bt&&(h=p.bv(t,n,y)):h=p.QL(t,n,y),h){let x=p;i!==null&&(x=i(p)),x&&(s===null||s(x))&&o.add(x)}Tt.s(y)}}return r===void 0&&Tt.s(a),h||this.background!==null}return r===void 0&&Tt.s(a),!1}get isOrthogonal(){return(this.Da&2)===2}static sN(t){return(t&2)===2}get isAvoiding(){return(this.Da&4)===4}computeCurve(){if(this.$o===null){const t=this.fromPort,i=t!==null&&t===this.toPort,s=this.isOrthogonal;this.$o=i&&!s}return this.$o?9:this.curve}computeCorner(){if(this.curve===9)return 0;let t=this.corner;return(isNaN(t)||t<0)&&(t=10),t}findMidLabel(){const t=this.path,i=this.L.r,s=i.length;for(let o=0;o<s;o++){const r=i[o];if(!(r===t||r.isPanelMain)&&(r.segmentIndex===-1/0||isNaN(r.segmentIndex)))return r}const n=this.labelNodes;for(;n.next();){const o=n.value;if(o.segmentIndex===-1/0||isNaN(o.segmentIndex))return o}return null}computeSpacing(){if(!this.isVisible())return 0;let t=Lt.Kv;t=Math.max(t,this.computeThickness());const i=this.fromPort,s=this.toPort;if(i!==null&&s!==null){const n=this.findMidLabel();if(n!==null){const o=n.naturalBounds,r=n.margin,a=isNaN(o.width)?30:o.width*n.scale+r.left+r.right,h=isNaN(o.height)?14:o.height*n.scale+r.top+r.bottom,l=n.segmentOrientation;if(l===21||l===25||l===24)t=Math.max(t,h);else if(l===23||l===27||l===22||l===26)t=Math.max(t,a);else{const u=i.getDocumentPoint(B.Center).directionPoint(s.getDocumentPoint(B.Center))/180*Math.PI;t=Math.max(t,Math.abs(Math.sin(u)*a)+Math.abs(Math.cos(u)*h)+1)}this.curve===9&&(t*=1.333)}}return t}arrangeBundledLinks(t,i){if(i)for(let s=0;s<t.length;s++){const n=t[s];n.computeAdjusting()===0&&n.invalidateRoute()}}computeCurviness(){let t=this.curviness;if(isNaN(t)){t=Lt.Xv;const i=this.Zo;if(i!==null){const s=b.nt();let n=0;const o=i.qs;for(let a=0;a<o.length;a++){const h=o[a].computeSpacing();s.push(h),n+=h}let r=-n/2;for(let a=0;a<o.length;a++){if(o[a]===this){t=r+s[a]/2;break}r+=s[a]}i.ry===this.fromNode&&(t=-t),b.tt(s)}}return t}computeThickness(){if(!this.isVisible())return 0;const t=this.path;return t!==null?Math.max(t.strokeWidth,1):1}hasCurviness(){return!isNaN(this.curviness)||this.Zo!==null}Wv(t,i,s,n,o,r){const a=this.getLinkPoint(t,i,s,!0,!1,n,o),h=this.getLinkPoint(n,o,r,!1,!1,t,i);if(this.hasCurviness()){const l=h.x-a.x,u=h.y-a.y,c=this.computeCurviness(),d=c,m=a.x+l/2,g=a.y+u/2;let p=m,y=g;if(A.u(u,0))l>0?y-=d:y+=d;else{const x=-l/u;let P=Math.sqrt(d*d/(x*x+1));c<0&&(P=-P),p=(u<0?-1:1)*P+m,y=x*(p-m)+g}this.addPoint(a),this.addPointAt(p,y),this.addPoint(h)}else{this.addPoint(a),this.addPoint(h);const l=z.l();i.getDocumentBounds(l);const u=l.containsPoint(h);o.getDocumentBounds(l);const c=l.containsPoint(a);if(u||c){const d=i.getDocumentPoint(this.p1(s,!0),new S);this.setPoint(0,this.getLinkPointFromPoint(t,i,d,h,!0,d));const m=o.getDocumentPoint(this.p1(r,!1),new S);this.setPoint(1,this.getLinkPointFromPoint(n,o,m,a,!1,m))}z.s(l)}}qv(t,i,s,n,o,r){const a=this.getLinkPoint(t,i,s,!0,!1,n,o),h=this.getLinkPoint(n,o,r,!1,!1,t,i),l=h.x-a.x,u=h.y-a.y,c=this.computeCurviness();let d=0,m=0,g=a.x+l/3,p=a.y+u/3,y=g,x=p;A.u(u,0)?l>0?x-=c:x+=c:(d=-l/u,m=Math.sqrt(c*c/(d*d+1)),c<0&&(m=-m),y=(u<0?-1:1)*m+g,x=d*(y-g)+p),g=a.x+2*l/3,p=a.y+2*u/3;let P=g,k=p;A.u(u,0)?l>0?k-=c:k+=c:(P=(u<0?-1:1)*m+g,k=d*(P-g)+p),this.clearPoints(),this.addPoint(a),this.addPointAt(y,x),this.addPointAt(P,k),this.addPoint(h),this.setPoint(0,this.getLinkPoint(t,i,s,!0,!1,n,o)),this.setPoint(3,this.getLinkPoint(n,o,r,!1,!1,t,i))}adjustPoints(t,i,s,n){let o=this.computeAdjusting();if(this.isOrthogonal){if(o===18)return!1;o===19&&(o=17)}switch(o){case 18:return this._v(t,i,s,n);case 19:return this.tO(t,i,s,n);case 17:return this.iO(t,i,s,n);default:return!1}}_v(t,i,s,n){const o=this.getPoint(t),r=this.getPoint(s);if(o.equalsApprox(i)&&r.equalsApprox(n))return!0;const a=o.x,h=o.y,l=r.x,u=r.y;let c=l-a,d=u-h;const m=Math.sqrt(c*c+d*d);if(A.K(m,0))return!0;let g=0;A.K(c,0)?d<0?g=-Math.PI/2:g=Math.PI/2:(g=Math.atan(d/Math.abs(c)),c<0&&(g=Math.PI-g));const p=i.x,y=i.y,x=n.x,P=n.y,k=x-p,w=P-y,N=Math.sqrt(k*k+w*w);let M=0;A.K(k,0)?w<0?M=-Math.PI/2:M=Math.PI/2:(M=Math.atan(w/Math.abs(k)),k<0&&(M=Math.PI-M));const C=N/m,O=M-g;this.setPoint(t,i);for(let T=t+1;T<s;T++){const L=this.getPoint(T);c=L.x-a,d=L.y-h;const F=Math.sqrt(c*c+d*d);if(A.K(F,0))continue;let D=0;A.K(c,0)?d<0?D=-Math.PI/2:D=Math.PI/2:(D=Math.atan(d/Math.abs(c)),c<0&&(D=Math.PI-D));const R=D+O,I=F*C,j=p+I*Math.cos(R),X=y+I*Math.sin(R);this.setPointAt(T,j,X)}return this.setPoint(s,n),!0}tO(t,i,s,n){const o=this.getPoint(t),r=this.getPoint(s);if(o.equalsApprox(i)&&r.equalsApprox(n))return!0;const a=o.x,h=o.y,l=r.x,u=r.y,c=(l-a)*(l-a)+(u-h)*(u-h),d=i.x,m=i.y,g=n.x,p=n.y;let y=0,x=1;g-d!==0?(y=(p-m)/(g-d),x=Math.sqrt(1+1/(y*y))):y=9e9,this.setPoint(t,i);for(let P=t+1;P<s;P++){const k=this.getPoint(P),w=k.x,N=k.y;let M=.5;c!==0&&(M=((a-w)*(a-l)+(h-N)*(h-u))/c);const C=a+M*(l-a),O=h+M*(u-h);let T=Math.sqrt((w-C)*(w-C)+(N-O)*(N-O));N<y*(w-C)+O&&(T=-T),y>0&&(T=-T);const L=d+M*(g-d),F=m+M*(p-m);if(y!==0){const D=L+T/x,R=F-(D-L)/y;this.setPointAt(P,D,R)}else this.setPointAt(P,L,F+T)}return this.setPoint(s,n),!0}iO(t,i,s,n){if(this.isOrthogonal){let o=this.getPoint(t),r=this.getPoint(t+1),a=this.getPoint(t+2),h=r.x,l=r.y;const u=h,c=l;A.u(o.y,r.y)?A.u(r.x,a.x)?l=i.y:A.u(r.y,a.y)&&(h=i.x):A.u(o.x,r.x)&&(A.u(r.y,a.y)?h=i.x:A.u(r.x,a.x)&&(l=i.y)),this.setPointAt(t+1,h,l),o=this.getPoint(s),r=this.getPoint(s-1),a=this.getPoint(s-2);let d=r.x,m=r.y;const g=d,p=m;if(A.u(o.y,r.y)?A.u(r.x,a.x)?m=n.y:A.u(r.y,a.y)&&(d=n.x):A.u(o.x,r.x)&&(A.u(r.y,a.y)?d=n.x:A.u(r.x,a.x)&&(m=n.y)),this.setPointAt(s-1,d,m),this.AL())return this.setPointAt(t+1,u,c),this.setPointAt(s-1,g,p),!1}return this.setPoint(t,i),this.setPoint(s,n),!0}addOrthoPoints(t,i,s,n,o,r){i<0?i+=360:i>=360&&(i-=360),n<0?n+=360:n>=360&&(n-=360);const a=n;i>=315||i<45?i=0:45<=i&&i<135?i=90:135<=i&&i<225?i=180:i=270,n>=315||n<45?n=0:45<=n&&n<135?n=90:135<=n&&n<225?n=180:n=270;const h=t,l=s,u=o.actualBounds.copy(),c=r.actualBounds.copy();if(!u.isReal()||!c.isReal())return;u.inflate(Lt.va,Lt.va),c.inflate(Lt.va,Lt.va),u.unionPoint(t),c.unionPoint(s);const d=S.l(),m=S.l();i===0?l.x>h.x||n===270&&l.y<h.y&&c.right>h.x||n===90&&l.y>h.y&&c.right>h.x?(d.e(l.x,h.y),m.e(l.x,(h.y+l.y)/2),n===180?(d.x=this.computeMidOrthoPosition(h.x,h.y,l.x,l.y,!1),m.x=d.x,m.y=l.y):n===270&&l.y<h.y||n===90&&l.y>h.y?(h.x<c.left?d.x=this.computeMidOrthoPosition(h.x,h.y,c.left,l.y,!1):h.x<c.right&&(n===270&&h.y<c.top||n===90&&h.y>c.bottom)?d.x=this.computeMidOrthoPosition(h.x,h.y,l.x,l.y,!1):d.x=c.right,m.x=d.x,m.y=l.y):n===0&&h.x<c.left&&h.y>c.top&&h.y<c.bottom&&(d.x=h.x,h.y<l.y?d.y=Math.min(l.y,c.top):d.y=Math.max(l.y,c.bottom),m.y=d.y)):(d.e(h.x,l.y),m.e((h.x+l.x)/2,l.y),(n===180||n===90&&l.y<u.top||n===270&&l.y>u.bottom)&&(n===180&&(c.containsPoint(h)||u.containsPoint(l))?d.y=this.computeMidOrthoPosition(h.x,h.y,l.x,l.y,!0):l.y<h.y&&(n===180||n===90)?d.y=this.computeMidOrthoPosition(h.x,u.top,l.x,Math.max(l.y,c.bottom),!0):l.y>h.y&&(n===180||n===270)&&(d.y=this.computeMidOrthoPosition(h.x,u.bottom,l.x,Math.min(l.y,c.top),!0)),m.x=l.x,m.y=d.y),d.y>u.top&&d.y<u.bottom&&(l.x>=u.left&&l.x<=h.x||h.x<=c.right&&h.x>=l.x?(n===90||n===270)&&(d.e(Math.max((h.x+l.x)/2,h.x),h.y),m.e(d.x,l.y)):(n===270||(n===0||n===180)&&l.y<h.y?d.y=Math.min(l.y,n===0?u.top:Math.min(u.top,c.top)):d.y=Math.max(l.y,n===0?u.bottom:Math.max(u.bottom,c.bottom)),m.x=l.x,m.y=d.y))):i===180?l.x<h.x||n===270&&l.y<h.y&&c.left<h.x||n===90&&l.y>h.y&&c.left<h.x?(d.e(l.x,h.y),m.e(l.x,(h.y+l.y)/2),n===0?(d.x=this.computeMidOrthoPosition(h.x,h.y,l.x,l.y,!1),m.x=d.x,m.y=l.y):n===270&&l.y<h.y||n===90&&l.y>h.y?(h.x>c.right?d.x=this.computeMidOrthoPosition(h.x,h.y,c.right,l.y,!1):h.x>c.left&&(n===270&&h.y<c.top||n===90&&h.y>c.bottom)?d.x=this.computeMidOrthoPosition(h.x,h.y,l.x,l.y,!1):d.x=c.left,m.x=d.x,m.y=l.y):n===180&&h.x>c.right&&h.y>c.top&&h.y<c.bottom&&(d.x=h.x,h.y<l.y?d.y=Math.min(l.y,c.top):d.y=Math.max(l.y,c.bottom),m.y=d.y)):(d.e(h.x,l.y),m.e((h.x+l.x)/2,l.y),(n===0||n===90&&l.y<u.top||n===270&&l.y>u.bottom)&&(n===0&&(c.containsPoint(h)||u.containsPoint(l))?d.y=this.computeMidOrthoPosition(h.x,h.y,l.x,l.y,!0):l.y<h.y&&(n===0||n===90)?d.y=this.computeMidOrthoPosition(h.x,u.top,l.x,Math.max(l.y,c.bottom),!0):l.y>h.y&&(n===0||n===270)&&(d.y=this.computeMidOrthoPosition(h.x,u.bottom,l.x,Math.min(l.y,c.top),!0)),m.x=l.x,m.y=d.y),d.y>u.top&&d.y<u.bottom&&(l.x<=u.right&&l.x>=h.x||h.x>=c.left&&h.x<=l.x?(n===90||n===270)&&(d.e(Math.min((h.x+l.x)/2,h.x),h.y),m.e(d.x,l.y)):(n===270||(n===0||n===180)&&l.y<h.y?d.y=Math.min(l.y,n===180?u.top:Math.min(u.top,c.top)):d.y=Math.max(l.y,n===180?u.bottom:Math.max(u.bottom,c.bottom)),m.x=l.x,m.y=d.y))):i===90?l.y>h.y||n===180&&l.x<h.x&&c.bottom>h.y||n===0&&l.x>h.x&&c.bottom>h.y?(d.e(h.x,l.y),m.e((h.x+l.x)/2,l.y),n===270?(d.y=this.computeMidOrthoPosition(h.x,h.y,l.x,l.y,!0),m.x=l.x,m.y=d.y):n===180&&l.x<h.x||n===0&&l.x>h.x?(h.y<c.top?d.y=this.computeMidOrthoPosition(h.x,h.y,l.x,c.top,!0):h.y<c.bottom&&(n===180&&h.x<c.left||n===0&&h.x>c.right)?d.y=this.computeMidOrthoPosition(h.x,h.y,l.x,l.y,!0):d.y=c.bottom,m.x=l.x,m.y=d.y):n===90&&h.y<c.top&&h.x>c.left&&h.x<c.right&&(h.x<l.x?d.x=Math.min(l.x,c.left):d.x=Math.max(l.x,c.right),d.y=h.y,m.x=d.x)):(d.e(l.x,h.y),m.e(l.x,(h.y+l.y)/2),(n===270||n===0&&l.x<u.left||n===180&&l.x>u.right)&&(n===270&&(c.containsPoint(h)||u.containsPoint(l))?d.x=this.computeMidOrthoPosition(h.x,h.y,l.x,l.y,!1):l.x<h.x&&(n===270||n===0)?d.x=this.computeMidOrthoPosition(u.left,h.y,Math.max(l.x,c.right),l.y,!1):l.x>h.x&&(n===270||n===180)&&(d.x=this.computeMidOrthoPosition(u.right,h.y,Math.min(l.x,c.left),l.y,!1)),m.x=d.x,m.y=l.y),d.x>u.left&&d.x<u.right&&(l.y>=u.top&&l.y<=h.y||h.y<=c.bottom&&h.y>=l.y?(n===0||n===180)&&(d.e(h.x,Math.max((h.y+l.y)/2,h.y)),m.e(l.x,d.y)):(n===180||(n===90||n===270)&&l.x<h.x?d.x=Math.min(l.x,n===90?u.left:Math.min(u.left,c.left)):d.x=Math.max(l.x,n===90?u.right:Math.max(u.right,c.right)),m.x=d.x,m.y=l.y))):l.y<h.y||n===180&&l.x<h.x&&c.top<h.y||n===0&&l.x>h.x&&c.top<h.y?(d.e(h.x,l.y),m.e((h.x+l.x)/2,l.y),n===90?(d.y=this.computeMidOrthoPosition(h.x,h.y,l.x,l.y,!0),m.x=l.x,m.y=d.y):n===180&&l.x<h.x||n===0&&l.x>=h.x?(h.y>c.bottom?d.y=this.computeMidOrthoPosition(h.x,h.y,l.x,c.bottom,!0):h.y>c.top&&(n===180&&h.x<c.left||n===0&&h.x>c.right)?d.y=this.computeMidOrthoPosition(h.x,h.y,l.x,l.y,!0):d.y=c.top,m.x=l.x,m.y=d.y):n===270&&h.y>c.bottom&&h.x>c.left&&h.x<c.right&&(h.x<l.x?d.x=Math.min(l.x,c.left):d.x=Math.max(l.x,c.right),d.y=h.y,m.x=d.x)):(d.e(l.x,h.y),m.e(l.x,(h.y+l.y)/2),(n===90||n===0&&l.x<u.left||n===180&&l.x>u.right)&&(n===90&&(c.containsPoint(h)||u.containsPoint(l))?d.x=this.computeMidOrthoPosition(h.x,h.y,l.x,l.y,!1):l.x<h.x&&(n===90||n===0)?d.x=this.computeMidOrthoPosition(u.left,h.y,Math.max(l.x,c.right),l.y,!1):l.x>h.x&&(n===90||n===180)&&(d.x=this.computeMidOrthoPosition(u.right,h.y,Math.min(l.x,c.left),l.y,!1)),m.x=d.x,m.y=l.y),d.x>u.left&&d.x<u.right&&(l.y<=u.bottom&&l.y>=h.y||h.y>=c.top&&h.y<=l.y?(n===0||n===180)&&(d.e(h.x,Math.min((h.y+l.y)/2,h.y)),m.e(l.x,d.y)):(n===180||(n===90||n===270)&&l.x<h.x?d.x=Math.min(l.x,n===270?u.left:Math.min(u.left,c.left)):d.x=Math.max(l.x,n===270?u.right:Math.max(u.right,c.right)),m.x=d.x,m.y=l.y))),this.oN=n!==a,this.iN=i,this.eN=n,this.addPoint(d.copy()),this.addPoint(m.copy()),S.s(d),S.s(m)}computeMidOrthoPosition(t,i,s,n,o){let r=0;return this.hasCurviness()&&!this.computeSpot(!0,this.fromPort).isSide()&&!this.computeSpot(!1,this.toPort).isSide()&&(r=this.computeCurviness()),o?(i+n)/2+r:(t+s)/2+r}AL(){if(this.diagram===null||!this.isAvoiding||this.diagram.animationManager.isTicking)return!1;const t=this.points.r,i=t.length;if(i<4)return!1;const s=this.diagram.getPositions(!1,this.containingGroup,null);for(let n=1;n<i-2;n++){const o=t[n],r=t[n+1];if(!s.isUnoccupied(Math.min(o.x,r.x),Math.min(o.y,r.y),Math.abs(o.x-r.x),Math.abs(o.y-r.y)))return!0}return!1}findClosestSegment(t){const i=t.x,s=t.y;let n=this.getPoint(0),o=this.getPoint(1),r=S.distanceLineSegmentSquared(i,s,n.x,n.y,o.x,o.y),a=0;for(let h=1;h<this.pointsCount-1;h++){n=this.getPoint(h+1);const l=S.distanceLineSegmentSquared(i,s,o.x,o.y,n.x,n.y);o=n,l<r&&(a=h,r=l)}return a}ee(){this.wh=!1,this.c()}get wh(){return(this.Nt&128)!==0}set wh(t){(this.Nt&128)!==0!==t&&(this.Nt=this.Nt^128)}get geometry(){if(!this.wh){if(this.updateRoute(),this.pointsCount<2)return this.wh=!0,this.ct;this.ct=this.makeGeometry()}return this.ct}hd(t){if(!t){if(this.Me===!1)return;const o=this.findMainElement();if(this.wh&&(o===null||o.geometry!==null))return}this.pointsCount<2?this.wh=!0:this.ct=this.makeGeometry();const i=this.path;if(i===null)return;i.ct=this.ct;const s=this.L.r,n=s.length;for(let o=0;o<n;o++){const r=s[o];r!==i&&r.isPanelMain&&r instanceof bt&&(r.ct=this.ct)}}eO(t){return this.Oa()&&t.$l.has(this)&&(this.Sf.width!==0||this.Sf.height!==0)&&(t.animationManager.isAnimating||t.currentTool!==t.toolManager)}makeGeometry(){const t=this.ct,i=this.pointsCount;let s=!1;const n=this.diagram;n!==null&&this.eO(n)&&(s=!0);let o=0,r=0,a=this.getPoint(0).copy();const h=a.copy(),l=this.ki.r,u=this.computeCurve();if(u===9&&i>=3&&!A.K(this.smoothness,0))if(i===3){let c=this.getPoint(1);o=Math.min(a.x,c.x),r=Math.min(a.y,c.y),c=this.getPoint(2),o=Math.min(o,c.x),r=Math.min(r,c.y)}else if(this.isOrthogonal){for(let c=0;c<i;c++){const d=l[c];h.x=Math.min(d.x,h.x),h.y=Math.min(d.y,h.y)}o=h.x,r=h.y}else{for(let c=3;c<i;c+=3){c+3>=i&&(c=i-1);const d=this.getPoint(c);h.x=Math.min(d.x,h.x),h.y=Math.min(d.y,h.y)}o=h.x,r=h.y}else{for(let c=0;c<i;c++){const d=l[c];h.x=Math.min(d.x,h.x),h.y=Math.min(d.y,h.y)}o=h.x,r=h.y}if(o-=this.f1.x,r-=this.f1.y,a.x-=o,a.y-=r,i===2&&!this.Oa()){let c=this.getPoint(1).copy();return c.x-=o,c.y-=r,this.computeShortLength(!0)!==0&&(a=this.Nf(a,!0,h)),this.computeShortLength(!1)!==0&&(c=this.Nf(c,!1,h)),t.type=1,t.startX=a.x,t.startY=a.y,t.endX=c.x,t.endY=c.y,this.wh=!0,t}else{t.type=4;const c=Ui.mC(t);if(this.computeShortLength(!0)!==0&&(a=this.Nf(a,!0,h)),c.fu(a.x,a.y,!1,!1),u===9&&i>=3&&!A.K(this.smoothness,0))if(i===3){const d=this.getPoint(1),m=d.x-o,g=d.y-r;let p=this.getPoint(2).copy();p.x-=o,p.y-=r,this.computeShortLength(!1)!==0&&(p=this.Nf(p,!1,h)),c.dr(m,g,m,g,p.x,p.y)}else if(this.isOrthogonal){const d=S.X(o,r),m=S.l();m.a(this.getPoint(1));const g=S.X(o,r),p=S.X(o,r);let y=this.getPoint(0),x=null;const P=this.smoothness/3;for(let M=1;M<this.pointsCount-1;M++){x=this.getPoint(M);const C=y,O=x,T=this.getPoint(this.lN(x,M,!1));A.K(C.x,O.x)&&A.K(O.x,T.x)||A.K(C.y,O.y)&&A.K(O.y,T.y)||(this.sO(C,O,T,P,g,p),(M===1||M===2&&A.K(y.x,this.getPoint(0).x)&&A.K(y.y,this.getPoint(0).y))&&(m.x=(y.x+x.x)*.5,m.y=(y.y+x.y)*.5),c.dr(m.x-o,m.y-r,g.x-o,g.y-r,x.x-o,x.y-r),d.set(g),m.set(p),y=x)}let k=y.x,w=y.y,N=this.getPoint(this.pointsCount-1);this.computeShortLength(!1)!==0&&(N=this.Nf(N.copy(),!1,S.Po)),k=.5*(k+N.x),w=.5*(w+N.y),c.dr(p.x-o,p.y-r,k-o,w-r,N.x-o,N.y-r),S.s(d),S.s(m),S.s(g),S.s(p)}else for(let d=3;d<i;d+=3){const m=this.getPoint(d-2);d+3>=i&&(d=i-1);const g=this.getPoint(d-1);let p=this.getPoint(d);d===i-1&&this.computeShortLength(!1)!==0&&(p=this.Nf(p.copy(),!1,S.Po)),c.dr(m.x-o,m.y-r,g.x-o,g.y-r,p.x-o,p.y-r)}else{const d=S.l();d.a(this.getPoint(0));const m=S.l();m.a(d);const g=this.computeCorner();let p=1,y=0;for(;p<i;){p=this.lN(d,p,p>1);let x=this.getPoint(p);if(p>=i-1){if(!d.equals(x))this.computeShortLength(!1)!==0&&(x=this.Nf(x.copy(),!1,S.Po)),this.Nn(c,-o,-r,d,x,s);else if(y===0)for(p=1;p<i;)m.a(d),x=this.getPoint(p++),this.Nn(c,-o,-r,d,x,s),d.a(x);break}y=this.lN(x,p+1,p<i-3);const P=this.getPoint(y);this.nO(c,-o,-r,d,x,P,d,m,g,s),m.a(x),p=y}S.s(d)}return Ui.pC(c),this.wh=!0,t}}b1(t,i,s,n){let o=s-t;if(isNaN(o)||o===1/0||o===-1/0)return NaN;o<0&&(o=-o);let r=n-i;return isNaN(r)||r===1/0||r===-1/0?NaN:(r<0&&(r=-r),A.K(o,0)?r:A.K(r,0)?o:Math.sqrt(o*o+r*r))}sO(t,i,s,n,o,r){isNaN(n)&&(n=this.smoothness/3);const a=t.x,h=t.y,l=i.x,u=i.y,c=s.x,d=s.y,m=n*this.b1(a,h,l,u),g=n*this.b1(l,u,c,d);if(A.K(h,u)&&A.K(l,c)&&(l>a?d>u?(o.x=l-m,o.y=u-m,r.x=l+g,r.y=u+g):(o.x=l-m,o.y=u+m,r.x=l+g,r.y=u-g):d>u?(o.x=l+m,o.y=u-m,r.x=l-g,r.y=u+g):(o.x=l+m,o.y=u+m,r.x=l-g,r.y=u-g)),A.K(a,l)&&A.K(u,d)&&(u>h?c>l?(o.x=l-m,o.y=u-m,r.x=l+g,r.y=u+g):(o.x=l+m,o.y=u-m,r.x=l-g,r.y=u+g):c>l?(o.x=l-m,o.y=u+m,r.x=l+g,r.y=u-g):(o.x=l+m,o.y=u+m,r.x=l-g,r.y=u-g)),A.K(a,l)&&A.K(l,c)||A.K(h,u)&&A.K(u,d)){const p=.5*(a+c),y=.5*(h+d);o.x=p,o.y=y,r.x=p,r.y=y}}Nf(t,i,s){const n=this.pointsCount;if(n<2)return t;if(i){const o=this.getPoint(1),r=o.x-s.x,a=o.y-s.y,h=this.b1(t.x,t.y,r,a);if(h===0)return t;const l=n===2?h*.5:h;let u=this.computeShortLength(!0);u>l&&(u=l);const c=u*(r-t.x)/h,d=u*(a-t.y)/h;t.x+=c,t.y+=d}else{const o=this.getPoint(n-2),r=o.x-s.x,a=o.y-s.y,h=this.b1(t.x,t.y,r,a);if(h===0)return t;const l=n===2?h*.5:h;let u=this.computeShortLength(!1);u>l&&(u=l);const c=u*(t.x-r)/h,d=u*(t.y-a)/h;t.x-=c,t.y-=d}return t}lN(t,i,s){const n=this.pointsCount;let o=t;for(;A.K(t.x,o.x)&&A.K(t.y,o.y);){if(i>=n)return n-1;o=this.getPoint(i++)}if(!A.K(t.x,o.x)&&!A.K(t.y,o.y))return i-1;let r=o;for(;A.K(t.x,o.x)&&A.K(o.x,r.x)&&(!s||(t.y>=o.y?o.y>=r.y:o.y<=r.y))||A.K(t.y,o.y)&&A.K(o.y,r.y)&&(!s||(t.x>=o.x?o.x>=r.x:o.x<=r.x));){if(i>=n)return n-1;r=this.getPoint(i++)}return i-2}nO(t,i,s,n,o,r,a,h,l,u){if(A.u(n.y,o.y)&&A.u(o.x,r.x)){let c=Math.min(l,Math.abs(o.x-h.x)/2);const d=Math.min(c,Math.abs(r.y-o.y)/2);if(c=d,A.u(c,0)){this.Nn(t,i,s,n,o,u),a.a(o);return}let m=o.x;const g=o.y,p=m;let y=g;o.x>n.x?(m=o.x-c,r.y>o.y?y=o.y+d:y=o.y-d):(m=o.x+c,r.y>o.y?y=o.y+d:y=o.y-d);const x=S.X(m,g);this.Nn(t,i,s,n,x,u),S.s(x),t.Mw(o.x+i,o.y+s,p+i,y+s),a.e(p,y)}else if(A.u(n.x,o.x)&&A.u(o.y,r.y)){let c=Math.min(l,Math.abs(o.y-h.y)/2);const d=Math.min(c,Math.abs(r.x-o.x)/2);if(c=d,A.u(d,0)){this.Nn(t,i,s,n,o,u),a.a(o);return}const m=o.x;let g=o.y,p=m;const y=g;o.y>n.y?(g=o.y-c,r.x>o.x?p=o.x+d:p=o.x-d):(g=o.y+c,r.x>o.x?p=o.x+d:p=o.x-d);const x=S.X(m,g);this.Nn(t,i,s,n,x,u),S.s(x),t.Mw(o.x+i,o.y+s,p+i,y+s),a.e(p,y)}else this.Nn(t,i,s,n,o,u),a.a(o)}computeJumpLength(){return 10}Nn(t,i,s,n,o,r){if(r||!this.Oa())t.ur(o.x+i,o.y+s);else{const a=this.computeJumpLength(),h=a/2,l=[];let u=0;this.isVisible()&&(u=this.oO(n,o,l));let c=n.x,d=n.y;if(u>0){if(A.u(n.y,o.y))if(n.x<o.x){let m=0;for(;m<u;){const g=Math.max(n.x,Math.min(l[m++]-h,o.x-a));t.ur(g+i,o.y+s),c=g+i,d=o.y+s;let p=Math.min(g+a,o.x);for(;m<u;){const k=l[m];if(k<p+a)m++,p=Math.min(k+h,o.x);else break}const y=o.y-a+s,x=p+i,P=o.y+s;this.curve===10?t.fu(x,P,!1,!1):t.dr(c,y,x,y,x,P),c=x,d=P}}else{let m=u-1;for(;m>=0;){const g=Math.min(n.x,Math.max(l[m--]+h,o.x+a));t.ur(g+i,o.y+s),c=g+i,d=o.y+s;let p=Math.max(g-a,o.x);for(;m>=0;){const k=l[m];if(k>p-a)m--,p=Math.max(k-h,o.x);else break}const y=o.y-a+s,x=p+i,P=o.y+s;this.curve===10?t.fu(x,P,!1,!1):t.dr(c,y,x,y,x,P),c=x,d=P}}else if(A.u(n.x,o.x))if(n.y<o.y){let m=0;for(;m<u;){const g=Math.max(n.y,Math.min(l[m++]-h,o.y-a));t.ur(o.x+i,g+s),c=o.x+i,d=g+s;let p=Math.min(g+a,o.y);for(;m<u;){const k=l[m];if(k<p+a)m++,p=Math.min(k+h,o.y);else break}const y=o.x-a+i,x=o.x+i,P=p+s;this.curve===10?t.fu(x,P,!1,!1):t.dr(y,d,y,P,x,P),c=x,d=P}}else{let m=u-1;for(;m>=0;){const g=Math.min(n.y,Math.max(l[m--]+h,o.y+a));t.ur(o.x+i,g+s),c=o.x+i,d=g+s;let p=Math.max(g-a,o.y);for(;m>=0;){const k=l[m];if(k>p-a)m--,p=Math.max(k-h,o.y);else break}const y=o.x-a+i,x=o.x+i,P=p+s;this.curve===10?t.fu(x,P,!1,!1):t.dr(y,d,y,P,x,P),c=x,d=P}}}t.ur(o.x+i,o.y+s)}}oO(t,i,s){const n=this.diagram;if(n===null||t.equals(i))return 0;const o=n.layers;for(;o.next();){const r=o.value;if(r!==null&&r.visible){const a=r.ES(),h=a.length;for(let l=0;l<h;l++){const u=a[l];if(!(u instanceof Lt))continue;if(u===this)return s.length>0&&s.sort((m,g)=>m-g),s.length;if(!u.isVisible()||!u.Oa())continue;const c=u.routeBounds;if(!c.isReal()||!this.routeBounds.intersectsRect(c)||this.usesSamePort(u))continue;const d=u.path;d!==null&&d.isVisibleObject()&&this.rO(t,i,s,u)}}}return s.length>0&&s.sort((r,a)=>r-a),s.length}rO(t,i,s,n){const o=A.u(t.y,i.y),r=n.pointsCount;let a=n.getPoint(0);const h=S.l();for(let l=1;l<r;l++){const u=n.getPoint(l);if(l<r-1){const c=n.getPoint(l+1);if(a.y===u.y&&u.y===c.y){if(u.x>a.x&&c.x>=u.x||u.x<a.x&&c.x<=u.x)continue}else if(a.x===u.x&&u.x===c.x&&(u.y>a.y&&c.y>=u.y||u.y<a.y&&c.y<=u.y))continue}this.lO(t,i,a,u,h)&&(o?s.push(h.x):s.push(h.y)),a=u}S.s(h)}lO(t,i,s,n,o){const r=t.x,a=t.y,h=i.x,l=i.y,u=s.x,c=s.y,d=n.x,m=n.y;if(A.u(r,h)){if(!A.u(a,l)&&A.u(c,m)&&Math.min(a,l)<c&&Math.max(a,l)>c&&Math.min(u,d)<r&&Math.max(u,d)>r&&!A.u(u,d))return o.x=r,o.y=c,!0}else if(A.u(a,l)&&A.u(u,d)&&Math.min(r,h)<u&&Math.max(r,h)>u&&Math.min(c,m)<a&&Math.max(c,m)>a&&!A.u(c,m))return o.x=u,o.y=a,!0;return o.x=0,o.y=0,!1}get firstPickIndex(){return this.pointsCount<=2?0:this.isOrthogonal||!this.Id(this.computeSpot(!0))?1:0}get lastPickIndex(){const t=this.pointsCount;return t===0?0:t<=2?t-1:this.isOrthogonal||!this.Id(this.computeSpot(!1))?t-2:t-1}Oa(){const t=this.curve;return t===11||t===10}g1(t){if(t||this.Oa()){const i=this.diagram;i!==null&&!i.animationManager.isTicking&&!i.$l.has(this)&&(this.Sf.width!==0||this.Sf.height!==0)&&i.$l.set(this,this.Sf.copy())}}invalidateOtherJumpOvers(t){const i=this.layer;if(i===null||!i.visible||i.isTemporary)return;const s=i.diagram;if(s===null||s.animationManager.isTicking)return;let n=!1;const o=s.layers;for(;o.next();){const r=o.value;if(r.visible){if(r===i){n=!0;let a=!1;const h=r.ES(),l=h.length;for(let u=0;u<l;u++){const c=h[u];c instanceof Lt&&(c===this?a=!0:a&&this.oT(c,t))}}else if(n){const a=r.ES(),h=a.length;for(let l=0;l<h;l++){const u=a[l];u instanceof Lt&&this.oT(u,t)}}}}}oT(t,i){if(t===null||!t.wh||!t.Me||!t.Oa())return;const s=t.routeBounds;s.isReal()&&(!this.routeBounds.intersectsRect(s)&&!i.intersectsRect(s)||this.usesSamePort(t)||t.ee())}usesSamePort(t){const i=this.pointsCount,s=t.pointsCount;if(i>0&&s>0){const n=this.getPoint(0),o=t.getPoint(0);if(n.equalsApprox(o))return!0;const r=this.getPoint(i-1),a=t.getPoint(s-1);if(r.equalsApprox(a)||n.equalsApprox(a)||r.equalsApprox(o))return!0}else if(this.fromNode===t.fromNode||this.toNode===t.toNode||this.fromNode===t.toNode||this.toNode===t.fromNode)return!0;return!1}isVisible(){if(!super.isVisible())return!1;const t=this.containingGroup;let i=!0;const s=this.diagram;s!==null&&(i=s.isTreePathToChildren);const n=this.fromNode;if(n!==null){if(this.isTreeLink&&i&&!n.isTreeExpanded)return!1;if(n===t)return!0;let r=n;for(;r!==null;){if(r.labeledLink===this)return!0;r=r.containingGroup}const a=n.findVisibleNode();if(a===null||a===t)return!1}const o=this.toNode;if(o!==null){if(this.isTreeLink&&!i&&!o.isTreeExpanded)return!1;if(o===t)return!0;let r=o;for(;r!==null;){if(r.labeledLink===this)return!0;r=r.containingGroup}const a=o.findVisibleNode();if(a===null||a===t)return!1}return!0}Ei(t){if(super.Ei(t),t&&this.g1(!1),this.Zo!==null&&this.Zo.Ad(),this.Hs!==null){const i=this.Hs.iterator;for(;i.next();)i.value.Ei(t)}}get adjusting(){return this.Pf}set adjusting(t){const i=this.Pf;i!==t&&(this.Pf=t,this.t("adjusting",i,t))}computeAdjusting(){return this.isAvoiding&&this.diagram!==null&&this.diagram.animationManager.defaultAnimation.isAnimating?17:this.Pf}get corner(){return this.Fd}set corner(t){const i=this.Fd;i!==t&&(this.Fd=t,this.ee(),this.t("corner",i,t))}get curve(){return this.Rd}set curve(t){const i=this.Rd;i!==t&&(this.Rd=t,this.invalidateRoute(),this.ee(),this.g1(i===10||i===11||t===10||t===11),this.t("curve",i,t))}get curviness(){return this.vd}set curviness(t){const i=this.vd;i!==t&&(this.vd=t,this.invalidateRoute(),this.ee(),this.t("curviness",i,t))}get routing(){return this.Da}set routing(t){const i=this.Da;i!==t&&(this.Da=t,this.isAvoiding&&this.diagram!==null&&(this.diagram.Ym=!0),this.$o=null,this.invalidateRoute(),this.g1(Lt.sN(i)||Lt.sN(t)),this.t("routing",i,t))}get smoothness(){return this.Od}set smoothness(t){const i=this.Od;i!==t&&(this.Od=t,this.ee(),this.t("smoothness",i,t))}wy(){const t=this.lo;if(t===null)return;const i=this.ao;if(i===null||!isNaN(this.curviness))return;const s=this.ho,n=this.co;let o=null,r=null;const a=t._t.r,h=a.length;for(let l=0;l<h;l++){const u=a[l];!(u.lo===t&&u.ho===s&&u.ao===i&&u.co===n)&&!(u.lo===i&&u.ho===n&&u.ao===t&&u.co===s)||(r===null?r=u:(o===null&&(o=[],o.push(r)),o.push(u)))}if(o!==null){let l=t.$A(i,s,n);l===null&&(l=new Zn(t,s,i,n),t.WA(l),i.WA(l)),l.qs=o;for(let u=0;u<o.length;u++){const c=o[u];c.Zo=l}l.Ad()}}yy(){const t=this.Zo;if(t!==null){if(!isNaN(this.curviness))return;this.Zo=null;const i=t.qs.indexOf(this);i>=0&&(b.tc(t.qs,i),t.Ad())}}Cl(){return!0}get key(){const t=this.diagram;if(!(t===null||!t.model.Ta()))return t.model.getKeyForLinkData(this.data)}};f(Lt,"Fa",null),f(Lt,"Ra",null),f(Lt,"Normal",1),f(Lt,"Orthogonal",2),f(Lt,"AvoidsNodes",6),f(Lt,"AvoidsNodesStraight",7),f(Lt,"None",0),f(Lt,"Bezier",9),f(Lt,"JumpGap",10),f(Lt,"JumpOver",11),f(Lt,"End",17),f(Lt,"Scale",18),f(Lt,"Stretch",19),f(Lt,"OrientAlong",21),f(Lt,"OrientPlus90",22),f(Lt,"OrientMinus90",23),f(Lt,"OrientOpposite",24),f(Lt,"OrientUpright",25),f(Lt,"OrientPlus90Upright",26),f(Lt,"OrientMinus90Upright",27),f(Lt,"OrientUpright45",28),f(Lt,"zv",8),f(Lt,"Xv",16),f(Lt,"Kv",14),f(Lt,"va",8);let dt=Lt;class Zn{constructor(e,t,i,s){f(this,"Eo");f(this,"Os");f(this,"ry");f(this,"J2");f(this,"h1");f(this,"$2");f(this,"qs");K.Yi(this),this.Eo=!1,this.Os=!1,this.ry=e,this.J2=t,this.h1=i,this.$2=s,this.qs=[]}Ad(){if(!this.Eo){const e=this.qs;if(e.length>0){const t=e[0].diagram;t!==null&&(t.lM.add(this),this.Os=t.undoManager.isUndoingRedoing)}}this.Eo=!0}bM(){if(this.Eo){this.Eo=!1;const e=this.qs;if(e.length>0){const t=e[0],i=t.diagram,s=i===null||i.Bh&&!this.Os;this.Os=!1,t.arrangeBundledLinks(e,s),e.length===1&&(t.Zo=null,e.length=0)}e.length===0&&(this.ry.JA(this),this.h1.JA(this))}}}const Yt=class Yt{constructor(e){f(this,"oe");f(this,"re");f(this,"Ia");f(this,"Ea");f(this,"pi");f(this,"yi");f(this,"Ot");f(this,"xh");f(this,"bh");f(this,"ha");f(this,"RM");f(this,"Eo");f(this,"by");f(this,"Gc");f(this,"vM");f(this,"OM");K.Yi(this),this.ha=null,this.RM=null,this.Eo=!0,this.by=!1,this.oe=1,this.re=1,this.Ia=-1,this.Ea=-1,this.pi=e.width,this.yi=e.height,this.Ot=null,this.xh=0,this.bh=0,this.Gc=11,this.vM=this.Gc*2,this.OM=this.Gc*2}kb(e){if(e.width<=0||e.height<=0)return;const t=e.x,i=e.y,s=e.x+e.width,n=e.y+e.height;this.oe=Math.floor((t-this.pi)/this.pi)*this.pi,this.re=Math.floor((i-this.yi)/this.yi)*this.yi,this.Ia=Math.ceil((s+2*this.pi)/this.pi)*this.pi,this.Ea=Math.ceil((n+2*this.yi)/this.yi)*this.yi;const o=1+(Math.ceil((this.Ia-this.oe)/this.pi)|0),r=1+(Math.ceil((this.Ea-this.re)/this.yi)|0);if(this.Ot===null||this.xh<o-1||this.bh<r-1){const a=[];for(let h=0;h<=o;h++)a[h]=new Uint32Array(r);this.Ot=a,this.xh=o-1,this.bh=r-1}this.hO(Yt.hN)}get bounds(){return new z(this.oe,this.re,this.Ia-this.oe,this.Ea-this.re)}get cellWidth(){return this.pi}set cellWidth(e){e>0&&e!==this.pi&&(this.pi=e,this.kb(this.bounds))}get cellHeight(){return this.yi}set cellHeight(e){e>0&&e!==this.yi&&(this.yi=e,this.kb(this.bounds))}Ud(e,t){return this.oe<=e&&e<=this.Ia&&this.re<=t&&t<=this.Ea}fo(e,t){if(!this.Ud(e,t))return Yt.hN;e-=this.oe,e/=this.pi,t-=this.re,t/=this.yi;const i=e|0,s=t|0;return this.Ot[i][s]}pR(e,t,i,s){if(!this.Ud(e,t))return;const n=(e-this.oe)/this.pi|0,o=(t-this.re)/this.yi|0,r=(e+i-this.oe)/this.pi|0,a=(t+s-this.re)/this.yi|0,h=Math.min(r,this.xh),l=Math.min(a,this.bh);for(let u=n;u<=h;u++){const c=this.Ot[u];if(c.fill)c.fill(Yt.Ws,o,l+1);else for(let d=o;d<=l;d++)c[d]=Yt.Ws}}hO(e){if(this.Ot!==null)for(let t=0;t<=this.xh;t++){const i=this.Ot[t];if(i.fill)i.fill(e);else for(let s=0;s<=this.bh;s++)i[s]=e}}zL(){if(this.Ot!==null)for(let e=0;e<=this.xh;e++){const t=this.Ot[e];for(let i=0;i<=this.bh;i++)t[i]>=Yt.Ba&&(t[i]=Yt.hN)}}aO(e,t){return this.fo(e,t)===Yt.Ws}isUnoccupied(e,t,i,s){if(e>this.Ia||e+i<this.oe||t>this.Ea||t+s<this.re)return!0;let n=(e-this.oe)/this.pi|0,o=(t-this.re)/this.yi|0,r=Math.max(0,i)/this.pi+1|0,a=Math.max(0,s)/this.yi+1|0;if(n<0&&(r+=n,n=0),o<0&&(a+=o,o=0),r<0||a<0)return!0;const h=Math.min(n+r-1,this.xh)|0,l=Math.min(o+a-1,this.bh)|0;for(let u=n;u<=h;u++){const c=this.Ot[u];for(let d=o;d<=l;d++)if(c[d]===Yt.Ws)return!1}return!0}maxAvoidsLinksSpaceH(e,t,i,s){if(e>this.Ia||t<this.oe||i>this.Ea||i<this.re)return 0;const n=(e-this.oe)/this.pi|0,o=(t-this.oe)/this.pi|0,r=(i-this.re)/this.yi|0,a=s/this.yi+1|0;let h;for(h=0;h<a/2;h++){let l=!1;for(let u=n;u<=o;u++)if(this.Ot[u][r+h]===Yt.Ws||this.Ot[u][r-h]===Yt.Ws){l=!0;break}if(l)return Math.max(0,(2*h-1)*this.yi)}return s}maxAvoidsLinksSpaceV(e,t,i,s){if(e>this.Ea||t<this.re||i>this.Ia||i<this.oe)return 0;const n=(e-this.re)/this.yi|0,o=(t-this.re)/this.yi|0,r=(i-this.oe)/this.pi|0,a=s/this.pi+1|0;let h;for(h=0;h<a/2;h++){let l=!1;for(let u=n;u<=o;u++)if(this.Ot[r+h][u]===Yt.Ws||this.Ot[r-h][u]===Yt.Ws){l=!0;break}if(l)return Math.max(0,(2*h-1)*this.pi)}return s}cO(e,t,i,s,n,o,r,a){e=e|0,t=t|0;let h=this.Ot[e][t];if(h>=Yt.Ba&&h<Yt.Bd)for(s?t+=i:e+=i,h+=1;n<=e&&e<=o&&r<=t&&t<=a;){const l=this.Ot[e][t];if(h>=l)break;this.Ot[e][t]=h,h+=1,s?t+=i:e+=i}return s?t:e}uo(e,t,i,s,n,o,r,a){if(e<n||e>o||t<r||t>a)return;const h=this.cO(e,t,i,s,n,o,r,a);if(s)if(i>0)for(let l=t+i;l<h;l+=i)this.uo(e,l,1,!s,n,o,r,a),this.uo(e,l,-1,!s,n,o,r,a);else for(let l=t+i;l>h;l+=i)this.uo(e,l,1,!s,n,o,r,a),this.uo(e,l,-1,!s,n,o,r,a);else if(i>0)for(let l=e+i;l<h;l+=i)this.uo(l,t,1,!s,n,o,r,a),this.uo(l,t,-1,!s,n,o,r,a);else for(let l=e+i;l>h;l+=i)this.uo(l,t,1,!s,n,o,r,a),this.uo(l,t,-1,!s,n,o,r,a)}k1(e,t,i,s,n,o,r,a,h,l){let u=e|0,c=t|0,d=Yt.Ws,m=Yt.Ba;for(this.Ot[u][c]=m;d===Yt.Ws&&u>r&&u<a&&c>h&&c<l;)m+=1,this.Ot[u][c]=m,o?c+=n:u+=n,d=this.Ot[u][c];return o?c:u}P1(e,t,i,s,n,o,r,a,h,l){let u=i|0,c=s|0,d=Yt.Ws;const m=Yt.Bd;for(this.Ot[u][c]=m;d===Yt.Ws&&u>r&&u<a&&c>h&&c<l;)this.Ot[u][c]=m,o?c+=n:u+=n,d=this.Ot[u][c]}rT(e,t,i,s,n,o){if(this.Ot===null)return;this.by=!1;let r=e.x,a=e.y;if(!this.Ud(r,a))return;r-=this.oe,r/=this.pi,a-=this.re,a/=this.yi;let h=i.x,l=i.y;if(!this.Ud(h,l))return;if(h-=this.oe,h/=this.pi,l-=this.re,l/=this.yi,Math.abs(r-h)<=1&&Math.abs(a-l)<=1){this.by=!0;return}let u=n.x,c=n.y,d=n.x+n.width,m=n.y+n.height;u-=this.oe,u/=this.pi,c-=this.re,c/=this.yi,d-=this.oe,d/=this.pi,m-=this.re,m/=this.yi;const g=Math.max(0,Math.min(this.xh,u|0)),p=Math.min(this.xh,Math.max(0,d|0)),y=Math.max(0,Math.min(this.bh,c|0)),x=Math.min(this.bh,Math.max(0,m|0)),P=0,k=90,w=270,N=this.Ot,M=r|0,C=a|0,O=h|0,T=l|0,L=t===P||t===k?1:-1,F=t===k||t===w;N[M][C]===Yt.Ws?(this.k1(M,C,O,T,L,F,g,p,y,x),this.k1(M,C,O,T,1,!F,g,p,y,x),this.k1(M,C,O,T,-1,!F,g,p,y,x)):this.k1(M,C,O,T,L,F,M,C,M,C),N[O][T]===Yt.Ws?(this.P1(M,C,O,T,s===P||s===k?1:-1,s===k||s===w,g,p,y,x),this.P1(M,C,O,T,1,!(s===k||s===w),g,p,y,x),this.P1(M,C,O,T,-1,!(s===k||s===w),g,p,y,x)):this.P1(M,C,O,T,L,F,O,T,O,T);const D=b.nt();if(o&&this.lT(O,T,s,M,C,D)){(D[0]!==O||D[1]!==T)&&(D.unshift(T),D.unshift(O)),(D[D.length-2]!==M||D[D.length-1]!==C)&&(D.push(M),D.push(C));let R=Yt.Ba,I=D[D.length-2],j=D[D.length-1];N[I][j]=R++;for(let X=D.length-4;X>=0;X-=2){I=D[X+2],j=D[X+3];const V=D[X],G=D[X+1];for(;V>I?I++:V<I?I--:G>j?j++:G<j&&j--,N[I][j]=R++,!(I===V&&j===G););}}else this.uo(M,C,1,!1,g,p,y,x),this.uo(M,C,-1,!1,g,p,y,x),this.uo(M,C,1,!0,g,p,y,x),this.uo(M,C,-1,!0,g,p,y,x);b.tt(D)}lT(e,t,i,s,n,o){const r=this.Ot;let a=e,h=t;for(;;){if(a===s&&h===n)return!0;let l=a,u=h;if(i===0)if(l<s)l++;else break;else if(i===90)if(u<n)u++;else break;else if(i===180)if(l>s)l--;else break;else if(u>n)u--;else break;const c=r[l][u];if(c===0||c===Yt.aN)break;a=l,h=u}for(;;){let l=i,u=a,c=h;i===0?c<n?(l=90,c++):c>n&&(l=270,c--):i===90?u<s?(l=0,u++):u>s&&(l=180,u--):i===180?c<n?(l=90,c++):c>n&&(l=270,c--):u<s?(l=0,u++):u>s&&(l=180,u--);const d=r[u][c];if(l!==i&&d!==0&&d!==Yt.aN){if(o.push(a),o.push(h),this.lT(a,h,l,s,n,o))return!0;o.pop(),o.pop()}if(r[a][h]=Yt.aN,i===0){if(a===e)return!1;a--}else if(i===90){if(h===t)return!1;h--}else if(i===180){if(a===e)return!1;a++}else{if(h===t)return!1;h++}}}};f(Yt,"Ws",0),f(Yt,"Ba",1),f(Yt,"Bd",999999),f(Yt,"hN",Yt.Bd+1),f(Yt,"aN",Yt.Bd+2);let xi=Yt;class Vs{constructor(){f(this,"de");f(this,"Qo");f(this,"rs");f(this,"Vd");K.Yi(this),this.de=null,this.Qo=null,this.rs=[],this.Vd=!1}toString(){const e=this.rs;let t=this.de.toString()+" "+e.length.toString()+":";for(let i=0;i<e.length;i++){const s=e[i];s!==null&&(t+=`
  `+s.toString())}return t}fO(e,t,i,s){const n=t.offsetY;switch(n){case 8:return 90;case 2:return 180;case 1:return 270;case 4:return 0}let o=i;switch(n){case 9:return o>180?270:90;case 6:return o>90&&o<=270?180:0}const r=Math.atan2(e.height,e.width)*180/Math.PI;switch(n){case 3:return o>r&&o<=180+r?180:270;case 5:return o>180-r&&o<=360-r?270:0;case 12:return o>r&&o<=180+r?90:0;case 10:return o>180-r&&o<=360-r?180:90;case 7:return o>90&&o<=180+r?180:o>180+r&&o<=360-r?270:0;case 13:return o>180&&o<=360-r?270:o>r&&o<=180?90:0;case 14:return o>r&&o<=180-r?90:o>180-r&&o<=270?180:0;case 11:return o>180-r&&o<=180+r?180:o>180+r?270:90}return s&&n!==15&&(o-=15,o<0&&(o+=360)),o>r&&o<180-r?90:o>=180-r&&o<=180+r?180:o>180+r&&o<360-r?270:0}Ad(){this.rs.length=0}nT(e){let t=this.rs;t.length===0&&(this.uO(),t=this.rs);for(let i=0;i<t.length;i++){const s=t[i];if(s!==null&&s.He===e)return s}return null}uO(){if(!this.Vd){const e=this.Vd;this.Vd=!0;let t,i=null;const s=this.de,n=s instanceof at?s:null;if(n!==null&&!n.isSubGraphExpanded){if(!n.actualBounds.isReal())return this.Vd=e,this.rs;i=n,t=i.findExternalLinksConnected()}else s.isTreeExpanded?t=s.findLinksConnected(this.Qo.portId):t=s.findExternalTreeLinksConnected();this.rs.length=0;let o=0;const r=this.Qo.getDocumentPoint(B.TopLeft,S.l()),a=this.Qo.getDocumentPoint(B.BottomRight,S.l()),h=z.X(r.x,r.y,0,0);h.unionPoint(a),S.s(r),S.s(a);const l=S.X(h.x+h.width/2,h.y+h.height/2),u=this.Qo.getDocumentAngle(),c=t.iterator;for(;c.next();){const p=c.value;if(!p.isVisible()||p.fromPort===p.toPort)continue;const y=p.fromPort===this.Qo||p.fromNode!==null&&p.fromNode.isMemberOf(i),x=p.computeSpot(y,this.Qo);if(!x.isSide())continue;let P;if(y?P=p.toPort:P=p.fromPort,P===null)continue;let k=P.part;if(k===null)continue;const w=k.findVisibleNode();w!==null&&w!==k&&(k=w,P=k.port);const N=p.computeOtherPoint(k,P);let M=l.directionPoint(N);M-=u,M<0?M+=360:M>=360&&(M-=360);const C=this.fO(h,x,M,p.isOrthogonal);let O=0;C===0?(O=4,M>180&&(M-=360)):C===90?(O=8,M>270&&(M-=360)):C===180?O=2:(O=1,M<90&&(M+=360));let T=this.rs[o];T===void 0?(T=new Qn(p,M,O),this.rs[o]=T):(T.He=p,T.Xt=M,T.me=O),T.S1.set(N),o++}S.s(l),this.dO();const d=this.rs.length;let m=-1,g=0;for(o=0;o<d;o++){const p=this.rs[o];p!==void 0&&(p.me!==m&&(m=p.me,g=0),p.zd=g,g++)}for(m=-1,g=0,o=d-1;o>=0;o--){const p=this.rs[o];p!==void 0&&(p.me!==m&&(m=p.me,g=p.zd+1),p.Mf=g)}this.gO(this.rs),this.mO(this.rs),this.Vd=e,z.s(h)}return this.rs}pO(e,t){return e===t?0:e===null?-1:t===null?1:e.me<t.me?-1:e.me>t.me?1:e.Xt<t.Xt?-1:e.Xt>t.Xt?1:0}dO(){this.rs.sort(Vs.prototype.pO)}gO(e){const t=this.Qo,i=this.de.portSpreading,s=S.l(),n=S.l(),o=S.l(),r=S.l();t.getDocumentPoint(B.TopLeft,s),t.getDocumentPoint(B.TopRight,n),t.getDocumentPoint(B.BottomRight,o),t.getDocumentPoint(B.BottomLeft,r);let a=0,h=0,l=0,u=0;if(i===2)for(let P=0;P<e.length;P++){const k=e[P];if(k===null)continue;const w=k.He.computeThickness();switch(k.me){case 8:l+=w;break;case 2:u+=w;break;case 1:a+=w;break;default:case 4:h+=w;break}}let c=0,d=0,m=1,g,p,y=0,x=0;for(let P=0;P<e.length;P++){const k=e[P];if(k===null)continue;if(c!==k.me){switch(c=k.me,c){case 8:g=o,p=r;break;case 2:g=r,p=s;break;case 1:g=s,p=n;break;default:case 4:g=n,p=o;break}switch(y=p.x-g.x,x=p.y-g.y,c){case 8:l>Math.abs(y)?(m=Math.abs(y)/l,l=Math.abs(y)):m=1;break;case 2:u>Math.abs(x)?(m=Math.abs(x)/u,u=Math.abs(x)):m=1;break;case 1:a>Math.abs(y)?(m=Math.abs(y)/a,a=Math.abs(y)):m=1;break;default:case 4:h>Math.abs(x)?(m=Math.abs(x)/h,h=Math.abs(x)):m=1;break}d=0}const w=k.Ed;if(i===2){let N=k.He.computeThickness();switch(N*=m,w.set(g),c){case 8:w.x=g.x+y/2+l/2-d-N/2;break;case 2:w.y=g.y+x/2+u/2-d-N/2;break;case 1:w.x=g.x+y/2-a/2+d+N/2;break;default:case 4:w.y=g.y+x/2-h/2+d+N/2;break}d+=N}else{let N=.5;i===1&&(N=(k.zd+1)/(k.Mf+1)),w.x=g.x+y*N,w.y=g.y+x*N}}S.s(s),S.s(n),S.s(o),S.s(r)}mO(e){for(let t=0;t<e.length;t++){const i=e[t];i!==null&&(i.w1=this.yO(i))}}yO(e){const t=e.He,i=t.fromPort===this.Qo,s=t.computeEndSegmentLength(this.de,this.Qo,B.None,i);let n=e.zd;if(n<0)return s;const o=e.Mf;if(o<=1||!t.isOrthogonal)return s;const r=e.S1,a=e.Ed;(e.me===2||e.me===8)&&(n=o-1-n);const h=dt.zv,l=e.me===2||e.me===4;return(l?r.y<a.y:r.x<a.x)?s+n*h:(l?r.y===a.y:r.x===a.x)?s:s+(o-1-n)*h}}class Qn{constructor(e,t,i){f(this,"He");f(this,"Xt");f(this,"me");f(this,"S1");f(this,"zd");f(this,"Mf");f(this,"Ed");f(this,"w1");this.He=e,this.Xt=t,this.me=i,this.S1=new S,this.zd=0,this.Mf=0,this.Ed=new S,this.w1=0}toString(){return this.He.toString()+" "+this.Xt.toString()+" "+this.me.toString()+":"+this.zd.toString()+"/"+this.Mf.toString()+" "+this.Ed.toString()+" "+this.w1.toString()+" "+this.S1.toString()}}class ys{constructor(){f(this,"fa");f(this,"ua");f(this,"da");f(this,"ga");f(this,"ma");f(this,"pa");f(this,"E0");f(this,"O0");f(this,"B0");f(this,"I0");this.fa=B.Default,this.ua=B.Default,this.da=NaN,this.ga=NaN,this.ma=NaN,this.pa=NaN,this.E0=null,this.O0=null,this.B0=1/0,this.I0=1/0}copy(){const e=new ys;return e.fa=this.fa.N(),e.ua=this.ua.N(),e.da=this.da,e.ga=this.ga,e.ma=this.ma,e.pa=this.pa,e.E0=this.E0,e.O0=this.O0,e.B0=this.B0,e.I0=this.I0,e}}class Si{constructor(){f(this,"L0");f(this,"A0");f(this,"T0");f(this,"C0");f(this,"xp");f(this,"bp");this.L0=-1/0,this.A0=0,this.T0=S.Po,this.C0=0,this.xp="None",this.bp="None"}copy(){const e=new Si;return e.L0=this.L0,e.A0=this.A0,e.T0=this.T0.N(),e.C0=this.C0,e.xp=this.xp,e.bp=this.bp,e}}class at extends nt{constructor(t,i){let s;t===void 0||t instanceof Rt||typeof t=="string"?s=t:t&&(i=t);super(s);f(this,"Xd");f(this,"It");f(this,"la");f(this,"u0");f(this,"ni");f(this,"ie");this.E=this.E|4608,this.Xd=new K,this.It=null,this.ie=new be,this.ie.group=this,this.la=new K,this.u0=null,this.ni=null,i&&Object.assign(this,i)}cloneProtected(t){super.cloneProtected(t),this.E=this.E&-32769;const i=t.findInVisualTree(s=>s instanceof Ue);i instanceof Ue?t.It=i:t.It=null,this.ie!==null?(t.ie=this.ie.copy(),t.ie.group=t):(t.ie!==null&&(t.ie.group=null),t.ie=null),this.ni!==null&&(t.ni=this.ni.copy())}Vo(t){super.Vo(t);const i=t.findSubGraphParts(),s=t.memberParts;for(;s.next();){const n=s.value;if(n.c(),n.invalidateLayout(8),n.clearAdornments(),n instanceof nt)n.invalidateConnectedLinks(i);else if(n instanceof dt){const o=n.labelNodes;for(;o.next();)o.value.invalidateConnectedLinks(i)}}}Jc(t,i,s,n,o,r,a){if(t===3&&i==="elements"){if(o instanceof Ue)this.It===null?this.It=o:this.It!==o&&b.o("Cannot insert a second Placeholder into the visual tree of a Group.");else if(o instanceof ct){const h=o.findInVisualTree(l=>l instanceof Ue);h instanceof Ue&&(this.It===null?this.It=h:this.It!==h&&b.o("Cannot insert a second Placeholder into the visual tree of a Group."))}}else t===4&&i==="elements"&&this.It!==null&&(n===this.It?this.It=null:n instanceof ct&&this.It.isContainedBy(n)&&(this.It=null));super.Jc(t,i,s,n,o,r,a)}td(t,i){if(super.td(t,i),this.isClipping&&this.type!==ct.Spot&&this.isSubGraphExpanded){let s=this.resizeObject;s instanceof ct&&(s=s.findMainElement()),this.ni===null&&(this.ni=new z),s.getDocumentBounds(this.ni),s instanceof bt&&this.ni.inflate(-s.strokeWidth,-s.strokeWidth)}}ah(t,i,s,n){this.hasPlaceholder()&&(this.Jo=this.placeholder),super.ah(t,i,s,n)}ensureBounds(){this.isSubGraphExpanded&&this.memberParts.each(t=>{t.ensureBounds()}),super.ensureBounds()}Hr(){if(!super.Hr())return!1;const t=this.memberParts;for(;t.next();){const i=t.value;if(i instanceof nt){if(!i.isVisible())continue;if(i.is())return!1}else if(i instanceof dt){if(!i.isVisible())continue;if(i.is()&&i.fromNode!==this&&i.toNode!==this)return!1}}return!0}hasPlaceholder(){return this.It!==null&&this.It.isVisibleObject()&&this.isSubGraphExpanded}get placeholder(){return this.It}get computesBoundsAfterDrag(){return(this.E&2048)!==0}set computesBoundsAfterDrag(t){const i=(this.E&2048)!==0;i!==t&&(b.i(t,"boolean",at,"computesBoundsAfterDrag"),this.E=this.E^2048,this.t("computesBoundsAfterDrag",i,t))}get computesBoundsIncludingLinks(){return(this.E&4096)!==0}set computesBoundsIncludingLinks(t){b.i(t,"boolean",at,"computesBoundsIncludingLinks");const i=(this.E&4096)!==0;i!==t&&(this.E=this.E^4096,this.t("computesBoundsIncludingLinks",i,t))}get computesBoundsIncludingLocation(){return(this.E&8192)!==0}set computesBoundsIncludingLocation(t){b.i(t,"boolean",at,"computesBoundsIncludingLocation");const i=(this.E&8192)!==0;i!==t&&(this.E=this.E^8192,this.t("computesBoundsIncludingLocation",i,t))}get handlesDragDropForMembers(){return(this.E&16384)!==0}set handlesDragDropForMembers(t){b.i(t,"boolean",at,"handlesDragDropForMembers");const i=(this.E&16384)!==0;i!==t&&(this.E=this.E^16384,this.t("handlesDragDropForMembers",i,t))}get avoidableMembers(){return(this.E&131072)!==0}set avoidableMembers(t){b.i(t,"boolean",at,"avoidableMembers");const i=(this.E&131072)!==0;i!==t&&(this.E=this.E^131072,this.t("avoidableMembers",i,t))}get memberParts(){return this.Xd.iterator}j2(t){if(this.Xd.add(t)){t instanceof at&&this.la.add(t);const s=this.memberAdded;if(s!==null){let n=!0;const o=this.diagram;o!==null&&(n=o.Y,o.Y=!0),s(this,t),o!==null&&(o.Y=n)}(!this.isVisible()||!this.isSubGraphExpanded)&&t.Ei(!1)}if(t instanceof dt&&!this.computesBoundsIncludingLinks)return;let i=this.It;i===null&&(i=this),i.c()}G2(t){if(this.Xd.delete(t)){t instanceof at&&this.la.delete(t);const s=this.memberRemoved;if(s!==null){let n=!0;const o=this.diagram;o!==null&&(n=o.Y,o.Y=!0),s(this,t),o!==null&&(o.Y=n)}(!this.isVisible()||!this.isSubGraphExpanded)&&t.Ei(!0)}if(t instanceof dt&&!this.computesBoundsIncludingLinks)return;let i=this.It;i===null&&(i=this),i.c()}Kc(){if(this.Xd.count>0){const t=this.diagram;if(t!==null){const i=this.Xd.copy().iterator;for(;i.next();){const s=i.value;t.remove(s)}}}super.Kc()}get layout(){return this.ie}set layout(t){const i=this.ie;if(i!==t){t!==null&&t.diagram!==null&&t.diagram.layout===t&&b.o("A layout cannot be both the Diagram.layout and a Group.layout: "+t),i!==null&&(i.diagram=null,i.group=null),this.ie=t;const s=this.diagram;t!==null&&(t.diagram=s,t.group=this),s!==null&&(s.Kr=!0),this.t("layout",i,t),s!==null&&s.requestUpdate()}}get memberAdded(){return this.gt!==null?this.gt.uy:null}set memberAdded(t){const i=this.memberAdded;i!==t&&(t!==null&&b.i(t,"function",at,"memberAdded"),this.cl(),this.gt.uy=t,this.t("memberAdded",i,t))}get memberRemoved(){return this.gt!==null?this.gt.gy:null}set memberRemoved(t){const i=this.memberRemoved;i!==t&&(t!==null&&b.i(t,"function",at,"memberRemoved"),this.cl(),this.gt.gy=t,this.t("memberRemoved",i,t))}get memberValidation(){return this.gt!==null?this.gt.eh:null}set memberValidation(t){const i=this.memberValidation;i!==t&&(t!==null&&b.i(t,"function",at,"memberValidation"),this.cl(),this.gt.eh=t,this.t("memberValidation",i,t))}canAddMembers(t){const i=this.diagram;if(i===null)return!1;const s=i.commandHandler,n=s.i2(t).iterator;for(;n.next();){const o=n.value;if(!s.isValidMember(this,o))return!1}return!0}addMembers(t,i){const s=this.diagram;if(s===null)return!1;const n=s.commandHandler,o=n.i2(t);let r=!0;const a=o.iterator;for(;a.next();){const h=a.value;!i||n.isValidMember(this,h)?h.containingGroup=this:r=!1}return r}get ungroupable(){return(this.E&256)!==0}set ungroupable(t){const i=(this.E&256)!==0;i!==t&&(b.i(t,"boolean",at,"ungroupable"),this.E=this.E^256,this.t("ungroupable",i,t))}canUngroup(){if(!this.ungroupable)return!1;const t=this.layer;if(t===null||!t.allowUngroup)return!1;const i=t.diagram;return!(i!==null&&!i.allowUngroup)}invalidateConnectedLinks(t){const i=this.wO();if(super.invalidateConnectedLinks(t),i)return;this.kL(!0);const s=this.findExternalLinksConnected();for(;s.next();){const n=s.value;if(t!==void 0&&t.has(n))continue;const o=n.fromNode;if(o!==null&&o!==this&&o.isMemberOf(this)&&!o.isVisible())o.Wi(n.fromPort),o.Wi(n.toPort),n.invalidateRoute();else{const r=n.toNode;r!==null&&r!==this&&r.isMemberOf(this)&&!r.isVisible()&&(r.Wi(n.fromPort),r.Wi(n.toPort),n.invalidateRoute())}}}findExternalLinksConnected(){const t=this.diagram!==null&&this.diagram.dM;if(t&&this.u0!==null)return this.u0.iterator;const i=this.findSubGraphParts();i.add(this);const s=new K,n=i.iterator;for(;n.next();){const o=n.value;if(!(o instanceof nt))continue;const r=o.linksConnected;for(;r.next();){const a=r.value;i.has(a)||s.add(a)}}return t&&(this.u0=s),s.iterator}findExternalNodesConnected(){const t=this.findSubGraphParts();t.add(this);const i=new K,s=t.iterator;for(;s.next();){const n=s.value;if(!(n instanceof nt))continue;const o=n.linksConnected;for(;o.next();){const r=o.value,a=r.fromNode;a!==null&&(!t.has(a)||a===this)&&i.add(a);const h=r.toNode;h!==null&&(!t.has(h)||h===this)&&i.add(h)}}return i.iterator}mE(){function t(s,n){s!==null&&(n.add(s),t(s.containingGroup,n))}const i=new K;return t(this,i),i}findSubGraphParts(){const t=new K;return Bt.sh(t,this,!0,0,!0),t.delete(this),t}Ei(t){super.Ei(t);const i=this.memberParts;for(;i.next();)i.value.Ei(t)}collapseSubGraph(){const t=this.diagram;if(t===null||t.isCollapsingExpanding)return;t.isCollapsingExpanding=!0;const i=this.findSubGraphParts();this.hT(i,t,this),t.isCollapsingExpanding=!1}hT(t,i,s){const n=this.memberParts;for(;n.next();){const o=n.value;if(o.Ei(!1),o instanceof at&&o.isSubGraphExpanded&&(o.wasSubGraphExpanded=o.isSubGraphExpanded,o.hT(t,i,s)),o instanceof nt)o.invalidateConnectedLinks(t),i.Lc(o,s);else if(o instanceof dt){const r=o.labelNodes;for(;r.next();)r.value.invalidateConnectedLinks(t)}}this.isSubGraphExpanded=!1}expandSubGraph(){const t=this.diagram;if(t===null||t.isCollapsingExpanding)return;t.isCollapsingExpanding=!0;const i=this.findSubGraphParts();this.aT(i,t,this),t.isCollapsingExpanding=!1}aT(t,i,s){const n=this.memberParts;for(;n.next();){const o=n.value;if(o.Ei(!0),o instanceof at&&o.wasSubGraphExpanded&&(o.wasSubGraphExpanded=!1,o.aT(t,i,s)),o instanceof nt)o.invalidateConnectedLinks(t);else if(o instanceof dt){const r=o.labelNodes;for(;r.next();)r.value.invalidateConnectedLinks(t)}}this.isSubGraphExpanded=!0}get isSubGraphExpanded(){return(this.E&512)!==0}set isSubGraphExpanded(t){const i=(this.E&512)!==0;if(i!==t){b.i(t,"boolean",at,"isSubGraphExpanded"),this.E=this.E^512;const s=this.diagram;this.t("isSubGraphExpanded",i,t);const n=this.subGraphExpandedChanged;if(n!==null){let o=!0;s!==null&&(o=s.Y,s.Y=!0),n(this),s!==null&&(s.Y=o)}if(s!==null&&s.undoManager.isUndoingRedoing){this.It!==null&&this.It.c(),this.memberParts.each(o=>o.updateAdornments());return}t?this.expandSubGraph():this.collapseSubGraph()}}get wasSubGraphExpanded(){return(this.E&1024)!==0}set wasSubGraphExpanded(t){const i=(this.E&1024)!==0;i!==t&&(b.i(t,"boolean",at,"wasSubGraphExpanded"),this.E=this.E^1024,this.t("wasSubGraphExpanded",i,t))}get subGraphExpandedChanged(){return this.gt!==null?this.gt.my:null}set subGraphExpandedChanged(t){const i=this.subGraphExpandedChanged;i!==t&&(t!==null&&b.i(t,"function",at,"subGraphExpandedChanged"),this.cl(),this.gt.my=t,this.t("subGraphExpandedChanged",i,t))}move(t,i){i===void 0&&(i=!1);const s=i?this.location:this.position,n=s.x,o=s.y,r=t.x,a=t.y;if((n===r||isNaN(n)&&isNaN(r))&&(o===a||isNaN(o)&&isNaN(a)))return;const h=r-(isNaN(n)?0:n),l=a-(isNaN(o)?0:o),u=S.l();super.move(t,i);const c=new K,d=this.findSubGraphParts().iterator;for(;d.next();){const m=d.value;m instanceof dt&&(m.suspendsRouting&&c.add(m),!(!m.Me&&(m.fromNode===this||m.toNode===this))&&(m.suspendsRouting=!0))}for(d.reset();d.next();){const m=d.value;if(m.Cl()||m instanceof nt&&m.isLinkLabel)continue;const g=m.position,p=m.location;g.isReal()?(u.x=g.x+h,u.y=g.y+l,m.position=u):p.isReal()&&(u.x=p.x+h,u.y=p.y+l,m.location=u)}for(d.reset();d.next();){const m=d.value;if(!(m instanceof dt)||(m.suspendsRouting=c.has(m),!m.Me&&(m.fromNode===this||m.toNode===this)))continue;const g=m.position;u.x=g.x+h,u.y=g.y+l,u.isReal()?m.move(u):m.invalidateRoute()}S.s(u)}wO(){return(this.E&65536)!==0}kL(t){(this.E&65536)!==0!==t&&(this.E=this.E^65536)}get Jr(){return(this.E&32768)!==0}set Jr(t){(this.E&32768)!==0!==t&&(this.E=this.E^32768)}}class Ue extends he{constructor(t){super();f(this,"$t");f(this,"Kd");this.$t=Kt.Eg,this.Kd=new z(NaN,NaN,NaN,NaN),t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.$t=this.$t.N(),t.Kd=this.Kd.copy()}hh(t){if(this.background===null)return!1;const i=this.naturalBounds;return z.contains(0,0,i.width,i.height,t.x,t.y)}Qu(t,i,s,n){const o=this.part;if((o===null||!(o instanceof at)&&!(o instanceof Mt))&&b.o("Placeholder is not inside a Group or Adornment."),o instanceof at){const r=this.computeBorder(this.Kd),a=this.minSize,h=isFinite(a.width)?Math.max(a.width,r.width):r.width,l=isFinite(a.height)?Math.max(a.height,r.height):r.height,u=this.Vi;u.En(h||0,l||0),this.Qn(0,0,u.width,u.height);const c=o.memberParts;let d=!1;for(;c.next();)if(c.value.isVisible()){d=!0;break}const m=o.diagram;if(d&&m!==null&&!m.animationManager.CS(o)&&!isNaN(r.x)&&!isNaN(r.y)){const g=S.l();g.setRectSpot(r,o.locationSpot),o.location=g,S.s(g)}}else{const r=o,a=this.Vi,h=this.$t,l=h.left+h.right,u=h.top+h.bottom,c=r.adornedObject,d=c.getDocumentAngle();r.angle=d;let m=0;c instanceof bt&&(m=c.strokeWidth);const g=c.getDocumentScale(),p=c.naturalBounds,y=(p.width+m)*g,x=(p.height+m)*g;if(r.type!==ct.Link){const P=r.category==="Selection"?B.TopLeft:r.locationSpot,k=c.getDocumentPoint(P,S.l());r.location=k,S.s(k)}if(!isNaN(y)&&!isNaN(x))a.En(y+l||0,x+u||0),this.Qn(-h.left,-h.top,a.width,a.height);else{const P=c.getDocumentPoint(B.TopLeft,S.l()),k=z.X(P.x,P.y,0,0);k.unionPoint(c.getDocumentPoint(B.BottomRight,P)),k.unionPoint(c.getDocumentPoint(B.TopRight,P)),k.unionPoint(c.getDocumentPoint(B.BottomLeft,P)),a.En(k.width+l||0,k.height+u||0),this.Qn(-h.left,-h.top,a.width,a.height),S.s(P),z.s(k)}}}ah(t,i,s,n){this.actualBounds.e(t,i,s,n)}computeBorder(t){const i=this.part,s=i.diagram,n=s===null||!s.animationManager.isAnimating;if(s!==null&&i instanceof at&&!i.layer.isTemporary&&i.computesBoundsAfterDrag&&this.Kd.isReal()){const h=s.toolManager.findTool("Dragging");if(h===s.currentTool){const l=h.computeBorder(i,this.Kd,t);if(l!==null)return l}}const o=z.l(),r=this.computeMemberBounds(o),a=this.$t;return i instanceof at&&!i.isSubGraphExpanded?t.e(r.x-a.left,r.y-a.top,0,0):t.e(r.x-a.left,r.y-a.top,Math.max(r.width+a.left+a.right,0),Math.max(r.height+a.top+a.bottom,0)),z.s(o),n&&i instanceof at&&i.computesBoundsIncludingLocation&&i.location.isReal()&&t.unionPoint(i.location),t}computeMemberBounds(t){if(!(this.part instanceof at))return t.e(0,0,0,0),t;const i=this.part;let s=1/0,n=1/0,o=-1/0,r=-1/0;const a=i.memberParts;for(;a.next();){const h=a.value;if(!h.isVisible()||h instanceof dt&&(!i.computesBoundsIncludingLinks||h.Oo()||h.fromNode===i||h.toNode===i))continue;const l=h.actualBounds;l.left<s&&(s=l.left),l.top<n&&(n=l.top),l.right>o&&(o=l.right),l.bottom>r&&(r=l.bottom)}if(!isFinite(s)||!isFinite(n)){const h=i.location;t.e(h.x,h.y,0,0)}else t.e(s,n,o-s,r-n);return t}get padding(){return this.$t}set padding(t){typeof t=="number"&&(t=new Kt(t));const i=this.$t;i.equals(t)||(t=t.N(),this.$t=t,this.t("padding",i,t),this.c())}}class be{constructor(e){f(this,"p");f(this,"ha");f(this,"Yd");f(this,"kr");f(this,"Gd");f(this,"jd");f(this,"Fo");f(this,"ul");f(this,"Hd");f(this,"qd");f(this,"go");K.Yi(this),this.p=null,this.ha=null,this.Yd=!0,this.kr=!0,this.Gd=!1,this.jd=new S(0,0).g(),this.Fo=!0,this.ul=null,this.Hd=null,this.qd=!1,this.go=null,e&&Object.assign(this,e)}cloneProtected(e){e.Yd=this.Yd,e.kr=this.kr,e.Gd=this.Gd,e.jd.a(this.jd),e.Fo=this.Fo,e.ul=this.ul,e.Hd=this.Hd,e.qd=!0}copy(){const e=new this.constructor;return this.cloneProtected(e),e}ri(e){}toString(){let e=b.sn(this.constructor);return e+="(",this.group!==null&&(e+=" in "+this.group),this.diagram!==null&&(e+=" for "+this.diagram),e+=")",e}get diagram(){return this.p}set diagram(e){this.p=e}get group(){return this.ha}set group(e){this.ha!==e&&(this.ha=e,e!==null&&(this.p=e.diagram))}get isOngoing(){return this.Yd}set isOngoing(e){this.Yd!==e&&(b.i(e,"boolean",be,"isOngoing"),this.Yd=e)}get isInitial(){return this.kr}set isInitial(e){b.i(e,"boolean",be,"isInitial"),this.kr=e,e||(this.qd=!0)}get isViewportSized(){return this.Gd}set isViewportSized(e){this.Gd!==e&&(b.i(e,"boolean",be,"isViewportSized"),this.Gd=e,e&&this.invalidateLayout())}get isRouting(){return this.Fo}set isRouting(e){this.Fo!==e&&(b.i(e,"boolean",be,"isRouting"),this.Fo=e)}get isRealtime(){return this.ul}set isRealtime(e){this.ul!==e&&(e!==null&&b.i(e,"boolean",be,"isRealtime"),this.ul=e)}get isValidLayout(){return this.qd}set isValidLayout(e){if(this.qd!==e&&(b.i(e,"boolean",be,"isValidLayout"),this.qd=e,!e)){const t=this.diagram;t!==null&&(t.Kr=!0)}}invalidateLayout(){if(this.isValidLayout){const e=this.diagram;if(e===null||e.undoManager.isUndoingRedoing)return;const t=e.animationManager;if(t.isTicking)return;t.defaultAnimation.isAnimating&&t.stopAnimation(),(this.isOngoing&&e.Bh||this.isInitial&&!e.Bh)&&(this.isValidLayout=!1,e.requestUpdate())}}get network(){return this.go}set network(e){this.go!==e&&(this.go=e,e!==null&&(e.layout=this))}createNetwork(){return new Mi(this)}makeNetwork(e){const t=this.createNetwork();return e instanceof At?(t.addParts(e.nodes,!0),t.addParts(e.links,!0)):e instanceof at?t.addParts(e.memberParts):t.addParts(e.iterator),t}updateParts(){this.isValidLayout=!0;let e=this.diagram;if(e===null&&this.network!==null){const t=this.network.vertexes.iterator;for(;t.next();){const i=t.value.node;if(i!==null&&(e=i.diagram,e!==null))break}}try{e!==null&&e.startTransaction("Layout"),this.commitLayout()}finally{e!==null&&e.commitTransaction("Layout")}}commitLayout(){if(this.network===null)return;const e=this.network.vertexes.iterator;for(;e.next();)e.value.commit();if(this.isRouting){const t=this.network.edges.iterator;for(;t.next();)t.value.commit()}}doLayout(e){const t=new K;if(e instanceof At?(this.kh(t,e.nodes,!0,this.Jr,!0,!1,!0),this.kh(t,e.parts,!0,this.Jr,!0,!1,!0)):e instanceof at?this.kh(t,e.memberParts,!1,this.Jr,!0,!1,!0):t.addAll(e.iterator),t.count>0){const i=this.diagram;i!==null&&i.startTransaction("Layout"),this.doMinimalNoNetworkLayout(t),i!==null&&i.commitTransaction("Layout")}this.isValidLayout=!0}doMinimalNoNetworkLayout(e){const t=e.count,i=Math.ceil(Math.sqrt(t));this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin);const s=this.arrangementOrigin.x,n=this.arrangementOrigin.y;let o=s,r=n,a=0,h=0;const l=e.iterator;for(;l.next();){const u=l.value;u.ensureBounds();const c=u.measuredBounds,d=c.width,m=c.height;u.moveTo(o,r),u instanceof at&&(u.Jr=!1),o+=Math.max(d,50)+20,h=Math.max(h,Math.max(m,50)),a>=i-1?(a=0,o=s,r+=h+20,h=0):a++}}doMinimalNetworkLayout(){const e=this.network.vertexes.count,t=Math.ceil(Math.sqrt(e));this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin);const i=this.arrangementOrigin.x,s=this.arrangementOrigin.y;let n=i,o=s,r=0,a=0;const h=this.network.vertexes.iterator;for(;h.next();){const l=h.value.node;if(l===null||l instanceof dt||(l.ensureBounds(),!this.Jr(l)))continue;const u=l.measuredBounds,c=u.width,d=u.height;l.moveTo(n,o),l instanceof at&&(l.Jr=!1),n+=Math.max(c,50)+20,a=Math.max(a,Math.max(d,50)),r>=t-1?(r=0,n=i,o+=a+20,a=0):r++}}Jr(e){return!!(!e.location.isReal()&&!e.position.isReal()||e instanceof at&&e.Jr)}kh(e,t,i,s,n,o,r){const a=t.iterator;for(;a.next();){const h=a.value;if(!(i&&!h.isTopLevel)&&!(s!==null&&!s(h))&&h.canLayout())if(n&&h instanceof nt){if(h.isLinkLabel)continue;h instanceof at&&h.layout===null?this.kh(e,h.memberParts,!1,s,n,o,r):(h.ensureBounds(),e.add(h))}else o&&h instanceof dt?e.add(h):r&&h.Pe()&&!(h instanceof nt)&&(h.ensureBounds(),e.add(h))}}getLayoutBounds(e,t){const i=this.boundsComputation;return i!==null?(t||(t=new z),i(e,this,t)):!t&&e.margin.equalTo(0,0,0,0)?e.actualBounds:(t||(t=new z),t.set(e.actualBounds),t.addMargin(e.margin),t)}get boundsComputation(){return this.Hd}set boundsComputation(e){this.Hd!==e&&(e!==null&&b.i(e,"function",be,"boundsComputation"),this.Hd=e,this.invalidateLayout())}collectParts(e){const t=new K;return e instanceof At?(this.kh(t,e.nodes,!0,null,!0,!0,!0),this.kh(t,e.links,!0,null,!0,!0,!0),this.kh(t,e.parts,!0,null,!0,!0,!0)):e instanceof at?this.kh(t,e.memberParts,!1,null,!0,!0,!0):this.kh(t,e.iterator,!1,null,!0,!0,!0),t}get arrangementOrigin(){return this.jd}set arrangementOrigin(e){this.jd.equals(e)||(this.jd.a(e),this.invalidateLayout())}initialOrigin(e){const t=this.group;if(t!==null)if(t.hasPlaceholder()){const i=t.placeholder,s=i.getDocumentPoint(B.TopLeft);(isNaN(s.x)||isNaN(s.y))&&s.set(e);const n=i.padding;return s.x+=n.left,s.y+=n.top,s}else{const i=t.position.copy();return(isNaN(i.x)||isNaN(i.y))&&i.set(e),i}return e}}class Mi{constructor(e){f(this,"ie");f(this,"mo");f(this,"Cn");f(this,"ky");f(this,"Py");K.Yi(this),this.ie=e,this.mo=new K,this.Cn=new K,this.ky=new St,this.Py=new St}clear(){if(this.mo){const e=this.mo.iterator;for(;e.next();)e.value.clear()}if(this.Cn){const e=this.Cn.iterator;for(;e.next();)e.value.clear()}this.mo=new K,this.Cn=new K,this.ky=new St,this.Py=new St}toString(e){e===void 0&&(e=0);let t="LayoutNetwork"+(this.layout!==null?"("+this.layout.toString()+")":"");if(e<=0)return t;if(t+=" vertexes: "+this.mo.count+" edges: "+this.Cn.count,e>1){const i=this.mo.iterator;for(;i.next();){const n=i.value;t+=`
    `+n.toString(e-1)}const s=this.Cn.iterator;for(;s.next();){const n=s.value;t+=`
    `+n.toString(e-1)}}return t}get layout(){return this.ie}set layout(e){e!==null&&(this.ie=e)}get vertexes(){return this.mo}get edges(){return this.Cn}createVertex(){return new Ni(this)}createEdge(){return new qi(this)}addParts(e,t,i){if(e===null)return;t===void 0&&(t=!1),b.i(t,"boolean",Mi,"addParts:toplevelonly"),i===void 0&&(i=null),i===null&&(i=n=>{if(n instanceof nt)return!n.isLinkLabel;if(n instanceof dt){const o=n.fromNode;if(o===null||o.isLinkLabel)return!1;const r=n.toNode;return!(r===null||r.isLinkLabel)}return!1});const s=e.iterator;for(;s.next();){const n=s.value;if(n instanceof nt&&!(t&&!n.isTopLevel)&&n.canLayout()&&i(n))if(n instanceof at&&n.layout===null)this.addParts(n.memberParts,!1);else{if(this.findVertex(n)!==null)continue;const o=this.createVertex();o.node=n,this.addVertex(o)}}for(s.reset();s.next();){const n=s.value;if(!(n instanceof dt)||t&&!n.isTopLevel||!n.canLayout()||!i(n)||this.findEdge(n)!==null)continue;const o=n.fromNode,r=n.toNode;if(o===null||r===null||o===r)continue;const a=this.findGroupVertex(o),h=this.findGroupVertex(r);this.linkVertexes(a,h,n)}}findGroupVertex(e){if(e===null)return null;const t=e.findVisibleNode();if(t===null)return null;let i=this.findVertex(t);if(i!==null)return i;let s=t.containingGroup;for(;s!==null;){if(i=this.findVertex(s),i!==null)return i;s=s.containingGroup}return null}addVertex(e){if(e===null)return;this.mo.add(e);const t=e.node;t!==null&&this.ky.set(t,e),e.network=this}addNode(e){if(e===null)return null;let t=this.findVertex(e);return t===null&&(t=this.createVertex(),t.node=e,this.addVertex(t)),t}deleteVertex(e){if(e!==null&&this.cT(e)){let t=e._o;for(let i=t.count-1;i>=0;i--){const s=t.elt(i);this.deleteEdge(s)}t=e.tr;for(let i=t.count-1;i>=0;i--){const s=t.elt(i);this.deleteEdge(s)}}}cT(e){if(e===null)return!1;const t=this.mo.delete(e);if(t){const i=e.node;i!==null&&this.ky.delete(i)}return t}deleteNode(e){if(e===null)return;const t=this.findVertex(e);t!==null&&this.deleteVertex(t)}findVertex(e){return e===null?null:this.ky.get(e)}addEdge(e){if(e===null)return;this.cN(e);const t=e.toVertex;t!==null&&t.addSourceEdge(e);const i=e.fromVertex;i!==null&&i.addDestinationEdge(e)}cN(e){if(e===null)return;this.Cn.add(e);const t=e.link;t!==null&&this.findEdge(t)===null&&this.Py.set(t,e),e.network=this}addLink(e){if(e===null)return null;const t=e.fromNode,i=e.toNode;let s=this.findEdge(e);return s===null?(s=this.createEdge(),s.link=e,t!==null&&(s.fromVertex=this.addNode(t)),i!==null&&(s.toVertex=this.addNode(i)),this.addEdge(s)):(t!==null?s.fromVertex=this.addNode(t):s.fromVertex=null,i!==null?s.toVertex=this.addNode(i):s.toVertex=null),s}deleteEdge(e){if(e===null)return;const t=e.toVertex;t!==null&&t.deleteSourceEdge(e);const i=e.fromVertex;i!==null&&i.deleteDestinationEdge(e),this.fN(e)}fN(e){if(e===null)return!1;const t=this.Cn.delete(e);if(t){const i=e.link;i!==null&&this.Py.delete(i)}return t}deleteLink(e){if(e===null)return;const t=this.findEdge(e);t!==null&&this.deleteEdge(t)}findEdge(e){return e===null?null:this.Py.get(e)}linkVertexes(e,t,i){if(e===null||t===null)return null;if(e.network===this&&t.network===this){const s=this.createEdge();return s.link=i,s.fromVertex=e,s.toVertex=t,this.addEdge(s),s}return null}reverseEdge(e){if(e===null)return;const t=e.fromVertex,i=e.toVertex;t===null||i===null||(t.deleteDestinationEdge(e),i.deleteSourceEdge(e),e.reverseEdge(),t.addSourceEdge(e),i.addDestinationEdge(e))}deleteSelfEdges(){const e=b.nt(),t=this.Cn.iterator;for(;t.next();){const s=t.value;s.fromVertex===s.toVertex&&e.push(s)}const i=e.length;for(let s=0;s<i;s++)this.deleteEdge(e[s]);b.tt(e)}deleteArtificialVertexes(){const e=b.nt(),t=this.mo.iterator;for(;t.next();){const o=t.value;o.node===null&&o.data===null&&e.push(o)}let i=e.length;for(let o=0;o<i;o++)this.deleteVertex(e[o]);const s=b.nt(),n=this.Cn.iterator;for(;n.next();){const o=n.value;o.link===null&&o.data===null&&s.push(o)}i=s.length;for(let o=0;o<i;o++)this.deleteEdge(s[o]);b.tt(e),b.tt(s)}deleteUselessEdges(){const e=b.nt(),t=this.Cn.iterator;for(;t.next();){const s=t.value;(s.fromVertex===null||s.toVertex===null)&&e.push(s)}const i=e.length;for(let s=0;s<i;s++)this.deleteEdge(e[s]);b.tt(e)}isSingleton(e){return!(e._o.count>0||e.tr.count>0)}splitIntoSubNetworks(e){e===void 0&&(e=!0),e&&(this.deleteArtificialVertexes(),this.deleteUselessEdges(),this.deleteSelfEdges());const t=new J;let i=!0;for(;i;){i=!1;const s=this.mo.iterator;for(;s.next();){const n=s.value;if(this.isSingleton(n))continue;const o=this.layout.createNetwork();t.add(o),this.xO(o,n),i=!0;break}}return t.sort((s,n)=>s===null||n===null||s===n?0:n.vertexes.count-s.vertexes.count),t}xO(e,t){if(t===null)return;const i=new J;for(i.add(t);i.count>0;){const s=i.first();if(i.removeAt(0),s.network===e)continue;this.cT(s),e.addVertex(s);let n=s.sourceEdges;for(;n.next();){const o=n.value;o.network!==e&&(this.fN(o),e.cN(o),i.add(o.fromVertex))}for(n=s.destinationEdges;n.next();){const o=n.value;o.network!==e&&(this.fN(o),e.cN(o),i.add(o.toVertex))}}}findAllParts(){const e=new K,t=this.mo.iterator;for(;t.next();){const s=t.value;e.add(s.node)}const i=this.Cn.iterator;for(;i.next();){const s=i.value;e.add(s.link)}return e}}class Ni{constructor(e){f(this,"go");f(this,"Qt");f(this,"de");f(this,"Ae");f(this,"qe");f(this,"_o");f(this,"tr");K.Yi(this),this.go=e,this.Ae=new z(0,0,10,10).g(),this.qe=new S(5,5).g(),this.Qt=null,this.de=null,this._o=new J,this.tr=new J}clear(){this.Qt=null,this.de=null,this._o=new J,this.tr=new J}toString(e){e===void 0&&(e=0);let t="LayoutVertex#"+K.as(this);if(e>0&&(t+=this.node!==null?"("+this.node.toString()+")":"",e>1)){let i="",s=!0,n=this._o.iterator;for(;n.next();){const r=n.value;s?s=!1:i+=",",i+=r.toString(0)}let o="";for(s=!0,n=this.tr.iterator;n.next();){const r=n.value;s?s=!1:o+=",",o+=r.toString(0)}t+=" sources: "+i+" destinations: "+o}return t}get po(){return this._o.WN}get ir(){return this.tr.WN}get data(){return this.Qt}set data(e){if(this.Qt=e,e!==null&&e.bounds){const t=e.bounds,i=t.x,s=t.y,n=t.width,o=t.height;this.qe.e(n/2,o/2),this.Ae.e(i,s,n,o)}}get node(){return this.de}set node(e){if(this.de!==e){this.de=e,e.ensureBounds();const t=this.network.layout,i=z.l(),s=t.getLayoutBounds(e,i);let n=s.x,o=s.y;const r=s.width,a=s.height;if(isNaN(n)&&(n=0),isNaN(o)&&(o=0),this.Ae.e(n,o,r,a),z.s(i),!(e instanceof at)){const h=e.locationObject.getDocumentPoint(B.Center);if(h.isReal()){this.qe.e(h.x-n,h.y-o);return}}this.qe.e(r/2,a/2)}}get bounds(){return this.Ae}set bounds(e){this.Ae.equals(e)||this.Ae.a(e)}get focus(){return this.qe}set focus(e){this.qe.equals(e)||this.qe.a(e)}get centerX(){return this.Ae.x+this.qe.x}set centerX(e){const t=this.Ae;t.x+this.qe.x!==e&&(t.ot(),t.x=e-this.qe.x,t.g())}get centerY(){return this.Ae.y+this.qe.y}set centerY(e){const t=this.Ae;t.y+this.qe.y!==e&&(t.ot(),t.y=e-this.qe.y,t.g())}get focusX(){return this.qe.x}set focusX(e){const t=this.qe;t.x!==e&&(t.ot(),t.x=e,t.g())}get focusY(){return this.qe.y}set focusY(e){const t=this.qe;t.y!==e&&(t.ot(),t.y=e,t.g())}get x(){return this.Ae.x}set x(e){const t=this.Ae;t.x!==e&&(t.ot(),t.x=e,t.g())}get y(){return this.Ae.y}set y(e){const t=this.Ae;t.y!==e&&(t.ot(),t.y=e,t.g())}get width(){return this.Ae.width}set width(e){const t=this.Ae;t.width!==e&&(t.ot(),t.width=e,t.g())}get height(){return this.Ae.height}set height(e){const t=this.Ae;t.height!==e&&(t.ot(),t.height=e,t.g())}commit(){const e=this.Qt;if(e!==null){const i=this.bounds,s=e.bounds;b.wt(s)?(s.x=i.x,s.y=i.y,s.width=i.width,s.height=i.height):e.bounds=i.copy();return}const t=this.node;if(t!==null){const i=this.bounds;if(!(t instanceof at)){const s=z.l();t.ensureBounds();const n=this.network.layout.getLayoutBounds(t,s),o=t.locationObject.getDocumentPoint(B.Center);if(n.isReal()&&o.isReal()){t.moveTo(i.x+this.focusX-(o.x-n.x)+t.margin.left,i.y+this.focusY-(o.y-n.y+t.margin.top)),z.s(s);return}z.s(s)}t.moveTo(i.x+t.margin.left,i.y+t.margin.top)}}addSourceEdge(e){e!==null&&(this._o.has(e)||this._o.add(e))}deleteSourceEdge(e){e!==null&&this._o.delete(e)}addDestinationEdge(e){e!==null&&(this.tr.has(e)||this.tr.add(e))}deleteDestinationEdge(e){e!==null&&this.tr.delete(e)}get network(){return this.go}set network(e){this.go=e}get sourceVertexes(){const e=new K,t=this.sourceEdges;for(;t.next();){const i=t.value;e.add(i.fromVertex)}return e.iterator}get destinationVertexes(){const e=new K,t=this.destinationEdges;for(;t.next();){const i=t.value;e.add(i.toVertex)}return e.iterator}get vertexes(){const e=new K;let t=this.sourceEdges;for(;t.next();){const i=t.value;e.add(i.fromVertex)}for(t=this.destinationEdges;t.next();){const i=t.value;e.add(i.toVertex)}return e.iterator}get sourceEdges(){return this._o.iterator}get destinationEdges(){return this.tr.iterator}get edges(){const e=new J;let t=this.sourceEdges;for(;t.next();){const i=t.value;e.add(i)}for(t=this.destinationEdges;t.next();){const i=t.value;e.add(i)}return e.iterator}get edgesCount(){return this._o.count+this.tr.count}static standardComparer(e,t){const i=e.de,s=t.de;if(i)if(s){const n=i.text,o=s.text;return n<o?-1:n>o?1:0}else return 1;else return s!==null?-1:0}static smartComparer(e,t){if(e!==null)if(t!==null){const i=e.de,s=t.de;if(i!==null)if(s!==null){const n=i.text.toLocaleLowerCase(),o=s.text.toLocaleLowerCase(),r=n.split(/([+-]?[.]?\d+(?:\.\d*)?(?:e[+-]?\d+)?)/),a=o.split(/([+-]?[.]?\d+(?:\.\d*)?(?:e[+-]?\d+)?)/);let h=0;for(;h<r.length;h++)if(a[h]!==""&&a[h]!==void 0){const l=parseFloat(r[h]),u=parseFloat(a[h]);if(isNaN(l))if(isNaN(u)){if(r[h].localeCompare(a[h])!==0)return r[h].localeCompare(a[h]);continue}else return 1;else{if(isNaN(u))return-1;if(l-u!==0)return l-u;continue}}else{if(r[h]==="")continue;return 1}return a[h]!==""&&a[h]!==void 0?-1:0}else return 1;else return s!==null?-1:0}else return 1;else return t!==null?-1:0}}class qi{constructor(e){f(this,"go");f(this,"Qt");f(this,"He");f(this,"We");f(this,"Je");K.Yi(this),this.go=e,this.Qt=null,this.He=null,this.We=null,this.Je=null}clear(){this.Qt=null,this.He=null,this.We=null,this.Je=null}toString(e){e===void 0&&(e=0);let t="LayoutEdge#"+K.as(this);return e>0&&(t+=this.He!==null?"("+this.He.toString()+")":"",e>1&&(t+=" "+(this.We?this.We.toString():"null")+" --> "+(this.Je?this.Je.toString():"null"))),t}reverseEdge(){const e=this.We;this.We=this.Je,this.Je=e}commit(){}getOtherVertex(e){return this.Je===e?this.We:this.We===e?this.Je:null}get network(){return this.go}set network(e){this.go=e}get data(){return this.Qt}set data(e){this.Qt!==e&&(this.Qt=e)}get link(){return this.He}set link(e){this.He!==e&&(this.He=e)}get fromVertex(){return this.We}set fromVertex(e){this.We!==e&&(this.We=e)}get toVertex(){return this.Je}set toVertex(e){this.Je!==e&&(this.Je=e)}}var zs=(v=>(v[v.Position=0]="Position",v[v.Location=1]="Location",v))(zs||{}),js=(v=>(v[v.LeftToRight=10]="LeftToRight",v[v.RightToLeft=11]="RightToLeft",v))(js||{}),Ks=(v=>(v[v.Forwards=20]="Forwards",v[v.Reverse=21]="Reverse",v[v.Ascending=22]="Ascending",v[v.Descending=23]="Descending",v))(Ks||{});const ni=class ni extends be{constructor(t){super();f(this,"Wd");f(this,"Jd");f(this,"Lo");f(this,"Ln");f(this,"oi");f(this,"zi");f(this,"pe");f(this,"ye");this.isViewportSized=!0,this.Wd=NaN,this.Jd=NaN,this.Lo=new ut(NaN,NaN).g(),this.Ln=new ut(10,10).g(),this.oi=1,this.zi=10,this.pe=22,this.ye=ni.standardComparer,t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Wd=this.Wd,t.Jd=this.Jd,t.Lo.a(this.Lo),t.Ln.a(this.Ln),t.oi=this.oi,t.zi=this.zi,t.pe=this.pe,t.ye=this.ye}ri(t){t in Ks?this.sorting=t:t in js?this.arrangement=t:t in zs?this.alignment=t:super.ri(t)}doLayout(t){this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin);const i=this.collectParts(t),s=this.diagram,n=i.copy().iterator;for(;n.next();){const g=n.value;if(g.Cl()&&(g.fromNode!==null||g.toNode!==null)){i.delete(g);continue}if(g.ensureBounds(),g instanceof at){const p=g.memberParts;for(;p.next();){const y=p.value;i.delete(y)}}}const o=i.toArray();if(o.length===0)return;switch(this.sorting){case 20:break;case 21:o.reverse();break;case 22:o.sort(this.comparer);break;case 23:o.sort(this.comparer),o.reverse();break}let r=this.wrappingColumn;isNaN(r)&&(r=0);let a=this.wrappingWidth;if(isNaN(a)&&s!==null){const g=s.viewportBounds,p=s.padding;a=Math.max(g.width-p.left-p.right,0)}else a=Math.max(this.wrappingWidth,0);r<=0&&a<=0&&(r=1);let h=this.spacing.width;isFinite(h)||(h=0);let l=this.spacing.height;isFinite(l)||(l=0),s!==null&&s.startTransaction("Layout");const u=[];switch(this.alignment){case 0:this.bO(o,a,r,h,l,u);break;case 1:this.kO(o,a,r,h,l,u);break}let c=0,d=0,m=0;for(let g=0;g<u.length;g++){const p=u[g];c=Math.min(c,p.x),d=Math.min(d,p.y),m=Math.max(m,p.x+p.width)}this.arrangement===11?this.commitLayers(u,new S(c+h/2-(m+c),d-l/2)):this.commitLayers(u,new S(c-h/2,d-l/2)),s!==null&&s.commitTransaction("Layout"),this.isValidLayout=!0}bO(t,i,s,n,o,r){const a=z.l();let h=Math.max(this.cellSize.width,1);if(!isFinite(h)){h=0;for(let x=0;x<t.length;x++){const P=t[x],k=this.getLayoutBounds(P,a);h=Math.max(h,k.width)}}h+=n,h=Math.max(h,1);let l=Math.max(this.cellSize.height,1);if(!isFinite(l)){l=0;for(let x=0;x<t.length;x++){const P=t[x],k=this.getLayoutBounds(P,a);l=Math.max(l,k.height)}}l+=o,l=Math.max(l,1);const u=this.arrangement,c=this.arrangementOrigin.x,d=this.arrangementOrigin.y;let m=c,g=d,p=0,y=0;for(let x=0;x<t.length;x++){const P=t[x],k=this.getLayoutBounds(P,a),w=Math.ceil((k.width+n)/h),N=Math.ceil((k.height+o)/l),M=w*h,C=N*l;let O=0;switch(u){case 11:O=Math.abs(m-k.width);break;default:O=m+k.width;break}(s>0&&p>s-1||i>0&&p>0&&O-c>i)&&(r.push(new z(0,g,i+n,y)),p=0,m=c,g+=y,y=0),y=Math.max(y,C);let T=0;switch(u){case 11:T=-k.width;break;default:T=0;break}switch(P.moveTo(m+T+P.margin.left,g+P.margin.top),u){case 11:m-=M;break;default:m+=M;break}p++}r.push(new z(0,g,i+n,y)),z.s(a)}kO(t,i,s,n,o,r){const a=z.l();let h=Math.max(this.cellSize.width,1),l=0,u=0,c=0;const d=S.l();for(let T=0;T<t.length;T++){const L=t[T],F=this.getLayoutBounds(L,a),D=L.getRelativePoint(L.locationObject,L.locationSpot,d);l=Math.max(l,D.x),u=Math.max(u,F.width-D.x),c=Math.max(c,D.y)}const m=this.arrangement;switch(m){case 11:l+=n;break;default:u+=n;break}isFinite(h)?h=Math.max(h+n,1):h=Math.max(l+u,1);const g=this.arrangementOrigin.x,p=this.arrangementOrigin.y;let y=g,x=p,P=0;i>=l&&(i-=l);let k=0,w=0;const N=Math.max(this.cellSize.height,1);c=0;let M=0,C=!0;const O=S.l();for(let T=0;T<t.length;T++){const L=t[T],F=this.getLayoutBounds(L,a),D=L.getRelativePoint(L.locationObject,L.locationSpot,d);if(P>0)switch(m){case 11:{let I=(y-g-(F.width-D.x))/h;A.K(Math.round(I),I)?I=Math.round(I):I=Math.floor(I),y=I*h+g;break}default:{let I=(y-g+D.x)/h;A.K(Math.round(I),I)?I=Math.round(I):I=Math.ceil(I),y=I*h+g;break}}else switch(m){case 11:k=y+D.x+F.width;break;default:k=y-D.x;break}let R=0;switch(m){case 11:R=-(y+D.x)+k;break;default:R=y+F.width-D.x-k;break}if(s>0&&P>s-1||i>0&&P>0&&R>i){r.push(new z(0,C?x-c:x,i+n,M+c+o));for(let I=0;I<P&&T!==P;I++){const j=t[T-P+I],X=j.getRelativePoint(j.locationObject,j.locationSpot,O);j.moveTo(j.position.x,j.position.y+c-X.y)}M+=o,C?x+=M:x+=M+c,c=0,M=0,P=0,y=g,C=!1}switch(y===g&&(m===11?w=Math.max(w,F.width-D.x):w=Math.min(w,-D.x)),c=Math.max(c,D.y),M=Math.max(M,F.height-D.y),isFinite(N)&&(M=Math.max(M,Math.max(F.height,N)-D.y)),C?L.moveTo(y-D.x,x-D.y):L.moveTo(y-D.x,x),m){case 11:y-=D.x+n;break;default:y+=F.width-D.x+n;break}P++}if(r.push(new z(0,x,i+n,(C?M:M+c)+o)),t.length!==P)for(let T=0;T<P;T++){const L=t[t.length-P+T],F=L.getRelativePoint(L.locationObject,L.locationSpot,d);L.moveTo(L.position.x,L.position.y+c-F.y)}if(S.s(d),S.s(O),m===11)for(let T=0;T<r.length;T++){const L=r[T];L.width+=w,L.x-=w}else for(let T=0;T<r.length;T++){const L=r[T];L.x>w&&(L.width+=L.x-w,L.x=w)}z.s(a)}commitLayers(t,i){}get wrappingWidth(){return this.Wd}set wrappingWidth(t){this.Wd!==t&&(t>0||isNaN(t))&&(this.Wd=t,this.isViewportSized=isNaN(t),this.invalidateLayout())}get wrappingColumn(){return this.Jd}set wrappingColumn(t){this.Jd!==t&&(t>0||isNaN(t))&&(this.Jd=t,this.invalidateLayout())}get cellSize(){return this.Lo}set cellSize(t){this.Lo.equals(t)||(this.Lo.a(t),this.invalidateLayout())}get spacing(){return this.Ln}set spacing(t){this.Ln.equals(t)||(this.Ln.a(t),this.invalidateLayout())}get alignment(){return this.oi}set alignment(t){this.oi!==t&&(t===1||t===0)&&(this.oi=t,this.invalidateLayout())}get arrangement(){return this.zi}set arrangement(t){this.zi!==t&&(t===10||t===11)&&(this.zi=t,this.invalidateLayout())}get sorting(){return this.pe}set sorting(t){this.pe!==t&&(t===20||t===21||t===22||t===23)&&(this.pe=t,this.invalidateLayout())}get comparer(){return this.ye}set comparer(t){this.ye!==t&&(this.ye=t,this.invalidateLayout())}static standardComparer(t,i){const s=t.text,n=i.text;return s<n?-1:s>n?1:0}static smartComparer(t,i){if(t!==null)if(i!==null){const s=t.text.toLocaleLowerCase(),n=i.text.toLocaleLowerCase(),o=s.split(/([+-]?[.]?\d+(?:\.\d*)?(?:e[+-]?\d+)?)/),r=n.split(/([+-]?[.]?\d+(?:\.\d*)?(?:e[+-]?\d+)?)/);let a=0;for(;a<o.length;a++)if(r[a]!==""&&r[a]!==void 0){const h=parseFloat(o[a]),l=parseFloat(r[a]);if(isNaN(h))if(isNaN(l)){if(o[a].localeCompare(r[a])!==0)return o[a].localeCompare(r[a]);continue}else return 1;else{if(isNaN(l))return-1;if(h-l!==0)return h-l;continue}}else{if(o[a]==="")continue;return 1}return r[a]!==""&&r[a]!==void 0?-1:0}else return 1;else return i!==null?-1:0}};f(ni,"Position",0),f(ni,"Location",1),f(ni,"LeftToRight",10),f(ni,"RightToLeft",11),f(ni,"Forward",20),f(ni,"Reverse",21),f(ni,"Ascending",22),f(ni,"Descending",23);let xs=ni;const oi=class oi{constructor(){f(this,"$d");f(this,"qs");f(this,"At");f(this,"Ua");f(this,"p");f(this,"Sy");f(this,"yo");f(this,"dl");f(this,"uN");this.$d=new K,this.qs=new K,this.At=new K,this.yo=new St,this.dl=new St,this.Ua=new St,this.p=null,this.Sy=!1,this.uN=!0}clear(){this.$d.clear(),this.qs.clear(),this.At.clear(),this.yo.clear(),this.dl.clear(),this.Ua.clear()}To(e){this.p=e}qh(e){if(e instanceof nt){if(this.$d.add(e),e instanceof at){const i=e.containingGroup;i===null?this.p.Yr.add(e):i.la.add(e);const s=e.layout;s!==null&&(s.diagram=this.p)}}else e instanceof dt?(this.qs.add(e),e.isAvoiding&&(this.p.Ym=!0)):e instanceof Mt||this.At.add(e);const t=e.data;t!==null&&(e instanceof Mt||(e instanceof dt?this.fT(t,e):this.yo.set(t,e)))}te(e){if(e.clearAdornments(),e instanceof nt){if(this.$d.delete(e),e instanceof at){const i=e.containingGroup;i===null?this.p.Yr.delete(e):i.la.delete(e);const s=e.layout;s!==null&&(s.diagram=null)}}else e instanceof dt?this.qs.delete(e):e instanceof Mt||this.At.delete(e);const t=e.data;t!==null&&(e instanceof Mt||(e instanceof dt?this.uT(t,e):this.yo.delete(t)))}fT(e,t){this.dl.set(e,t)}uT(e,t){this.dl.delete(e)}rebuildParts(){const e=this.p;if(e===null)return;const t=e.nodeTemplateMap.iterator;for(;t.next();){const l=t.value,u=t.key;(!l.Pe()||l instanceof at)&&b.o(`Invalid node template in Diagram.nodeTemplateMap: template for "${u}" must be a Node or a simple Part, not a Group or Link: ${l}`)}const i=e.groupTemplateMap.iterator;for(;i.next();){const l=i.value,u=i.key;l instanceof at||b.o(`Invalid group template in Diagram.groupTemplateMap: template for "${u}" must be a Group, not a normal Node or Link: ${l}`)}const s=e.linkTemplateMap.iterator;for(;s.next();){const l=s.value,u=s.key;l instanceof dt||b.o(`Invalid link template in Diagram.linkTemplateMap: template for "${u}" must be a Link, not a normal Node or simple Part: ${l}`)}const n=b.nt(),o=e.selection.iterator;for(;o.next();){const l=o.value.data;l&&n.push(l)}const r=b.nt(),a=e.highlighteds.iterator;for(;a.next();){const l=a.value.data;l&&r.push(l)}const h=b.nt();if(this.preservesRebuildLocations){const l=this.nodes.iterator;for(;l.next();){const d=l.value;d.data!==null&&(h.push(d.data),h.push(d.location))}const u=this.links.iterator;for(;u.next();){const d=u.value;d.data!==null&&(h.push(d.data),h.push(d.location))}const c=this.parts.iterator;for(;c.next();){const d=c.value;d.data!==null&&(h.push(d.data),h.push(d.location))}}this.dT(),this.LM();for(let l=0;l<n.length;l++){const u=this.findPartForData(n[l]);u!==null&&(u.isSelected=!0)}for(let l=0;l<r.length;l++){const u=this.findPartForData(r[l]);u!==null&&(u.isHighlighted=!0)}if(this.preservesRebuildLocations)for(let l=0;l<h.length;l+=2){const u=this.findPartForData(h[l]);u!==null&&(u.location=h[l+1])}b.tt(n),b.tt(r),b.tt(h)}LM(){const e=this.diagram.model;this.My(e.nodeDataArray)}My(e,t){const i=this.diagram.model;e.forEach(s=>{i.containsNodeData(s)&&this.gT(s,!1)}),e.forEach(s=>{i.containsNodeData(s)&&this.M1(s)}),t!==!1&&this.diagram.bb(!1)}gT(e,t){if(e==null||this.diagram.undoManager.isUndoingRedoing||this.yo.has(e))return null;t===void 0&&(t=!0);const i=this.PO(e);return i!==null&&t&&this.M1(e),i}PO(e){if(e==null||this.p.undoManager.isUndoingRedoing||this.yo.has(e))return null;const t=this.SO(e),i=this.findTemplateForNodeData(e,t);if(i!==null){i.li();const s=i.copy();if(s!==null){const n=this.diagram.fe;return this.diagram.fe=!0,s.Ho=t,s.Qt=e,this.Sy&&(s.ll="Tool"),this.diagram.add(s),s.Qt=null,s.data=e,this.diagram.fe=n,s}}return null}insertLink(e,t,i,s){return null}M1(e){}SO(e){return this.p.model.getCategoryForNodeData(e)}findTemplateForNodeData(e,t){const i=this.p,s=i.model,n=s.qc()&&s.isGroupForData(e);let o=null;return n?(o=i.groupTemplateMap.get(t),o===null&&(o=i.groupTemplateMap.get(""),o===null&&(oi.pT||(oi.pT=!0,b.ii('No Group template found for category "'+t+'"'),b.ii("  Using default group template")),o=i.rM))):(o=i.nodeTemplateMap.get(t),o===null&&(o=i.nodeTemplateMap.get(""),o===null&&(oi.mT||(oi.mT=!0,b.ii('No Node template found for category "'+t+'"'),b.ii("  Using default node template")),o=i.sM))),o}getLinkCategoryForData(e){return""}setLinkCategoryForData(e,t){}setFromNodeForLink(e,t,i){}setToNodeForLink(e,t,i){}findLinkTemplateForCategory(e){const t=this.p;let i=t.linkTemplateMap.get(e);return i===null&&(i=t.linkTemplateMap.get(""),i===null&&(oi.yT||(oi.yT=!0,b.ii('No Link template found for category "'+e+'"'),b.ii("  Using default link template")),i=t.nM)),i}fv(e,t,i){e instanceof dt?(t!==null&&this.uT(t,e),i!==null&&this.fT(i,e)):e instanceof Bt&&(t!==null&&this.yo.delete(t),i!==null&&this.yo.set(i,e))}dT(){const e=this.diagram.model;this.dN(e.nodeDataArray)}dN(e){e.forEach(t=>{this.N1(t)})}N1(e){const t=this.findPartForData(e);t!==null&&(this.diagram.NM(t,!1),this.gN(t))}gN(e){}nN(e){}findPartForKey(e){if(e==null)return null;const t=this.p.model.findNodeDataForKey(e);return t!==null?this.yo.get(t):null}findNodeForKey(e){if(e==null)return null;const t=this.p.model.findNodeDataForKey(e);if(t===null)return null;const i=this.yo.get(t);return i instanceof nt?i:null}findLinkForKey(e){return null}findPartForData(e){if(e===null)return null;let t=this.yo.get(e);return t!==null||(t=this.dl.get(e)),t}findNodeForData(e){if(e===null)return null;const t=this.yo.get(e);return t instanceof nt?t:null}findLinkForData(e,t){return e===null?null:this.dl.get(e)}findNodesByExample(...e){const t=new K,i=this.$d.iterator;for(;i.next();){const s=i.value,n=s.data;if(n!==null)for(let o=0;o<arguments.length;o++){const r=arguments[o];if(b.wt(r)&&this.mN(n,r)){t.add(s);break}}}return t.iterator}findLinksByExample(...e){const t=new K,i=this.qs.iterator;for(;i.next();){const s=i.value,n=s.data;if(n!==null)for(let o=0;o<arguments.length;o++){const r=arguments[o];if(b.wt(r)&&this.mN(n,r)){t.add(s);break}}}return t.iterator}mN(e,t){for(const i in t){const s=e[i],n=t[i];if(Array.isArray(n)){if(!Array.isArray(s))return!1;const o=s,r=n;if(o.length<r.length)return!1;for(let a=0;a<o.length;a++){const h=o[a],l=r[a];if(l!==void 0&&!this.wT(h,l))return!1}}else if(!this.wT(s,n))return!1}return!0}wT(e,t){if(typeof t=="function"){if(!t(e))return!1}else if(t instanceof RegExp){if(!e||!t.test(e.toString()))return!1}else if(b.wt(e)&&b.wt(t)){if(!this.mN(e,t))return!1}else if(e!==t)return!1;return!0}doModelDataChanged(e){if(e.model===this.diagram.model&&this.diagram.Y){this.diagram.Y=!1;try{const t=e.change;e.modelChange===""&&t===2&&this.Ny(e.object,e.propertyName)}finally{this.diagram.Y=!0}}}doModelChanged(e){if(!this.p)return;const t=this.p;if(e.model!==t.model)return;const i=e.change;if(t.uR(e),!!t.Y){t.Y=!1;try{const s=e.modelChange;if(s!=="")if(i===2){if(s==="nodeCategory"){const n=e.object,o=this.findPartForData(n),r=e.newValue;o!==null&&typeof r=="string"&&(o.category=r)}else if(s==="nodeDataArray"){const n=e.oldValue;this.dN(n);const o=e.newValue;this.My(o)}t.isModified=!0}else if(i===3){const n=e.newValue;s==="nodeDataArray"&&b.wt(n)&&this.gT(n),t.isModified=!0}else if(i===4){const n=e.oldValue;s==="nodeDataArray"&&b.wt(n)&&this.N1(n),t.isModified=!0}else i===1&&(s==="SourceChanged"?e.object!==null?this.Ny(e.object,e.propertyName):(this.updateAllRelationshipsFromData(),this.updateAllTargetBindings()):s==="ModelDisplaced"&&this.rebuildParts());else if(i===2){const n=e.propertyName,o=e.object,r=t.model;o===r?(n==="nodeKeyProperty"||n==="nodeCategoryProperty")&&(t.undoManager.isUndoingRedoing||this.rebuildParts()):this.Ny(o,n),t.isModified=!0}else(i===3||i===4)&&(this.MO(e),t.isModified=!0)}finally{t.Y=!0}}}updateAllTargetBindings(e){e===void 0&&(e="");let t=this.parts.iterator;for(;t.next();)t.value.updateTargetBindings(e);for(t=this.nodes.iterator;t.next();)t.value.updateTargetBindings(e);for(t=this.links.iterator;t.next();)t.value.updateTargetBindings(e)}updateAllThemeBindings(){let e=this.parts.iterator;for(;e.next();)e.value.Io();for(e=this.nodes.iterator;e.next();)e.value.Io();for(e=this.links.iterator;e.next();)e.value.Io()}updateAllRelationshipsFromData(){const e=this.p.model,t=new K,i=e.nodeDataArray;for(let o=0;o<i.length;o++){const r=i[o];t.add(r)}const s=[];this.nodes.each(o=>{o.data!==null&&!t.has(o.data)&&s.push(o.data)}),this.parts.each(o=>{o.data!==null&&!t.has(o.data)&&s.push(o.data)}),s.forEach(o=>e.xT(o,!1));for(let o=0;o<i.length;o++){const r=i[o];this.findPartForData(r)===null&&e.bT(r,!1)}this.kT();let n=this.parts.iterator;for(;n.next();)n.value.updateRelationshipsFromData();for(n=this.nodes.iterator;n.next();)n.value.updateRelationshipsFromData();for(n=this.links.iterator;n.next();)n.value.updateRelationshipsFromData()}kT(){}updateRelationshipsFromData(e){}Ny(e,t){if(typeof t=="string"){const i=this.findPartForData(e);if(i!==null)i.updateTargetBindings(t);else{const s=this.NO(e);if(s!==null&&s.length>0){for(let o=0;o<s.length;o++)s[o].updateTargetBindings(t);const n=s[0].part;if(n!==null){const o=n.adornments;for(;o.next();)o.value.updateTargetBindings(t)}b.tt(s)}}e===this.diagram.model.modelData&&this.updateAllTargetBindings(t)}}NO(e){let t=null;const i=this.Ua.iterator;for(;i.next();){const s=i.value;for(let n=0;n<s.length;n++){const o=s[n].findItemPanelForData(e);o!==null&&(t===null&&(t=b.nt()),t.push(o))}if(t!==null)break}return t}MO(e){const t=e.object,i=e.change===3,s=i?e.newParam:e.oldParam,n=i?e.newValue:e.oldValue,o=this.Ua.get(t);if(Array.isArray(o))for(let r=0;r<o.length;r++){const a=o[r];i?a.Wb(n,s,!0):a.dv(s)}}SM(e,t){t!==null&&e.qr(s=>t.SL(s));const i=e.mh;if(Array.isArray(i)){const s=this.Ua.get(i);if(s===null){const n=[];n.push(e),this.Ua.set(i,n)}else{for(let n=0;n<s.length;n++)if(s[n]===e)return;s.push(e)}}}MM(e,t){e.qr(s=>t.gR(s));const i=e.mh;if(Array.isArray(i)){const s=this.Ua.get(i);if(s!==null){for(let n=0;n<s.length;n++)if(s[n]===e){s.splice(n,1),s.length===0&&this.Ua.delete(i);return}}}}copyParts(e,t,i){i===void 0&&(i=!1);const s=new St;if(Array.isArray(e))for(let o=0;o<e.length;o++)this.C1(e[o],t,s,i);else{const o=e.iterator;for(;o.next();)this.C1(o.value,t,s,i)}if(t!==null){const o=t.model,r=t.a0().dragsLink,a=new K,h=new St,l=s.iterator;for(;l.next();){const u=l.value;if(u instanceof dt)!r&&(u.fromNode===null||u.toNode===null)&&a.add(u);else if(u instanceof nt&&u.data!==null){if(o.pc()){const c=u,d=l.key,m=d.findTreeParentNode();if(m!==null){const g=s.get(m);if(g!==null){o.setParentKeyForNodeData(c.data,o.getKeyForNodeData(g.data));const p=t.findLinkForData(c.data),y=d.findTreeParentLink();y!==null&&p!==null&&h.set(y,p)}else o.setParentKeyForNodeData(c.data,void 0)}}else if(o.ju()){const c=u,d=l.key,m=o.isRelatedKeysPathTo?d.findNodesOutOf():d.findNodesInto();for(;m.next();){const g=m.value,p=s.get(g);if(p!==null){o.addRelatedKeyForNodeData(c.data,p.key);const y=t.partManager.findLinkForData(c.data,p.key),x=this.findLinkForData(d.data,g.key);x!==null&&y!==null&&h.set(x,y)}else o.removeRelatedKeyForNodeData(c.data,g.key)}}}}if(a.count>0&&t.removeParts(a,!1),h.count>0){const u=h.iterator;for(;u.next();){const c=u.key,d=u.value;s.set(c,d)}}}if(t!==null&&this.p!==null){const o=t.model,r=o.afterCopyFunction;if(r!==null){const a=new St;s.each(l=>{l.key.data!==null&&a.set(l.key.data,l.value.data)});const h=this.p.model;r(a,o,h)}}const n=s.iterator;for(;n.next();)n.value.updateTargetBindings();return s}C1(e,t,i,s){if(e===null||s&&!e.canCopy())return null;if(i.has(e))return i.get(e);const n=this.pN(e,t);if(!(n instanceof Bt))return null;if(n.isSelected=!1,n.isHighlighted=!1,i.set(e,n),e instanceof nt){const o=e.linksConnected;for(;o.next();){const r=o.value;if(r.fromNode===e){const a=i.get(r);a!==null&&(a.fromNode=n)}if(r.toNode===e){const a=i.get(r);a!==null&&(a.toNode=n)}}if(e instanceof at&&n instanceof at){const r=e.memberParts;for(;r.next();){const a=r.value,h=this.C1(a,t,i,s);h instanceof dt||h!==null&&(h.containingGroup=n)}}}else if(e instanceof dt&&n instanceof dt){const o=e.fromNode;if(o!==null){const h=i.get(o);h!==null&&(n.fromNode=h)}const r=e.toNode;if(r!==null){const h=i.get(r);h!==null&&(n.toNode=h)}const a=e.labelNodes;for(;a.next();){const h=a.value,l=this.C1(h,t,i,s);l!==null&&l instanceof nt&&(l.labeledLink=n)}}return n}pN(e,t){let i=null;const s=e.data;if(s!==null&&t!==null){const n=t.model;if(!(e instanceof dt)){const o=n.copyNodeData(s);b.wt(o)&&(n.addNodeData(o),i=t.findPartForData(o))}}else if(e.li(),i=e.copy(),i!==null){const n=this.p;if(t!==null)t.add(i);else if(s!==null&&n!==null&&n.commandHandler!==null&&n.commandHandler.copiesClipboardData){const o=n.model;let r=null;i instanceof dt||(r=o.copyNodeData(s)),b.wt(r)&&(i.data=r)}}return i}get nodes(){return this.$d}get links(){return this.qs}get parts(){return this.At}get diagram(){return this.p}get addsToTemporaryLayer(){return this.Sy}set addsToTemporaryLayer(e){this.Sy=e}get preservesRebuildLocations(){return this.uN}set preservesRebuildLocations(e){this.uN=e}};f(oi,"mT",!1),f(oi,"pT",!1),f(oi,"yT",!1);let Ei=oi;class _n extends Ei{LM(){const e=this.diagram.model;this.My(e.nodeDataArray),this.PT(e.linkDataArray)}My(e){super.My(e,!1);const t=this.links.iterator;for(;t.next();)t.value.Ld();this.diagram.bb(!1)}PT(e){e.forEach(t=>{this.ST(t)}),this.diagram.bb(!1)}ST(e){if(e==null||this.diagram.undoManager.isUndoingRedoing||this.dl.has(e))return null;const t=this.getLinkCategoryForData(e),i=this.findLinkTemplateForCategory(t);if(i!==null){i.li();const s=i.copy();if(s!==null){const n=this.diagram.fe;this.diagram.fe=!0,s.Ho=t,s.Qt=e;const o=this.diagram.model,r=o.L1(e,!0);r!==""&&(s.fromPortId=r);const a=o.Te(e,!0);if(a!==void 0){const c=this.findNodeForKey(a);c instanceof nt&&(s.fromNode=c)}const h=o.L1(e,!1);h!==""&&(s.toPortId=h);const l=o.Te(e,!1);if(l!==void 0){const c=this.findNodeForKey(l);c instanceof nt&&(s.toNode=c)}const u=o.getLabelKeysForLinkData(e);return Array.isArray(u)&&u.forEach(c=>{const d=this.findNodeForKey(c);d!==null&&(d.labeledLink=s)}),this.Sy&&(s.ll="Tool"),this.diagram.add(s),s.Qt=null,s.data=e,this.diagram.fe=n,s}}return null}dT(){const e=this.diagram.model;this.MT(e.linkDataArray),this.dN(e.nodeDataArray)}MT(e){e.forEach(t=>{this.N1(t)})}getLinkCategoryForData(e){return this.diagram.model.getCategoryForLinkData(e)}setLinkCategoryForData(e,t){return this.diagram.model.setCategoryForLinkData(e,t)}setFromNodeForLink(e,t){const i=this.diagram.model,s=t!==null?t.data:null;i.setFromKeyForLinkData(e.data,i.getKeyForNodeData(s))}setToNodeForLink(e,t){const i=this.diagram.model,s=t!==null?t.data:null;i.setToKeyForLinkData(e.data,i.getKeyForNodeData(s))}nN(e){this.diagram.model.removeLinkData(e.data)}findPartForKey(e){const t=super.findPartForKey(e);if(t===null){const i=this.diagram.model.findLinkDataForKey(e);if(i!==null)return this.dl.get(i)}return t}findLinkForKey(e){if(e==null)return null;const t=this.diagram.model.findLinkDataForKey(e);return t!==null?this.dl.get(t):null}doModelChanged(e){if(super.doModelChanged(e),!this.diagram)return;const t=this.diagram;if(e.model!==t.model)return;const i=e.change;if(t.Y){t.Y=!1;try{const s=e.modelChange;if(s!==""){if(i===2){if(s==="linkFromKey"){const n=e.object,o=this.findLinkForData(n);if(o!==null){const r=e.newValue,a=this.findNodeForKey(r);o.fromNode=a}}else if(s==="linkToKey"){const n=e.object,o=this.findLinkForData(n);if(o!==null){const r=e.newValue,a=this.findNodeForKey(r);o.toNode=a}}else if(s==="linkFromPortId"){const n=e.object,o=this.findLinkForData(n);if(o!==null){const r=e.newValue;typeof r=="string"&&(o.fromPortId=r)}}else if(s==="linkToPortId"){const n=e.object,o=this.findLinkForData(n);if(o!==null){const r=e.newValue;typeof r=="string"&&(o.toPortId=r)}}else if(s==="nodeGroupKey"){const n=e.object,o=this.findPartForData(n);if(o!==null){const r=e.newValue;if(r!==void 0){const a=this.findNodeForKey(r);a instanceof at?o.containingGroup=a:o.containingGroup=null}else o.containingGroup=null}}else if(s==="linkLabelKeys"){const n=e.object,o=this.findLinkForData(n);if(o!==null){const r=e.oldValue,a=e.newValue;Array.isArray(r)&&r.forEach(h=>{if(a.indexOf(h)>=0)return;const l=this.findNodeForKey(h);l!==null&&(l.labeledLink=null)}),Array.isArray(a)&&a.forEach(h=>{const l=this.findNodeForKey(h);l!==null&&(l.labeledLink=o)})}}else if(s==="linkCategory"){const n=e.object,o=this.findLinkForData(n),r=e.newValue;o!==null&&typeof r=="string"&&(o.category=r)}else if(s==="linkDataArray"){const n=e.oldValue;this.MT(n);const o=e.newValue;this.PT(o)}t.isModified=!0}else if(i===3){const n=e.newValue;if(s==="linkDataArray"&&typeof n=="object"&&n!==null)this.ST(n);else if(s==="linkLabelKeys"&&e.model.isKeyType(n)){const o=e.object,r=this.findLinkForData(o),a=this.findNodeForKey(n);r!==null&&a!==null&&(a.labeledLink=r)}t.isModified=!0}else if(i===4){const n=e.oldValue;if(s==="linkDataArray"&&typeof n=="object"&&n!==null)this.N1(n);else if(s==="linkLabelKeys"&&e.model.isKeyType(n)){const o=this.findNodeForKey(n);o!==null&&(o.labeledLink=null)}t.isModified=!0}}else if(i===2){const n=e.propertyName,o=e.object,r=t.model;o===r&&(n==="linkFromKeyProperty"||n==="linkToKeyProperty"||n==="linkFromPortIdProperty"||n==="linkToPortIdProperty"||n==="linkLabelKeysProperty"||n==="nodeIsGroupProperty"||n==="nodeGroupKeyProperty"||n==="linkCategoryProperty")&&(t.undoManager.isUndoingRedoing||this.rebuildParts()),t.isModified=!0}}finally{t.Y=!0}}}kT(){const e=this.diagram.model,t=new K,i=e.linkDataArray;i.forEach(n=>{t.add(n)});const s=[];this.links.each(n=>{n.data!==null&&!t.has(n.data)&&s.push(n.data)}),s.forEach(n=>{e.NT(n,!1)}),i.forEach(n=>{this.findLinkForData(n)===null&&e.CT(n,!1)})}updateRelationshipsFromData(e){const t=e.data;if(t===null)return;const i=e.diagram;if(i===null)return;const s=i.model;if(e instanceof dt){let n=s.Te(t,!0),o=i.findNodeForKey(n);e.fromNode=o,n=s.Te(t,!1),o=i.findNodeForKey(n),e.toNode=o;const r=s.getLabelKeysForLinkData(t);if(r.length>0||e.labelNodes.count>0){if(r.length===1&&e.labelNodes.count===1){const c=r[0],d=e.labelNodes.first();if(s.getKeyForNodeData(d.data)===c)return}const a=new K().addAll(r),h=new K;e.labelNodes.each(c=>{if(c.data!==null){const d=s.getKeyForNodeData(c.data);d!==void 0&&h.add(d)}});const l=h.copy();l.removeAll(a);const u=a.copy();if(u.removeAll(h),l.count>0||u.count>0){const c=e;l.each(d=>{const m=i.findNodeForKey(d);m!==null&&m.labeledLink===c&&(m.labeledLink=null)}),u.each(d=>{const m=i.findNodeForKey(d);m!==null&&m.labeledLink!==c&&(m.labeledLink=c)})}}}else if(!(e instanceof Mt)){const n=s.getGroupKeyForNodeData(t),o=i.findPartForKey(n);(o===null||o instanceof at)&&(e.containingGroup=o)}}M1(e){const t=this.diagram.model,i=t.getKeyForNodeData(e);if(i!==void 0){const s=t.Cy(i),n=this.findPartForData(e);if(s!==null&&n!==null){const r=s.iterator;for(;r.next();){const a=r.value;if(t.containsNodeData(a)){if(n instanceof at&&t.getGroupKeyForNodeData(a)===i){const h=this.findPartForData(a);h!==null&&(h.containingGroup=n)}}else{const h=this.findLinkForData(a);if(h!==null&&n instanceof nt){t.Te(a,!0)===i&&(h.fromNode=n),t.Te(a,!1)===i&&(h.toNode=n);const l=t.getLabelKeysForLinkData(a);Array.isArray(l)&&l.some(u=>u===i?(n.labeledLink=h,!0):!1)}}}t.Js(i)}const o=t.getGroupKeyForNodeData(e);if(o!==void 0){const r=this.findNodeForKey(o);r instanceof at&&(n.containingGroup=r)}}}gN(e){const t=this.diagram.model;if(e instanceof nt){const i=t.getKeyForNodeData(e.data);if(i!==void 0){const s=e.linksConnected;for(;s.next();){const n=s.value;t.$s(i,n.data)}if(e.isLinkLabel){const n=e.labeledLink;n!==null&&t.$s(i,n.data)}if(e instanceof at){const n=e.memberParts;for(;n.next();){const o=n.value.data;t.containsNodeData(o)&&t.$s(i,o)}}}}}pN(e,t){let i=super.pN(e,t);if(e instanceof dt){const s=e.data;if(s!==null&&t!==null){const n=t.model,o=n.copyLinkData(s);typeof o=="object"&&o!==null&&(n.addLinkData(o),i=t.findLinkForData(o))}else if(i!==null){const n=this.diagram;if(s!==null&&n!==null&&n.commandHandler!==null&&n.commandHandler.copiesClipboardData){const o=n.model.copyLinkData(s);typeof o=="object"&&o!==null&&(i.data=o)}}}return i}insertLink(e,t,i,s){const n=this.diagram,o=n.model,r=n.toolManager.findTool("Linking");let a="";e!==null&&(t===null&&(t=e),a=t.portId,a===null&&(a=""));let h="";i!==null&&(s===null&&(s=i),h=s.portId,h===null&&(h=""));const l=r.archetypeLinkData;if(l instanceof dt){l.li();const u=l.copy();if(u!==null){u.fromNode=e,u.fromPortId=a,u.toNode=i,u.toPortId=h,n.add(u);const c=r.archetypeLabelNodeData;if(c instanceof nt){c.li();const d=c.copy();d!==null&&(d.labeledLink=u,n.add(d))}return u}}else if(l!==null){const u=o.copyLinkData(l);if(typeof u=="object"&&u!==null){e!==null&&o.Zd(u,o.getKeyForNodeData(e.data),!0),o.Qd(u,a,!0),i!==null&&o.Zd(u,o.getKeyForNodeData(i.data),!1),o.Qd(u,h,!1),o.addLinkData(u);const c=r.archetypeLabelNodeData;if(c!==null&&!(c instanceof nt)){const d=o.copyNodeData(c);if(typeof d=="object"&&d!==null){o.addNodeData(d);const m=o.getKeyForNodeData(d);m!==void 0&&o.addLabelKeyForLinkData(u,m)}}return n.findLinkForData(u)}}return null}}class to extends Ei{constructor(){super(...arguments);f(this,"Ph",null)}A1(t,i){if(t===null||i===null||i.findTreeParentLink()!==null)return null;const s=this.diagram.toolManager.findTool("Linking");let n=t,o=i;if(this.diagram.isTreePathToChildren){if(s!==null&&s.xu(n,o,null,!0))return null}else if(n=i,o=t,s!==null&&s.xu(n,o,null,!0))return null;const r=this.getLinkCategoryForData(i.data),a=this.findLinkTemplateForCategory(r);if(a!==null){a.li();const h=a.copy();if(h!==null){const l=this.diagram.fe;return this.diagram.fe=!0,h.Ho=r,h.Qt=i.data,h.fromNode=n,h.toNode=o,this.diagram.add(h),h.Qt=null,h.data=i.data,this.diagram.fe=l,h}}return null}getLinkCategoryForData(t){return this.diagram.model.getParentLinkCategoryForNodeData(t)}setLinkCategoryForData(t,i){this.diagram.model.setParentLinkCategoryForNodeData(t,i)}setFromNodeForLink(t,i,s){const n=this.diagram.model;s===void 0&&(s=null);const o=i!==null?i.data:null;if(this.diagram.isTreePathToChildren)n.setParentKeyForNodeData(t.data,n.getKeyForNodeData(o));else{const r=this.Ph;this.Ph=t,s!==null&&n.setParentKeyForNodeData(s.data,void 0);const a=t.toNode!==null?t.toNode.data:null;n.setParentKeyForNodeData(o,n.getKeyForNodeData(a)),this.Ph=r}}setToNodeForLink(t,i,s){const n=this.diagram.model;s===void 0&&(s=null);const o=i!==null?i.data:null;if(this.diagram.isTreePathToChildren){const r=this.Ph;this.Ph=t,s!==null&&n.setParentKeyForNodeData(s.data,void 0);const a=t.fromNode!==null?t.fromNode.data:null;n.setParentKeyForNodeData(o,n.getKeyForNodeData(a)),this.Ph=r}else n.setParentKeyForNodeData(t.data,n.getKeyForNodeData(o))}nN(t){this.diagram.model.setParentKeyForNodeData(t.data,void 0)}findLinkForKey(t){if(t==null)return null;const i=this.diagram.model.findNodeDataForKey(t);return i!==null?this.dl.get(i):null}doModelChanged(t){if(super.doModelChanged(t),!this.diagram)return;const i=this.diagram;if(t.model!==i.model)return;const s=t.change;if(i.Y){i.Y=!1;try{const n=t.modelChange;if(n!==""){if(s===2){if(n==="nodeParentKey"){const o=t.object,r=t.newValue,a=this.findNodeForKey(r),h=this.findNodeForData(o);if(this.Ph!==null)a!==null&&(this.Ph.data=o,this.Ph.category=this.getLinkCategoryForData(o));else if(h!==null){const l=h.findTreeParentLink();l!==null?a===null?i.remove(l):i.isTreePathToChildren?l.fromNode=a:l.toNode=a:this.A1(a,h)}}else if(n==="parentLinkCategory"){const o=t.object,r=this.findNodeForData(o),a=t.newValue;if(r!==null&&typeof a=="string"){const h=r.findTreeParentLink();h!==null&&(h.category=a)}}i.isModified=!0}}else if(s===2){const o=t.propertyName,r=t.object,a=i.model;r===a&&o==="nodeParentKeyProperty"&&(i.undoManager.isUndoingRedoing||this.rebuildParts()),i.isModified=!0}}finally{i.Y=!0}}}updateRelationshipsFromData(t){const i=t.data;if(i===null)return;const s=t.diagram;if(s===null)return;const n=s.model;if(t instanceof nt){const o=n.getParentKeyForNodeData(i),r=s.findNodeForKey(o),a=t.findTreeParentNode();if(r!==a){const h=t.findTreeParentLink();r!==null?h!==null?s.isTreePathToChildren?h.fromNode=r:h.toNode=r:this.A1(r,t):h!==null&&s.NM(h,!1)}}}Ny(t,i){if(super.Ny(t,i),typeof i=="string"&&this.findPartForData(t)!==null){const s=this.findLinkForData(t);s!==null&&s.updateTargetBindings(i)}}M1(t){const i=this.diagram.model,s=i.getKeyForNodeData(t);if(s!==void 0){const n=i.Cy(s),o=this.findPartForData(t);if(n!==null&&o!==null){const a=n.iterator;for(;a.next();){const h=a.value;if(i.containsNodeData(h)&&o instanceof nt&&i.getParentKeyForNodeData(h)===s){const l=this.findNodeForData(h);this.A1(o,l)}}i.Js(s)}const r=i.getParentKeyForNodeData(t);if(r!==void 0&&o instanceof nt){const a=this.findNodeForKey(r);this.A1(a,o)}}}gN(t){const i=this.diagram.model;if(t instanceof nt){const s=i.getKeyForNodeData(t.data),n=this.findLinkForData(t.data);if(n!==null){n.isSelected=!1,n.isHighlighted=!1;const a=n.layer;if(a!==null){const h=a.te(-1,n,!1);h>=0&&this.diagram.raiseChangedEvent(4,"parts",a,n,null,h,null);const l=n.layerChanged;l!==null&&l(n,a,null)}}const o=this.diagram.isTreePathToChildren,r=t.linksConnected;for(;r.next();){const a=r.value,h=(o?a.toNode:a.fromNode).data;i.containsNodeData(h)&&i.$s(s,h)}}}insertLink(t,i,s,n){const o=this.diagram.model;let r=t,a=s;if(this.diagram.isTreePathToChildren||(r=s,a=t),r!==null&&a!==null){const h=r.data,l=a.data;return o.setParentKeyForNodeData(l,o.getKeyForNodeData(h)),a.findTreeParentLink()}return null}}var bs=(v=>(v[v.OneWay=1]="OneWay",v[v.TwoWay=2]="TwoWay",v))(bs||{});const Ee=class Ee{constructor(e,t,i,s){f(this,"n");f(this,"yN");f(this,"Va");f(this,"Cf");f(this,"Sh");f(this,"Lf");f(this,"Af");f(this,"Tf");f(this,"T1");f(this,"ke");f(this,"gd");f(this,"ff");K.Yi(this),e===void 0?e="":b.i(e,"string",Ee,"constructor:targetprop"),t===void 0?t=e:b.i(t,"string",Ee,"constructor:sourceprop"),i===void 0?i=null:i!==null&&b.i(i,"function",Ee,"constructor:conv"),this.yN=-1,this.ke=null,this.Va=e,this.gd=0,this.ff=0,this.Cf=null,this.Sh=t,this.Lf=i,s===void 0?(this.Af=1,this.Tf=null):(this.Af=2,this.Tf=s),this.T1=new K,this.n=2}copy(){const e=new this.constructor;return this.cloneProtected(e),e}cloneProtected(e){e.Va=this.Va,e.gd=this.gd,e.ff=this.ff,e.Cf=this.Cf,e.Sh=this.Sh,e.Lf=this.Lf,e.Af=this.Af,e.Tf=this.Tf,e.n=this.n&-2}static parseEnum(e,t){return b.i(e,"function",Ee,"parseEnum:ctor"),i=>{let s=parseInt(i);return isNaN(s)&&(s=b.Ih(e,i),s===null)?t:s}}ri(e){e in bs?this.mode=e:b.lr(this,e)}static toString(e){return b.toString(e)}toString(){return"Binding("+this.targetProperty+":"+this.sourceProperty+(this.targetId!==-1?" "+this.targetId:"")+" "+bs[this.mode]+")"}g(){return this.n=this.n|1,this}ot(){return this.n=this.n&-2,this}get targetId(){return this.yN}set targetId(e){this.h&&b.T(this),b.i(e,"number",Ee,"targetId"),this.yN=e}get targetProperty(){return this.Va}set targetProperty(e){this.h&&b.T(this),b.i(e,"string",Ee,"targetProperty"),this.Va=e}get sourceProperty(){return this.Sh}set sourceProperty(e){this.h&&b.T(this),b.i(e,"string",Ee,"sourceProperty"),this.Sh=e}get h(){return(this.n&1)!==0}get isToData(){return(this.n&2)!==0}get isToObject(){return(this.n&4)!==0}get isToModel(){return(this.n&8)!==0}get isToTheme(){return(this.n&16)!==0}get wN(){return this.isToTheme&&!(this.isToData||this.isToObject||this.isToModel)}Zu(){return!1}get sourceName(){return this.Cf}set sourceName(e){this.h&&b.T(this),e!==null&&b.i(e,"string",Ee,"sourceName"),this.Cf=e,e!==null?this.n=this.n&-3|4:this.n=this.n|2}get converter(){return this.Lf}set converter(e){this.h&&b.T(this),e!==null&&b.i(e,"function",Ee,"converter"),this.Lf=e}get backConverter(){return this.Tf}set backConverter(e){this.h&&b.T(this),e!==null&&b.i(e,"function",Ee,"backConverter"),this.Tf=e}get mode(){return this.Af}set mode(e){this.h&&b.T(this),this.isToTheme&&e===2&&b.o("Theme Bindings cannot be TwoWay."),this.Af=e}makeTwoWay(e){return this.isToTheme&&b.o("Theme Bindings cannot be TwoWay."),this.mode=2,e&&(b.i(e,"function",Ee,"makeTwoWay"),this.backConverter=e),this}ofObject(e){return this.h&&b.T(this),e===void 0&&(e=""),this.sourceName=e,this}ofModel(){return this.h&&b.T(this),this.n=this.n&-3&-5|8,this.Cf=null,this}ZL(e,t){const i=this.sourceName;let s=null;return i===null||i===""?s=e:i==="/"?s=t.part:i==="."?s=t:i===".."?s=t.panel:s=e.findObject(i),s}check(e){const t=this.Va,i=this.Sh,s=this.Lf;(this.Zu()&&s===null&&this.Mh===null&&t===""||s===null&&t==="")&&b.ii("Binding error: target property is the empty string: "+this.toString()),this.Zu()&&this.wN&&i===""&&s===null&&this.Mh===null&&b.ii("Binding error: theme bindings require a source property when not using a converter: "+this.toString()),e&&typeof t=="string"&&(typeof e.setAttribute!="function"&&t.length>0&&t[0]!=="_"&&!b.fw(e,t)?b.ii("Binding error: undefined target property: "+t+" on "+e.toString()):t==="name"&&e instanceof he&&b.ii("Binding error: cannot modify GraphObject.name on "+e.toString()))}updateTarget(e,t,i){var h,l,u;const s=this.Sh;if(i!==void 0&&s!==""&&s!==i)return;const n=this.Va,o=this.Lf;let r=t;if(s!==""&&!this.wN&&(r=mt.vt(t,s)),r===void 0)return;const a=((h=e.diagram)==null?void 0:h.themeManager)??((u=(l=e.panel)==null?void 0:l.diagram)==null?void 0:u.themeManager);if(o===null){if(n!==""){if(this.Zu()&&(r=this.LT(a,r,e,n),r===void 0))return;mt.rt(e,n,r)}}else try{if(n!==""){let c=o(r,e);if(this.Zu()&&(c=this.LT(a,c,e,n),c===void 0))return;mt.rt(e,n,c)}else o(r,e)}catch{}}updateSource(e,t,i,s){if(this.Af!==2)return;const n=this.Va;if(i!==void 0&&n!==i)return;const o=this.Sh,r=this.Tf;let a=e;if(n!==""&&(a=mt.vt(e,n)),a!==void 0&&!this.T1.has(e))try{this.T1.add(e);const h=s!==null?s.diagram:null,l=h!==null?h.model:null;if(r===null){if(o!=="")l!==null?l.setDataProperty(t,o,a):mt.rt(t,o,a);else if(l!==null&&s!==null&&s.itemIndex>=0&&s.panel!==null&&Array.isArray(s.panel.itemArray)){const u=s.itemIndex,c=s.panel.itemArray;l.removeArrayItem(c,u),l.insertArrayItem(c,u,a)}}else try{if(o!==""){const u=r(a,t,l);l!==null?l.setDataProperty(t,o,u):mt.rt(t,o,u)}else{const u=r(a,t,l);if(u!==void 0&&l!==null&&s!==null&&s.itemIndex>=0&&s.panel!==null&&Array.isArray(s.panel.itemArray)){const c=s.itemIndex,d=s.panel.itemArray;l.removeArrayItem(d,c),l.insertArrayItem(d,c,u)}}}catch{}}finally{this.T1.delete(e)}}};f(Ee,"OneWay",1),f(Ee,"TwoWay",2);let bi=Ee;class Hi extends bi{constructor(t,i,s,n,o){super(t,i,n);f(this,"Ly");f(this,"Mh");f(this,"za");s==null&&(s=""),o===void 0&&(o=null),this.Ly=s,this.Mh=o,this.za=null,this.n=16}cloneProtected(t){super.cloneProtected(t),t.Ly=this.Ly,t.Mh=this.Mh,t.za=this.za}Zu(){return!0}get themeSource(){return this.Ly}set themeSource(t){this.h&&b.T(this),t!==null&&b.i(t,"string",Hi,"themeSource"),this.Ly=t,this.za=null,t!==null?this.n=this.n|16:this.n=this.n&-17}get themeConverter(){return this.Mh}set themeConverter(t){this.h&&b.T(this),t!==null&&b.i(t,"function",Hi,"themeConverter"),this.Mh=t}ofData(){return this.h&&b.T(this),this.n=this.n|2,this.Cf=null,this}LT(t,i,s,n){if(!t||(this.wN&&(i=this.Sh),!i&&i!==0))return;let o=this.themeSource;this.za!==null?o=this.za:typeof o=="string"&&o.includes(".")&&(this.za=o.split("."),o=this.za);let r=t.findValue(i,o,n);return r===void 0&&b.ii(`Theme warning: ${i} could not be found when setting target property ${n}.`),typeof this.Mh=="function"&&(r=this.Mh(r,s)),r}}const vt=class vt{constructor(e,t){f(this,"Mt");f(this,"_d");f(this,"vo");f(this,"D1");f(this,"De");f(this,"Df");f(this,"Ff");f(this,"tg");f(this,"ig");f(this,"eg");f(this,"sg");f(this,"Xa");f(this,"er");f(this,"F1");f(this,"Ro");f(this,"R1");f(this,"ti");f(this,"Nh");f(this,"ng",new K);f(this,"og",new K);f(this,"Ay");f(this,"vT",`,
  "insertedNodeKeys": `);f(this,"CO",`,
  "modifiedNodeData": `);f(this,"OT",`,
  "removedNodeKeys": `);f(this,"Ka",null);if(K.Yi(this),this.Mt="",this._d="",this.vo=!1,this.D1={},this.De=[],this.ti=new St,this.Nh="key",this.Df=null,this.Ff=null,this.tg=!1,this.ig=!1,this.eg=!1,this.sg=null,this.Xa="category",this.er=new St,this.Ay=100,this.F1=new J,this.Ro=!1,this.R1=null,this.undoManager=new Li,e!==void 0&&(Array.isArray(e)?this.nodeDataArray=e:t=e),t){Object.assign(this,t);const i=t.Changed;i&&(delete this.Changed,this.addChangedListener(i))}}cloneProtected(e){e.Mt=this.Mt,e._d=this._d,e.vo=this.vo,e.Nh=this.Nh,e.Df=this.Df,e.Ff=this.Ff,e.tg=this.tg,e.ig=this.ig,e.eg=this.eg,e.Ay=this.Ay,e.sg=this.sg,e.Xa=this.Xa}copy(){const e=new this.constructor;return this.cloneProtected(e),e}clear(){this.De=[],this.ti.clear(),this.er.clear(),this.undoManager.clear()}toString(e){if(e===void 0&&(e=0),e>1)return this.toJson();{let t=(this.name!==""?this.name:"")+" Model";if(e>0){t+=`
 node data:`;const i=this.nodeDataArray,s=i.length;for(let n=0;n<s;n++){const o=i[n];t+=" "+this.getKeyForNodeData(o)+":"+b.toString(o)}}return t}}toIncrementalData(e){e.change!==1&&b.o("Model.toIncrementalData argument is not a Transaction ChangedEvent:"+e.toString());const t=e.object;if(!e.isTransactionFinished||!(t instanceof pe))return null;this.AT(t);const i=this.xN(t,e.propertyName==="FinishedUndo");return this.Ka=null,i}xN(e,t){const i=this;let s=!1;const n=new K,o=new K,r=new K,a=this.Ka;e.changes.each(d=>{if(d.model===i){if(d.modelChange==="nodeDataArray")d.change===3?n.add(d.newValue):d.change===4&&r.add(d.oldValue);else if(i.containsNodeData(d.object))o.add(d.object);else if(d.change===2&&(i.modelData===d.object||d.propertyName==="modelData"))s=!0;else if(d.object!==null)if(a&&a.has(d.object))a.get(d.object).each(m=>{i.containsNodeData(m)&&o.add(m)});else{if(d.object instanceof vt||i.Ta()&&i.containsLinkData(d.object))return;i.TT(d.object).each(m=>{o.add(m)})}}});const h=this.og;h.clear(),n.each(d=>{h.add(i.getKeyForNodeData(d)),t||o.add(d)});const l=this.ng;l.clear(),r.each(d=>{l.add(i.getKeyForNodeData(d)),t&&o.add(d)});const u=i.cloneDeep(o.toArray());let c=null;return s&&(c===null&&(c={}),c.modelData=this.cloneDeep(this.modelData)),h.count>0&&(c===null&&(c={}),t?c.removedNodeKeys=h.toArray():c.insertedNodeKeys=h.toArray()),u.length>0&&(c===null&&(c={}),c.modifiedNodeData=u),l.count>0&&(c===null&&(c={}),t?c.insertedNodeKeys=l.toArray():c.removedNodeKeys=l.toArray()),l.clear(),h.clear(),c}cloneDeep(e){return this.rg(e,!0)}rg(e,t,i,s,n){if(!b.wt(e))return e;n||(n=[]);const o=Object.isExtensible(e);if(i||(i=new St),o){const h=i.get(e);if(h)return h}else{s||(s=new St);const h=s.iterator;for(;h.next();){const l=h.key;if(h.value===e){const u=i.get(l);if(u)return u}}}function r(h,l){if(o)h.__gohashid===void 0&&n.push(h),i.set(h,l);else{const u=K.su++;i.set(u,l),s.set(u,e)}}let a;if(Array.isArray(e)){a=[],r(e,a);for(let h=0;h<e.length;h++){const l=e[h];a.push(this.rg(l,!1,i,s,n))}}else if(e instanceof S||e instanceof ut||e instanceof z||e instanceof Kt||e instanceof B)a=e.copy(),r(e,a);else{if(e instanceof jt||e instanceof Ft)return e;if(e instanceof J)a=new J().addAll(this.rg(e.toArray(),!1,i,s,n)),r(e,a);else if(e instanceof K)a=new K().addAll(this.rg(e.toArray(),!1,i,s,n)),r(e,a);else if(e instanceof St)a=new St().addAll(this.rg(e.toArray(),!1,i,s,n)),r(e,a);else if(e instanceof Date)a=new Date(e.getTime()),r(e,a);else if(e instanceof RegExp)a=new RegExp(e),r(e,a),a.lastIndex=e.lastIndex;else if(typeof e.copy=="function")a=e.copy(),r(e,a);else{a={},r(e,a);for(const h in e){if(h==="__gohashid")continue;const l=e[h];a[h]=this.rg(l,!1,i,s,n)}}}return t&&n.forEach(h=>{delete h.__gohashid}),a}Fe(e){return JSON.stringify(e).replace(/[\u007F-\uFFFF]/g,t=>{const i="0000"+t.charCodeAt(0).toString(16);return"\\u"+i.substring(i.length-4)})}lg(){let e="";return this.name!==""&&(e+=`,
  "name": `+this.Fe(this.name)),this.dataFormat!==""&&(e+=`,
  "dataFormat": `+this.Fe(this.dataFormat)),this.isReadOnly&&(e+=`,
  "isReadOnly": `+this.isReadOnly),this.nodeKeyProperty!=="key"&&typeof this.nodeKeyProperty=="string"&&(e+=`,
  "nodeKeyProperty": `+this.Fe(this.nodeKeyProperty)),this.copiesArrays&&(e+=`,
  "copiesArrays": true`),this.copiesArrayObjects&&(e+=`,
  "copiesArrayObjects": true`),this.copiesKey&&(e+=`,
  "copiesKey": true`),this.pointsDigits!==100&&(e+=`,
  "pointsDigits": `+this.pointsDigits.toString()),this.nodeCategoryProperty!=="category"&&typeof this.nodeCategoryProperty=="string"&&(e+=`,
  "nodeCategoryProperty": `+this.Fe(this.nodeCategoryProperty)),e}Ty(e){e.name&&(this.name=e.name),e.dataFormat&&(this.dataFormat=e.dataFormat),e.isReadOnly&&(this.isReadOnly=!0),e.nodeKeyProperty&&(this.nodeKeyProperty=e.nodeKeyProperty),e.copiesArrays&&(this.copiesArrays=!0),e.copiesArrayObjects&&(this.copiesArrayObjects=!0),e.copiesKey!==void 0&&(this.copiesKey=e.copiesKey),e.pointsDigits!==void 0&&(this.pointsDigits=parseInt(e.pointsDigits)),e.nodeCategoryProperty&&(this.nodeCategoryProperty=e.nodeCategoryProperty)}DT(){const e=this.modelData;return`,
  "modelData": `+this.FT(e)}RT(e){const t=e.modelData;b.wt(t)&&(this.replaceJsonObjects(t),this.modelData=t)}bN(){const e=this.modelData;let t=!1;for(const s in e)if(!this.v1(e,s,e[s])){t=!0;break}let i="";return t&&(i=this.DT()),i+`,
  "nodeDataArray": `+this.Ch(this.nodeDataArray,!0)}kN(e){this.RT(e);const t=e.nodeDataArray;Array.isArray(t)&&(this.replaceJsonObjects(t),this.nodeDataArray=t)}PN(e,t,i){if(e===t)return!0;if(typeof e!=typeof t||typeof e=="function"||typeof t=="function")return!1;if(Array.isArray(e)&&Array.isArray(t)){if(i.get(e)===t)return!0;if(i.set(e,t),e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(!this.PN(e[s],t[s],i))return!1;return!0}else if(b.wt(e)&&b.wt(t)){if(i.get(e)===t)return!0;i.set(e,t);for(const s in e){const n=e[s];if(this.v1(e,s,n))continue;const o=t[s];if(o===void 0||!this.PN(n,o,i))return!1}for(const s in t){const n=t[s];if(this.v1(t,s,n))continue;const o=e[s];if(o===void 0||!this.PN(o,n,i))return!1}return!0}return!1}AT(e){let t=this.Ka;const i=(s,n)=>{const o=n.part;if(!o)return;const r=o.data;if(s===r)return;let a=t.get(s);a===null?(a=new K,a.add(r),t.set(s,a)):a.add(r)};t===null&&(t=new St,e.changes.each(s=>{if(s.diagram!==null){const n=s.change;if(n===2){const o=s.object.panel;if(o){const r=o.data;r&&i(r,o)}}else if(n===3||n===4){const o=s.object,r=o.itemArray;r&&i(r,o)}}}),this.Ka=t)}TT(e){const t=new K;for(let i=0;i<this.nodeDataArray.length;i++){const s=this.nodeDataArray[i];this.O1(e,s,s,t)}return t}O1(e,t,i,s){if(Array.isArray(t))for(let n=0;n<t.length;n++){const o=t[n];if(o===e)return s.add(i),!0;if(this.O1(e,o,i,s))return!0}else if(b.wt(t)&&Object.getPrototypeOf(t)===Object.prototype)for(const n in t){const o=t[n];if(o===e)return s.add(i),!0;if(this.O1(e,o,i,s))return!0}return!1}SN(e,t){const i=this;let s=!1;const n=new K,o=new K,r=new K,a=this.Ka;e.changes.each(c=>{if(c.model===i){if(c.modelChange==="nodeDataArray")c.change===3?n.add(c.newValue):c.change===4&&r.add(c.oldValue);else if(i.containsNodeData(c.object))o.add(c.object);else if(c.change===2&&(i.modelData===c.object||c.propertyName==="modelData"))s=!0;else if(c.object!==null)if(a&&a.has(c.object))a.get(c.object).each(d=>{i.containsNodeData(d)&&o.add(d)});else{if(c.object instanceof vt||i.Ta()&&i.containsLinkData(c.object))return;i.TT(c.object).each(d=>{o.add(d)})}}});const h=this.og;h.clear(),n.each(c=>{h.add(i.getKeyForNodeData(c)),t||o.add(c)});const l=this.ng;l.clear(),r.each(c=>{l.add(i.getKeyForNodeData(c)),t&&o.add(c)});let u="";return s&&(u+=this.DT()),h.count>0&&(u+=(t?this.OT:this.vT)+this.Ch(h.toArray(),!0)),o.count>0&&(u+=this.CO+this.Ch(o.toArray(),!0)),l.count>0&&(u+=(t?this.vT:this.OT)+this.Ch(l.toArray(),!0)),l.clear(),h.clear(),u}Dy(e){(e.name!==void 0&&e.name!==this.name||e.dataFormat!==void 0&&e.dataFormat!==this.dataFormat||e.isReadOnly!==void 0&&e.isReadOnly!==this.isReadOnly||e.nodeKeyProperty!==void 0&&e.nodeKeyProperty!==this.nodeKeyProperty||e.copiesArrays!==void 0&&e.copiesArrays!==this.copiesArrays||e.copiesArrayObjects!==void 0&&e.copiesArrayObjects!==this.copiesArrayObjects||e.copiesKey!==void 0&&e.copiesKey!==this.copiesKey||e.nodeCategoryProperty!==void 0&&e.nodeCategoryProperty!==this.nodeCategoryProperty)&&b.o("applyIncrementalJson cannot change Model properties"),this.RT(e);const t=e.insertedNodeKeys,i=e.modifiedNodeData,s=new St;if(Array.isArray(i))for(let o=0;o<i.length;o++){const r=i[o],a=this.getKeyForNodeData(r);a!=null&&s.set(a,r)}if(Array.isArray(t)){const o=t.length;for(let r=0;r<o;r++){const a=t[r];let h=this.findNodeDataForKey(a);h===null&&(h=s.get(a)||this.copyNodeData({}),this.setKeyForNodeData(h,a),this.addNodeData(h))}}if(Array.isArray(i)){const o=i.length;for(let r=0;r<o;r++){const a=i[r],h=this.getKeyForNodeData(a),l=this.findNodeDataForKey(h);if(l!==null){for(const u in a)u==="__gohashid"||u===this.nodeKeyProperty||(this.gc()||this.ju())&&u===this.nodeIsGroupProperty||this.setDataProperty(l,u,a[u]);this.hg(a,l)}}}const n=e.removedNodeKeys;if(Array.isArray(n)){const o=n.length;for(let r=0;r<o;r++){const a=n[r],h=this.findNodeDataForKey(a);h!==null&&this.removeNodeData(h)}}}toIncrementalJson(e,t){e.change!==1&&b.o("Model.toIncrementalJson argument is not a Transaction ChangedEvent:"+e.toString());const i=e.object;if(!e.isTransactionFinished||!(i instanceof pe))return'{ "incremental": 0 }';t===void 0&&(t=b.sn(this)),this.AT(i);const s=this.SN(i,e.propertyName==="FinishedUndo");return this.Ka=null,t==="2"?'{ "incremental": 2'+s+"}":'{ "class": '+this.Fe(t)+', "incremental": 1'+this.lg()+s+"}"}toIncrementalJSON(e,t){return this.toIncrementalJson(e,t)}toJson(e){return e===void 0&&(e=b.sn(this)),'{ "class": '+this.Fe(e)+this.lg()+this.bN()+"}"}toJSON(e){return this.toJson(e)}applyIncrementalJson(e){let t=null;if(typeof e=="string")try{t=Z.JSON.parse(e)}catch{}else typeof e=="object"?t=e:b.o("Unable to modify a Model from: "+e);const i=t.incremental;typeof i!="number"&&b.o("Unable to apply non-incremental changes to Model: "+e),i!==0&&(this.startTransaction("applyIncrementalJson"),this.Dy(t),this.commitTransaction("applyIncrementalJson"))}applyIncrementalJSON(e){return this.applyIncrementalJson(e)}static fromJson(e,t){t===void 0&&(t=null);let i=null;if(typeof e=="string")try{i=Z.JSON.parse(e)}catch{}else typeof e=="object"?i=e:b.o("Unable to construct a Model from: "+e);if(t===null){const s=vt.LO(i);s===null||s instanceof vt?t=s:b.o("Unable to construct a Model of declared class: "+i.class)}return t===null&&(t=vt.constructGraphLinksModel()),t.Ty(i),t.kN(i),t}static fromJSON(e,t){return this.fromJson(e,t)}static constructGraphLinksModel(){return new vt}static LO(e){let t=null,i=e.class;if(typeof i=="string")try{let s=null;i.indexOf("go.")===0?(i=i.substring(3),s=vt.I1(i)):(s=vt.I1(i),s===null&&(s=Z[i])),typeof s=="function"&&(t=new s)}catch{}return t}replaceJsonObjects(e){if(Array.isArray(e)){const t=e.length;for(let i=0;i<t;i++){const s=e[i];b.wt(s)&&(e[i]=this.replaceJsonObjects(s))}}else if(b.wt(e)){for(const t in e){const i=e[t];if(b.wt(i)){const s=this.replaceJsonObjects(i);if(e[t]=s,t==="points"&&Array.isArray(s)){let n=s.length%2===0;for(let o=0;o<s.length;o++)if(typeof s[o]!="number"){n=!1;break}if(n){const o=new J;for(let r=0;r<s.length/2;r++)o.add(new S(s[r*2],s[r*2+1]));o.g(),e[t]=o}}}}return this.AO(e)}return e}writeJsonValue(e){return e===void 0?"undefined":e===null?"null":e===!0?"true":e===!1?"false":typeof e=="string"?this.Fe(e):typeof e=="number"?e===1/0?"9e9999":e===-1/0?"-9e9999":isNaN(e)?'{"class":"NaN"}':e.toString():e instanceof Date?'{"class":"Date", "value":"'+e.toJSON()+'"}':e instanceof Number?this.writeJsonValue(e.valueOf()):Array.isArray(e)?this.Ch(e):b.wt(e)?this.FT(e):typeof e=="function"?"null":e.toString()}Ch(e,t){t===void 0&&(t=!1);const i=e.length;if(i<=0)return"[]";const s=new me;s.add("["),t&&i>1&&s.add(`
`);for(let n=0;n<i;n++){const o=e[n];o!==void 0&&(n>0&&(s.add(","),t&&s.add(`
`)),s.add(this.writeJsonValue(o)))}return t&&i>1&&s.add(`
`),s.add("]"),s.toString()}v1(e,t,i){return i===void 0||t==="__gohashid"||t[0]==="_"||typeof i=="function"}Xi(e){return isNaN(e)?"NaN":e===1/0?"9e9999":e===-1/0?"-9e9999":e}FT(e){const t=e;if(t instanceof S)e={class:"go.Point",x:this.Xi(t.x),y:this.Xi(t.y)};else if(t instanceof ut)e={class:"go.Size",width:this.Xi(t.width),height:this.Xi(t.height)};else if(t instanceof z)e={class:"go.Rect",x:this.Xi(t.x),y:this.Xi(t.y),width:this.Xi(t.width),height:this.Xi(t.height)};else if(t instanceof Kt)e={class:"go.Margin",top:this.Xi(t.top),right:this.Xi(t.right),bottom:this.Xi(t.bottom),left:this.Xi(t.left)};else if(t instanceof B)t.isSpot()?e={class:"go.Spot",x:this.Xi(t.x),y:this.Xi(t.y),offsetX:this.Xi(t.offsetX),offsetY:this.Xi(t.offsetY)}:e={class:"go.Spot",enum:t.toString()};else if(t instanceof jt){if(e={class:"go.Brush",type:Bi[t.type]},t.type===1?e.color=t.color:(t.type===2||t.type===3)&&(e.start=t.start,e.end=t.end,t.type===3&&(t.startRadius!==0&&(e.startRadius=this.Xi(t.startRadius)),isNaN(t.endRadius)||(e.endRadius=this.Xi(t.endRadius)))),t.colorStops!==null){const n={},o=t.colorStops.iterator;for(;o.next();){const r=o.key,a=o.value;n[r]=a}e.colorStops=n}}else if(t instanceof Ft)e={class:"go.Geometry",type:pi[t.type]},t.startX!==0&&(e.startX=this.Xi(t.startX)),t.startY!==0&&(e.startY=this.Xi(t.startY)),t.endX!==0&&(e.endX=this.Xi(t.endX)),t.endY!==0&&(e.endY=this.Xi(t.endY)),t.spot1.equals(B.TopLeft)||(e.spot1=t.spot1),t.spot2.equals(B.BottomRight)||(e.spot2=t.spot2),t.type===4&&(e.path=Ft.stringify(t));else if(vt.I1(b.sn(t))!==null)return b.ii("ERROR: trying to convert a GraphObject or Diagram or Model or Tool or Layout or UndoManager or other unknown data type into JSON text: "+t.toString()),"{}";let i="{",s=!0;for(const n in e){const o=vt.vt(e,n);if(!this.v1(e,n,o))if(s?s=!1:i+=",",i+=this.Fe(n)+":",n==="points"&&o instanceof J){const r=o;let a="[";const h=r.iterator;for(;h.next();){const l=h.value;a.length>1&&(a+=","),a+=this.IT(l.x),a+=",",a+=this.IT(l.y)}a+="]",i+=a}else i+=this.writeJsonValue(o)}return i+="}",i}IT(e){if(e===1/0)return"9e9999";if(e===-1/0)return"-9e9999";if(isNaN(e))return"0";const t=this.pointsDigits;return t>16?e.toString():e.toFixed(t)}get pointsDigits(){return this.Ay}set pointsDigits(e){e<0?e=0:e>100&&(e=100),this.Ay=e}Ki(e){return typeof e=="number"?e:e==="NaN"?NaN:e==="9e9999"?1/0:e==="-9e9999"?-1/0:parseFloat(e)}AO(e){if(typeof e!="object")return e;let t=e.class||"";if(typeof t!="string"||t==="")return e;if(t==="NaN")return NaN;if(t==="Date")return new Date(e.value);if(t.indexOf("go.")!==0)return e;t=t.substring(3);let i=e;if(t==="Point")i=new S(this.Ki(e.x),this.Ki(e.y));else if(t==="Size")i=new ut(this.Ki(e.width),this.Ki(e.height));else if(t==="Rect")i=new z(this.Ki(e.x),this.Ki(e.y),this.Ki(e.width),this.Ki(e.height));else if(t==="Margin")i=new Kt(this.Ki(e.top),this.Ki(e.right),this.Ki(e.bottom),this.Ki(e.left));else if(t==="Spot")typeof e.enum=="string"?i=B.parse(e.enum):i=new B(this.Ki(e.x),this.Ki(e.y),this.Ki(e.offsetX),this.Ki(e.offsetY));else if(t==="Brush"){const s=new jt;s.type=b.Ih(Bi,e.type)??1,typeof e.color=="string"&&(s.color=e.color),e.start instanceof B&&(s.start=e.start),e.end instanceof B&&(s.end=e.end),typeof e.startRadius=="number"&&(s.startRadius=this.Ki(e.startRadius)),typeof e.endRadius=="number"&&(s.endRadius=this.Ki(e.endRadius));const n=e.colorStops;if(b.wt(n))for(const o in n){const r=parseFloat(o);s.addColorStop(r,n[o])}i=s}else if(t==="Geometry"){let s=null;typeof e.path=="string"?s=Ft.parse(e.path):s=new Ft,s.type=b.Ih(pi,e.type)??1,typeof e.startX=="number"&&(s.startX=this.Ki(e.startX)),typeof e.startY=="number"&&(s.startY=this.Ki(e.startY)),typeof e.endX=="number"&&(s.endX=this.Ki(e.endX)),typeof e.endY=="number"&&(s.endY=this.Ki(e.endY)),e.spot1 instanceof B&&(s.spot1=e.spot1),e.spot2 instanceof B&&(s.spot2=e.spot2),i=s}else if(t==="EnumValue"){let s=e.classType;s.indexOf("go.")===0&&(s=s.substring(3));const n=vt.I1(s);typeof n=="function"&&(i=b.Ih(n,e.name))}return i}get name(){return this.Mt}set name(e){const t=this.Mt;t!==e&&(b.i(e,"string",vt,"name"),this.Mt=e,this.t("name",t,e))}get dataFormat(){return this._d}set dataFormat(e){const t=this._d;t!==e&&(b.i(e,"string",vt,"dataFormat"),this._d=e,this.t("dataFormat",t,e))}get isReadOnly(){return this.vo}set isReadOnly(e){const t=this.vo;t!==e&&(b.i(e,"boolean",vt,"isReadOnly"),this.vo=e,this.t("isReadOnly",t,e))}get modelData(){return this.D1}set modelData(e){const t=this.D1;t!==e&&(b.i(e,"object",vt,"modelData"),this.D1=e,this.t("modelData",t,e),this.updateTargetBindings(e))}addChangedListener(e){return b.i(e,"function",vt,"addChangedListener:listener"),this.F1.add(e),this}removeChangedListener(e){b.i(e,"function",vt,"removeChangedListener:listener"),this.F1.delete(e)}Ew(e){this.skipsUndoManager||this.undoManager.handleChanged(e);const t=this.F1,i=t.length;for(let s=0;s<i;s++)t.elt(s)(e)}raiseChangedEvent(e,t,i,s,n,o,r){this.Et("",e,t,i,s,n,o,r)}raiseChanged(e,t,i,s,n){this.Et("",2,e,this,t,i,s,n)}t(e,t,i,s,n){this.Et("",2,e,this,t,i,s,n)}raiseDataChanged(e,t,i,s,n,o){this.Et("",2,t,e,i,s,n,o)}Et(e,t,i,s,n,o,r,a){r===void 0&&(r=null),a===void 0&&(a=null);const h=new ci;h.model=this,h.change=t,h.modelChange=e,h.propertyName=i,h.object=s,h.oldValue=n,h.oldParam=r,h.newValue=o,h.newParam=a,this.Ew(h)}get undoManager(){return this.R1}set undoManager(e){const t=this.R1;t!==e&&(t!==null&&t.removeModel(this),this.R1=e,e!==null&&e.addModel(this))}get skipsUndoManager(){return this.Ro}set skipsUndoManager(e){b.i(e,"boolean",vt,"skipsUndoManager"),this.Ro=e}changeState(e,t){if(e!==null&&e.model===this)if(e.change===2){const i=e.object,s=e.propertyName,n=e.getValue(t);if(s===this.nodeKeyProperty&&this.containsNodeData(i)){const o=e.getValue(!t);o!==void 0&&this.ti.delete(o),n!==void 0&&this.ti.set(n,i)}vt.rt(i,s,n)}else if(e.change===3){const i=e.newParam;if(e.modelChange==="nodeDataArray"){const s=e.newValue;if(b.wt(s)&&typeof i=="number"){const n=this.getKeyForNodeData(s);t?(this.De[i]===s&&b.tc(this.De,i),n!==void 0&&this.ti.delete(n)):(this.De[i]!==s&&b.eu(this.De,i,s),n!==void 0&&this.ti.set(n,s))}}else if(e.modelChange===""){let s=e.object;if(s&&!Array.isArray(s)&&e.propertyName&&(s=vt.vt(e.object,e.propertyName)),Array.isArray(s)&&typeof i=="number"){const n=e.newValue;t?b.tc(s,i):b.eu(s,i,n)}}else b.o("unknown ChangeType.Insert modelChange: "+e.toString())}else if(e.change===4){const i=e.oldParam;if(e.modelChange==="nodeDataArray"){const s=e.oldValue;if(b.wt(s)&&typeof i=="number"){const n=this.getKeyForNodeData(s);t?(this.De[i]!==s&&b.eu(this.De,i,s),n!==void 0&&this.ti.set(n,s)):(this.De[i]===s&&b.tc(this.De,i),n!==void 0&&this.ti.delete(n))}}else if(e.modelChange===""){let s=e.object;if(s&&!Array.isArray(s)&&e.propertyName&&(s=vt.vt(e.object,e.propertyName)),Array.isArray(s)&&typeof i=="number"){const n=e.oldValue;t?b.eu(s,i,n):b.tc(s,i)}}else b.o("unknown ChangeType.Remove modelChange: "+e.toString())}else e.change===1||b.o("unknown ChangedEvent: "+e.toString())}startTransaction(e){return this.undoManager.startTransaction(e)}commitTransaction(e){return this.undoManager.commitTransaction(e)}rollbackTransaction(){return this.undoManager.rollbackTransaction()}commit(e,t){let i=t;i===void 0&&(i="");const s=this.skipsUndoManager;i===null&&(this.skipsUndoManager=!0,i=""),this.undoManager.startTransaction(i);let n=!1;try{e(this),n=!0}finally{n?this.undoManager.commitTransaction(i):this.undoManager.rollbackTransaction(),this.skipsUndoManager=s}}updateTargetBindings(e,t){t===void 0&&(t=""),this.Et("SourceChanged",1,t,e,null,null)}get nodeKeyProperty(){return this.Nh}set nodeKeyProperty(e){const t=this.Nh;t!==e&&(this.An(e,vt,"nodeKeyProperty"),e===""&&b.o("Model.nodeKeyProperty may not be the empty string"),this.ti.count>0&&b.o("Cannot set Model.nodeKeyProperty when there is existing node data"),this.Nh=e,this.t("nodeKeyProperty",t,e))}An(e,t,i){}getKeyForNodeData(e){if(e===null)return;const t=this.Nh;if(t==="")return;const i=vt.vt(e,t);if(i!==void 0){if(this.isKeyType(i))return i;b.o("Key value for node data "+e+" is not a number or a string: "+i)}}setKeyForNodeData(e,t){if((t==null||!this.isKeyType(t))&&b.we(t,"number or string",vt,"setKeyForNodeData:key"),e===null)return;const i=this.Nh;if(i==="")return;if(!this.containsNodeData(e)){vt.rt(e,i,t);return}const s=vt.vt(e,i);if(s!==t){if(this.findNodeDataForKey(t)!==null)return;vt.rt(e,i,t),s!==void 0&&this.ti.delete(s),this.ti.set(t,e),this.Et("nodeKey",2,i,e,s,t),typeof i=="string"&&this.updateTargetBindings(e,i),this.Fy(s,t)}}get makeUniqueKeyFunction(){return this.Df}set makeUniqueKeyFunction(e){const t=this.Df;t!==e&&(e!==null&&b.i(e,"function",vt,"makeUniqueKeyFunction"),this.Df=e,this.t("makeUniqueKeyFunction",t,e))}isKeyType(e){return typeof e=="number"||typeof e=="string"}containsNodeData(e){if(e===null)return!1;const t=this.getKeyForNodeData(e);return t===void 0?!1:this.ti.get(t)===e}findNodeDataForKey(e){return e===null&&b.o("Model.findNodeDataForKey:key must not be null"),e===void 0||!this.isKeyType(e)?null:this.ti.get(e)}get nodeDataArray(){return this.De}set nodeDataArray(e){const t=this.De;if(t!==e){this.ti.clear(),this.MN();const i=e.length;for(let o=0;o<i;o++){const r=e[o];b.wt(r)||b.o("Model.nodeDataArray must only contain Objects, not: "+r)}this.De=e;const s=new J;for(let o=0;o<i;o++){const r=e[o],a=this.getKeyForNodeData(r);a===void 0||this.ti.get(a)!==null?s.add(r):this.ti.set(a,r)}const n=s.iterator;for(;n.next();){const o=n.value;this.makeNodeDataKeyUnique(o);const r=this.getKeyForNodeData(o);r!==void 0&&this.ti.set(r,o)}this.Et("nodeDataArray",2,"nodeDataArray",this,t,e);for(let o=0;o<i;o++){const r=e[o];this.ag(r),this.cg(r)}}}makeNodeDataKeyUnique(e){if(e===null)return;const t=this.Nh;if(t==="")return;let i=this.getKeyForNodeData(e);if(i!==void 0&&!this.ti.has(i))return;const s=this.Df;if(s!==null&&(i=s(this,e),i!=null&&!this.ti.has(i))){vt.rt(e,t,i);return}if(typeof i=="string"){let n=2;for(;this.ti.has(i+n);)n++;vt.rt(e,t,i+n)}else if(i===void 0||typeof i=="number"){let n=-this.ti.count-1;for(;this.ti.has(n);)n--;vt.rt(e,t,n)}}addNodeData(e){e!==null&&(this.containsNodeData(e)||this.bT(e,!0))}bT(e,t){let i=this.getKeyForNodeData(e);if(i===void 0)this.makeNodeDataKeyUnique(e),i=this.getKeyForNodeData(e);else{if(this.ti.get(i)===e)return;this.makeNodeDataKeyUnique(e),i=this.getKeyForNodeData(e)}i===void 0&&b.o("Model.makeNodeDataKeyUnique failed on "+e+".  Data not added to Model."),this.ti.set(i,e);let s=null;t&&(s=this.De.length,b.eu(this.De,s,e)),this.Et("nodeDataArray",3,"nodeDataArray",this,null,e,null,s),this.ag(e),this.cg(e)}addNodeDataCollection(e){if(Array.isArray(e)){const t=e.length;for(let i=0;i<t;i++)this.addNodeData(e[i])}else{const t=e.iterator;for(;t.next();){const i=t.value;this.addNodeData(i)}}}removeNodeData(e){e!==null&&this.xT(e,!0)}xT(e,t){const i=this.getKeyForNodeData(e);i!==void 0&&this.ti.delete(i);let s=null;if(t){if(s=this.De.indexOf(e),s<0)return;b.tc(this.De,s)}this.Et("nodeDataArray",4,"nodeDataArray",this,e,null,s,null),this.Ry(e)}removeNodeDataCollection(e){if(Array.isArray(e)){const t=e.length;for(let i=0;i<t;i++)this.removeNodeData(e[i])}else{const t=e.iterator;for(;t.next();){const i=t.value;this.removeNodeData(i)}}}mergeNodeDataArray(e){if(e!==this.nodeDataArray&&Array.isArray(e)){const t=this.ng;t.clear(),t.addAll(this.ti.iteratorKeys);const i=this.og;i.clear();const s=e.length;for(let o=0;o<s;o++){const r=e[o],a=this.getKeyForNodeData(r);if(a!==void 0){i.add(a);const h=this.findNodeDataForKey(a);if(h===r)continue;if(h!==null)this.assignAllDataProperties(h,r),this.hg(r,h);else{const l=this.cloneDeep(r);this.setKeyForNodeData(l,a),this.addNodeData(l)}}else{const h=this.cloneDeep(r);this.addNodeData(h),i.add(this.getKeyForNodeData(h))}}const n=t.iterator;for(;n.next();){const o=n.value;if(!i.has(o)){const r=this.findNodeDataForKey(o);r&&this.removeNodeData(r)}}t.clear(),i.clear()}}Fy(e,t){if(t===void 0)return;const i=this.Cy(e);i instanceof K&&this.er.set(t,i)}MN(){}ag(e){}cg(e){}Ry(e){}$s(e,t){if(e===void 0)return;let i=this.er.get(e);i===null&&(i=new K,this.er.set(e,i)),i.add(t)}Js(e,t){if(e===void 0)return;const i=this.er.get(e);i instanceof K&&(t==null?this.er.delete(e):(i.delete(t),i.count===0&&this.er.delete(e)))}Cy(e){if(e===void 0)return null;const t=this.er.get(e);return t instanceof K?t:null}pE(e){e===void 0?this.er.clear():this.er.delete(e)}get copyNodeDataFunction(){return this.Ff}set copyNodeDataFunction(e){const t=this.Ff;t!==e&&(e!==null&&b.i(e,"function",vt,"copyNodeDataFunction"),this.Ff=e,this.t("copyNodeDataFunction",t,e))}get copiesArrays(){return this.tg}set copiesArrays(e){const t=this.tg;t!==e&&(e!==null&&b.i(e,"boolean",vt,"copiesArrays"),this.tg=e,this.t("copiesArrays",t,e))}get copiesArrayObjects(){return this.ig}set copiesArrayObjects(e){const t=this.ig;t!==e&&(e!==null&&b.i(e,"boolean",vt,"copiesArrayObjects"),this.ig=e,this.t("copiesArrayObjects",t,e))}get copiesKey(){return this.eg}set copiesKey(e){const t=this.eg;t!==e&&(e!==null&&b.i(e,"boolean",vt,"copiesKey"),this.eg=e,this.t("copiesKey",t,e))}copyNodeData(e){if(e===null)return null;let t=null;const i=this.Ff;return i!==null?t=i(e,this):t=this.E1(e,!0),t}E1(e,t){if(this.copiesArrays&&Array.isArray(e)){const i=e,s=[];for(let n=0;n<i.length;n++){const o=i[n],r=this.E1(o,this.copiesArrayObjects);s.push(r)}return s}else if(t&&b.wt(e)){const i=e,s=i.constructor,n=s?new s:{},o=!this.copiesKey&&typeof this.nodeKeyProperty=="string"?this.nodeKeyProperty:null;for(const r in i){if(r==="__gohashid"){n.__gohashid=void 0;continue}if(r===o){n[o]=void 0;continue}const a=vt.vt(i,r);if(this.TO(i,r,a))vt.rt(n,r,a);else{const h=this.E1(a,!1);vt.rt(n,r,h)}}return n}else return e instanceof S||e instanceof ut||e instanceof z||e instanceof B||e instanceof Kt?e.copy():e}get afterCopyFunction(){return this.sg}set afterCopyFunction(e){const t=this.sg;t!==e&&(e!==null&&b.i(e,"function",vt,"afterCopyFunction"),this.sg=e,this.t("afterCopyFunction",t,e))}TO(e,t,i){const s=b.sn(i);return s==="GraphObject"||s==="Diagram"||s==="Layer"||s==="RowColumnDefinition"||s==="AnimationManager"||s==="Tool"||s==="CommandHandler"||s==="Layout"||s==="InputEvent"||s==="DiagramEvent"?!0:i instanceof vt||i instanceof Li||i instanceof pe||i instanceof ci}setDataProperty(e,t,i){if(this.containsNodeData(e)){if(t===this.nodeKeyProperty){this.setKeyForNodeData(e,i);return}else if(t===this.nodeCategoryProperty){this.setCategoryForNodeData(e,i);return}}else!vt.ET&&e instanceof he&&(vt.ET=!0,b.ii('Model.setDataProperty is modifying a GraphObject, "'+e.toString()+'"'),b.ii("  Is that really your intent?"));const s=vt.vt(e,t);s!==i&&(vt.rt(e,t,i),this.raiseDataChanged(e,t,s,i))}set(e,t,i){this.setDataProperty(e,t,i)}assignAllDataProperties(e,t){if(!t)return;const i=this.containsNodeData(e);for(const s in t)s!=="__gohashid"&&(i&&s===this.nodeKeyProperty||this.setDataProperty(e,s,t[s]))}addArrayItem(e,t){this.insertArrayItem(e,-1,t)}insertArrayItem(e,t,i){t<0&&(t=e.length),b.eu(e,t,i),this.Et("",3,"",e,null,i,null,t)}removeArrayItem(e,t){t===void 0&&(t=-1),e===this.De&&b.o("Model.removeArrayItem should not be called on the Model.nodeDataArray"),t===-1&&(t=e.length-1);const i=e[t];b.tc(e,t),this.Et("",4,"",e,i,null,t,null)}get nodeCategoryProperty(){return this.Xa}set nodeCategoryProperty(e){const t=this.Xa;t!==e&&(this.An(e,vt,"nodeCategoryProperty"),this.Xa=e,this.t("nodeCategoryProperty",t,e))}getCategoryForNodeData(e){if(e===null)return"";const t=this.Xa;if(t==="")return"";const i=vt.vt(e,t);if(i===void 0)return"";if(typeof i=="string")return i;b.o("getCategoryForNodeData found a non-string category for "+e+": "+i)}setCategoryForNodeData(e,t){if(b.i(t,"string",vt,"setCategoryForNodeData:cat"),e===null)return;const i=this.Xa;if(i==="")return;if(!this.containsNodeData(e)){vt.rt(e,i,t);return}let s=vt.vt(e,i);s===void 0&&(s=""),s!==t&&(vt.rt(e,i,t),this.Et("nodeCategory",2,i,e,s,t))}hg(e,t){this.setCategoryForNodeData(t,this.getCategoryForNodeData(e))}get type(){return"Model"}pc(){return!1}gc(){return!1}ju(){return!1}Ta(){return!1}Xw(){return!1}qc(){return!1}static initDiagramModel(){return new vt}static I1(e){return vt.classMap[e]?vt.classMap[e]:Z.go!==void 0&&Z.go[e]?Z.go[e]:null}static registerClass(e,t){vt.classMap[t]=e}static vt(e,t){if(!e||!t)return null;let i;try{typeof t=="function"?i=t(e):typeof e.getAttribute=="function"?(i=e.getAttribute(t),i===null&&(i=void 0)):i=e[t]}catch{}return i}static rt(e,t,i){if(!(!e||!t))try{typeof t=="function"?t(e,i):typeof e.setAttribute=="function"?e.setAttribute(t,i):e[t]=i}catch{}}};f(vt,"ET",!1),f(vt,"classMap",{}),vt.registerClass(jt,"Brush"),vt.registerClass(ci,"ChangedEvent"),vt.registerClass(Ft,"Geometry"),vt.registerClass(Kt,"Margin"),vt.registerClass(ct,"Panel"),vt.registerClass(S,"Point"),vt.registerClass(z,"Rect"),vt.registerClass(ut,"Size"),vt.registerClass(B,"Spot"),vt.registerClass(pe,"Transaction"),vt.registerClass(Li,"UndoManager");let mt=vt;mt.fromJSON=mt.fromJson=mt.fromJson;const ge=class ge extends mt{constructor(t,i,s){super();f(this,"$e");f(this,"sr");f(this,"fi");f(this,"Lh");f(this,"Rf");f(this,"vf");f(this,"Ll");f(this,"wo");f(this,"xo");f(this,"Ya");f(this,"Ga");f(this,"ja");f(this,"Zs");f(this,"Of");f(this,"Tn");f(this,"fg");f(this,"UT",`,
  "insertedLinkKeys": `);f(this,"DO",`,
  "modifiedLinkData": `);f(this,"VT",`,
  "removedLinkKeys": `);if(this.$e=[],this.sr=new K,this.fi=new St,this.Lh="",this.Rf=null,this.vf=null,this.Ll=null,this.wo="from",this.xo="to",this.Ya="",this.Ga="",this.ja="category",this.Zs="",this.Of="isGroup",this.Tn="group",this.fg=!1,i!==void 0&&(this.linkDataArray=i),t!==void 0&&(Array.isArray(t)?this.nodeDataArray=t:s=t),s){Object.assign(this,s);const n=s.Changed;n&&(delete this.Changed,this.addChangedListener(n))}}cloneProtected(t){super.cloneProtected(t),t.Lh=this.Lh,t.Rf=this.Rf,t.vf=this.vf,t.wo=this.wo,t.xo=this.xo,t.Ya=this.Ya,t.Ga=this.Ga,t.ja=this.ja,t.Zs=this.Zs,t.Of=this.Of,t.Tn=this.Tn,t.fg=this.fg}clear(){super.clear(),this.$e=[],this.fi.clear(),this.sr.clear()}toString(t){if(t===void 0&&(t=0),t>=2)return this.toJson();{let i=(this.name!==""?this.name:"")+" GraphLinksModel";if(t>0){i+=`
 node data:`;let s=this.nodeDataArray,n=s.length,o=0;for(o=0;o<n;o++){const r=s[o];i+=" "+this.getKeyForNodeData(r)+":"+bi.toString(r)}for(i+=`
 link data:`,s=this.linkDataArray,n=s.length,o=0;o<n;o++){const r=s[o];i+=" "+this.Te(r,!0)+"-->"+this.Te(r,!1)}}return i}}xN(t,i){if(this.linkKeyProperty===""){const d=this.skipsUndoManager;this.skipsUndoManager=!0,this.linkKeyProperty="key",this.skipsUndoManager=d}let s=super.xN(t,i);const n=this,o=new K,r=new K,a=new K,h=this.Ka;t.changes.each(d=>{if(d.model===n){if(d.modelChange==="linkDataArray")d.change===3?o.add(d.newValue):d.change===4&&a.add(d.oldValue);else if(n.containsLinkData(d.object))r.add(d.object);else if(d.object!==null)if(d.object!==null&&h&&h.has(d.object))h.get(d.object).each(m=>{n.containsLinkData(m)&&r.add(m)});else{if(d.object instanceof mt||n.containsNodeData(d.object))return;n.BT(d.object).each(m=>r.add(m))}}});const l=this.og;l.clear(),o.each(d=>{l.add(n.getKeyForLinkData(d)),i||r.add(d)});const u=this.ng;u.clear(),a.each(d=>{u.add(n.getKeyForLinkData(d)),i&&r.add(d)});const c=n.cloneDeep(r.toArray());return l.count>0&&(s===null&&(s={}),i?s.removedLinkKeys=l.toArray():s.insertedLinkKeys=l.toArray()),c.length>0&&(s===null&&(s={}),s.modifiedLinkData=c),u.count>0&&(s===null&&(s={}),i?s.insertedLinkKeys=u.toArray():s.removedLinkKeys=u.toArray()),u.clear(),l.clear(),s}lg(){const t=super.lg();let i="";return this.linkCategoryProperty!=="category"&&typeof this.linkCategoryProperty=="string"&&(i+=`,
  "linkCategoryProperty": `+this.Fe(this.linkCategoryProperty)),this.linkKeyProperty!==""&&typeof this.linkKeyProperty=="string"&&(i+=`,
  "linkKeyProperty": `+this.Fe(this.linkKeyProperty)),this.linkFromKeyProperty!=="from"&&typeof this.linkFromKeyProperty=="string"&&(i+=`,
  "linkFromKeyProperty": `+this.Fe(this.linkFromKeyProperty)),this.linkToKeyProperty!=="to"&&typeof this.linkToKeyProperty=="string"&&(i+=`,
  "linkToKeyProperty": `+this.Fe(this.linkToKeyProperty)),this.linkFromPortIdProperty!==""&&typeof this.linkFromPortIdProperty=="string"&&(i+=`,
  "linkFromPortIdProperty": `+this.Fe(this.linkFromPortIdProperty)),this.linkToPortIdProperty!==""&&typeof this.linkToPortIdProperty=="string"&&(i+=`,
  "linkToPortIdProperty": `+this.Fe(this.linkToPortIdProperty)),this.linkLabelKeysProperty!==""&&typeof this.linkLabelKeysProperty=="string"&&(i+=`,
  "linkLabelKeysProperty": `+this.Fe(this.linkLabelKeysProperty)),this.nodeIsGroupProperty!=="isGroup"&&typeof this.nodeIsGroupProperty=="string"&&(i+=`,
  "nodeIsGroupProperty": `+this.Fe(this.nodeIsGroupProperty)),this.nodeGroupKeyProperty!=="group"&&typeof this.nodeGroupKeyProperty=="string"&&(i+=`,
  "nodeGroupKeyProperty": `+this.Fe(this.nodeGroupKeyProperty)),t+i}Ty(t){super.Ty(t),t.linkKeyProperty&&(this.linkKeyProperty=t.linkKeyProperty),t.linkFromKeyProperty&&(this.linkFromKeyProperty=t.linkFromKeyProperty),t.linkToKeyProperty&&(this.linkToKeyProperty=t.linkToKeyProperty),t.linkFromPortIdProperty&&(this.linkFromPortIdProperty=t.linkFromPortIdProperty),t.linkToPortIdProperty&&(this.linkToPortIdProperty=t.linkToPortIdProperty),t.linkCategoryProperty&&(this.linkCategoryProperty=t.linkCategoryProperty),t.linkLabelKeysProperty&&(this.linkLabelKeysProperty=t.linkLabelKeysProperty),t.nodeIsGroupProperty&&(this.nodeIsGroupProperty=t.nodeIsGroupProperty),t.nodeGroupKeyProperty&&(this.nodeGroupKeyProperty=t.nodeGroupKeyProperty)}bN(){const t=super.bN(),i=`,
  "linkDataArray": `+this.Ch(this.linkDataArray,!0);return t+i}kN(t){super.kN(t);const i=t.linkDataArray;Array.isArray(i)&&(this.replaceJsonObjects(i),this.linkDataArray=i)}BT(t){const i=new K;for(let s=0;s<this.linkDataArray.length;s++){const n=this.linkDataArray[s];this.O1(t,n,n,i)}return i}SN(t,i){if(this.linkKeyProperty===""){const d=this.skipsUndoManager;this.skipsUndoManager=!0,this.linkKeyProperty="key",this.skipsUndoManager=d}const s=super.SN(t,i),n=this,o=new K,r=new K,a=new K,h=this.Ka;t.changes.each(d=>{if(d.model===n){if(d.modelChange==="linkDataArray")d.change===3?o.add(d.newValue):d.change===4&&a.add(d.oldValue);else if(n.containsLinkData(d.object))r.add(d.object);else if(d.object!==null)if(d.object!==null&&h&&h.has(d.object))h.get(d.object).each(m=>{n.containsLinkData(m)&&r.add(m)});else{if(d.object instanceof mt||n.containsNodeData(d.object))return;n.BT(d.object).each(m=>r.add(m))}}});const l=this.og;l.clear(),o.each(d=>{l.add(n.getKeyForLinkData(d)),i||r.add(d)});const u=this.ng;u.clear(),a.each(d=>{u.add(n.getKeyForLinkData(d)),i&&r.add(d)});let c=s;return l.count>0&&(c+=(i?this.VT:this.UT)+this.Ch(l.toArray(),!0)),r.count>0&&(c+=this.DO+this.Ch(r.toArray(),!0)),u.count>0&&(c+=(i?this.UT:this.VT)+this.Ch(u.toArray(),!0)),u.clear(),l.clear(),c}Dy(t){(t.linkCategoryProperty!==void 0&&t.linkCategoryProperty!==this.linkCategoryProperty||t.linkKeyProperty!==void 0&&t.linkKeyProperty!==this.linkKeyProperty||t.linkFromKeyProperty!==void 0&&t.linkFromKeyProperty!==this.linkFromKeyProperty||t.linkToKeyProperty!==void 0&&t.linkToKeyProperty!==this.linkToKeyProperty||t.linkFromPortIdProperty!==void 0&&t.linkFromPortIdProperty!==this.linkFromPortIdProperty||t.linkToPortIdProperty!==void 0&&t.linkToPortIdProperty!==this.linkToPortIdProperty||t.linkLabelKeysProperty!==void 0&&t.linkLabelKeysProperty!==this.linkLabelKeysProperty||t.nodeIsGroupProperty!==void 0&&t.nodeIsGroupProperty!==this.nodeIsGroupProperty||t.nodeGroupKeyProperty!==void 0&&t.nodeGroupKeyProperty!==this.nodeGroupKeyProperty)&&b.o("applyIncrementalJson cannot change Model properties"),super.Dy(t);const i=t.insertedLinkKeys;if(Array.isArray(i)){const o=i.length;for(let r=0;r<o;r++){const a=i[r];let h=this.findLinkDataForKey(a);h===null&&(h=this.copyLinkData({}),this.setKeyForLinkData(h,a),this.addLinkData(h))}}const s=t.modifiedLinkData;if(Array.isArray(s)){const o=s.length;for(let r=0;r<o;r++){const a=s[r],h=this.getKeyForLinkData(a),l=this.findLinkDataForKey(h);if(l!==null){for(const u in a)u==="__gohashid"||u===this.linkKeyProperty||this.setDataProperty(l,u,a[u]);this.zT(a,l)}}}const n=t.removedLinkKeys;if(Array.isArray(n)){const o=n.length;for(let r=0;r<o;r++){const a=n[r],h=this.findLinkDataForKey(a);h!==null&&this.removeLinkData(h)}}}changeState(t,i){if(!(t===null||t.model!==this)){if(t.change===2){const s=t.object,n=t.propertyName;if(n===this.linkKeyProperty&&this.containsLinkData(s)){const o=t.getValue(i),r=t.getValue(!i);r!==void 0&&this.fi.delete(r),o!==void 0&&this.fi.set(o,s),mt.rt(s,n,o);return}}else if(t.change===3){let s=t.newParam;if(t.modelChange==="linkDataArray"){const n=t.newValue;if(b.wt(n)&&typeof s=="number"){const o=this.getKeyForLinkData(n);i?(this.sr.delete(n),this.$e[s]===n&&this.$e.splice(s,1),o!==void 0&&this.fi.delete(o)):(this.sr.add(n),this.$e[s]!==n&&this.$e.splice(s,0,n),o!==void 0&&this.fi.set(o,n))}return}else if(t.modelChange==="linkLabelKeys"){const n=this.getLabelKeysForLinkData(t.object);Array.isArray(n)&&typeof s=="number"&&(i?(s=n.indexOf(t.newValue),s>=0&&n.splice(s,1)):n.indexOf(t.newValue)<0&&n.splice(s,0,t.newValue));return}}else if(t.change===4){let s=t.oldParam;if(t.modelChange==="linkDataArray"){const n=t.oldValue;if(b.wt(n)&&typeof s=="number"){const o=this.getKeyForLinkData(n);i?(this.sr.add(n),this.$e[s]!==n&&this.$e.splice(s,0,n),o!==void 0&&this.fi.set(o,n)):(this.sr.delete(n),this.$e[s]===n&&this.$e.splice(s,1),o!==void 0&&this.fi.delete(o))}return}else if(t.modelChange==="linkLabelKeys"){const n=this.getLabelKeysForLinkData(t.object);Array.isArray(n)&&typeof s=="number"&&(i?n.indexOf(t.newValue)<0&&n.splice(s,0,t.newValue):(s=n.indexOf(t.newValue),s>=0&&n.splice(s,1)));return}}super.changeState(t,i)}}get archetypeNodeData(){return this.Ll}set archetypeNodeData(t){const i=this.Ll;i!==t&&(this.Ll=t,this.t("archetypeNodeData",i,t))}NN(t){if(t===void 0)return;const i=this.Ll;if(i!==null){let s=this.findNodeDataForKey(t);s===null&&(s=this.copyNodeData(i),mt.rt(s,this.nodeKeyProperty,t),this.addNodeData(s))}return t}get linkFromKeyProperty(){return this.wo}set linkFromKeyProperty(t){const i=this.wo;i!==t&&(this.An(t,ge,"linkFromKeyProperty"),this.wo=t,this.t("linkFromKeyProperty",i,t))}getFromKeyForLinkData(t){return this.Te(t,!0)}setFromKeyForLinkData(t,i){this.Zd(t,i,!0)}get linkToKeyProperty(){return this.xo}set linkToKeyProperty(t){const i=this.xo;i!==t&&(this.An(t,ge,"linkToKeyProperty"),this.xo=t,this.t("linkToKeyProperty",i,t))}getToKeyForLinkData(t){return this.Te(t,!1)}setToKeyForLinkData(t,i){this.Zd(t,i,!1)}Te(t,i){if(t===null)return;const s=i?this.wo:this.xo;if(s==="")return;const n=mt.vt(t,s);if(n!==void 0){if(this.isKeyType(n))return n;b.o((i?"FromKey":"ToKey")+" value for link data "+t+" is not a number or a string: "+n)}}Zd(t,i,s){if(i===null&&(i=void 0),i!==void 0&&!this.isKeyType(i)&&b.we(i,"number or string",ge,s?"setFromKeyForLinkData:key":"setToKeyForLinkData:key"),t===null)return;const n=s?this.wo:this.xo;if(n==="")return;if(i=this.NN(i),!this.containsLinkData(t)){mt.rt(t,n,i);return}const o=mt.vt(t,n);o!==i&&(this.Js(o,t),mt.rt(t,n,i),this.findNodeDataForKey(i)===null&&this.$s(i,t),this.Et(s?"linkFromKey":"linkToKey",2,n,t,o,i),typeof n=="string"&&this.updateTargetBindings(t,n))}get linkFromPortIdProperty(){return this.Ya}set linkFromPortIdProperty(t){const i=this.Ya;i!==t&&(this.An(t,ge,"linkFromPortIdProperty"),this.Ya=t,this.t("linkFromPortIdProperty",i,t))}getFromPortIdForLinkData(t){return this.L1(t,!0)}setFromPortIdForLinkData(t,i){this.Qd(t,i,!0)}get linkToPortIdProperty(){return this.Ga}set linkToPortIdProperty(t){const i=this.Ga;i!==t&&(this.An(t,ge,"linkToPortIdProperty"),this.Ga=t,this.t("linkToPortIdProperty",i,t))}getToPortIdForLinkData(t){return this.L1(t,!1)}setToPortIdForLinkData(t,i){this.Qd(t,i,!1)}L1(t,i){if(t===null)return"";const s=i?this.Ya:this.Ga;if(s==="")return"";const n=mt.vt(t,s);return n===void 0?"":n}Qd(t,i,s){if(t===null)return;const n=s?this.Ya:this.Ga;if(n==="")return;if(!this.containsLinkData(t)){mt.rt(t,n,i);return}let o=mt.vt(t,n);o===void 0&&(o=""),o!==i&&(mt.rt(t,n,i),this.Et(s?"linkFromPortId":"linkToPortId",2,n,t,o,i),typeof n=="string"&&this.updateTargetBindings(t,n))}get linkLabelKeysProperty(){return this.Zs}set linkLabelKeysProperty(t){const i=this.Zs;i!==t&&(this.An(t,ge,"linkLabelKeysProperty"),this.Zs=t,this.t("linkLabelKeysProperty",i,t))}getLabelKeysForLinkData(t){if(t===null)return ge.EmptyArray;const i=this.Zs;if(i==="")return ge.EmptyArray;const s=mt.vt(t,i);return s===void 0?ge.EmptyArray:s}setLabelKeysForLinkData(t,i){if(t===null)return;const s=this.Zs;if(s==="")return;if(!this.containsLinkData(t)){mt.rt(t,s,i);return}let n=mt.vt(t,s);if(n===void 0&&(n=ge.EmptyArray),n!==i){if(Array.isArray(n)){const r=n.length;for(let a=0;a<r;a++){const h=n[a];this.Js(h,t)}}mt.rt(t,s,i);const o=i.length;for(let r=0;r<o;r++){const a=i[r];this.findNodeDataForKey(a)===null&&this.$s(a,t)}this.Et("linkLabelKeys",2,s,t,n,i),typeof s=="string"&&this.updateTargetBindings(t,s)}}addLabelKeyForLinkData(t,i){if(i==null||(this.isKeyType(i)||b.we(i,"number or string",ge,"addLabelKeyForLinkData:key"),t===null))return;const s=this.Zs;if(s==="")return;const n=mt.vt(t,s);if(n===void 0){const o=[];o.push(i),this.setLabelKeysForLinkData(t,o)}else if(Array.isArray(n)){let o=n.indexOf(i);if(o>=0)return;o=n.length,n.push(i),this.containsLinkData(t)&&(this.findNodeDataForKey(i)===null&&this.$s(i,t),this.Et("linkLabelKeys",3,s,t,null,i,null,o))}else b.o(s+" property is not an Array; cannot addLabelKeyForLinkData: "+t)}removeLabelKeyForLinkData(t,i){if(i==null||(this.isKeyType(i)||b.we(i,"number or string",ge,"removeLabelKeyForLinkData:key"),t===null))return;const s=this.Zs;if(s==="")return;const n=mt.vt(t,s);if(Array.isArray(n)){const o=n.indexOf(i);if(o<0)return;n.splice(o,1),this.containsLinkData(t)&&(this.Js(i,t),this.Et("linkLabelKeys",4,s,t,i,null,o,null))}else n!==void 0&&b.o(s+" property is not an Array; cannot removeLabelKeyforLinkData: "+t)}get linkDataArray(){return this.$e}set linkDataArray(t){const i=this.$e;if(i!==t){this.fi.clear();const s=t.length;for(let o=0;o<s;o++){const r=t[o];b.wt(r)||b.o("GraphLinksModel.linkDataArray must only contain Objects, not: "+r)}if(this.$e=t,this.linkKeyProperty!==""){const o=new J;for(let a=0;a<s;a++){const h=t[a],l=this.getKeyForLinkData(h);l===void 0||this.fi.get(l)!==null?o.add(h):this.fi.set(l,h)}const r=o.iterator;for(;r.next();){const a=r.value;this.makeLinkDataKeyUnique(a);const h=this.getKeyForLinkData(a);h!==void 0&&this.fi.set(h,a)}}const n=new K;for(let o=0;o<s;o++){const r=t[o];n.add(r)}this.sr=n,this.Et("linkDataArray",2,"linkDataArray",this,i,t);for(let o=0;o<s;o++){const r=t[o];this.CN(r)}}}get linkKeyProperty(){return this.Lh}set linkKeyProperty(t){const i=this.Lh;if(i!==t){this.An(t,ge,"linkKeyProperty"),this.Lh=t,this.fi.clear();const s=this.linkDataArray.length;for(let n=0;n<s;n++){const o=this.linkDataArray[n];let r=this.getKeyForLinkData(o);r===void 0&&(this.makeLinkDataKeyUnique(o),r=this.getKeyForLinkData(o)),r!==void 0&&this.fi.set(r,o)}this.t("linkKeyProperty",i,t)}}getKeyForLinkData(t){if(t===null)return;const i=this.Lh;if(i==="")return;const s=mt.vt(t,i);if(s!==void 0){if(this.isKeyType(s))return s;b.o("Key value for link data "+t+" is not a number or a string: "+s)}}setKeyForLinkData(t,i){if((i==null||!this.isKeyType(i))&&b.we(i,"number or string",ge,"setKeyForLinkData:key"),t===null)return;const s=this.Lh;if(s==="")return;if(!this.containsLinkData(t)){mt.rt(t,s,i);return}const n=mt.vt(t,s);if(n!==i){if(this.findLinkDataForKey(i)!==null)return;mt.rt(t,s,i),n!==void 0&&this.fi.delete(n),this.fi.set(i,t),this.Et("linkKey",2,s,t,n,i),typeof s=="string"&&this.updateTargetBindings(t,s)}}get makeUniqueLinkKeyFunction(){return this.Rf}set makeUniqueLinkKeyFunction(t){const i=this.Rf;i!==t&&(this.Rf=t,this.t("makeUniqueLinkKeyFunction",i,t))}findLinkDataForKey(t){return t===null&&b.o("GraphLinksModel.findLinkDataForKey:key must not be null"),t===void 0||!this.isKeyType(t)?null:this.fi.get(t)}makeLinkDataKeyUnique(t){if(t===null)return;const i=this.Lh;if(i==="")return;let s=this.getKeyForLinkData(t);if(s!==void 0&&!this.fi.has(s))return;const n=this.Rf;if(n!==null&&(s=n(this,t),s!=null&&!this.fi.has(s))){mt.rt(t,i,s);return}if(typeof s=="string"){let o=2;for(;this.fi.has(s+o);)o++;mt.rt(t,i,s+o)}else if(s===void 0||typeof s=="number"){let o=-this.fi.count-1;for(;this.fi.has(o);)o--;mt.rt(t,i,o)}}containsLinkData(t){return t===null?!1:this.sr.has(t)}addLinkData(t){t!==null&&(this.containsLinkData(t)||this.CT(t,!0))}CT(t,i){if(this.linkKeyProperty!==""){let n=this.getKeyForLinkData(t);if(n===void 0)this.makeLinkDataKeyUnique(t),n=this.getKeyForLinkData(t);else{if(this.fi.get(n)===t)return;this.makeLinkDataKeyUnique(t),n=this.getKeyForLinkData(t)}n===void 0&&b.o("GraphLinksModel.makeLinkDataKeyUnique failed on "+t+". Data not added to model."),this.fi.set(n,t)}this.sr.add(t);let s=null;i&&(s=this.$e.length,this.$e.splice(s,0,t)),this.Et("linkDataArray",3,"linkDataArray",this,null,t,null,s),this.CN(t)}addLinkDataCollection(t){if(Array.isArray(t)){const i=t.length;for(let s=0;s<i;s++)this.addLinkData(t[s])}else{const i=t.iterator;for(;i.next();){const s=i.value;this.addLinkData(s)}}}removeLinkData(t){t!==null&&this.NT(t,!0)}NT(t,i){this.sr.delete(t);const s=this.getKeyForLinkData(t);s!==void 0&&this.fi.delete(s);let n=null;if(i){if(n=this.$e.indexOf(t),n<0)return;this.$e.splice(n,1)}this.Et("linkDataArray",4,"linkDataArray",this,t,null,n,null),this.FO(t)}removeLinkDataCollection(t){if(Array.isArray(t)){const i=t.length;for(let s=0;s<i;s++)this.removeLinkData(t[s])}else{const i=t.iterator;for(;i.next();){const s=i.value;this.removeLinkData(s)}}}mergeLinkDataArray(t){if(this.linkKeyProperty===""&&b.o("GraphLinksModel.linkKeyProperty must not be an empty string for .mergeLinkDataArray() to succeed."),t!==this.linkDataArray&&Array.isArray(t)){const i=this.ng;i.clear(),i.addAll(this.fi.iteratorKeys);const s=this.og;s.clear();const n=t.length;for(let r=0;r<n;r++){const a=t[r],h=this.getKeyForLinkData(a);if(h!==void 0){s.add(h);const l=this.findLinkDataForKey(h);if(l===a)continue;if(l!==null)this.assignAllDataProperties(l,a),this.zT(a,l);else{const u=this.cloneDeep(a);this.setKeyForLinkData(u,h),this.addLinkData(u)}}else{const l=this.cloneDeep(a);this.addLinkData(l),s.add(this.getKeyForLinkData(l))}}const o=i.iterator;for(;o.next();){const r=o.value;if(!s.has(r)){const a=this.findLinkDataForKey(r);a&&this.removeLinkData(a)}}i.clear(),s.clear()}}CN(t){let i=this.Te(t,!0);i=this.NN(i),this.findNodeDataForKey(i)===null&&this.$s(i,t),i=this.Te(t,!1),i=this.NN(i),this.findNodeDataForKey(i)===null&&this.$s(i,t);const s=this.getLabelKeysForLinkData(t);if(Array.isArray(s)){const n=s.length;for(let o=0;o<n;o++)i=s[o],this.findNodeDataForKey(i)===null&&this.$s(i,t)}}FO(t){let i=this.Te(t,!0);this.Js(i,t),i=this.Te(t,!1),this.Js(i,t);const s=this.getLabelKeysForLinkData(t);if(Array.isArray(s)){const n=s.length;for(let o=0;o<n;o++)i=s[o],this.Js(i,t)}}get copyLinkDataFunction(){return this.vf}set copyLinkDataFunction(t){const i=this.vf;i!==t&&(this.vf=t,this.t("copyLinkDataFunction",i,t))}copyLinkData(t){if(t===null)return null;let i=null;const s=this.vf;return s!==null?i=s(t,this):i=this.E1(t,!0),b.wt(i)&&(this.wo!==""&&mt.rt(i,this.wo,void 0),this.xo!==""&&mt.rt(i,this.xo,void 0),this.Zs!==""&&mt.rt(i,this.Zs,[])),i}get nodeIsGroupProperty(){return this.Of}set nodeIsGroupProperty(t){const i=this.Of;i!==t&&(this.An(t,ge,"nodeIsGroupProperty"),this.Of=t,this.t("nodeIsGroupProperty",i,t))}isGroupForNodeData(t){if(t===null)return!1;const i=this.Of;return i===""?!1:!!mt.vt(t,i)}isGroupForData(t){return this.isGroupForNodeData(t)}get nodeGroupKeyProperty(){return this.Tn}set nodeGroupKeyProperty(t){const i=this.Tn;i!==t&&(this.An(t,ge,"nodeGroupKeyProperty"),this.Tn=t,this.t("nodeGroupKeyProperty",i,t))}get copiesGroupKeyOfNodeData(){return this.fg}set copiesGroupKeyOfNodeData(t){this.fg!==t&&(this.fg=t)}getGroupKeyForNodeData(t){if(t===null)return;const i=this.Tn;if(i==="")return;const s=mt.vt(t,i);if(s!==void 0){if(this.isKeyType(s))return s;b.o("GroupKey value for node data "+t+" is not a number or a string: "+s)}}getGroupForData(t){return this.getGroupKeyForNodeData(t)}setGroupKeyForNodeData(t,i){if(i===null&&(i=void 0),i!==void 0&&!this.isKeyType(i)&&b.we(i,"number or string",ge,"setGroupKeyForNodeData:key"),t===null)return;const s=this.Tn;if(s==="")return;if(!this.containsNodeData(t)){mt.rt(t,s,i);return}const n=mt.vt(t,s);n!==i&&(this.Js(n,t),mt.rt(t,s,i),this.findNodeDataForKey(i)===null&&this.$s(i,t),this.Et("nodeGroupKey",2,s,t,n,i),typeof s=="string"&&this.updateTargetBindings(t,s))}setGroupForData(t,i){this.setGroupKeyForNodeData(t,i)}copyNodeData(t){if(t===null)return null;const i=super.copyNodeData(t);return!this.copiesGroupKeyOfNodeData&&this.Tn!==""&&mt.vt(i,this.Tn)!==void 0&&mt.rt(i,this.Tn,void 0),i}setDataProperty(t,i,s){if(this.containsNodeData(t)){if(i===this.nodeKeyProperty){this.setKeyForNodeData(t,s);return}else if(i===this.nodeCategoryProperty){this.setCategoryForNodeData(t,s);return}else if(i===this.nodeGroupKeyProperty){this.setGroupKeyForNodeData(t,s);return}}else if(this.containsLinkData(t)){if(i===this.linkFromKeyProperty){this.Zd(t,s,!0);return}else if(i===this.linkToKeyProperty){this.Zd(t,s,!1);return}else if(i===this.linkFromPortIdProperty){this.Qd(t,s,!0);return}else if(i===this.linkToPortIdProperty){this.Qd(t,s,!1);return}else if(i===this.linkKeyProperty){this.setKeyForLinkData(t,s);return}else if(i===this.linkCategoryProperty){this.setCategoryForLinkData(t,s);return}else if(i===this.linkLabelKeysProperty){this.setLabelKeysForLinkData(t,s);return}}const n=mt.vt(t,i);n!==s&&(mt.rt(t,i,s),this.raiseDataChanged(t,i,n,s))}assignAllDataProperties(t,i){if(!i)return;const s=this.containsNodeData(t),n=this.containsLinkData(t);for(const o in i)if(o!=="__gohashid"&&!(s&&o===this.nodeKeyProperty)){if(s&&o===this.nodeIsGroupProperty&&mt.vt(t,o)===i[o]||n&&o===this.linkKeyProperty)continue;this.setDataProperty(t,o,i[o])}}Fy(t,i){super.Fy(t,i);const s=this.ti.iterator;for(;s.next();){const o=s.value;this.LN(o,t,i)}const n=this.sr.iterator;for(;n.next();){const o=n.value;this.RO(o,t,i)}}LN(t,i,s){if(this.getGroupKeyForNodeData(t)===i){const n=this.Tn;mt.rt(t,n,s),this.Et("nodeGroupKey",2,n,t,i,s),typeof n=="string"&&this.updateTargetBindings(t,n)}}RO(t,i,s){if(this.Te(t,!0)===i){const o=this.wo;mt.rt(t,o,s),this.Et("linkFromKey",2,o,t,i,s),typeof o=="string"&&this.updateTargetBindings(t,o)}if(this.Te(t,!1)===i){const o=this.xo;mt.rt(t,o,s),this.Et("linkToKey",2,o,t,i,s),typeof o=="string"&&this.updateTargetBindings(t,o)}const n=this.getLabelKeysForLinkData(t);if(Array.isArray(n)){const o=n.length,r=this.Zs;for(let a=0;a<o;a++)n[a]===i&&(n[a]=s,this.Et("linkLabelKeys",3,r,t,i,s,a,a))}}MN(){super.MN();const t=this.linkDataArray,i=t.length;for(let s=0;s<i;s++){const n=t[s];this.CN(n)}}ag(t){super.ag(t);const i=this.getKeyForNodeData(t),s=this.Cy(i);if(s!==null){const n=b.nt(),o=s.iterator;for(;o.next();){const r=o.value;if(this.containsNodeData(r)){if(this.getGroupKeyForNodeData(r)===i){const a=this.Tn;this.Et("nodeGroupKey",2,a,r,i,i),typeof a=="string"&&this.updateTargetBindings(r,a),n.push(r)}}else{if(this.Te(r,!0)===i){const h=this.wo;this.Et("linkFromKey",2,h,r,i,i),typeof h=="string"&&this.updateTargetBindings(r,h),n.push(r)}if(this.Te(r,!1)===i){const h=this.xo;this.Et("linkToKey",2,h,r,i,i),typeof h=="string"&&this.updateTargetBindings(r,h),n.push(r)}const a=this.getLabelKeysForLinkData(r);if(Array.isArray(a)){const h=a.length,l=this.Zs;for(let u=0;u<h;u++)a[u]===i&&(this.Et("linkLabelKeys",3,l,r,i,i,u,u),n.push(r))}}}for(let r=0;r<n.length;r++)this.Js(i,n[r]);b.tt(n)}}cg(t){super.cg(t);const i=this.getGroupKeyForNodeData(t);this.findNodeDataForKey(i)===null&&this.$s(i,t)}Ry(t){super.Ry(t);const i=this.getGroupKeyForNodeData(t);this.Js(i,t)}get linkCategoryProperty(){return this.ja}set linkCategoryProperty(t){const i=this.ja;i!==t&&(this.An(t,ge,"linkCategoryProperty"),this.ja=t,this.t("linkCategoryProperty",i,t))}getCategoryForLinkData(t){if(t===null)return"";const i=this.ja;if(i==="")return"";const s=mt.vt(t,i);if(s===void 0)return"";if(typeof s=="string")return s;b.o("getCategoryForLinkData found a non-string category for "+t+": "+s)}getLinkCategoryForData(t){return this.getCategoryForLinkData(t)}setCategoryForLinkData(t,i){if(t===null)return;const s=this.ja;if(s==="")return;if(!this.containsLinkData(t)){mt.rt(t,s,i);return}let n=mt.vt(t,s);n===void 0&&(n=""),n!==i&&(mt.rt(t,s,i),this.Et("linkCategory",2,s,t,n,i),typeof s=="string"&&this.updateTargetBindings(t,s))}setLinkCategoryForData(t,i){this.setCategoryForLinkData(t,i)}hg(t,i){super.hg(t,i),this.setGroupKeyForNodeData(i,this.getGroupKeyForNodeData(t))}zT(t,i){this.setCategoryForLinkData(i,this.getCategoryForLinkData(t)),this.setFromKeyForLinkData(i,this.getFromKeyForLinkData(t)),this.setToKeyForLinkData(i,this.getToKeyForLinkData(t)),this.setLabelKeysForLinkData(i,this.getLabelKeysForLinkData(t)),this.setFromPortIdForLinkData(i,this.getFromPortIdForLinkData(t)),this.setToPortIdForLinkData(i,this.getToPortIdForLinkData(t))}get type(){return"GraphLinksModel"}gc(){return!0}Ta(){return!0}Xw(){return!0}qc(){return!0}};f(ge,"EmptyArray",Object.freeze([]));let Wi=ge;mt.registerClass(Wi,"GraphLinksModel"),mt.constructGraphLinksModel=mt.constructGraphLinksModel=()=>new Wi,mt.initDiagramModel=mt.initDiagramModel=()=>new Wi;class $i extends mt{constructor(t,i){super();f(this,"Dn");f(this,"ug");f(this,"Ha");if(this.Dn="parent",this.ug=!1,this.Ha="parentLinkCategory",t!==void 0&&(Array.isArray(t)?this.nodeDataArray=t:i=t),i){Object.assign(this,i);const s=i.Changed;s&&(delete this.Changed,this.addChangedListener(s))}}cloneProtected(t){super.cloneProtected(t),t.Dn=this.Dn,t.ug=this.ug,t.Ha=this.Ha}toString(t){if(t===void 0&&(t=0),t>=2)return this.toJson();{let i=(this.name!==""?this.name:"")+" TreeModel";if(t>0){i+=`
 node data:`;const s=this.nodeDataArray,n=s.length;for(let o=0;o<n;o++){const r=s[o];i+=" "+this.getKeyForNodeData(r)+":"+bi.toString(r)}}return i}}lg(){const t=super.lg();let i="";return this.nodeParentKeyProperty!=="parent"&&typeof this.nodeParentKeyProperty=="string"&&(i+=`,
  "nodeParentKeyProperty": `+this.Fe(this.nodeParentKeyProperty)),t+i}Ty(t){super.Ty(t),t.nodeParentKeyProperty&&(this.nodeParentKeyProperty=t.nodeParentKeyProperty)}Dy(t){t.nodeParentKeyProperty!==void 0&&t.nodeParentKeyProperty!==this.nodeParentKeyProperty&&b.o("applyIncrementalJson cannot change Model properties"),super.Dy(t)}maybeEnsureLinkReference(t){return t}get nodeParentKeyProperty(){return this.Dn}set nodeParentKeyProperty(t){const i=this.Dn;i!==t&&(this.An(t,$i,"nodeParentKeyProperty"),this.Dn=t,this.t("nodeParentKeyProperty",i,t))}get copiesParentKeyOfNodeData(){return this.ug}set copiesParentKeyOfNodeData(t){this.ug!==t&&(this.ug=t)}getParentKeyForNodeData(t){if(t===null)return;const i=this.Dn;if(i==="")return;const s=mt.vt(t,i);if(s!==void 0){if(this.isKeyType(s))return s;b.o("ParentKey value for node data "+t+" is not a number or a string: "+s)}}setParentKeyForNodeData(t,i){if(i===null&&(i=void 0),i!==void 0&&!this.isKeyType(i)&&b.we(i,"number or string",$i,"setParentKeyForNodeData:key"),t===null)return;const s=this.Dn;if(s==="")return;if(i=this.maybeEnsureLinkReference(i),!this.containsNodeData(t)){mt.rt(t,s,i);return}const n=mt.vt(t,s);n!==i&&(this.Js(n,t),mt.rt(t,s,i),this.findNodeDataForKey(i)===null&&this.$s(i,t),this.Et("nodeParentKey",2,s,t,n,i),typeof s=="string"&&this.updateTargetBindings(t,s))}get parentLinkCategoryProperty(){return this.Ha}set parentLinkCategoryProperty(t){const i=this.Ha;i!==t&&(this.An(t,$i,"parentLinkCategoryProperty"),this.Ha=t,this.t("parentLinkCategoryProperty",i,t))}get linkCategoryProperty(){return this.parentLinkCategoryProperty}set linkCategoryProperty(t){this.parentLinkCategoryProperty=t}getParentLinkCategoryForNodeData(t){if(t===null)return"";const i=this.Ha;if(i==="")return"";const s=mt.vt(t,i);if(s===void 0)return"";if(typeof s=="string")return s;b.o("getParentLinkCategoryForNodeData found a non-string category for "+t+": "+s)}getLinkCategoryForData(t){return this.getParentLinkCategoryForNodeData(t)}setParentLinkCategoryForNodeData(t,i){if(t===null)return;const s=this.Ha;if(s==="")return;if(!this.containsNodeData(t)){mt.rt(t,s,i);return}let n=mt.vt(t,s);n===void 0&&(n=""),n!==i&&(mt.rt(t,s,i),this.Et("parentLinkCategory",2,s,t,n,i),typeof s=="string"&&this.updateTargetBindings(t,s))}setLinkCategoryForData(t,i){this.setParentLinkCategoryForNodeData(t,i)}copyNodeData(t){if(t===null)return null;const i=super.copyNodeData(t);return!this.copiesParentKeyOfNodeData&&this.Dn!==""&&mt.vt(i,this.Dn)!==void 0&&mt.rt(i,this.Dn,void 0),i}setDataProperty(t,i,s){if(this.containsNodeData(t)){if(i===this.nodeKeyProperty){this.setKeyForNodeData(t,s);return}else if(i===this.nodeCategoryProperty){this.setCategoryForNodeData(t,s);return}else if(i===this.nodeParentKeyProperty){this.setParentKeyForNodeData(t,s);return}else if(i===this.parentLinkCategoryProperty){this.setParentLinkCategoryForNodeData(t,s);return}}const n=mt.vt(t,i);n!==s&&(mt.rt(t,i,s),this.raiseDataChanged(t,i,n,s))}Fy(t,i){super.Fy(t,i);const s=this.ti.iterator;for(;s.next();){const n=s.value;this.LN(n,t,i)}}LN(t,i,s){if(this.getParentKeyForNodeData(t)===i){const n=this.Dn;mt.rt(t,n,s),this.Et("nodeParentKey",2,n,t,i,s),typeof n=="string"&&this.updateTargetBindings(t,n)}}ag(t){super.ag(t);const i=this.getKeyForNodeData(t),s=this.Cy(i);if(s!==null){const n=b.nt(),o=s.iterator;for(;o.next();){const r=o.value;if(this.containsNodeData(r)&&this.getParentKeyForNodeData(r)===i){const a=this.Dn;this.Et("nodeParentKey",2,a,r,i,i),typeof a=="string"&&this.updateTargetBindings(r,a),n.push(r)}}for(let r=0;r<n.length;r++)this.Js(i,n[r]);b.tt(n)}}cg(t){super.cg(t);let i=this.getParentKeyForNodeData(t);i=this.maybeEnsureLinkReference(i),this.findNodeDataForKey(i)===null&&this.$s(i,t)}Ry(t){super.Ry(t);const i=this.getParentKeyForNodeData(t);this.Js(i,t)}hg(t,i){super.hg(t,i),this.setParentLinkCategoryForNodeData(i,this.getParentLinkCategoryForNodeData(t)),this.setParentKeyForNodeData(i,this.getParentKeyForNodeData(t))}get type(){return"TreeModel"}pc(){return!0}Xw(){return!0}}mt.registerClass($i,"TreeModel");var Xs=(v=>(v[v.ConstantSpacing=0]="ConstantSpacing",v[v.ConstantDistance=1]="ConstantDistance",v[v.ConstantAngle=2]="ConstantAngle",v[v.Packed=3]="Packed",v))(Xs||{}),Ys=(v=>(v[v.Clockwise=10]="Clockwise",v[v.Counterclockwise=11]="Counterclockwise",v[v.BidirectionalLeft=12]="BidirectionalLeft",v[v.BidirectionalRight=13]="BidirectionalRight",v))(Ys||{}),Gs=(v=>(v[v.Forwards=20]="Forwards",v[v.Reverse=21]="Reverse",v[v.Ascending=22]="Ascending",v[v.Descending=23]="Descending",v[v.Optimized=24]="Optimized",v))(Gs||{}),Us=(v=>(v[v.Pythagorean=30]="Pythagorean",v[v.Circular=31]="Circular",v))(Us||{});class Le extends be{constructor(t){super();f(this,"le");f(this,"If");f(this,"B1");f(this,"dg");f(this,"U1");f(this,"Ah");f(this,"AN");f(this,"TN");f(this,"DN");f(this,"bs");f(this,"vy");f(this,"Oy");f(this,"qa");f(this,"Iy");f(this,"XT");f(this,"gg");f(this,"mg");f(this,"pg");f(this,"Ef");f(this,"zi");f(this,"S");f(this,"pe");f(this,"ye");f(this,"Ln");f(this,"yg");this.le=0,this.If=0,this.B1=0,this.dg=360,this.U1=0,this.Ah=0,this.AN=new S,this.TN=30,this.DN=0,this.bs=0,this.vy=0,this.Oy=new pn,this.qa=0,this.Iy=0,this.XT=600,this.gg=NaN,this.mg=1,this.pg=0,this.Ef=360,this.zi=0,this.S=10,this.pe=24,this.ye=Ni.standardComparer,this.Ln=6,this.yg=30,t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.gg=this.gg,t.mg=this.mg,t.pg=this.pg,t.Ef=this.Ef,t.zi=this.zi,t.S=this.S,t.pe=this.pe,t.ye=this.ye,t.Ln=this.Ln,t.yg=this.yg}ri(t){t in Gs?this.sorting=t:t in Ys?this.direction=t:t in Xs?this.arrangement=t:t in Us?this.nodeDiameterFormula=t:super.ri(t)}createNetwork(){return new yn(this)}vO(t,i,s){t=this.OO(t);let n=this.U1,o=this.TN,r=this.le,a=this.If,h=this.B1,l=this.dg,u=this.Ah,c=this.DN,d=this.bs,m=this.vy;if(n=this.arrangement,o=this.nodeDiameterFormula,r=this.radius,(!isFinite(r)||r<=0)&&(r=NaN),a=this.aspectRatio,(!isFinite(a)||a<=0)&&(a=1),h=this.startAngle,isFinite(h)||(h=0),l=this.sweepAngle,(!isFinite(l)||l>360||l<1)&&(l=360),u=this.spacing,isFinite(u)||(u=NaN),n===3&&o===31?n=0:n===3&&o!==31&&(o=31,n=this.arrangement),(this.direction===12||this.direction===13)&&this.sorting!==24){for(let y=0;!(y>=t.length||(i.add(t.elt(y)),y+1>=t.length));y+=2)s.add(t.elt(y+1));this.direction===12?(this.arrangement===3&&i.reverse(),t=new J,t.addAll(i),t.addAll(s)):(this.arrangement===3&&s.reverse(),t=new J,t.addAll(s),t.addAll(i))}const g=t.length;c=0;let p=0;for(let y=0;y<t.length;y++){const x=h+l*p*(this.direction===10?1:-1)/g;let P=t.elt(y).diameter;isNaN(P)&&(P=t.elt(y).Th(x)),l<360&&(y===0||y===t.length-1)&&(P/=2),c+=P,p++}if(isNaN(r)||n===3){if(isNaN(u)&&(u=6),n!==0&&n!==3){let y=-1/0;for(let x=0;x<g;x++){const P=t.elt(x),k=t.elt(x===g-1?0:x+1);isNaN(P.diameter)&&P.Th(0),isNaN(k.diameter)&&k.Th(0),y=Math.max(y,(P.diameter+k.diameter)/2)}if(m=y+u,n===2){const x=2*Math.PI/g,P=(y+u)/x;a>1?(r=P,d=r*a):(d=P,r=d)}else r=this.V1(m*(l>=360?g:g-1),a,h*Math.PI/180,l*Math.PI/180)}else r=this.V1(c+(l>=360?g:g-1)*(n!==3?u:u*1.6),a,h*Math.PI/180,l*Math.PI/180);d=r*a}else{d=r*a;const y=this.FN(r,d,h*Math.PI/180,l*Math.PI/180);if(isNaN(u))n===0&&(u=(y-c)/(l>=360?g:g-1));else if(n===0){const x=(y-c)/(l>=360?g:g-1);x<u?(r=this.V1(c+u*(l>=360?g:g-1),a,h*Math.PI/180,l*Math.PI/180),d=r*a):u=x}else{let x=-1/0;for(let w=0;w<g;w++){const N=t.elt(w),M=t.elt(w===g-1?0:w+1);isNaN(N.diameter)&&N.Th(0),isNaN(M.diameter)&&M.Th(0),x=Math.max(x,(N.diameter+M.diameter)/2)}const P=x+u,k=this.V1(P*(l>=360?g:g-1),a,h*Math.PI/180,l*Math.PI/180);k>r?(r=k,d=r*a,m=P):m=y/(l>=360?g:g-1)}}return this.U1=n,this.TN=o,this.le=r,this.If=a,this.B1=h,this.dg=l,this.Ah=u,this.DN=c,this.bs=d,this.vy=m,t}doLayout(t){this.network===null&&(this.network=this.makeNetwork(t)),this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin);const i=this.network.vertexes;if(i.count<=1){if(i.count===1){const m=i.first();m.centerX=0,m.centerY=0}this.updateParts(),this.network=null,this.isValidLayout=!0;return}let s=new J;s.addAll(i.iterator);const n=new J,o=new J;s=this.vO(s,n,o);const r=this.U1,a=this.le,h=this.B1,l=this.dg,u=this.Ah,c=this.bs,d=this.vy;if((this.direction===12||this.direction===13)&&r===3)this.KT(s,l,h-l/2,10);else if(this.direction===12||this.direction===13){let m=0;switch(r){case 1:m=this.z1(a,c,h,d)*180/Math.PI;break;case 0:{let g=0,p=0;const y=n.first();y!==null&&(g=y.Th(Math.PI/2));const x=o.first();x!==null&&(p=x.Th(Math.PI/2)),m=this.z1(a,c,h,u+(g+p)/2)*180/Math.PI;break}case 2:m=l/s.length;break}if(this.direction===12){switch(r){case 1:this.Ey(n,l/2,h,11);break;case 0:this.By(n,l/2,h,11);break;case 2:this.Uy(n,l/2,h,11);break}switch(r){case 1:this.Ey(o,l/2,h+m,10);break;case 0:this.By(o,l/2,h+m,10);break;case 2:this.Uy(o,l/2,h+m,10);break}}else{switch(r){case 1:this.Ey(o,l/2,h,11);break;case 0:this.By(o,l/2,h,11);break;case 2:this.Uy(o,l/2,h,11);break}switch(r){case 1:this.Ey(n,l/2,h+m,10);break;case 0:this.By(n,l/2,h+m,10);break;case 2:this.Uy(n,l/2,h+m,10);break}}}else switch(r){case 1:this.Ey(s,l,h,this.direction);break;case 0:this.By(s,l,h,this.direction);break;case 2:this.Uy(s,l,h,this.direction);break;case 3:this.KT(s,l,h,this.direction);break}this.updateParts(),this.network=null,this.isValidLayout=!0}Uy(t,i,s,n){const o=this.dg,r=this.le,a=this.bs,h=s*Math.PI/180,l=i*Math.PI/180,u=t.length;for(let c=0;c<u;c++){const d=h+(n===10?c*l/(o>=360?u:u-1):-(c*l)/u),m=t.elt(c),g=r*Math.tan(d)/a,p=Math.sqrt((r*r+a*a*g*g)/(1+g*g));m.centerX=p*Math.cos(d),m.centerY=p*Math.sin(d),m.actualAngle=d*180/Math.PI}}By(t,i,s,n){const o=this.le,r=this.bs,a=this.Ah;let h=s*Math.PI/180;const l=t.length;for(let u=0;u<l;u++){const c=t.elt(u),d=t.elt(u===l-1?0:u+1),m=o*Math.cos(h),g=r*Math.sin(h);c.centerX=m,c.centerY=g,c.actualAngle=h*180/Math.PI,isNaN(c.diameter)&&c.Th(0),isNaN(d.diameter)&&d.Th(0);const p=(c.diameter+d.diameter)/2,y=this.z1(o,r,n===10?h:-h,p+a);h+=n===10?y:-y}}Ey(t,i,s,n){const o=this.le,r=this.bs,a=this.vy;let h=s*Math.PI/180;const l=t.length;for(let u=0;u<l;u++){const c=t.elt(u);c.centerX=o*Math.cos(h),c.centerY=r*Math.sin(h),c.actualAngle=h*180/Math.PI;const d=this.z1(o,r,n===10?h:-h,a);h+=n===10?d:-d}}KT(t,i,s,n){let o=this.Iy;const r=this.dg;if(this.qa=0,this.Oy=new pn,i<360){for(o=s+(n===10?r:-r);o<0;)o+=360;o%=360,o>180&&(o-=360),o*=Math.PI/180,this.Iy=o,this.YT(t,i,s,n)}else this.GT(t,i,s,n);this.Oy.commit(t)}GT(t,i,s,n){const o=this.le,r=this.bs,a=this.Ah,h=this.If;let l=o*Math.cos(s*Math.PI/180),u=r*Math.sin(s*Math.PI/180);const c=t.toArray();if(c.length===3){c[0].centerX=o,c[0].centerY=0,c[1].centerX=c[0].centerX-c[0].width/2-c[1].width/2-a,c[1].y=c[0].y,c[2].centerX=(c[0].centerX+c[1].centerX)/2,c[2].y=c[0].y-c[2].height-a;return}else if(c.length===4){c[0].centerX=o,c[0].centerY=0,c[2].centerX=-c[0].centerX,c[2].centerY=c[0].centerY,c[1].centerX=0,c[1].y=Math.min(c[0].y,c[2].y)-c[1].height-a,c[3].centerX=0,c[3].y=Math.max(c[0].y+c[0].height+a,c[2].y+c[2].height+a);return}const d=S.l();for(let N=0;N<c.length&&(c[N].centerX=l,c[N].centerY=u,!(N>=c.length-1));N++)this.jT(l,u,c,N,n,d)||this.HT(l,u,c,N,n,d),l=d.x,u=d.y;if(S.s(d),this.qa++,this.qa>23)return;const m=c[0].centerX,g=c[0].centerY,p=c[c.length-1].centerX,y=c[c.length-1].centerY;let x=Math.abs(m-p)-((c[0].width+c[c.length-1].width)/2+a);const P=Math.abs(g-y)-((c[0].height+c[c.length-1].height)/2+a);let k=0;if(Math.abs(P)<1){const N=Math.abs(m-p),M=(c[0].width+c[c.length-1].width)/2;N<M&&(k=0),x=N-M}else P>0?k=P:Math.abs(x)<1?k=0:k=x;let w=!1;Math.abs(p)>Math.abs(y)?w=p>0!=g>y:w=y>0!=m<p,w=n===10?w:!w,w&&(k=-Math.abs(k),k=Math.min(k,-c[c.length-1].width),k=Math.min(k,-c[c.length-1].height)),this.Oy.IO(k,c),Math.abs(k)>1&&(this.qa<8?this.le-=k/(2*Math.PI):c.length<5&&k>10?this.le/=2:this.le-=k>0?1.7:-2.3,this.bs=this.le*h,this.GT(t,i,s,n))}YT(t,i,s,n){const o=this.le,r=this.bs,a=this.If;let h=o*Math.cos(s*Math.PI/180),l=r*Math.sin(s*Math.PI/180);const u=S.l(),c=t.toArray();for(let p=0;p<c.length&&(c[p].centerX=h,c[p].centerY=l,!(p>=c.length-1));p++)this.jT(h,l,c,p,n,u)||this.HT(h,l,c,p,n,u),h=u.x,l=u.y;if(S.s(u),this.qa++,this.qa>23)return;const d=Math.atan2(l,h);let m=n===10?this.Iy-d:d-this.Iy;m=Math.abs(m)<Math.abs(m-2*Math.PI)?m:m-2*Math.PI;const g=m*(o+r)/2;this.Oy.EO(g,c),Math.abs(g)>1&&(this.qa<8?this.le-=g/(2*Math.PI):this.le-=g>0?1.7:-2.3,this.bs=this.le*a,this.YT(t,i,s,n))}jT(t,i,s,n,o,r){const a=this.Ah,h=this.le,l=this.bs;let u=0,c=0;const d=(s[n].width+s[n+1].width)/2+a;let m=!1;if(i>=0!=(o===10)){if(u=t+d,u>h){if(u=t-d,u<-h)return r.x=u,r.y=c,!1;m=!0}}else if(u=t-d,u<-h){if(u=t+d,u>h)return r.x=u,r.y=c,!1;m=!0}return c=Math.sqrt(1-Math.min(1,u*u/(h*h)))*l,i<0!==m&&(c=-c),Math.abs(i-c)>(s[n].height+s[n+1].height)/2?(r.x=u,r.y=c,!1):(r.x=u,r.y=c,!0)}HT(t,i,s,n,o,r){const a=this.Ah,h=this.le,l=this.bs;let u=0,c=0;const d=(s[n].height+s[n+1].height)/2+a;let m=!1;if(t>=0!=(o===10)){if(c=i-d,c<-l){if(c=i+d,c>l)return r.x=u,r.y=c,!1;m=!0}}else if(c=i+d,c>l){if(c=i-d,c<-l)return r.x=u,r.y=c,!1;m=!0}return u=Math.sqrt(1-Math.min(1,c*c/(l*l)))*h,t<0!==m&&(u=-u),Math.abs(t-u)>(s[n].width+s[n+1].width)/2?(r.x=u,r.y=c,!1):(r.x=u,r.y=c,!0)}commitLayout(){this.commitNodes(),this.isRouting&&this.commitLinks()}commitNodes(){const t=this.group!==null&&this.group.hasPlaceholder(),i=t?this.group.location.copy():null;let s=this.actualCenter;t?s=new S(0,0):(s.x=this.arrangementOrigin.x+this.le,s.y=this.arrangementOrigin.y+this.bs);const n=this.network.vertexes.iterator;for(;n.next();){const o=n.value;o.x+=s.x,o.y+=s.y,o.commit()}if(t){this.group.ensureBounds();const o=this.group.position.copy(),r=this.group.location.copy(),a=i.subtract(r.subtract(o));this.group.move(a),this.AN=a.subtract(o)}}commitLinks(){const t=this.network.edges.iterator;for(;t.next();)t.value.commit()}FN(t,i,s,n){const o=this.XT;if(Math.abs(this.If-1)<.001)return s!==void 0&&n!==void 0?n*t:2*Math.PI*t;const r=t>i?Math.sqrt(t*t-i*i)/t:Math.sqrt(i*i-t*t)/i;let a=0,h=0;s!==void 0&&n!==void 0?h=n/(o+1):h=Math.PI/(2*(o+1));let l=0;for(let u=0;u<=o;u++){s!==void 0&&n!==void 0?l=s+u*n/o:l=u*Math.PI/(2*o);const c=Math.sin(l);a+=Math.sqrt(1-r*r*c*c)*h}return s!==void 0&&n!==void 0?(t>i?t:i)*a:4*(t>i?t:i)*a}V1(t,i,s,n){let o=0;return s!==void 0&&n!==void 0?o=this.FN(1,i,s,n):o=this.FN(1,i),t/o}z1(t,i,s,n){if(Math.abs(this.If-1)<.001)return n/t;const o=t>i?Math.sqrt(t*t-i*i)/t:Math.sqrt(i*i-t*t)/i;let r=0;const a=2*Math.PI/(this.network.vertexes.count*700);t>i&&(s+=Math.PI/2);for(let h=0;;h++){const l=s+h*a,u=Math.sin(l);if(r+=(t>i?t:i)*Math.sqrt(1-o*o*u*u)*a,r>=n)return h*a}}OO(t){switch(this.sorting){case 20:break;case 21:t.reverse();break;case 22:t.sort(this.comparer);break;case 23:t.sort(this.comparer),t.reverse();break;case 24:return this.BO(this.UO(t));default:b.o("Invalid sorting type.")}return t}UO(t){const i=[];for(let n=0;n<t.length;n++)i.push(0);const s=new J;for(let n=0;n<t.length;n++){let o=-1,r=-1;if(n===0)for(let c=0;c<t.length;c++){const d=t.elt(c).edgesCount;d>o&&(o=d,r=c)}else for(let c=0;c<t.length;c++){const d=i[c];d>o&&(o=d,r=c)}s.add(t.elt(r)),i[r]=-1;const a=t.elt(r);let h=0;const l=a.sourceEdges;for(;l.next();){const c=l.value.fromVertex;h=t.indexOf(c),!(h<0)&&i[h]>=0&&i[h]++}const u=a.destinationEdges;for(;u.next();){const c=u.value.toVertex;h=t.indexOf(c),!(h<0)&&i[h]>=0&&i[h]++}}return s}BO(t){const i=[];for(let d=0;d<t.length;d++){const m=t.elt(d);i[d]=[];let g=0;const p=m.destinationEdges;for(;p.next();){const x=p.value.toVertex;g=t.indexOf(x),g!==d&&i[d].indexOf(g)<0&&i[d].push(g)}const y=m.sourceEdges;for(;y.next();){const x=y.value.fromVertex;g=t.indexOf(x),g!==d&&i[d].indexOf(g)<0&&i[d].push(g)}}const s=[];for(let d=0;d<i.length;d++)s[d]=0;const n=[],o=[],r=[],a=[],h=new J;let l=0;for(let d=0;d<i.length;d++){const m=i[d].length;if(m===1){a.push(d);continue}if(m===0){h.add(t.elt(d));continue}if(l===0){n.push(d),l++;continue}let g=1/0,p=1/0,y=-1;const x=[];for(let P=0;P<n.length;P++)i[n[P]].indexOf(n[P===n.length-1?0:P+1])<0&&x.push(P===n.length-1?0:P+1);if(x.length===0)for(let P=0;P<n.length;P++)x.push(P);for(let P=0;P<x.length;P++){const k=x[P],w=this.VO(i[d],o,r,s,k,n);let N=0;for(let M=0;M<i[d].length;M++){const C=i[d][M],O=n.indexOf(C);if(O>=0){const T=Math.abs(k-(O>=k?O+1:O));N+=T<n.length+1-T?T:n.length+1-T}}for(let M=0;M<o.length;M++){let C=s[o[M]],O=s[r[M]];if(C>=k&&C++,O>=k&&O++,C>O){const T=O;O=C,C=T}O-C<(n.length+2)/2==(C<k&&k<=O)&&N++}(w<g||w===g&&N<p)&&(g=w,p=N,y=k)}n.splice(y,0,d);for(let P=0;P<n.length;P++)s[n[P]]=P;for(let P=0;P<i[d].length;P++){const k=i[d][P];n.indexOf(k)>=0&&(o.push(d),r.push(k))}l++}let u=!1;const c=n.length;for(;;){u=!0;for(let d=0;d<a.length;d++){const m=a[d],g=i[m][0],p=n.indexOf(g);if(p>=0){let y=0;for(let x=0;x<i[g].length;x++){const P=i[g][x],k=n.indexOf(P);if(k<0||k===p)continue;const w=k>p?k-p:p-k,N=c-w;y+=k<p!=w>N?1:-1}n.splice(y<0?p:p+1,0,m),a.splice(d,1),d--}else u=!1}if(u)break;n.push(a[0]),a.splice(0,1)}for(let d=0;d<n.length;d++){const m=n[d];h.add(t.elt(m))}return h}VO(t,i,s,n,o,r){let a=0;for(let h=0;h<i.length;h++){const l=i[h],u=s[h],c=n[l],d=n[u];let m=0,g=0;if(c<d?(m=c,g=d):(m=d,g=c),m<o&&o<=g)for(let p=0;p<t.length;p++){const y=t[p];r.indexOf(y)<0||m<n[y]&&n[y]<g||m===n[y]||g===n[y]||a++}else for(let p=0;p<t.length;p++){const y=t[p];r.indexOf(y)<0||!(m<n[y]&&n[y]<g)||m===n[y]||g===n[y]||a++}}return a}get radius(){return this.gg}set radius(t){this.gg!==t&&(t>0||isNaN(t))&&(this.gg=t,this.invalidateLayout())}get aspectRatio(){return this.mg}set aspectRatio(t){this.mg!==t&&t>0&&(this.mg=t,this.invalidateLayout())}get startAngle(){return this.pg}set startAngle(t){this.pg!==t&&(this.pg=t,this.invalidateLayout())}get sweepAngle(){return this.Ef}set sweepAngle(t){this.Ef!==t&&(t>0&&t<=360?this.Ef=t:this.Ef=360,this.invalidateLayout())}get arrangement(){return this.zi}set arrangement(t){this.zi!==t&&(t===3||t===0||t===1||t===2)&&(this.zi=t,this.invalidateLayout())}get direction(){return this.S}set direction(t){this.S!==t&&(t===10||t===11||t===12||t===13)&&(this.S=t,this.invalidateLayout())}get sorting(){return this.pe}set sorting(t){this.pe!==t&&(this.pe=t,this.invalidateLayout())}get comparer(){return this.ye}set comparer(t){this.ye!==t&&(this.ye=t,this.invalidateLayout())}get spacing(){return this.Ln}set spacing(t){this.Ln!==t&&(this.Ln=t,this.invalidateLayout())}get nodeDiameterFormula(){return this.yg}set nodeDiameterFormula(t){this.yg!==t&&(t===30||t===31)&&(this.yg=t,this.invalidateLayout())}get actualXRadius(){return this.le}get actualYRadius(){return this.bs}get actualSpacing(){return this.Ah}get actualCenter(){return this.AN}}f(Le,"ConstantSpacing",0),f(Le,"ConstantDistance",1),f(Le,"ConstantAngle",2),f(Le,"Packed",3),f(Le,"Clockwise",10),f(Le,"Counterclockwise",11),f(Le,"BidirectionalLeft",12),f(Le,"BidirectionalRight",13),f(Le,"Forwards",20),f(Le,"Reverse",21),f(Le,"Ascending",22),f(Le,"Descending",23),f(Le,"Optimized",24),f(Le,"Pythagorean",30),f(Le,"Circular",31);class pn{constructor(){f(this,"Bf");f(this,"Wa");f(this,"Uf");this.Bf=-1/0,this.Wa=null,this.Uf=null}IO(e,t){if(e>0&&this.Bf<0||Math.abs(e)<Math.abs(this.Bf)&&!(e<0&&this.Bf>0)){this.Bf=e,this.Wa=[],this.Uf=[];for(let i=0;i<t.length;i++)this.Wa[i]=t[i].bounds.x,this.Uf[i]=t[i].bounds.y}}EO(e,t){if(Math.abs(e)<Math.abs(this.Bf)){this.Bf=e,this.Wa=[],this.Uf=[];for(let i=0;i<t.length;i++)this.Wa[i]=t[i].bounds.x,this.Uf[i]=t[i].bounds.y}}commit(e){if(!(this.Wa===null||this.Uf===null))for(let t=0;t<this.Wa.length;t++){const i=e.elt(t);i.x=this.Wa[t],i.y=this.Uf[t]}}}class yn extends Mi{constructor(e){super(e)}createVertex(){return new xn(this)}createEdge(){return new bn(this)}}class xn extends Ni{constructor(t){super(t);f(this,"bo");f(this,"X1");this.bo=NaN,this.X1=NaN}Th(t){const i=this.network;if(i===null)return NaN;const s=i.layout;if(s===null)return NaN;if(s.arrangement===3){if(s.nodeDiameterFormula===31)return this.bo=Math.max(this.width,this.height),this.bo;{const n=Math.abs(Math.sin(t)),o=Math.abs(Math.cos(t));return n===0?this.width:o===0?this.height:(this.bo=Math.min(this.height/n,this.width/o),this.bo)}}else return s.nodeDiameterFormula===31?(this.bo=Math.max(this.width,this.height),this.bo):(this.bo=Math.sqrt(this.width*this.width+this.height*this.height),this.bo)}get diameter(){return this.bo}set diameter(t){this.bo!==t&&(this.bo=t)}get actualAngle(){return this.X1}set actualAngle(t){this.X1!==t&&(this.X1=t)}}class bn extends qi{constructor(e){super(e)}}class eo extends be{constructor(t){super();f(this,"Vy");f(this,"Dh");f(this,"ks");f(this,"wg");f(this,"Fn");f(this,"Re");f(this,"xg");f(this,"bg");f(this,"kg");f(this,"Vf");f(this,"Pg");f(this,"Sg");f(this,"zf");f(this,"Xf");f(this,"Kf");f(this,"Yf");f(this,"Mg");f(this,"Ng");f(this,"Gf");f(this,"Ja");this.Vy=0,this.Dh=0,this.ks=new ut(100,100).g(),this.wg=!1,this.Fn=!0,this.Re=!1,this.xg=100,this.bg=300,this.kg=1,this.Vf=1e3,this.Pg=10,this.Sg=Math,this.zf=.05,this.Xf=50,this.Kf=150,this.Yf=0,this.Mg=10,this.Ng=5,this.Gf=NaN,this.Ja=10,t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.ks.a(this.ks),t.wg=this.wg,t.Fn=this.Fn,t.Re=this.Re,t.xg=this.xg,t.bg=this.bg,t.kg=this.kg,t.Vf=this.Vf,t.Pg=this.Pg,t.Sg=this.Sg,t.zf=this.zf,t.Xf=this.Xf,t.Kf=this.Kf,t.Yf=this.Yf,t.Mg=this.Mg,t.Ng=this.Ng,t.Gf=this.Gf,t.Ja=this.Ja}createNetwork(){return new vn(this)}doLayout(t){this.network=this.makeNetwork(t);let i=this.network.vertexes.iterator;const s=this.maxIterations;if(this.network.vertexes.count>0){for(this.network.deleteSelfEdges(),i=this.network.vertexes.iterator;i.next();){const o=i.value;o.charge=this.electricalCharge(o),o.mass=this.gravitationalMass(o)}const n=this.network.edges.iterator;for(;n.next();){const o=n.value;o.stiffness=this.springStiffness(o),o.length=this.springLength(o)}if(this.RN(),this.Dh=0,this.needsPrelayout()){const o=this.network,r=o.splitIntoSubNetworks(!1);let a=r.iterator;for(;a.next();){const h=a.value;this.doConnectedSubnetLayout(h)}for(a=r.iterator,this.zO(a,o),a=r.iterator;a.next();){const h=a.value,l=h.vertexes.iterator;for(;l.next();){const c=l.value;o.addVertex(c)}const u=h.edges.iterator;for(;u.next();){const c=u.value;o.addEdge(c)}}}else this.qT(this.network,this.maxIterations);this.updateParts()}this.maxIterations=s,this.isValidLayout=!0}needsPrelayout(){if(this.network.vertexes.count<3)return!1;let t=0,i=0;const s=this.network.vertexes.first().bounds,n=this.network.vertexes.iterator;for(;n.next();){const o=n.value,r=o.bounds;if(isNaN(o.x)||isNaN(o.y)||r.intersectsRect(s)&&(t++,t>2))return!0;if(i>10)return!1;i++}return!1}doConnectedSubnetLayout(t){let i=t.vertexes.iterator;for(;i.next();){const h=i.value;h.hierarchicalVertexes.add(h)}let s=t,n=this.Gf;if(isNaN(n)&&(n=t.edges.count/t.vertexes.count),n<t.vertexes.count)for(;s.vertexes.count>Math.max(100,Math.sqrt(n*t.vertexes.count));)s=this.coarsenNetwork(s);let o=0;i=s.vertexes.iterator;let r=this.randomNumberGenerator;for(r===null&&(this.randomNumberGenerator=r=new Pn(0));i.next();){i.value.idInCluster=o++;const h=10*(r.random()-.5),l=10*(r.random()-.5);this.isFixed(i.value)||(i.value.x=h,i.value.y=l);const u=i.value.hierarchicalVertexes.iterator;for(;u.next();)this.isFixed(u.value)||(u.value.x=h,u.value.y=l)}const a=this.computePairwiseDistances(s);this.XO(s,a,this.maxPrelayoutIterations,t.vertexes.count),this.qT(t,this.maxIterations)}computePairwiseDistances(t){const i=t.vertexes.count,s=new Array(i);for(let a=0;a<i;a++)s[a]=new Array(i).fill(-1),s[a][a]=0;const n=t.vertexes.iterator;let o=new Map,r=[];for(;n.next();){const a=n.value;for(r=[a],o=new Map,o.set(a.idInCluster,0);r.length>0;){const h=r.shift(),l=h.vertexes.iterator;for(;l.next();){const u=l.value;o.has(u.idInCluster)||(o.set(u.idInCluster,o.get(h.idInCluster)+1),r.push(u))}}for(let h=0;h<i;h++){const l=Math.min(s[a.idInCluster][h],s[h][a.idInCluster]),u=o.get(h);(l<0||u<l)&&(s[a.idInCluster][h]=u,s[h][a.idInCluster]=u)}}return s}coarsenNetwork(t){const i=this.createNetwork(),s=new Map;let n=0,o=t.vertexes.iterator;for(;o.next();)o.value.idInCluster=n++;for(o=t.vertexes.iterator;o.next();){const a=o.value;if(s.has(a.idInCluster))continue;let h=Number.MAX_SAFE_INTEGER,l=null;const u=a.vertexes.iterator;for(;u.next();){const d=u.value;s.has(d.idInCluster)||d.hierarchicalVertexes.length<h&&(h=d.hierarchicalVertexes.length,l=d)}const c=i.createVertex();c.hierarchicalVertexes.addAll(a.hierarchicalVertexes),l!=null&&c.hierarchicalVertexes.addAll(l.hierarchicalVertexes),s.set(a.idInCluster,c),l!=null&&s.set(l.idInCluster,c),i.addVertex(c)}const r=t.edges.iterator;for(;r.next();){const a=r.value,h=s.get(a.fromVertex.idInCluster),l=s.get(a.toVertex.idInCluster);if(h===l)continue;const u=i.createEdge();u.fromVertex=h,u.toVertex=l,i.addEdge(u)}return i}Nw(t,i){let s=!0;const n=t.vertexes.iterator;for(;n.next();){const o=n.value;s?(s=!1,i.set(o.bounds)):i.unionRect(o.bounds)}return i}zO(t,i){const s=this.arrangementSpacing,n=t.count;let o=!0,r=0,a=0;const h=b.nt();for(let d=0;d<n+i.vertexes.count+2;d++)h[d]=null;let l=0;t.reset();const u=z.l();let c;for(;t.next();){const d=t.value;if(this.Nw(d,u),o)o=!1,r=u.x+u.width/2,a=u.y+u.height/2,h[0]=new S(u.x+u.width+s.width,u.y),h[1]=new S(u.x,u.y+u.height+s.height),l=2;else{const m=this.WT(h,l,r,a,u.width,u.height,s),g=h[m],p=new S(g.x+u.width+s.width,g.y),y=new S(g.x,g.y+u.height+s.height);m+1<l&&h.splice(m+1,0,null),h[m]=p,h[m+1]=y,l++;const x=g.x-u.x,P=g.y-u.y;for(c=d.vertexes.iterator;c.next();){const k=c.value;this.isFixed(k)||(k.centerX+=x,k.centerY+=P)}}}for(z.s(u),c=i.vertexes.iterator;c.next();){const d=c.value,m=d.bounds;if(l<2){r=m.x+m.width/2,a=m.y+m.height/2,h[0]=new S(m.x+m.width+s.width,m.y),h[1]=new S(m.x,m.y+m.height+s.height),l=2;continue}const g=this.WT(h,l,r,a,m.width,m.height,s),p=h[g],y=new S(p.x+m.width+s.width,p.y),x=new S(p.x,p.y+m.height+s.height);g+1<l&&h.splice(g+1,0,null),h[g]=y,h[g+1]=x,l++,this.isFixed(d)||(d.centerX=p.x+d.width/2,d.centerY=p.y+d.height/2)}b.tt(h)}WT(t,i,s,n,o,r,a){let h=9e19,l=-1;t:for(let u=0;u<i;u++){const c=t[u],d=c.x-s,m=c.y-n,g=d*d+m*m;if(g<h){for(let p=u-1;p>=0;p--)if(t[p].y>c.y&&t[p].x-c.x<o+a.width)continue t;for(let p=u+1;p<i;p++)if(t[p].x>c.x&&t[p].y-c.y<r+a.height)continue t;l=u,h=g}}return l}RN(){if(!this.comments)return;const t=this.network.vertexes.iterator;for(;t.next();){const i=t.value;this.addComments(i)}}addComments(t){const i=t.node;if(i!==null){const s=i.findNodesConnected();for(;s.next();){const n=s.value;if(n.category!=="Comment"||!n.isVisible())continue;let o=this.network.findVertex(n);o===null&&(o=this.network.addNode(n)),o.charge=this.defaultCommentElectricalCharge;let r=null;const a=o.destinationEdges;for(;a.next();){const h=a.value;if(h.toVertex===t){r=h;break}}if(r===null){const h=o.sourceEdges;for(;h.next();){const l=h.value;if(l.fromVertex===t){r=l;break}}}r===null&&(r=this.network.linkVertexes(t,o,null)),r.length=this.defaultCommentSpringLength}}}vN(t,i){const s=t.bounds,n=s.x,o=s.y,r=s.width,a=s.height,h=i.bounds,l=h.x,u=h.y,c=h.width,d=h.height;if(n+r<l)if(o>u+d){const m=n+r-l,g=o-u-d;return A.bw(m*m+g*g)}else if(o+a<u){const m=n+r-l,g=o+a-u;return A.bw(m*m+g*g)}else return l-(n+r);else if(n>l+c)if(o>u+d){const m=n-l-c,g=o-u-d;return A.bw(m*m+g*g)}else if(o+a<u){const m=n-l-c,g=o+a-u;return A.bw(m*m+g*g)}else return n-(l+c);else return o>u+d?o-(u+d):o+a<u?u-(o+a):.1}qT(t,i){const s=this.Dh+i;for(;this.Dh<s&&(this.Dh++,!!this.KO(t)););}KO(t){const i=t.vertexes.toArray();if(i.length<=0)return!1;const s=i[0];s.forceX=0,s.forceY=0;let n=s.centerX,o=n,r=s.centerY,a=r;for(let p=1;p<i.length;p++){const y=i[p];y.forceX=0,y.forceY=0;const x=y.centerX,P=y.centerY;n=Math.min(n,x),o=Math.max(o,x),r=Math.min(r,P),a=Math.max(a,P)}const h=o-n>a-r;h?i.sort((p,y)=>p===null||y===null||p===y?0:p.centerX-y.centerX):i.sort((p,y)=>p===null||y===null||p===y?0:p.centerY-y.centerY);const l=this.Vf;let u=0,c=0,d=0;for(let p=0;p<i.length;p++){const y=i[p],x=y.bounds,P=y.focus,k=x.x+P.x,w=x.y+P.y;c=y.charge*this.electricalFieldX(k,w),d=y.charge*this.electricalFieldY(k,w),c+=y.mass*this.gravitationalFieldX(k,w),d+=y.mass*this.gravitationalFieldY(k,w),y.forceX+=c,y.forceY+=d;for(let N=p+1;N<i.length;N++){const M=i[N];if(!this.shouldInteract(y,M)||N===p)continue;const C=M.bounds,O=M.focus,T=C.x+O.x,L=C.y+O.y;if(k-T>l||T-k>l){if(h)break;continue}if(w-L>l||L-w>l){if(!h)break;continue}const F=this.vN(y,M),D=2*y.charge,R=2*M.charge;if(F>1)u=D*R/(F*F),c=u*(k-T)/F,d=u*(w-L)/F;else{let I=this.randomNumberGenerator;I===null&&(this.randomNumberGenerator=I=new Pn(0));const j=I.random(),X=I.random();if(k>T)c=Math.abs(M.bounds.right-y.bounds.x),c=D*R*(1+c)*j;else if(k<T)c=Math.abs(M.bounds.x-y.bounds.right),c=-(D*R)*(1+c)*j;else{const V=Math.max(M.width,y.width);c=D*R*((1+V)*j-V/2)}if(w>L)d=Math.abs(M.bounds.bottom-y.bounds.y),d=D*R*(1+d)*X;else if(k<T)d=Math.abs(M.bounds.y-y.bounds.bottom),d=-(D*R)*(1+d)*X;else{const V=Math.max(M.height,y.height);d=D*R*((1+V)*X-V/2)}}y.forceX+=c,y.forceY+=d,M.forceX-=c,M.forceY-=d}}const m=t.edges.iterator;for(;m.next();){const p=m.value,y=p.fromVertex,x=p.toVertex,P=y.bounds,k=y.focus,w=P.x+k.x,N=P.y+k.y,M=x.bounds,C=x.focus,O=M.x+C.x,T=M.y+C.y,L=this.vN(y,x);L>1&&(u=.1*p.stiffness*(L-p.length),c=u*.5*(y.width+x.height)*(w-O)/L,d=u*.5*(y.width+x.height)*(N-T)/L),y.forceX-=c,y.forceY-=d,x.forceX+=c,x.forceY+=d}let g=0;for(let p=0;p<i.length;p++){const y=i[p];this.isFixed(y)?this.moveFixedVertex(y):g=Math.max(g,this.moveVertex(y)||0)}return g>this.epsilonDistance*this.epsilonDistance}XO(t,i,s,n){const o=this.Dh+s,r=Math.sqrt(n);this.Vy=this.Ja*t.vertexes.count;const a=t.vertexes.toArray();let h=0,l=0,u=0;for(;this.Dh<o;){this.Dh++,l=h,h=0;for(let c=0;c<a.length;c++){a[c].forceX=0,a[c].forceY=0;for(let m=0;m<a.length;m++){if(c===m)continue;const g=this.vN(a[c],a[m]),p=i[a[c].idInCluster][a[m].idInCluster],y=(g-this.Ja*r*p)/g;a[c].forceX+=y*(a[m].x-a[c].x),a[c].forceY+=y*(a[m].y-a[c].y)}const d=Math.sqrt(a[c].forceX*a[c].forceX+a[c].forceY*a[c].forceY);if(d>0){a[c].forceX=this.Vy*a[c].forceX/d,a[c].forceY=this.Vy*a[c].forceY/d,this.isFixed(a[c])||(a[c].x+=a[c].forceX,a[c].y+=a[c].forceY);const m=a[c].hierarchicalVertexes.iterator;for(;m.next();){const g=m.value;this.isFixed(g)||(g.centerX+=a[c].forceX,g.centerY+=a[c].forceY)}}h+=d*d}if(h>=l){if(u++,u>=5)break}else u=0;this.Vy*=.95}}moveVertex(t){let i=t.forceX,s=t.forceY;const n=this.moveLimit;return i<-n?i=-n:i>n&&(i=n),s<-n?s=-n:s>n&&(s=n),t.centerX+=i,t.centerY+=s,i*i+s*s}shouldInteract(t,i){return!0}moveFixedVertex(t){}commitLayout(){this.zy(),this.commitNodes(),this.isRouting&&this.commitLinks()}zy(){if(!this.setsPortSpots)return;const t=this.network.edges.iterator;for(;t.next();){const i=t.value.link;i!==null&&(i.fromSpot=B.Default,i.toSpot=B.Default)}}commitNodes(){let t=0,i=0;if(this.arrangesToOrigin){const o=z.l();this.Nw(this.network,o);const r=this.arrangementOrigin;t=r.x-o.x,i=r.y-o.y,z.s(o)}const s=z.l(),n=this.network.vertexes.iterator;for(;n.next();){const o=n.value;(t!==0||i!==0)&&(s.a(o.bounds),s.x+=t,s.y+=i,o.bounds=s),o.commit()}z.s(s)}commitLinks(){const t=this.network.edges.iterator;for(;t.next();)t.value.commit()}springStiffness(t){const i=t.stiffness;return isNaN(i)?this.zf:i}springLength(t){const i=t.length;return isNaN(i)?this.Xf:i}electricalCharge(t){const i=t.charge;return isNaN(i)?this.Kf:i}electricalFieldX(t,i){return 0}electricalFieldY(t,i){return 0}gravitationalMass(t){const i=t.mass;return isNaN(i)?this.Yf:i}gravitationalFieldX(t,i){return 0}gravitationalFieldY(t,i){return 0}isFixed(t){return t.isFixed}get currentIteration(){return this.Dh}get arrangementSpacing(){return this.ks}set arrangementSpacing(t){this.ks.equals(t)||(this.ks.a(t),this.invalidateLayout())}get arrangesToOrigin(){return this.wg}set arrangesToOrigin(t){this.wg!==t&&(this.wg=t,this.invalidateLayout())}get setsPortSpots(){return this.Fn}set setsPortSpots(t){this.Fn!==t&&(this.Fn=t,this.invalidateLayout())}get comments(){return this.Re}set comments(t){this.Re!==t&&(this.Re=t,this.invalidateLayout())}get maxPrelayoutIterations(){return this.xg}set maxPrelayoutIterations(t){this.xg!==t&&t>=0&&(this.xg=t,this.invalidateLayout())}get maxIterations(){return this.bg}set maxIterations(t){this.bg!==t&&t>=0&&(this.bg=t,this.invalidateLayout())}get epsilonDistance(){return this.kg}set epsilonDistance(t){this.kg!==t&&t>0&&(this.kg=t,this.invalidateLayout())}get infinityDistance(){return this.Vf}set infinityDistance(t){this.Vf!==t&&t>1&&(this.Vf=t,this.invalidateLayout())}get moveLimit(){return this.Pg}set moveLimit(t){this.Pg!==t&&(this.Pg=t,this.invalidateLayout())}get randomNumberGenerator(){return this.Sg}set randomNumberGenerator(t){this.Sg!==t&&(t!==null&&typeof t.random!="function"&&b.o('ForceDirectedLayout.randomNumberGenerator must have a "random()" function on it: '+t),this.Sg=t)}get defaultSpringStiffness(){return this.zf}set defaultSpringStiffness(t){this.zf!==t&&(this.zf=t,this.invalidateLayout())}get defaultSpringLength(){return this.Xf}set defaultSpringLength(t){this.Xf!==t&&(this.Xf=t,this.invalidateLayout())}get defaultElectricalCharge(){return this.Kf}set defaultElectricalCharge(t){this.Kf!==t&&(this.Kf=t,this.invalidateLayout())}get defaultGravitationalMass(){return this.Yf}set defaultGravitationalMass(t){this.Yf!==t&&(this.Yf=t,this.invalidateLayout())}get defaultCommentSpringLength(){return this.Mg}set defaultCommentSpringLength(t){this.Mg!==t&&(this.Mg=t,this.invalidateLayout())}get defaultCommentElectricalCharge(){return this.Ng}set defaultCommentElectricalCharge(t){this.Ng!==t&&(this.Ng=t,this.invalidateLayout())}get prelayoutQuality(){return this.Gf}set prelayoutQuality(t){this.Gf!==t&&(this.Gf=t,this.invalidateLayout())}get prelayoutSpread(){return this.Ja}set prelayoutSpread(t){this.Ja!==t&&(this.Ja=t,this.invalidateLayout())}}class vn extends Mi{constructor(e){super(e)}createVertex(){return new wn(this)}createEdge(){return new kn(this)}}class wn extends Ni{constructor(t){super(t);f(this,"K1");f(this,"Y1");f(this,"G1");f(this,"j1");f(this,"H1");f(this,"hierarchicalVertexes");f(this,"idInCluster");this.K1=!1,this.Y1=NaN,this.G1=NaN,this.j1=0,this.H1=0,this.hierarchicalVertexes=new J,this.idInCluster=-1}get isFixed(){return this.K1}set isFixed(t){this.K1!==t&&(this.K1=t)}get charge(){return this.Y1}set charge(t){this.Y1!==t&&(this.Y1=t)}get mass(){return this.G1}set mass(t){this.G1!==t&&(this.G1=t)}get forceX(){return this.j1}set forceX(t){this.j1!==t&&(this.j1=t)}get forceY(){return this.H1}set forceY(t){this.H1!==t&&(this.H1=t)}}class kn extends qi{constructor(t){super(t);f(this,"q1");f(this,"W1");this.q1=NaN,this.W1=NaN}get stiffness(){return this.q1}set stiffness(t){this.q1!==t&&(this.q1=t)}get length(){return this.W1}set length(t){this.W1!==t&&(this.W1=t)}}class Pn{constructor(e){f(this,"I");f(this,"R");f(this,"Q");f(this,"M");f(this,"A");f(this,"seed");e===void 0&&(e=42),this.seed=e,this.A=48271,this.M=2147483647,this.Q=this.M/this.A,this.R=this.M%this.A,this.I=1/this.M,this.random()}random(){const e=this.seed/this.Q,t=this.seed%this.Q,i=this.A*t-this.R*e;return i>0?this.seed=i:this.seed=i+this.M,this.seed*this.I}}var qs=(v=>(v[v.DepthFirst=0]="DepthFirst",v[v.Greedy=1]="Greedy",v[v.FromLayers=2]="FromLayers",v))(qs||{}),Hs=(v=>(v[v.OptimalLinkLength=10]="OptimalLinkLength",v[v.LongestPathSink=11]="LongestPathSink",v[v.LongestPathSource=12]="LongestPathSource",v))(Hs||{}),Ws=(v=>(v[v.DepthFirstOut=20]="DepthFirstOut",v[v.DepthFirstIn=21]="DepthFirstIn",v[v.Naive=22]="Naive",v))(Ws||{}),$s=(v=>(v[v.None=30]="None",v[v.Less=31]="Less",v[v.More=32]="More",v))($s||{}),Sn=(v=>(v[v.None=0]="None",v[v.Expand=1]="Expand",v[v.Straighten=2]="Straighten",v[v.Median=4]="Median",v[v.MaybeExpand=8]="MaybeExpand",v[v.All=15]="All",v))(Sn||{}),Mn=(v=>(v[v.None=0]="None",v[v.UpperLeft=1]="UpperLeft",v[v.UpperRight=2]="UpperRight",v[v.LowerLeft=4]="LowerLeft",v[v.LowerRight=8]="LowerRight",v[v.All=15]="All",v))(Mn||{});class ne extends be{constructor(t){super();f(this,"Ps");f(this,"Ji");f(this,"S");f(this,"jf");f(this,"Hf");f(this,"qf");f(this,"$a");f(this,"Wf");f(this,"nr");f(this,"Jf");f(this,"Fn");f(this,"St");f(this,"Xy");f(this,"Kt");f(this,"Cg");f(this,"Ss");f(this,"ui");f(this,"Qs");f(this,"Ms");f(this,"Ns");f(this,"Ut");f(this,"Lg");f(this,"Za");f(this,"Ag");f(this,"_s");f(this,"$f");f(this,"or");f(this,"Rn");f(this,"vn");f(this,"ON");this.Ps=25,this.Ji=25,this.S=0,this.jf=0,this.Hf=10,this.qf=20,this.$a=4,this.Wf=31,this.nr=15,this.Jf=10,this.Fn=!0,this.St=-1,this.Xy=-1,this.Kt=-1,this.Cg=0,this.Ss=0,this.ui=null,this.Qs=null,this.Ms=null,this.Ns=null,this.Ut=null,this.Lg=0,this.Za=null,this.Ag=null,this._s=0,this.$f=null,this.or=new S,this.Rn=[],this.Rn.length=100,this.vn=15,this.ON=0,t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Ps=this.Ps,t.Ji=this.Ji,t.S=this.S,t.jf=this.jf,t.Hf=this.Hf,t.qf=this.qf,t.$a=this.$a,t.Wf=this.Wf,t.nr=this.nr,t.Jf=this.Jf,t.Fn=this.Fn,t.vn=this.vn}ri(t){t in $s?this.aggressiveOption=t:t in qs?this.cycleRemoveOption=t:t in Ws?this.initializeOption=t:t in Hs?this.layeringOption=t:super.ri(t)}createNetwork(){return new Nn(this)}doLayout(t){this.network===null&&(this.network=this.makeNetwork(t)),this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin),this.YO(),this.network.vertexes.count>0&&(this.network.deleteSelfEdges(),this.cycleRemoveOption!==2&&this.removeCycles(),this.GO(),this.cycleRemoveOption===2&&this.removeCycles(),this.jO(),this.HO(),this.qO(),this.reduceCrossings(),this.straightenAndPack(),this.updateParts()),this.network=null,this.isValidLayout=!0}linkMinLength(t){return 1}linkLengthWeight(t){return 1}linkStraightenWeight(t){const i=t.fromVertex.node||t.fromVertex.data,s=t.toVertex.node||t.toVertex.data;return i===null&&s===null?8:i===null||s===null?4:1}nodeMinLayerSpace(t,i){return t.node===null&&t.data===null?0:this.S===90||this.S===270?i?t.focus.y+10:t.bounds.height-t.focus.y+10:i?t.focus.x+10:t.bounds.width-t.focus.x+10}nodeMinColumnSpace(t,i){if(t.node===null&&t.data===null)return 0;const s=i?t.J1:t.$1;if(s!==null)return s;const n=this.S;return n===90||n===270?i?t.J1=t.focus.x/this.Ji+1|0:t.$1=(t.bounds.width-t.focus.x)/this.Ji+1|0:i?t.J1=t.focus.y/this.Ji+1|0:t.$1=(t.bounds.height-t.focus.y)/this.Ji+1|0}$i(){this.Za===null&&(this.Za=[]);let t=0;const i=this.network.vertexes.iterator;for(;i.next();){const s=i.value;this.Za[t]=s.layer,t++,this.Za[t]=s.column,t++,this.Za[t]=s.index,t++}return this.Za}Ze(t){let i=0;const s=this.network.vertexes.iterator;for(;s.next();){const n=s.value;n.layer=t[i],i++,n.column=t[i],i++,n.index=t[i],i++}}JT(t,i){const s=this.Fh(t),n=this.ui[t];(this.Ag===null||this.Ag.length<n*n)&&(this.Ag=[]);const o=this.Ag;for(let r=0;r<n;r++){let a=0;const h=s[r],l=h.near;let u=0;l!==null&&l!==h&&l.layer===h.layer&&(a+=Math.max(0,Math.abs(l.index-h.index)-1));let c,d=0,m,g=0,p=0,y=0,x,P=0,k,w=0,N=0,M=0,C;if(i>=0){for(c=s[r].po,d=0;d<c.length;d++)if(m=c[d],m.valid&&m.fromVertex.layer!==t)for(g=m.fromVertex.index,p=m.portToPos,y=m.portFromPos,P=d+1;P<c.length;P++)k=c[P],k.valid&&k.fromVertex.layer!==t&&(w=k.fromVertex.index,N=k.portToPos,M=k.portFromPos,p<N&&(g>w||g===w&&y>M)&&a++,N<p&&(w>g||w===g&&M>y)&&a++)}if(i<=0){for(c=s[r].ir,d=0;d<c.length;d++)if(m=c[d],m.valid&&m.toVertex.layer!==t)for(g=m.toVertex.index,p=m.portToPos,y=m.portFromPos,P=d+1;P<c.length;P++)k=c[P],k.valid&&k.toVertex.layer!==t&&(w=k.toVertex.index,N=k.portToPos,M=k.portFromPos,y<M&&(g>w||g===w&&p>N)&&a++,M<y&&(w>g||w===g&&N>p)&&a++)}for(o[r*n+r]=a,u=r+1;u<n;u++){let O=0,T=0;if(i>=0){for(x=s[r].po,C=s[u].po,d=0;d<x.length;d++)if(m=x[d],m.valid&&m.fromVertex.layer!==t)for(g=m.fromVertex.index,p=m.portToPos,y=m.portFromPos,P=0;P<C.length;P++)k=C[P],k.valid&&k.fromVertex.layer!==t&&(w=k.fromVertex.index,N=k.portToPos,M=k.portFromPos,(g<w||g===w&&y<M)&&T++,(w<g||w===g&&M<y)&&O++)}if(i<=0){for(x=s[r].ir,C=s[u].ir,d=0;d<x.length;d++)if(m=x[d],m.valid&&m.toVertex.layer!==t)for(g=m.toVertex.index,p=m.portToPos,y=m.portFromPos,P=0;P<C.length;P++)k=C[P],k.valid&&k.toVertex.layer!==t&&(w=k.toVertex.index,N=k.portToPos,M=k.portFromPos,(g<w||g===w&&p<N)&&T++,(w<g||w===g&&N<p)&&O++)}o[r*n+u]=O,o[u*n+r]=T}}return this.Rh(t,s),o}countCrossings(){let t=0;for(let i=0;i<=this.St;i++){const s=this.JT(i,1),n=this.ui[i];for(let o=0;o<n;o++)for(let r=o;r<n;r++)t+=s[o*n+r]}return t}WO(t,i,s){const n=this.Fh(t),o=this.ui[t];let r=0;for(let a=0;a<o;a++){let h=null;i<=0&&(h=n[a].po);let l=null;i>=0&&(l=n[a].ir);let u,c=0,d=0;if(h!==null)for(let m=0;m<h.length;m++)u=h[m],u.valid&&u.fromVertex.layer!==t&&(c=u.fromVertex.column+u.portFromColOffset,d=u.toVertex.column+u.portToColOffset,s?r+=Math.abs(c-d)*this.linkStraightenWeight(u):r+=Math.abs(c-d));if(l!==null)for(let m=0;m<l.length;m++)u=l[m],u.valid&&u.toVertex.layer!==t&&(c=u.fromVertex.column+u.portFromColOffset,d=u.toVertex.column+u.portToColOffset,s?r+=(Math.abs(c-d)+1)*this.linkStraightenWeight(u):r+=Math.abs(c-d))}return this.Rh(t,n),r}Z1(t){let i=0;for(let s=0;s<=this.St;s++)i+=this.WO(s,1,t);return i}Ky(){let t=1/0;this.Kt=-1;const i=this.network.vertexes.iterator;for(;i.next();){const s=i.value;t=Math.min(t,s.column-this.nodeMinColumnSpace(s,!0)),this.Kt=Math.max(this.Kt,s.column+this.nodeMinColumnSpace(s,!1))}for(i.reset();i.next();){const s=i.value;s.column-=t}this.Kt-=t}Yy(t,i){const s=this.Fh(t),n=this.ui[t],o=[];for(let r=0;r<n;r++){const a=s[r];let h=null;i<=0&&(h=a.po);let l=null;i>=0&&(l=a.ir);let u=0,c=0;const d=a.near;d!==null&&d.layer===a.layer&&(u+=d.column-1,c++);let m;if(h!==null)for(let g=0;g<h.length;g++){m=h[g];const p=m.fromVertex;m.valid&&!m.rev&&p.layer!==t&&(u+=p.column,c++)}if(l!==null)for(let g=0;g<l.length;g++){m=l[g];const p=m.toVertex;m.valid&&!m.rev&&p.layer!==t&&(u+=p.column,c++)}c===0?o[r]=-1:o[r]=u/c}return this.Rh(t,s),o}$T(t,i){const s=this.Fh(t),n=this.ui[t],o=[];for(let r=0;r<n;r++){const a=s[r];let h=null;i<=0&&(h=a.po);let l=null;i>=0&&(l=a.ir);let u=0;const c=[],d=a.near;d!==null&&d.layer===a.layer&&(c[u]=d.column-1,u++);let m;if(h!==null)for(let g=0;g<h.length;g++){m=h[g];const p=m.fromVertex;m.valid&&!m.rev&&p.layer!==t&&(c[u]=p.column+m.portFromColOffset,u++)}if(l!==null)for(let g=0;g<l.length;g++){m=l[g];const p=m.toVertex;m.valid&&!m.rev&&p.layer!==t&&(c[u]=p.column+m.portToColOffset,u++)}if(u===0)o[r]=-1;else{c.sort((p,y)=>p-y);const g=u>>1;u&1?o[r]=c[g]:o[r]=c[g-1]+c[g]>>1}}return this.Rh(t,s),o}Gy(t,i,s,n,o){if(t.component===s){t.component=i;let r=0,a=0;if(n){const h=t.destinationEdges;for(;h.next();){const l=h.value,u=l.toVertex;r=t.layer-u.layer,a=this.linkMinLength(l),r===a&&this.Gy(u,i,s,n,o)}}if(o){const h=t.sourceEdges;for(;h.next();){const l=h.value,u=l.fromVertex;r=u.layer-t.layer,a=this.linkMinLength(l),r===a&&this.Gy(u,i,s,n,o)}}}}IN(t,i,s,n,o){if(t.component===s){if(t.component=i,n){const r=t.destinationEdges;for(;r.next();){const a=r.value.toVertex;this.IN(a,i,s,n,o)}}if(o){const r=t.sourceEdges;for(;r.next();){const a=r.value.fromVertex;this.IN(a,i,s,n,o)}}}}removeCycles(){const t=this.network.edges.iterator;for(;t.next();){const i=t.value;i.rev=!1}switch(this.jf){default:case 1:this.JO();break;case 0:this.$O();break;case 2:this.ZO();break}}ZO(){const t=this.network,i=t.vertexes.iterator;let s=1/0;for(;i.next();){const n=i.value;s=Math.min(s,n.layer)}if(s<1/0){if(s<0)for(i.reset();i.next();){const a=i.value;a.layer-=s}const n=[];for(i.reset();i.next();){const a=i.value,h=n[a.layer];h===void 0?n[a.layer]=[a]:h.push(a)}let o=0;for(let a=0;a<n.length;a++){const h=n[a];if(!h||h.length===0)o++;else if(a>0)for(let l=0;l<h.length;l++){const u=h[l];u.layer-=o}}const r=t.edges.iterator;for(;r.next();){const a=r.value,h=a.fromVertex,l=a.toVertex;h.layer<l.layer&&(t.reverseEdge(a),a.rev=!0)}}}JO(){const t=this.network;let i=0,s=t.vertexes.count-1;const n=[];n.length=s+1;const o=t.vertexes.iterator;for(;o.next();){const a=o.value;a.Zi=!0}for(;this.QO(t)!==null;){let a;for(a=this.ZT(t);a!==null;)n[s]=a,s--,a.Zi=!1,a=this.ZT(t);for(a=this.QT(t);a!==null;)n[i]=a,i++,a.Zi=!1,a=this.QT(t);a=this._O(t),a!==null&&(n[i]=a,i++,a.Zi=!1)}for(let a=0;a<t.vertexes.count;a++)n[a].index=a;const r=t.edges.iterator;for(;r.next();){const a=r.value,h=a.fromVertex,l=a.toVertex;h.index>l.index&&(t.reverseEdge(a),a.rev=!0)}}QO(t){const i=t.vertexes.iterator;for(;i.next();){const s=i.value;if(s.Zi)return s}return null}ZT(t){const i=t.vertexes.iterator;for(;i.next();){const s=i.value;if(s.Zi){let n=!0;const o=s.destinationEdges;for(;o.next();)if(o.value.toVertex.Zi){n=!1;break}if(n)return s}}return null}QT(t){const i=t.vertexes.iterator;for(;i.next();){const s=i.value;if(s.Zi){let n=!0;const o=s.sourceEdges;for(;o.next();)if(o.value.fromVertex.Zi){n=!1;break}if(n)return s}}return null}_O(t){let i=null,s=0;const n=this.network.vertexes.iterator;for(;n.next();){const o=n.value;if(o.Zi){let r=0;const a=o.destinationEdges;for(;a.next();)a.value.toVertex.Zi&&r++;let h=0;const l=o.sourceEdges;for(;l.next();)l.value.fromVertex.Zi&&h++;(i===null||s<r-h)&&(i=o,s=r-h)}}return i}$O(){const t=this.network.vertexes.iterator;for(;t.next();){const s=t.value;s.Zf=-1,s.jn=-1}const i=this.network.edges.iterator;for(;i.next();){const s=i.value;s.forest=!1}for(this.Lg=0,t.reset();t.next();){const s=t.value;s.sourceEdges.count===0&&this.EN(s)}for(t.reset();t.next();){const s=t.value;s.Zf===-1&&this.EN(s)}for(i.reset();i.next();){const s=i.value;if(!s.forest){const n=s.fromVertex,o=n.Zf,r=n.jn,a=s.toVertex,h=a.Zf,l=a.jn;h<o&&r<l&&(this.network.reverseEdge(s),s.rev=!0)}}}EN(t){t.Zf=this.Lg,this.Lg++;const i=t.destinationEdges;for(;i.next();){const s=i.value,n=s.toVertex;n.Zf===-1&&(s.forest=!0,this.EN(n))}t.jn=this.Lg,this.Lg++}GO(){const t=this.network.vertexes.iterator;for(;t.next();){const i=t.value;i.layer=-1}for(this.St=-1,this.assignLayers(),t.reset();t.next();){const i=t.value;this.St=Math.max(this.St,i.layer)}}assignLayers(){switch(this.Hf){case 11:this._T();break;case 12:this.tI();break;default:case 10:this.iI();break}}_T(){const t=this.network.vertexes.iterator;for(;t.next();){const i=t.value,s=this.tD(i);this.St=Math.max(s,this.St)}}tD(t){let i=0;if(t.layer===-1){const s=t.destinationEdges;for(;s.next();){const n=s.value,o=n.toVertex,r=this.linkMinLength(n);i=Math.max(i,this.tD(o)+r)}t.layer=i}else i=t.layer;return i}tI(){let t=0;const i=this.network.vertexes.iterator;for(;i.next();){const s=i.value;t=this.iD(s),this.St=Math.max(t,this.St)}for(i.reset();i.next();){const s=i.value;s.layer=this.St-s.layer}}iD(t){let i=0;if(t.layer===-1){const s=t.sourceEdges;for(;s.next();){const n=s.value,o=n.fromVertex,r=this.linkMinLength(n);i=Math.max(i,this.iD(o)+r)}t.layer=i}else i=t.layer;return i}iI(){this._T();const t=this.network.vertexes.iterator;for(;t.next();){const s=t.value;s.Zi=!1}for(t.reset();t.next();){const s=t.value;s.sourceEdges.count===0&&this.eD(s)}let i=1/0;for(t.reset();t.next();){const s=t.value;i=Math.min(i,s.layer)}for(this.St=-1,t.reset();t.next();){const s=t.value;s.layer-=i,this.St=Math.max(this.St,s.layer)}}eD(t){if(!t.Zi){t.Zi=!0;const i=t.destinationEdges;for(;i.next();){const s=i.value.toVertex;this.eD(s)}this.eI(t),this.sI(t)}}eI(t){const i=this.network.vertexes.iterator;for(;i.next();){const a=i.value;a.component=-1}const s=0,n=1,o=t.po;let r=o.length;for(let a=0;a<r;a++){const h=o[a],l=h.fromVertex,u=h.toVertex,c=this.linkMinLength(h);l.layer-u.layer>c&&this.Gy(l,s,-1,!0,!1)}for(this.Gy(t,n,-1,!0,!0);t.component!==s;){let a=0,h=1/0,l=0,u=null;const c=this.network.vertexes.iterator;for(;c.next();){const d=c.value;if(d.component===n){let m=0,g=!1;const p=d.po;r=p.length;for(let x=0;x<r;x++){const P=p[x],k=P.fromVertex;if(m+=this.linkLengthWeight(P),k.component!==n){a+=this.linkLengthWeight(P);const w=k.layer-d.layer,N=this.linkMinLength(P);h=Math.min(h,w-N)}}const y=d.ir;r=y.length;for(let x=0;x<r;x++){const P=y[x],k=P.toVertex;m-=this.linkLengthWeight(P),k.component!==n?a-=this.linkLengthWeight(P):g=!0}(u===null||m<l)&&!g&&(u=d,l=m)}}if(a>0){for(i.reset();i.next();){const d=i.value;d.component===n&&(d.layer+=h)}t.component=s}else u.component=s}}sI(t){const i=this.network.vertexes.iterator;for(;i.next();){const o=i.value;o.component=-1}const s=0,n=1;for(this.Gy(t,n,-1,!0,!1);t.component!==s;){let o=0,r=1/0,a=0,h=null;const l=this.network.vertexes.iterator;for(;l.next();){const u=l.value;if(u.component===n){let c=0,d=!1;const m=u.po;let g=m.length;for(let y=0;y<g;y++){const x=m[y],P=x.fromVertex;c+=this.linkLengthWeight(x),P.component!==n?o+=this.linkLengthWeight(x):d=!0}const p=u.ir;g=p.length;for(let y=0;y<g;y++){const x=p[y],P=x.toVertex;if(c-=this.linkLengthWeight(x),P.component!==n){o-=this.linkLengthWeight(x);const k=u.layer-P.layer,w=this.linkMinLength(x);r=Math.min(r,k-w)}}(h===null||c>a)&&!d&&(h=u,a=c)}}if(o<0){for(i.reset();i.next();){const u=i.value;u.component===n&&(u.layer-=r)}t.component=s}else h.component=s}}jO(){const t=this.network,i=[],s=t.edges.iterator;for(;s.next();){const n=s.value;n.valid=!1,i.push(n)}for(let n=0;n<i.length;n++){const o=i[n];let r=o.fromVertex;const a=o.toVertex;if(o.valid||(r.node===null&&r.data===null||a.node===null&&a.data===null)&&r.layer===a.layer)continue;let h=0,l=0,u=0,c=0;if(o.link!==null){const M=o.link;if(M===null)continue;const C=r.node,O=a.node;if(C===null||O===null)continue;let T=M.fromNode,L=M.toNode,F=M.fromPort;for(;F!==null&&!F.isVisibleObject();)F=F.panel;let D=M.toPort;for(;D!==null&&!D.isVisibleObject();)D=D.panel;if(o.rev){const $=T,pt=F;T=L,F=D,L=$,D=pt}const R=r.focus,I=a.focus,j=o.rev?a.bounds:r.bounds,X=S.l();C!==T?j.isReal()&&T.isVisible()?T.actualBounds.isReal()?(T.getRelativePoint(F,B.Center,X),X.x+=T.actualBounds.x-j.x,X.y+=T.actualBounds.y-j.y):(T.getRelativePoint(F,B.Center,X),X.isReal()||X.a(R)):X.a(R):j.isReal()?(T.getRelativePoint(F,B.Center,X),X.isReal()||X.a(R)):X.a(R);const V=o.rev?r.bounds:a.bounds,G=S.l();O!==L?V.isReal()&&L.isVisible()?L.actualBounds.isReal()?(L.getRelativePoint(D,B.Center,G),G.x+=L.actualBounds.x-V.x,G.y+=L.actualBounds.y-V.y):(L.getRelativePoint(D,B.Center,G),G.isReal()||G.a(I)):G.a(I):V.isReal()?(L.getRelativePoint(D,B.Center,G),G.isReal()||G.a(I)):G.a(I),this.S===90||this.S===270?(h=Math.round((X.x-R.x)/this.Ji),u=X.x,l=Math.round((G.x-I.x)/this.Ji),c=G.x):(h=Math.round((X.y-R.y)/this.Ji),u=X.y,l=Math.round((G.y-I.y)/this.Ji),c=G.y),S.s(X),S.s(G),o.portFromColOffset=h,o.portFromPos=u,o.portToColOffset=l,o.portToPos=c}else o.portFromColOffset=0,o.portFromPos=0,o.portToColOffset=0,o.portToPos=0;let d=r.layer;const m=a.layer,g=this.nI(o),p=g===1||g===3,y=g===2||g===3;let x,P,k=null,w;y&&(k=this.oI(r,a),w=1,P=t.createVertex(),P.node=null,P.Q1=1,P.layer=d,P.near=r,t.addVertex(P),x=t.linkVertexes(r,P,o.link),x.valid=!1,x.rev=o.rev,x.portFromColOffset=h,x.portToColOffset=0,x.portFromPos=u,x.portToPos=0,r=P);let N=1;if(p&&N--,d-m>N&&d>0){for(o.valid=!1,P=t.createVertex(),P.node=null,P.Q1=2,P.layer=d-1,k&&w<k.length&&P.layer===k[w].layer&&(P.near=k[w++]),t.addVertex(P),x=t.linkVertexes(r,P,o.link),x.valid=!0,x.rev=o.rev,x.portFromColOffset=y?0:h,x.portToColOffset=0,x.portFromPos=y?0:u,x.portToPos=0,r=P,d--;d-m>N&&d>0;)P=t.createVertex(),P.node=null,P.Q1=3,P.layer=d-1,k&&w<k.length&&P.layer===k[w].layer&&(P.near=k[w++]),t.addVertex(P),x=t.linkVertexes(r,P,o.link),x.valid=!0,x.rev=o.rev,x.portFromColOffset=0,x.portToColOffset=0,x.portFromPos=0,x.portToPos=0,r=P,d--;x=t.linkVertexes(P,a,o.link),x.valid=!p,p&&(P.near=a),x.rev=o.rev,x.portFromColOffset=0,x.portToColOffset=l,x.portFromPos=0,x.portToPos=c}else o.valid=!0}}nI(t){let i=0;const s=t.link;if(s!==null){const n=s.fromPort,o=s.toPort;if(n!==null&&o!==null){const r=s.fromNode,a=s.toNode;if(r!==null&&a!==null){const h=this._1(!0),l=this._1(!1),u=this.setsPortSpots?h:s.computeSpot(!0,n),c=this.setsPortSpots?l:s.computeSpot(!1,o),d=s.isOrthogonal;if(u.isSide()&&u.includesSide(l)&&c.isSide()&&c.includesSide(h))return 0;const m=s.getLinkPoint(r,n,u,!0,d,a,o,S.l()),g=s.getLinkDirection(r,n,m,u,!0,d,a,o);S.s(m),(!u.isNone()&&g===this.sD(t,!0)||this.setsPortSpots&&r!==null&&r.ports.count===1&&t.rev)&&(i+=1);const p=s.getLinkPoint(a,o,c,!1,d,r,n,S.l()),y=s.getLinkDirection(a,o,p,c,!1,d,r,n);S.s(p),(!c.isNone()&&y===this.sD(t,!1)||this.setsPortSpots&&a!==null&&a.ports.count===1&&t.rev)&&(i+=2)}}}return i}sD(t,i){return this.S===90?i&&!t.rev||!i&&t.rev?270:90:this.S===180?i&&!t.rev||!i&&t.rev?0:180:this.S===270?i&&!t.rev||!i&&t.rev?90:270:i&&!t.rev||!i&&t.rev?180:0}oI(t,i){const s=[];return s.push(i),this.nD(t,s)?s.reverse():[]}nD(t,i){const s=i[i.length-1].sourceEdges.iterator;for(;s.next();){const n=s.value;if(n.rev||!n.valid)continue;const o=n.fromVertex;if(i.push(o),o===t||this.nD(t,i))return!0;i.pop()}return!1}HO(){const t=this.ui=[];for(let s=0;s<=this.St;s++)t[s]=0;const i=this.network.vertexes.iterator;for(;i.next();){const s=i.value;s.index=-1}this.initializeIndices(),this.Xy=-1,this.Cg=0,this.Ss=0;for(let s=0;s<=this.St;s++)t[s]>t[this.Ss]&&(this.Xy=t[s]-1,this.Ss=s),t[s]<t[this.Cg]&&(this.Cg=s);this.$f=[];for(let s=0;s<t.length;s++)this.$f[s]=[];for(i.reset();i.next();){const s=i.value,n=s.layer,o=this.$f[n];o[s.index]=s}}initializeIndices(){switch(this.qf){default:case 22:this.rI();break;case 20:this.lI();break;case 21:this.hI();break}}rI(){let t=null;const i=this.network.vertexes.iterator;for(;i.next();){const s=i.value;if(s.near&&(t===null&&(t=new Map),s.layer===s.near.layer)){const n=t.get(s.near)||[];n.push(s),t.set(s.near,n)}}for(i.reset();i.next();){const s=i.value;if(s.near)continue;const n=s.layer;if(s.index=this.ui[n],this.ui[n]++,!t)continue;const o=t.get(s);Array.isArray(o)&&o.forEach(r=>{r.index=this.ui[n],this.ui[n]++})}}lI(){let t=null;const i=this.network.vertexes.iterator;for(;i.next();){const s=i.value;if(s.near&&(t===null&&(t=new Map),s.layer===s.near.layer)){const n=t.get(s.near)||[];n.push(s),t.set(s.near,n)}}for(let s=this.St;s>=0;s--)for(i.reset();i.next();){const n=i.value;n.layer===s&&n.index===-1&&this.oD(n,t)}}oD(t,i){if(t.near)return;const s=t.layer;if(t.index=this.ui[s],this.ui[s]++,i){const r=i.get(t);Array.isArray(r)&&r.forEach(a=>{a.index=this.ui[s],this.ui[s]++})}const n=t.ir;let o=!0;for(;o;){o=!1;for(let r=0;r<n.length-1;r++){const a=n[r],h=n[r+1];a.portFromColOffset>h.portFromColOffset&&(o=!0,n[r]=h,n[r+1]=a)}}for(let r=0;r<n.length;r++){const a=n[r];if(a.valid){const h=a.toVertex;h.index===-1&&this.oD(h,i)}}}hI(){let t=null;const i=this.network.vertexes.iterator;for(;i.next();){const s=i.value;if(s.near&&(t===null&&(t=new Map),s.layer===s.near.layer)){const n=t.get(s.near)||[];n.push(s),t.set(s.near,n)}}for(let s=0;s<=this.St;s++)for(i.reset();i.next();){const n=i.value;n.layer===s&&n.index===-1&&this.rD(n,t)}}rD(t,i){if(t.near)return;const s=t.layer;if(t.index=this.ui[s],this.ui[s]++,i){const l=i.get(t);Array.isArray(l)&&l.forEach(u=>{u.index=this.ui[s],this.ui[s]++})}const n=t.po;let o=!0,r=0;for(;o;)for(o=!1,r=0;r<n.length-1;r++){const l=n[r],u=n[r+1];l.portToColOffset>u.portToColOffset&&(o=!0,n[r]=u,n[r+1]=l)}let a,h;for(r=0;r<n.length;r++)h=n[r],h.valid&&(a=h.fromVertex,a.index===-1&&this.rD(a,i))}qO(){this.Kt=-1;for(let t=0;t<=this.St;t++){const i=this.Fh(t);let s=0;const n=this.ui[t];for(let o=0;o<n;o++){const r=i[o];s+=this.nodeMinColumnSpace(r,!0),r.column=s,s+=1,s+=this.nodeMinColumnSpace(r,!1)}this.Kt=Math.max(this.Kt,s-1),this.Rh(t,i)}}reduceCrossings(){let t=this.countCrossings(),i=this.$i(),s=0,n=0,o=0;for(s=0;s<this.$a;s++){for(n=0;n<=this.St;n++)this.tk(n,1),this.ls(n,1,!1,1);for(o=this.countCrossings(),o<t&&(t=o,i=this.$i()),n=this.St;n>=0;n--)this.tk(n,-1),this.ls(n,-1,!1,-1);o=this.countCrossings(),o<t&&(t=o,i=this.$i())}for(this.Ze(i),s=0;s<this.$a;s++){for(n=0;n<=this.St;n++)this.tk(n,0),this.ls(n,0,!1,0);for(o=this.countCrossings(),o<t&&(t=o,i=this.$i()),n=this.St;n>=0;n--)this.tk(n,0),this.ls(n,0,!1,0);o=this.countCrossings(),o<t&&(t=o,i=this.$i())}this.Ze(i);let r=!1,a=0,h=0,l=0,u=0;switch(this.Wf){case 30:break;case 32:for(l=t+1;(u=this.countCrossings())<l;)for(l=u,a=this.St;a>=0;a--)for(h=0;h<=a;h++){for(r=!0;r;)for(r=!1,n=a;n>=h;n--)r=this.ls(n,-1,!1,-1)||r;for(o=this.countCrossings(),o>=t?this.Ze(i):(t=o,i=this.$i()),r=!0;r;)for(r=!1,n=a;n>=h;n--)r=this.ls(n,1,!1,1)||r;for(o=this.countCrossings(),o>=t?this.Ze(i):(t=o,i=this.$i()),r=!0;r;)for(r=!1,n=h;n<=a;n++)r=this.ls(n,1,!1,1)||r;for(o>=t?this.Ze(i):(t=o,i=this.$i()),r=!0;r;)for(r=!1,n=h;n<=a;n++)r=this.ls(n,-1,!1,-1)||r;for(o>=t?this.Ze(i):(t=o,i=this.$i()),r=!0;r;)for(r=!1,n=a;n>=h;n--)r=this.ls(n,0,!1,0)||r;for(o>=t?this.Ze(i):(t=o,i=this.$i()),r=!0;r;)for(r=!1,n=h;n<=a;n++)r=this.ls(n,0,!1,0)||r;o>=t?this.Ze(i):(t=o,i=this.$i())}break;default:case 31:for(a=this.St,h=0,l=t+1;(u=this.countCrossings())<l;){for(l=u,r=!0;r;)for(r=!1,n=a;n>=h;n--)r=this.ls(n,-1,!1,-1)||r;for(o=this.countCrossings(),o>=t?this.Ze(i):(t=o,i=this.$i()),r=!0;r;)for(r=!1,n=a;n>=h;n--)r=this.ls(n,1,!1,1)||r;for(o=this.countCrossings(),o>=t?this.Ze(i):(t=o,i=this.$i()),r=!0;r;)for(r=!1,n=h;n<=a;n++)r=this.ls(n,1,!1,1)||r;for(o>=t?this.Ze(i):(t=o,i=this.$i()),r=!0;r;)for(r=!1,n=h;n<=a;n++)r=this.ls(n,-1,!1,-1)||r;for(o>=t?this.Ze(i):(t=o,i=this.$i()),r=!0;r;)for(r=!1,n=a;n>=h;n--)r=this.ls(n,0,!1,0)||r;for(o>=t?this.Ze(i):(t=o,i=this.$i()),r=!0;r;)for(r=!1,n=h;n<=a;n++)r=this.ls(n,0,!1,0)||r;o>=t?this.Ze(i):(t=o,i=this.$i())}break}this.Ze(i)}tk(t,i){let s=0,n=!1;const o=this.Fh(t),r=this.ui[t],a=this.$T(t,i),h=this.Yy(t,i);for(s=0;s<r;s++)h[s]===-1&&(h[s]=o[s].column),a[s]===-1&&(a[s]=o[s].column);let l=!0,u;for(;l;)for(l=!1,s=0;s<r-1;s++)if(a[s+1]<a[s]||a[s+1]===a[s]&&h[s+1]<h[s]){n=!0,l=!0;const d=a[s];a[s]=a[s+1],a[s+1]=d;const m=h[s];h[s]=h[s+1],h[s+1]=m,u=o[s],o[s]=o[s+1],o[s+1]=u}let c=0;for(s=0;s<r;s++)u=o[s],u.index=s,c+=this.nodeMinColumnSpace(u,!0),u.column=c,c+=1,c+=this.nodeMinColumnSpace(u,!1);return this.Rh(t,o),n}ls(t,i,s,n){const o=this.Fh(t),r=this.ui[t],a=this.JT(t,i);let h=0,l;if(!s||n>0)for(l=[],h=0;h<r;h++)l[h]=-1;else l=this.Yy(t,-1);let u;if(!s||n<0)for(u=[],h=0;h<r;h++)u[h]=-1;else u=this.Yy(t,1);let c=!1,d=!0;for(;d;)for(d=!1,h=0;h<r-1;h++){const m=a[o[h].index*r+o[h+1].index],g=a[o[h+1].index*r+o[h].index];let p=0,y=0;const x=o[h].column,P=o[h+1].column,k=this.nodeMinColumnSpace(o[h],!0),w=this.nodeMinColumnSpace(o[h],!1),N=this.nodeMinColumnSpace(o[h+1],!0),M=this.nodeMinColumnSpace(o[h+1],!1),C=x-k+N,O=P-w+M;let T=0,L=0,F=0,D=0,R=0,I=0,j=0,X,V=0,G,$=0;const pt=o[h].sourceEdges.iterator;if(s&&n<=0)for(;pt.next();){const Ct=pt.value;X=Ct.fromVertex,Ct.valid&&X.layer!==t&&(F=this.linkStraightenWeight(Ct),D=Ct.portFromColOffset,R=Ct.portToColOffset,I=X.column,T+=(Math.abs(x+R-(I+D))+1)*F,L+=(Math.abs(O+R-(I+D))+1)*F)}for(pt.reset();pt.next();){const Ct=pt.value;if(X=Ct.fromVertex,Ct.valid&&X.layer===t){for(V=0;V<o.length&&o[V]!==X;)V++;V<h&&(p+=2*(h-V),y+=2*(h+1-V)),V===h+1&&(p+=1),V>h+1&&(p+=4*(V-h),y+=4*(V-(h+1)))}}const Q=o[h].destinationEdges.iterator;if(s&&n>=0)for(;Q.next();){const Ct=Q.value;G=Ct.toVertex,Ct.valid&&G.layer!==t&&(F=this.linkStraightenWeight(Ct),D=Ct.portFromColOffset,R=Ct.portToColOffset,j=G.column,T+=(Math.abs(x+D-(j+R))+1)*F,L+=(Math.abs(O+D-(j+R))+1)*F)}for(Q.reset();Q.next();){const Ct=Q.value;if(G=Ct.toVertex,Ct.valid&&G.layer===t){for($=0;$<o.length&&o[$]!==G;)$++;$===h+1&&(y+=1)}}const it=o[h+1].sourceEdges.iterator;if(s&&n<=0)for(;it.next();){const Ct=it.value;X=Ct.fromVertex,Ct.valid&&X.layer!==t&&(F=this.linkStraightenWeight(Ct),D=Ct.portFromColOffset,R=Ct.portToColOffset,I=X.column,T+=(Math.abs(P+R-(I+D))+1)*F,L+=(Math.abs(C+R-(I+D))+1)*F)}for(it.reset();it.next();){const Ct=it.value;if(X=Ct.fromVertex,Ct.valid&&X.layer===t){for(V=0;V<o.length&&o[V]!==X;)V++;V<h&&(p+=2*(h+1-V),y+=2*(h-V)),V===h&&(y+=1),V>h+1&&(p+=4*(V-(h+1)),y+=4*(V-h))}}const et=o[h+1].destinationEdges.iterator;if(s&&n>=0)for(;et.next();){const Ct=et.value;G=Ct.toVertex,Ct.valid&&G.layer!==t&&(F=this.linkStraightenWeight(Ct),D=Ct.portFromColOffset,R=Ct.portToColOffset,j=G.column,T+=(Math.abs(P+D-(j+R))+1)*F,L+=(Math.abs(C+D-(j+R))+1)*F)}for(et.reset();et.next();){const Ct=et.value;if(G=Ct.toVertex,Ct.valid&&G.layer===t){for($=0;$<o.length&&o[$]!==G;)$++;$===h&&(p+=1)}}let st=0,Pt=0;const wt=l[o[h].index],_=u[o[h].index],ft=l[o[h+1].index],qt=u[o[h+1].index];if(wt!==-1&&(st+=Math.abs(wt-x),Pt+=Math.abs(wt-O)),_!==-1&&(st+=Math.abs(_-x),Pt+=Math.abs(_-O)),ft!==-1&&(st+=Math.abs(ft-P),Pt+=Math.abs(ft-C)),qt!==-1&&(st+=Math.abs(qt-P),Pt+=Math.abs(qt-C)),y<p-.5||y===p&&g<m-.5||y===p&&g===m&&L<T-.5||y===p&&g===m&&L===T&&Pt<st-.5){c=!0,d=!0,o[h].column=O,o[h+1].column=C;const Ct=o[h];o[h]=o[h+1],o[h+1]=Ct}}for(h=0;h<r;h++)o[h].index=h;return this.Rh(t,o),c}straightenAndPack(){if(this.vn!==0){this.aI();return}let t=0,i=!1,s=(this.nr&1)!==0;const n=(this.nr&8)!==0;if(this.network.edges.count>1e3&&n&&(s=!1),s){const o=[];let r=0;for(r=0;r<=this.St;r++)o[r]=0;let a=0;const h=this.network.vertexes.iterator;for(;h.next();){const u=h.value;t=u.layer,a=u.column;const c=this.nodeMinColumnSpace(u,!1);o[t]=Math.max(o[t],a+c)}const l=8;for(h.reset();h.next();){const u=h.value;t=u.layer,a=u.column,u.column=((this.Kt-o[t])*l>>1)+a*l}this.Kt*=l}if(this.nr&2){i=!0;let o=0;for(;i&&o<this.Jf;){for(i=!1,t=this.Ss+1;t<=this.St;t++)i=this.Tg(t,1)||i;for(t=this.Ss-1;t>=0;t--)i=this.Tg(t,-1)||i;i=this.Tg(this.Ss,0)||i,o++}}if(this.nr&4){for(t=this.Ss+1;t<=this.St;t++)this.BN(t,1);for(t=this.Ss-1;t>=0;t--)this.BN(t,-1);this.BN(this.Ss,0)}if(s&&(this.lD(-1),this.lD(1)),this.nr&2){i=!0;let o=0;for(;i&&o<this.Jf;){for(i=!1,i=this.Tg(this.Ss,0)||i,t=this.Ss+1;t<=this.St;t++)i=this.Tg(t,0)||i;for(t=this.Ss-1;t>=0;t--)i=this.Tg(t,0)||i;o++}}}Tg(t,i){let s=!1;for(;this.cI(t,i);)s=!0;return s}cI(t,i){let s=0;const n=this.Fh(t),o=this.ui[t],r=this.Yy(t,-1);if(i>0)for(s=0;s<o;s++)r[s]=-1;const a=this.Yy(t,1);if(i<0)for(s=0;s<o;s++)a[s]=-1;let h=!1,l=!0;for(;l;)for(l=!1,s=0;s<o;s++){const u=n[s].column,c=this.nodeMinColumnSpace(n[s],!0),d=this.nodeMinColumnSpace(n[s],!1);let m=0;s-1<0||u-n[s-1].column-1>c+this.nodeMinColumnSpace(n[s-1],!1)?m=u-1:m=u;let g=0;s+1>=o||n[s+1].column-u-1>d+this.nodeMinColumnSpace(n[s+1],!0)?g=u+1:g=u;let p=0,y=0,x=0,P=0,k=0,w=0;if(i<=0){const L=n[s].sourceEdges.iterator;for(;L.next();){const F=L.value,D=F.fromVertex;if(F.valid&&D.layer!==t){P=this.linkStraightenWeight(F),k=F.portFromColOffset,w=F.portToColOffset;const R=D.column;p+=(Math.abs(u+w-(R+k))+1)*P,y+=(Math.abs(m+w-(R+k))+1)*P,x+=(Math.abs(g+w-(R+k))+1)*P}}}if(i>=0){const L=n[s].destinationEdges.iterator;for(;L.next();){const F=L.value,D=F.toVertex;if(F.valid&&D.layer!==t){P=this.linkStraightenWeight(F),k=F.portFromColOffset,w=F.portToColOffset;const R=D.column;p+=(Math.abs(u+k-(R+w))+1)*P,y+=(Math.abs(m+k-(R+w))+1)*P,x+=(Math.abs(g+k-(R+w))+1)*P}}}let N=0,M=0,C=0;const O=r[n[s].index],T=a[n[s].index];O!==-1&&(N+=Math.abs(O-u),M+=Math.abs(O-m),C+=Math.abs(O-g)),T!==-1&&(N+=Math.abs(T-u),M+=Math.abs(T-m),C+=Math.abs(T-g)),y<p||y===p&&M<N?(h=!0,l=!0,n[s].column=m):(x<p||x===p&&C<N)&&(h=!0,l=!0,n[s].column=g)}return this.Rh(t,n),this.Ky(),h}BN(t,i){let s=0;const n=this.Fh(t),o=this.ui[t],r=this.$T(t,i),a=[];for(s=0;s<o;s++)a[s]=r[s];let h=!1,l=!0;for(;l;)for(l=!1,s=0;s<o;s++){const u=n[s].column,c=this.nodeMinColumnSpace(n[s],!0),d=this.nodeMinColumnSpace(n[s],!1);let m=0,g=0,p=0,y=0,x=0;a[s]===-1?s===0&&s===o-1?m=u:s===0?(g=n[s+1].column,g-u===d+this.nodeMinColumnSpace(n[s+1],!0)?m=u-1:m=u):s===o-1?(p=n[s-1].column,u-p===c+this.nodeMinColumnSpace(n[s-1],!1)?m=u+1:m=u):(p=n[s-1].column,x=p+this.nodeMinColumnSpace(n[s-1],!1)+c+1,g=n[s+1].column,y=g-this.nodeMinColumnSpace(n[s+1],!0)-d-1,m=(x+y)/2|0):s===0&&s===o-1?m=a[s]:s===0?(g=n[s+1].column,y=g-this.nodeMinColumnSpace(n[s+1],!0)-d-1,m=Math.min(a[s],y)):s===o-1?(p=n[s-1].column,x=p+this.nodeMinColumnSpace(n[s-1],!1)+c+1,m=Math.max(a[s],x)):(p=n[s-1].column,x=p+this.nodeMinColumnSpace(n[s-1],!1)+c+1,g=n[s+1].column,y=g-this.nodeMinColumnSpace(n[s+1],!0)-d-1,x<a[s]&&a[s]<y?m=a[s]:x>=a[s]?m=x:y<=a[s]&&(m=y)),m!==u&&(h=!0,l=!0,n[s].column=m)}return this.Rh(t,n),this.Ky(),h}fI(){for(let t=0;t<=this.Kt;t++)for(;this.uI(t,1););this.Ky()}uI(t,i){let s=!0;const n=this.network.vertexes.iterator;for(;n.next();){const r=n.value,a=this.nodeMinColumnSpace(r,!0),h=this.nodeMinColumnSpace(r,!1);if(r.column-a<=t&&r.column+h>=t){s=!1;break}}let o=!1;if(s){if(i>0)for(n.reset();n.next();){const r=n.value;r.column>t&&(r.column-=1,o=!0)}if(i<0)for(n.reset();n.next();){const r=n.value;r.column<t&&(r.column+=1,o=!0)}}return o}dI(){this.fI();for(let t=0;t<this.Kt;t++)for(;this.gI(t,1););this.Ky()}gI(t,i){let s=t;i>0&&(s=t+1),i<0&&(s=t-1);let n=0;const o=[],r=[];for(n=0;n<=this.St;n++)o[n]=!1,r[n]=!1;const a=this.network.vertexes.iterator;for(;a.next();){const u=a.value,c=u.column-this.nodeMinColumnSpace(u,!0),d=u.column+this.nodeMinColumnSpace(u,!1);c<=t&&d>=t&&(o[u.layer]=!0),c<=s&&d>=s&&(r[u.layer]=!0)}let h=!0,l=!1;for(n=0;n<=this.St;n++)h=h&&!(o[n]&&r[n]);if(h){if(i>0)for(a.reset();a.next();){const u=a.value;u.column>t&&(u.column-=1,l=!0)}if(i<0)for(a.reset();a.next();){const u=a.value;u.column<t&&(u.column+=1,l=!0)}}return l}lD(t){this.dI();let i=0,s,n=0,o=0,r=0;if(t>0)for(i=0;i<=this.Kt;i++)for(s=this.$i(),n=this.Z1(!0),o=n+1;n<o;)o=n,this.hD(i,1),r=this.Z1(!0),r>n?this.Ze(s):r<n&&(n=r,s=this.$i());if(t<0)for(i=this.Kt;i>=0;i--)for(s=this.$i(),n=this.Z1(!0),o=n+1;n<o;)o=n,this.hD(i,-1),r=this.Z1(!0),r>n?this.Ze(s):r<n&&(n=r,s=this.$i());this.Ky()}hD(t,i){this._s=0;const s=this.network.vertexes.iterator;for(;s.next();){const c=s.value;c.component=-1}if(i>0)for(s.reset();s.next();){const c=s.value;c.column-this.nodeMinColumnSpace(c,!0)<=t&&(c.component=this._s)}if(i<0)for(s.reset();s.next();){const c=s.value;c.column+this.nodeMinColumnSpace(c,!1)>=t&&(c.component=this._s)}for(this._s++,s.reset();s.next();){const c=s.value;c.component===-1&&(this.IN(c,this._s,-1,!0,!0),this._s++)}let n=0;const o=[];for(n=0;n<this._s*this._s;n++)o[n]=!1;const r=[];for(n=0;n<(this.St+1)*(this.Kt+1);n++)r[n]=-1;for(s.reset();s.next();){const c=s.value,d=c.layer,m=Math.max(0,c.column-this.nodeMinColumnSpace(c,!0)),g=Math.min(this.Kt,c.column+this.nodeMinColumnSpace(c,!1));for(let p=m;p<=g;p++)r[d*(this.Kt+1)+p]=c.component}for(let c=0;c<=this.St;c++){if(i>0)for(let d=0;d<this.Kt;d++)r[c*(this.Kt+1)+d]!==-1&&r[c*(this.Kt+1)+d+1]!==-1&&r[c*(this.Kt+1)+d]!==r[c*(this.Kt+1)+d+1]&&(o[r[c*(this.Kt+1)+d]*this._s+r[c*(this.Kt+1)+d+1]]=!0);if(i<0)for(let d=this.Kt;d>0;d--)r[c*(this.Kt+1)+d]!==-1&&r[c*(this.Kt+1)+d-1]!==-1&&r[c*(this.Kt+1)+d]!==r[c*(this.Kt+1)+d-1]&&(o[r[c*(this.Kt+1)+d]*this._s+r[c*(this.Kt+1)+d-1]]=!0)}const a=[];for(n=0;n<this._s;n++)a[n]=!0;const h=[];h.push(0);let l=0;for(;h.length!==0;)if(l=h[h.length-1],h.pop(),a[l])for(a[l]=!1,n=0;n<this._s;n++)o[l*this._s+n]&&h.splice(0,0,n);let u=!1;if(i>0)for(s.reset();s.next();){const c=s.value;a[c.component]&&(c.column-=1,u=!0)}if(i<0)for(s.reset();s.next();){const c=s.value;a[c.component]&&(c.column+=1,u=!0)}return u}aI(){const t=b.nt(),i=this.$f.length;for(let m=0;m<=i;m++)t[m]=[];const s=this.network.vertexes.iterator;for(;s.next();){const m=s.value,g=i-m.layer,p=t[g];p[m.index]=m}const n=new K;this.mI(t,n);let o=null,r=null,a=null,h=null;const l=(this.vn&1)!==0,u=(this.vn&2)!==0,c=(this.vn&4)!==0,d=(this.vn&8)!==0;l&&(this.sl(t,n,!0),o=this.ik(t,!0,!1)),t.reverse(),c&&(this.sl(t,n,!1),a=this.ik(t,!1,!1));for(const m of t)m.reverse();d&&(this.sl(t,n,!1),h=this.ik(t,!1,!0)),t.reverse(),u&&(this.sl(t,n,!0),r=this.ik(t,!0,!0)),b.tt(t),this.pI(o,r,a,h),this.network.vertexes.each(m=>{const g=m,p=b.nt();l&&p.push(o.get(g)),u&&p.push(r.get(g)),c&&p.push(a.get(g)),d&&p.push(h.get(g)),p.sort((w,N)=>w-N);const y=p.length,x=Math.floor((y-1)/2),P=Math.ceil((y-1)/2),k=(p[x]+p[P])/2;b.tt(p),g.he=k})}mI(t,i){const s=t.length;for(let n=1;n<s-1;n++){let o=0,r=0;const a=t[n],h=t[n+1];for(let l=0;r<h.length;l++){const u=h[l],c=this.yI(u);if(l===h.length-1||c){let d=a.length-1;for(c&&(d=u.getProperSourceVertexes()[0].index);r<=l;){const m=h[r].getProperSourceEdges();for(const g of m){const p=g.fromVertex.index;(p<o||p>d)&&i.add(g)}r++}o=d}}}}yI(t){if(t.node===null){const i=t.getProperSourceVertexes();if(i.length>0)return i[0].node===null}return!1}sl(t,i,s){this.wI(t);for(const n of t){let o=-1;for(const r of n){const a=s?r.getProperSourceVertexes():r.getProperDestinationVertexes(),h=a.length;if(h>0){a.sort((u,c)=>u.vh-c.vh);const l=(h-1)/2;for(let u=Math.floor(l),c=Math.ceil(l);u<=c;u++)if(r.On===r){const d=a[u];let m;s?m=d.getDestinationEdge(r):m=r.getDestinationEdge(d),!i.has(m)&&o<d.vh&&(d.On=r,r.Qa=d.Qa,r.On=d.Qa,o=d.vh)}}}}}wI(t){for(let i=0;i<t.length;i++){const s=t[i];for(let n=0;n<s.length;n++){const o=s[n];o.Qa=o,o.On=o,o.aD=i,o.vh=n}}}ik(t,i,s){const n=this.S===90||this.S===270;for(const r of t)for(const a of r)a.Qe=a,a.Qf=1/0,a.he=NaN,a.In=0;this.xI(t,i,s);for(const r of t)for(const a of r)a.Qa===a&&this.cD(a,t);for(let r=0;r<t.length;r++){if(t[r].length<=0)continue;const a=t[r][0];if(a.Qe===a){a.Qe.Qf===1/0&&(a.Qe.Qf=0);let h=r,l=0,u;do{for(u=t[h][l];u.On!==u.Qa;)if(u=u.On,h++,u.vh>0){const c=this.fD(u,t),d=n?c.width:c.height,m=u.Qe.Qf+u.he+u.In-(c.he+c.In+d+this.columnSpacing);c.Qe.Qf=Math.min(c.Qe.Qf,m)}l=u.vh+1}while(h<t.length&&l<t[h].length&&u.Qe===t[h][l].Qe)}}const o=new St;for(const r of t)for(const a of r){a.he=a.he+a.Qe.Qf+a.In;const h=n?a.width:a.height;o.set(a,s?-a.he-h:a.he)}return o}xI(t,i,s){const n=this.S===90||this.S===270;for(const o of t)for(const r of o)if(r.Qa===r){let a=0,h=r;for(;h.On!==r;){const l=h.On,u=n?h.width:h.height,c=n?l.width:l.height;let d,m,g,p;i?(g=h.getDestinationEdge(l),d=g.portFromPos,m=g.portToPos,g.link!==null&&(h.node&&h.node!==g.link.fromNode&&(d=n?h.focusX:h.focusY),l.node&&l.node!==g.link.toNode&&(m=n?l.focusX:l.focusY)),s?p=h.In+(u-d)-(c-m):p=h.In+d-m):(g=l.getDestinationEdge(h),d=g.portToPos,m=g.portFromPos,g.link!==null&&(h.node&&h.node!==g.link.toNode&&(d=n?h.focusX:h.focusY),l.node&&l.node!==g.link.fromNode&&(m=n?l.focusX:l.focusY)),s?p=h.In+(u-d)-(c-m):p=h.In+d-m),l.In=p,a=Math.min(a,p),h=h.On}h=r;do h.In=h.In-a,h=h.On;while(h!==r)}}cD(t,i){if(!isNaN(t.he))return;t.he=0;let s=t;do{if(s.vh>0){const n=this.fD(s,i),o=n.Qa;this.cD(o,i),t.Qe===t&&(t.Qe=o.Qe);const r=this.S===90||this.S===270?n.width:n.height;if(t.Qe===o.Qe){const a=o.he+n.In+r-s.In+this.columnSpacing;t.he=Math.max(t.he,a)}}s=s.On}while(s!==t);for(;s.On!==t;)s=s.On,s.he=t.he,s.Qe=t.Qe}fD(t,i){const s=t.aD,n=t.vh;return n<1&&b.o("Could not determine previous vertex in layer"),i[s][n-1]}pI(...t){let i=-1;const s=b.nt(),n=b.nt();let o=1/0;for(let r=0;r<4;r++){if(!t[r])continue;const a=this.bI(t[r],s,n,r);a<o&&(i=r,o=a)}for(let r=0;r<4;r++){const a=t[r];if(!a)continue;const h=r===0||r===2?s[i]-s[r]:n[i]-n[r];h!==0&&a.each(l=>{a.set(l.key,l.value+h)})}b.tt(s),b.tt(n)}bI(t,i,s,n){if(!t||t.count===0)return i[n]=0,s[n]=0,1/0;let o=1/0,r=-1/0;return t.each(a=>{const h=a.key,l=a.value,u=this.S===90||this.S===270?h.width:h.height;l<o&&(o=l),l+u>r&&(r=l+u)}),i[n]=o,s[n]=r,r-o}commitLayout(){this.zy(),this.commitNodes(),this.UN(),this.isRouting&&this.commitLinks()}zy(){if(!this.setsPortSpots)return;const t=this._1(!0),i=this._1(!1),s=this.network.edges.iterator;for(;s.next();){const n=s.value.link;n!==null&&(n.fromSpot=t,n.toSpot=i)}}_1(t){return this.S===270?t?B.MiddleTop:B.MiddleBottom:this.S===90?t?B.MiddleBottom:B.MiddleTop:this.S===180?t?B.MiddleLeft:B.MiddleRight:t?B.MiddleRight:B.MiddleLeft}commitNodes(){this.Qs=[],this.Ms=[],this.Ns=[],this.Ut=[];for(let g=0;g<=this.St;g++)this.Qs[g]=0,this.Ms[g]=0,this.Ns[g]=0,this.Ut[g]=0;const t=this.network.vertexes.iterator;for(;t.next();){const g=t.value,p=g.layer;this.Qs[p]=Math.max(this.Qs[p],this.nodeMinLayerSpace(g,!0)),this.Ms[p]=Math.max(this.Ms[p],this.nodeMinLayerSpace(g,!1))}let i=0;const s=this.Ps;for(let g=0;g<=this.St;g++){let p=s;this.Qs[g]+this.Ms[g]<=0&&(p=0),g>0&&(i+=p/2),this.S===90||this.S===0?(i+=this.Ms[g],this.Ns[g]=i,i+=this.Qs[g]):(i+=this.Qs[g],this.Ns[g]=i,i+=this.Ms[g]),g<this.St&&(i+=p/2),this.Ut[g]=i}const n=i,o=this.arrangementOrigin;for(let g=0;g<=this.St;g++)this.S===270?this.Ns[g]=o.y+this.Ns[g]:this.S===90?(this.Ns[g]=o.y+n-this.Ns[g],this.Ut[g]=n-this.Ut[g]):this.S===180?this.Ns[g]=o.x+this.Ns[g]:(this.Ns[g]=o.x+n-this.Ns[g],this.Ut[g]=n-this.Ut[g]);const r=this.vn!==0;t.reset();const a=this.S===270||this.S===90;let h=1/0,l=1/0,u=1/0,c=-1/0;for(;t.next();){const g=t.value,p=g.layer,y=g.column|0;let x=0,P=0;a?(x=o.x+this.Ji*y,P=this.Ns[p]):(x=this.Ns[p],P=o.y+this.Ji*y),g.centerX=x,g.centerY=P,r&&isFinite(g.he)&&(a?g.node?g.x=o.x+g.he:g.centerX=o.x+g.he:g.node?g.y=o.y+g.he:g.centerY=o.y+g.he),h=Math.min(g.x,h),l=Math.min(g.y,l),a?(u=h,c=Math.max(c,g.bounds.right)):(u=l,c=Math.max(c,g.bounds.bottom))}this.ON=c-u;const d=o.x-h,m=o.y-l;for(this.or=new S(r&&a?0:d,r&&!a?0:m),t.reset();t.next();){const g=t.value;g.x+=d,g.y+=m,g.commit()}}UN(){let t=0;const i=this.Ps;for(let o=0;o<=this.St;o++)t+=this.Qs[o],t+=this.Ms[o];t+=this.St*i;const s=[],n=this.vn!==0?this.ON:this.Ji*this.Kt;for(let o=this.maxLayer;o>=0;o--)this.S===270?o===0?s.push(new z(0,0,n,Math.abs(this.Ut[0]))):s.push(new z(0,this.Ut[o-1],n,Math.abs(this.Ut[o-1]-this.Ut[o]))):this.S===90?o===0?s.push(new z(0,this.Ut[0],n,Math.abs(this.Ut[0]-t))):s.push(new z(0,this.Ut[o],n,Math.abs(this.Ut[o-1]-this.Ut[o]))):this.S===180?o===0?s.push(new z(0,0,Math.abs(this.Ut[0]),n)):s.push(new z(this.Ut[o-1],0,Math.abs(this.Ut[o-1]-this.Ut[o]),n)):o===0?s.push(new z(this.Ut[0],0,Math.abs(this.Ut[0]-t),n)):s.push(new z(this.Ut[o],0,Math.abs(this.Ut[o-1]-this.Ut[o]),n));this.commitLayers(s,this.or)}commitLayers(t,i){}commitLinks(){const t=this.network.edges.iterator;let i;for(;t.next();)i=t.value.link,i!==null&&(i.startRoute(),i.clearPoints(),i.commitRoute());for(t.reset();t.next();)i=t.value.link,i!==null&&i.updateRoute();for(t.reset();t.next();){const s=t.value;if(i=s.link,i===null||i.pointsCount===0)continue;i.startRoute();const n=i;let o=n.fromNode,r=n.toNode,a=n.fromPort,h=n.toPort;if(o!==null){const F=o.findVisibleNode();F!==null&&F!==o&&(o=F,a=F.port)}if(r!==null){const F=r.findVisibleNode();F!==null&&F!==r&&(r=F,h=F.port)}const l=i.computeSpot(!0,a),u=i.computeSpot(!1,h);let c=s.fromVertex,d=s.toVertex;if(s.valid){if(i.curve===9&&i.pointsCount===4)if(c.column===d.column&&this.alignOption===0){const F=i.getLinkPoint(o,a,l,!0,!1,r,h),D=i.getLinkPoint(r,h,u,!1,!1,o,a);F.isReal()||F.set(o.actualBounds.center),D.isReal()||D.set(r.actualBounds.center),i.clearPoints(),i.addPointAt(F.x,F.y),i.addPointAt((2*F.x+D.x)/3,(2*F.y+D.y)/3),i.addPointAt((F.x+2*D.x)/3,(F.y+2*D.y)/3),i.addPointAt(D.x,D.y)}else{let F=!1,D=!1;if(a!==null&&l===B.None&&(F=!0),h!==null&&u===B.None&&(D=!0),F||D){let R=null;F&&(R=i.getLinkPointFromPoint(o,a,a.getDocumentPoint(B.Center),i.getPoint(3),!0),R.isReal()||R.set(o.actualBounds.center),i.setPointAt(0,R.x,R.y));let I=null;if(D&&(I=i.getLinkPointFromPoint(r,h,h.getDocumentPoint(B.Center),i.getPoint(0),!1),I.isReal()||I.set(r.actualBounds.center),i.setPointAt(3,I.x,I.y)),R){const j=i.getPoint(2);i.setPointAt(1,(R.x*2+j.x)/3,(R.y*2+j.y)/3)}if(I){const j=i.getPoint(1);i.setPointAt(2,(I.x*2+j.x)/3,(I.y*2+j.y)/3)}}}i.commitRoute();continue}if(c.layer===d.layer){i.commitRoute();continue}let m=!1,g=!1;const p=this.Ps;let y=0,x=i.firstPickIndex+1;if(i.isOrthogonal)g=!0,y=i.pointsCount,y>4&&i.points.removeRange(2,y-3);else if(i.curve===9)m=!0,y=i.pointsCount,y>4&&i.points.removeRange(2,y-3),y===4&&(x=2);else{y=i.pointsCount;const F=l===B.None,D=u===B.None;y>2&&F&&D?i.points.removeRange(1,y-2):y>3&&F&&!D?i.points.removeRange(1,y-3):y>3&&!F&&D?i.points.removeRange(2,y-2):y>4&&!F&&!D&&i.points.removeRange(2,y-3)}let P,k,w=0,N=0,M=0,C=0,O=0,T=0,L=0;if(s.rev){let F=0;for(;d!==null&&c!==d;){P=null,k=null;const D=d.sourceEdges.iterator;for(;D.next();){const R=D.value;if(R.link===s.link&&(P=R.fromVertex,k=R.toVertex,P.node===null))break}if(P===null)break;if(P!==c)if(w=i.getPoint(x-1).x,N=i.getPoint(x-1).y,M=P.centerX,C=P.centerY,g)this.S===180||this.S===0?x===i.firstPickIndex+1?(i.insertPointAt(x++,w,N),i.insertPointAt(x++,w,C)):(k!==null?k.centerY:N)!==C&&(O=this.Ut[P.layer-1]+this.or.x,i.insertPointAt(x++,O,N),i.insertPointAt(x++,O,C)):x===i.firstPickIndex+1?(i.insertPointAt(x++,w,N),i.insertPointAt(x++,M,N)):(k!==null?k.centerX:w)!==M&&(O=this.Ut[P.layer-1]+this.or.y,i.insertPointAt(x++,w,O),i.insertPointAt(x++,M,O));else if(x===i.firstPickIndex+1)if(T=Math.max(10,this.Qs[d.layer]),L=Math.max(10,this.Ms[d.layer]),m)this.S===180?M<=d.bounds.x?(F=d.bounds.x,i.insertPointAt(x++,F-T,C),i.insertPointAt(x++,F,C),i.insertPointAt(x++,F+L,C)):(i.insertPointAt(x++,M-T,C),i.insertPointAt(x++,M,C),i.insertPointAt(x++,M+L,C)):this.S===90?C>=d.bounds.bottom?(F=d.bounds.y+d.bounds.height,i.insertPointAt(x++,M,F+L),i.insertPointAt(x++,M,F),i.insertPointAt(x++,M,F-T)):(i.insertPointAt(x++,M,C+L),i.insertPointAt(x++,M,C),i.insertPointAt(x++,M,C-T)):this.S===270?C<=d.bounds.y?(F=d.bounds.y,i.insertPointAt(x++,M,F-T),i.insertPointAt(x++,M,F),i.insertPointAt(x++,M,F+L)):(i.insertPointAt(x++,M,C-T),i.insertPointAt(x++,M,C),i.insertPointAt(x++,M,C+L)):this.S===0&&(M>=d.bounds.right?(F=d.bounds.x+d.bounds.width,i.insertPointAt(x++,F+L,C),i.insertPointAt(x++,F,C),i.insertPointAt(x++,F-T,C)):(i.insertPointAt(x++,M+L,C),i.insertPointAt(x++,M,C),i.insertPointAt(x++,M-T,C)));else{i.insertPointAt(x++,w,N);let R=0;this.S===180||this.S===0?((this.S===180?M>=d.bounds.right:M<=d.bounds.x)&&(R=(this.S===0?-T:L)/2),i.insertPointAt(x++,w+R,C)):((this.S===270?C>=d.bounds.bottom:C<=d.bounds.y)&&(R=(this.S===90?-T:L)/2),i.insertPointAt(x++,M,N+R)),i.insertPointAt(x++,M,C)}else T=Math.max(10,this.Qs[P.layer]),L=Math.max(10,this.Ms[P.layer]),m?this.S===180?(i.insertPointAt(x++,M-T-p,C),i.insertPointAt(x++,Math.min(M-T+p/2,M),C),i.insertPointAt(x++,M,C),i.insertPointAt(x++,M,C),i.insertPointAt(x++,Math.max(M+L-p/2,M),C),i.insertPointAt(x++,M+L+p,C)):this.S===90?(i.insertPointAt(x++,M,C+L+p),i.insertPointAt(x++,M,Math.max(C+L-p/2,C)),i.insertPointAt(x++,M,C),i.insertPointAt(x++,M,C),i.insertPointAt(x++,M,Math.min(C-T+p/2,C)),i.insertPointAt(x++,M,C-T-p)):this.S===270?(i.insertPointAt(x++,M,C-T-p),i.insertPointAt(x++,M,Math.min(C-T+p/2,C)),i.insertPointAt(x++,M,C),i.insertPointAt(x++,M,C),i.insertPointAt(x++,M,Math.max(C+L-p/2,C)),i.insertPointAt(x++,M,C+L+p)):(i.insertPointAt(x++,M+L+p,C),i.insertPointAt(x++,Math.max(M+L-p/2,M),C),i.insertPointAt(x++,M,C),i.insertPointAt(x++,M,C),i.insertPointAt(x++,Math.min(M-T+p/2,M),C),i.insertPointAt(x++,M-T-p,C)):(this.S===180||this.S===90||this.S,i.insertPointAt(x++,M,C));d=P}if(h===null||l!==B.None||g)if(w=i.getPoint(x-1).x,N=i.getPoint(x-1).y,M=i.getPoint(x).x,C=i.getPoint(x).y,g){const D=this.Ms[c.layer];let R=0;this.S===180||this.S===0?(R=N,R>=c.bounds.y&&R<=c.bounds.bottom&&(this.S===180?M>=c.bounds.x:M<=c.bounds.right)&&(F=c.centerX+(this.S===180?-D:D),R<c.bounds.y+c.bounds.height/2?R=c.bounds.y-this.Ji/2:R=c.bounds.bottom+this.Ji/2,i.insertPointAt(x++,F,N),i.insertPointAt(x++,F,R)),i.insertPointAt(x++,M,R),i.insertPointAt(x++,M,C)):(R=w,R>=c.bounds.x&&R<=c.bounds.right&&(this.S===270?C>=c.bounds.y:C<=c.bounds.bottom)&&(F=c.centerY+(this.S===270?-D:D),R<c.bounds.x+c.bounds.width/2?R=c.bounds.x-this.Ji/2:R=c.bounds.right+this.Ji/2,i.insertPointAt(x++,w,F),i.insertPointAt(x++,R,F)),i.insertPointAt(x++,R,C),i.insertPointAt(x++,M,C))}else if(m)T=Math.max(10,this.Qs[c.layer]),L=Math.max(10,this.Ms[c.layer]),this.S===180&&M>=c.bounds.x?(F=c.bounds.x+c.bounds.width,i.setPointAt(x-2,F,N),i.setPointAt(x-1,F+L,N)):this.S===90&&C<=c.bounds.bottom?(F=c.bounds.y,i.setPointAt(x-2,w,F),i.setPointAt(x-1,w,F-T)):this.S===270&&C>=c.bounds.y?(F=c.bounds.y+c.bounds.height,i.setPointAt(x-2,w,F),i.setPointAt(x-1,w,F+L)):this.S===0&&M<=c.bounds.right&&(F=c.bounds.x,i.setPointAt(x-2,F,N),i.setPointAt(x-1,F-T,N));else{T=Math.max(10,this.Qs[c.layer]),L=Math.max(10,this.Ms[c.layer]);let D=0;this.S===180||this.S===0?((this.S===180?M<=c.bounds.x:M>=c.bounds.right)&&(D=(this.S===0?L:-T)/2),i.insertPointAt(x++,M+D,N)):((this.S===270?C<=c.bounds.y:C>=c.bounds.bottom)&&(D=(this.S===90?L:-T)/2),i.insertPointAt(x++,w,C+D)),i.insertPointAt(x++,M,C)}}else{for(;c!==null&&c!==d;){P=null,k=null;const F=c.destinationEdges.iterator;for(;F.next();){const D=F.value;if(D.link===s.link&&(P=D.toVertex,k=D.fromVertex,k.node!==null&&(k=null),P.node===null))break}if(P===null)break;P!==d&&(w=i.getPoint(x-1).x,N=i.getPoint(x-1).y,M=P.centerX,C=P.centerY,g?this.S===180||this.S===0?(k!==null?k.centerY:N)!==C&&(O=this.Ut[P.layer]+this.or.x,x===i.firstPickIndex+1&&(this.S===0?O=Math.max(O,w):O=Math.min(O,w)),i.insertPointAt(x++,O,N),i.insertPointAt(x++,O,C)):(k!==null?k.centerX:w)!==M&&(O=this.Ut[P.layer]+this.or.y,x===i.firstPickIndex+1&&(this.S===90?O=Math.max(O,N):O=Math.min(O,N)),i.insertPointAt(x++,w,O),i.insertPointAt(x++,M,O)):(T=Math.max(10,this.Qs[P.layer]),L=Math.max(10,this.Ms[P.layer]),m?this.S===180?(i.insertPointAt(x++,M+L+p,C),i.insertPointAt(x++,Math.max(M+L-p/2,M),C),i.insertPointAt(x++,M,C),i.insertPointAt(x++,M,C),i.insertPointAt(x++,Math.min(M-T+p/2,M),C),i.insertPointAt(x++,M-T-p,C)):this.S===90?(i.insertPointAt(x++,M,C-T-p),i.insertPointAt(x++,M,Math.min(C-T+p/2,C)),i.insertPointAt(x++,M,C),i.insertPointAt(x++,M,C),i.insertPointAt(x++,M,Math.max(C+L-p/2,C)),i.insertPointAt(x++,M,C+L+p)):this.S===270?(i.insertPointAt(x++,M,C+L+p),i.insertPointAt(x++,M,Math.max(C+L-p/2,C)),i.insertPointAt(x++,M,C),i.insertPointAt(x++,M,C),i.insertPointAt(x++,M,Math.min(C-T+p/2,C)),i.insertPointAt(x++,M,C-T-p)):(i.insertPointAt(x++,M-T-p,C),i.insertPointAt(x++,Math.min(M-T+p/2,M),C),i.insertPointAt(x++,M,C),i.insertPointAt(x++,M,C),i.insertPointAt(x++,Math.max(M+L-p/2,M),C),i.insertPointAt(x++,M+L+p,C)):this.S===180?(i.insertPointAt(x++,M+L,C),i.insertPointAt(x++,M-T,C)):this.S===90?(i.insertPointAt(x++,M,C-T),i.insertPointAt(x++,M,C+L)):this.S===270?(i.insertPointAt(x++,M,C+L),i.insertPointAt(x++,M,C-T)):(i.insertPointAt(x++,M-T,C),i.insertPointAt(x++,M+L,C)))),c=P}g&&(w=i.getPoint(x-1).x,N=i.getPoint(x-1).y,M=i.getPoint(x).x,C=i.getPoint(x).y,this.S===180||this.S===0?N!==C&&(this.S===0?O=Math.min(Math.max((M+w)/2,this.Ut[d.layer]+this.or.x),M):O=Math.max(Math.min((M+w)/2,this.Ut[d.layer]+this.or.x),M),i.insertPointAt(x++,O,N),i.insertPointAt(x++,O,C)):w!==M&&(this.S===90?O=Math.min(Math.max((C+N)/2,this.Ut[d.layer]+this.or.y),C):O=Math.max(Math.min((C+N)/2,this.Ut[d.layer]+this.or.y),C),i.insertPointAt(x++,w,O),i.insertPointAt(x++,M,O)))}if(n!==null&&m&&i.pointsCount>=4){if(a!==null){const F=l===B.None?i.getLinkPointFromPoint(o,a,a.getDocumentPoint(B.Center),i.getPoint(3),!0):i.getPoint(0);if(l===B.None){const D=i.getPoint(2),R=i.getPoint(3);this.direction===90||this.direction===270?(i.setPointAt(1,(F.x+D.x)/2,D.y),i.setPointAt(2,R.x,(D.y+R.y)/2)):(i.setPointAt(1,D.x,(F.y+D.y)/2),i.setPointAt(2,(D.x+R.x)/2,R.y))}F.isReal()||F.set(o.actualBounds.center),i.setPointAt(0,F.x,F.y)}if(h!==null){const F=u===B.None?i.getLinkPointFromPoint(r,h,h.getDocumentPoint(B.Center),i.getPoint(i.pointsCount-4),!1):i.getPoint(i.pointsCount-1);if(u===B.None){const D=i.getPoint(i.pointsCount-3),R=i.getPoint(i.pointsCount-4);this.direction===90||this.direction===270?(i.setPointAt(i.pointsCount-2,(F.x+D.x)/2,D.y),i.setPointAt(i.pointsCount-2,R.x,(D.y+R.y)/2)):(i.setPointAt(i.pointsCount-2,D.x,(F.y+D.y)/2),i.setPointAt(i.pointsCount-3,(D.x+R.x)/2,R.y))}F.isReal()||F.set(r.actualBounds.center),i.setPointAt(i.pointsCount-1,F.x,F.y)}}i.commitRoute(),s.commit()}}YO(){this.Xy=-1,this.Cg=0,this.Ss=0,this.Za=null,this.Ag=null,this.$f=null;for(let t=0;t<this.Rn.length;t++)this.Rn[t]=null}Fh(t){let i;const s=this.ui[t];if(s>=this.Rn.length){const o=[];for(let r=0;r<this.Rn.length;r++)o[r]=this.Rn[r];this.Rn=o}this.Rn[s]===void 0||this.Rn[s]===null?i=[]:(i=this.Rn[s],this.Rn[s]=null);const n=this.$f[t];for(let o=0;o<n.length;o++){const r=n[o];i[r.index]=r}return i}Rh(t,i){this.Rn[this.ui[t]]=i}get layerSpacing(){return this.Ps}set layerSpacing(t){this.Ps!==t&&t>=0&&(this.Ps=t,this.invalidateLayout())}get columnSpacing(){return this.Ji}set columnSpacing(t){this.Ji!==t&&t>0&&(this.Ji=t,this.invalidateLayout())}get direction(){return this.S}set direction(t){this.S!==t&&(t===0||t===90||t===180||t===270?(this.S=t,this.invalidateLayout()):b.o("LayeredDigraphLayout.direction must be 0, 90, 180, or 270"))}get cycleRemoveOption(){return this.jf}set cycleRemoveOption(t){this.jf!==t&&(t===1||t===0||t===2)&&(this.jf=t,this.invalidateLayout())}get layeringOption(){return this.Hf}set layeringOption(t){this.Hf!==t&&(t===10||t===11||t===12)&&(this.Hf=t,this.invalidateLayout())}get initializeOption(){return this.qf}set initializeOption(t){this.qf!==t&&(t===20||t===21||t===22)&&(this.qf=t,this.invalidateLayout())}get iterations(){return this.$a}set iterations(t){this.$a!==t&&t>=0&&(this.$a=t,this.invalidateLayout())}get aggressiveOption(){return this.Wf}set aggressiveOption(t){this.Wf!==t&&(t===30||t===31||t===32)&&(this.Wf=t,this.invalidateLayout())}get packOption(){return this.nr}set packOption(t){this.nr!==t&&t>=0&&t<8&&(this.nr=t,this.invalidateLayout())}get packIterations(){return this.Jf}set packIterations(t){this.Jf=t}get alignOption(){return this.vn}set alignOption(t){this.vn!==t&&t>=0&&t<16&&(this.vn=t,this.invalidateLayout())}get setsPortSpots(){return this.Fn}set setsPortSpots(t){this.Fn!==t&&(this.Fn=t,this.invalidateLayout())}get maxLayer(){return this.St}get maxIndex(){return this.Xy}get maxColumn(){return this.Kt}get minIndexLayer(){return this.Cg}get maxIndexLayer(){return this.Ss}}f(ne,"CycleDepthFirst",0),f(ne,"CycleGreedy",1),f(ne,"CycleFromLayers",2),f(ne,"LayerOptimalLinkLength",10),f(ne,"LayerLongestPathSink",11),f(ne,"LayerLongestPathSource",12),f(ne,"InitDepthFirstOut",20),f(ne,"InitDepthFirstIn",21),f(ne,"InitNaive",22),f(ne,"AggressiveNone",30),f(ne,"AggressiveLess",31),f(ne,"AggressiveMore",32),f(ne,"PackNone",0),f(ne,"PackExpand",1),f(ne,"PackStraighten",2),f(ne,"PackMedian",4),f(ne,"PackAll",15),f(ne,"AlignNone",0),f(ne,"AlignUpperLeft",1),f(ne,"AlignUpperRight",2),f(ne,"AlignLowerLeft",4),f(ne,"AlignLowerRight",8),f(ne,"AlignAll",15);class Nn extends Mi{constructor(e){super(e)}createVertex(){return new ls(this)}createEdge(){return new Cn(this)}}class ls extends Ni{constructor(t){super(t);f(this,"Wo");f(this,"Uo");f(this,"Dt");f(this,"ek");f(this,"sk");f(this,"Zi");f(this,"Zf");f(this,"jn");f(this,"Q1");f(this,"J1");f(this,"$1");f(this,"Qa");f(this,"On");f(this,"aD");f(this,"vh");f(this,"Qe");f(this,"Qf");f(this,"he");f(this,"In");f(this,"jy",null);f(this,"Hy",null);f(this,"qy",null);f(this,"Wy",null);this.Wo=-1,this.Uo=-1,this.Dt=-1,this.ek=NaN,this.sk=null,this.Zi=!1,this.Zf=NaN,this.jn=NaN,this.Q1=0,this.J1=null,this.$1=null}static uD(t,i){return t.index-i.index}getProperSourceEdges(){if(!this.qy){const t=[];for(const i of this.po){const s=i;s.valid&&t.push(s)}this.qy=t}return this.qy}getProperDestinationEdges(){if(!this.Wy){const t=[];for(const i of this.ir){const s=i;s.valid&&t.push(s)}this.Wy=t}return this.Wy}getDestinationEdge(t){const i=this.getProperDestinationEdges();for(const s of i)if(s.toVertex===t)return s;b.o("Unable to find destination edge to given vertex")}getProperSourceVertexes(){if(!this.jy){const t=[];for(const i of this.po){const s=i;!s.valid||s.fromVertex.layer<=s.toVertex.layer||t.push(s.fromVertex)}t.sort(ls.uD),this.jy=t}return this.jy}getProperDestinationVertexes(){if(!this.Hy){const t=[];for(const i of this.ir){const s=i;!s.valid||s.fromVertex.layer<=s.toVertex.layer||t.push(s.toVertex)}t.sort(ls.uD),this.Hy=t}return this.Hy}addSourceEdge(t){super.addSourceEdge(t),this.jy=null,this.qy=null}deleteSourceEdge(t){super.deleteSourceEdge(t),this.jy=null,this.qy=null}addDestinationEdge(t){super.addDestinationEdge(t),this.Hy=null,this.Wy=null}deleteDestinationEdge(t){super.deleteDestinationEdge(t),this.Hy=null,this.Wy=null}get layer(){return this.Wo}set layer(t){this.Wo!==t&&(this.Wo=t)}get column(){return this.Uo}set column(t){this.Uo!==t&&(this.Uo=t)}get index(){return this.Dt}set index(t){this.Dt!==t&&(this.Dt=t)}get component(){return this.ek}set component(t){this.ek!==t&&(this.ek=t)}get near(){return this.sk}set near(t){this.sk!==t&&(this.sk=t)}}class Cn extends qi{constructor(t){super(t);f(this,"Zi");f(this,"nk");f(this,"ok");f(this,"rk");f(this,"lk");f(this,"hk");f(this,"ak");this.Zi=!1,this.nk=!1,this.ok=!1,this.rk=NaN,this.lk=NaN,this.hk=0,this.ak=0}get fromVertex(){return this.We}set fromVertex(t){this.We!==t&&(this.We=t)}get toVertex(){return this.Je}set toVertex(t){this.Je!==t&&(this.Je=t)}get valid(){return this.Zi}set valid(t){this.Zi!==t&&(this.Zi=t)}get rev(){return this.nk}set rev(t){this.nk!==t&&(this.nk=t)}get forest(){return this.ok}set forest(t){this.ok!==t&&(this.ok=t)}get portFromPos(){return this.rk}set portFromPos(t){this.rk!==t&&(this.rk=t)}get portToPos(){return this.lk}set portToPos(t){this.lk!==t&&(this.lk=t)}get portFromColOffset(){return this.hk}set portFromColOffset(t){this.hk!==t&&(this.hk=t)}get portToColOffset(){return this.ak}set portToColOffset(t){this.ak!==t&&(this.ak=t)}}var Js=(v=>(v[v.Default=0]="Default",v[v.Destination=1]="Destination",v[v.Source=2]="Source",v))(Js||{}),Zs=(v=>(v[v.Forwards=10]="Forwards",v[v.Reverse=11]="Reverse",v[v.Ascending=12]="Ascending",v[v.Descending=13]="Descending",v))(Zs||{}),Qs=(v=>(v[v.CenterSubtrees=20]="CenterSubtrees",v[v.CenterChildren=21]="CenterChildren",v[v.Start=22]="Start",v[v.End=23]="End",v[v.Bus=24]="Bus",v[v.BusBranching=25]="BusBranching",v[v.TopLeftBus=26]="TopLeftBus",v[v.BottomRightBus=27]="BottomRightBus",v[v.Custom=28]="Custom",v))(Qs||{}),_s=(v=>(v[v.None=30]="None",v[v.Block=31]="Block",v))(_s||{}),tn=(v=>(v[v.Layered=40]="Layered",v[v.LastParents=41]="LastParents",v[v.Alternating=42]="Alternating",v[v.RootOnly=43]="RootOnly",v))(tn||{}),en=(v=>(v[v.Vertical=50]="Vertical",v[v.Horizontal=51]="Horizontal",v[v.FixedRoots=52]="FixedRoots",v))(en||{}),Tn=(v=>(v[v.Individual=60]="Individual",v[v.Siblings=61]="Siblings",v[v.Uniform=62]="Uniform",v))(Tn||{});class Wt extends be{constructor(t){super();f(this,"Fi");f(this,"Ti");f(this,"_f");f(this,"Dg");f(this,"VN");f(this,"Re");f(this,"zi");f(this,"ks");f(this,"V");f(this,"z");f(this,"ck");f(this,"hs");this.Fi=new K,this.Ti=0,this.hs=1,this._f=40,this.Dg=60,this.VN=[],this.Re=!0,this.zi=50,this.ks=new ut(10,10).g();const i=new sn(this);this.V=new We(i),this.z=new We(i),this.ck=[],t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Ti=this.Ti,t._f=this._f,t.Dg=this.Dg,t.Re=this.Re,t.zi=this.zi,t.ks.a(this.ks),t.V.copyInheritedPropertiesFrom(this.V),t.z.copyInheritedPropertiesFrom(this.z)}ri(t){t in Qs?this.alignment=t:t in en?this.arrangement=t:t in _s?this.compaction=t:t in Js?this.path=t:t in Zs?this.sorting=t:t in tn?this.treeStyle=t:super.ri(t)}createNetwork(){return new sn(this)}makeNetwork(t){const i=this.createNetwork(),s=n=>{if(n instanceof nt)return!n.isLinkLabel&&n.category!=="Comment";if(n instanceof dt){const o=n.fromNode;if(o===null||o.isLinkLabel||o.category==="Comment")return!1;const r=n.toNode;return!(r===null||r.isLinkLabel||r.category==="Comment")}return!1};return t instanceof At?(i.addParts(t.nodes,!0,s),i.addParts(t.links,!0,s)):t instanceof at?i.addParts(t.memberParts,!1,s):i.addParts(t.iterator,!1,s),i}doLayout(t){this.network===null&&(this.network=this.makeNetwork(t)),this.arrangement!==52&&(this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin));let i=this.diagram;i===null&&t instanceof At&&(i=t),this.path===0&&i!==null?this.hs=i.isTreePathToChildren?1:2:this.hs=this.path===0?1:this.path,this.network.vertexes.count>0&&(this.CI(),this.LI(),this.AI(),this.TI(),this.RN(),this.DI(),this.arrangeTrees(),this.updateParts()),this.network=null,this.Fi=new K,this.isValidLayout=!0}CI(){this.network.deleteSelfEdges();const t=this.network.vertexes.iterator;for(;t.next();){const o=t.value;o.initialized=!1,o.level=0,o.parent=null,o.children=[]}if(this.Fi.count>0){const o=new K,r=this.Fi.iterator;for(;r.next();){const a=r.value;if(a instanceof nt){const h=this.network.findVertex(a);h!==null&&o.add(h)}else a instanceof We&&o.add(a)}this.Fi=o}this.Fi.count===0&&this.findRoots();const i=this.Fi.copy().iterator;for(;i.next();){const o=i.value;o.initialized||(o.initialized=!0,this.zN(o))}let s=this.network.vertexes,n=null;for(;n=this.FI(s),n.count>0;){const o=this.dD(n);o!==null&&this.Fi.add(o),o.initialized=!0,this.zN(o),s=n}}FI(t){const i=new K,s=t.iterator;for(;s.next();){const n=s.value;n.initialized||i.add(n)}return i}findRoots(){const t=this.network.vertexes,i=t.iterator;for(;i.next();){const s=i.value;switch(this.hs){case 1:s.sourceEdges.count===0&&this.Fi.add(s);break;case 2:s.destinationEdges.count===0&&this.Fi.add(s);break;default:b.o("Unhandled path value "+this.hs.toString())}}if(this.Fi.count===0){const s=this.dD(t);s!==null&&this.Fi.add(s)}}dD(t){let i=999999,s=null;const n=t.iterator;for(;n.next();){const o=n.value;switch(this.hs){case 1:o.sourceEdges.count<i&&(i=o.sourceEdges.count,s=o);break;case 2:o.destinationEdges.count<i&&(i=o.destinationEdges.count,s=o);break;default:b.o("Unhandled path value "+this.hs.toString())}}return s}zN(t){if(t===null)return;switch(this.hs){case 1:if(t.destinationEdges.count>0){const n=new J,o=t.destinationVertexes;for(;o.next();){const r=o.value;this.gD(t,r)&&n.add(r)}n.count>0&&(t.children=n.toArray())}break;case 2:if(t.sourceEdges.count>0){const n=new J,o=t.sourceVertexes;for(;o.next();){const r=o.value;this.gD(t,r)&&n.add(r)}n.count>0&&(t.children=n.toArray())}break;default:b.o("Unhandled path value"+this.hs.toString())}const i=t.children,s=i.length;for(let n=0;n<s;n++){const o=i[n];o.initialized=!0,o.level=t.level+1,o.parent=t,this.Fi.delete(o)}for(let n=0;n<s;n++){const o=i[n];this.zN(o)}}gD(t,i){return i.initialized?this.RI(i,t)||i.level>t.level?!1:(this.vI(i.parent,i),!0):!0}RI(t,i){if(i===null)return!1;let s=i.parent;for(;s!==null&&s!==t;)s=s.parent;return s===t}vI(t,i){if(t===null||i===null)return;const s=t.children;let n=0;for(let o=0;o<s.length;o++)s[o]===i&&n++;if(n>0){const o=new Array(s.length-n);let r=0;for(let a=0;a<s.length;a++)s[a]!==i&&(o[r++]=s[a]);t.children=o}}LI(){const t=this.Fi.iterator;for(;t.next();){const i=t.value;i instanceof We&&this.mD(i)}}mD(t){if(t===null)return;this.initializeTreeVertexValues(t),t.alignment===25&&this.sortTreeVertexChildren(t);let i=0,s=t.childrenCount,n=0;const o=t.children,r=o.length;for(let a=0;a<r;a++){const h=o[a];this.mD(h),i+=h.descendantCount+1,s=Math.max(s,h.maxChildrenCount),n=Math.max(n,h.maxGenerationCount)}t.descendantCount=i,t.maxChildrenCount=s,t.maxGenerationCount=s>0?n+1:0}OI(t){switch(this._f){default:case 40:return t.parent!==null?t.parent:this.V;case 43:return t.parent===null?this.V:t.parent.parent===null?this.z:t.parent;case 42:return t.parent!==null?t.parent.parent!==null?t.parent.parent:this.z:this.V;case 41:{let i=!0;if(t.childrenCount===0)i=!1;else{const s=t.children,n=s.length;for(let o=0;o<n;o++)if(s[o].childrenCount>0){i=!1;break}}return i&&t.parent!==null?this.z:t.parent!==null?t.parent:this.V}}}initializeTreeVertexValues(t){const i=this.OI(t);if(t.copyInheritedPropertiesFrom(i),t.parent!==null&&t.parent.alignment===25){let s=t.angle;const n=t.parent.children;let o=0;for(;o<n.length&&t!==n[o];)o++;o%2===0?o!==n.length-1&&(s===90?s=180:s===180?s=270:s===270?s=180:s=270):s===90?s=0:s===180?s=90:s===270?s=0:s=90,t.angle=s}t.initialized=!0}AI(){const t=this.Fi.iterator;for(;t.next();){const i=t.value;i instanceof We&&this.pD(i)}}pD(t){if(t===null)return;this.assignTreeVertexValues(t);const i=t.children,s=i.length;for(let n=0;n<s;n++){const o=i[n];this.pD(o)}}assignTreeVertexValues(t){}TI(){const t=this.Fi.iterator;for(;t.next();){const i=t.value;i instanceof We&&this.yD(i)}}yD(t){if(t===null)return;t.alignment!==25&&this.sortTreeVertexChildren(t);const i=t.children,s=i.length;for(let n=0;n<s;n++){const o=i[n];this.yD(o)}}sortTreeVertexChildren(t){switch(t.sorting){default:case 10:break;case 11:t.children.reverse();break;case 12:t.children.sort(t.comparer);break;case 13:t.children.sort(t.comparer),t.children.reverse();break}}RN(){if(!this.comments)return;const t=this.network.vertexes.iterator;for(;t.next();){const i=t.value;this.addComments(i)}}addComments(t){const i=t.angle,s=t.parent;let n=0,o=21,r=!1;s!==null&&(n=s.angle,o=s.alignment,r=this.isBusAlignment(o));const a=i===90||i===270,h=n===90||n===270,l=t.childrenCount===0;let u=0,c=0,d=0;const m=t.commentSpacing;if(t.node!==null){const g=t.node.findNodesConnected();for(;g.next();){const p=g.value;if(p.category!=="Comment"||!p.canLayout())continue;t.comments===null&&(t.comments=[]),t.comments.push(p),p.ensureBounds();const y=p.measuredBounds;a&&!l||!r&&!h&&l||r&&h&&l?(u=Math.max(u,y.width),c+=y.height+Math.abs(d)):(u+=y.width+Math.abs(d),c=Math.max(c,y.height)),d=m}}if(t.comments!==null){a&&!l||!r&&!h&&l||r&&h&&l?(u+=Math.abs(t.commentMargin),c=Math.max(0,c-t.height)):(c+=Math.abs(t.commentMargin),u=Math.max(0,u-t.width));const g=z.X(0,0,t.bounds.width+u,t.bounds.height+c);t.bounds=g,z.s(g)}}isBusAlignment(t){return t===24||t===25||t===26||t===27}Jy(t){return t===24||t===25}XN(t){const i=t.parent;if(i!==null){const s=i.alignment;if(this.isBusAlignment(s))if(this.Jy(s)){const n=i.children;let o=0;for(;o<n.length&&t!==n[o];)o++;return o%2===0}else return s===26}return!1}layoutComments(t){if(t.comments!==null){const i=t.node.measuredBounds,s=t.parent,n=t.angle;let o=0,r=21,a=!1;s!==null&&(o=s.angle,r=s.alignment,a=this.isBusAlignment(r));const h=n===90||n===270,l=o===90||o===270,u=t.childrenCount===0,c=this.XN(t);let d=0;const m=t.comments,g=m.length,p=S.l();for(let x=0;x<g;x++){const P=m[x],k=P.measuredBounds;if(h&&!u||!a&&!l&&u||a&&l&&u){if(o>135&&!a||l&&c)if(t.commentMargin>=0){p.e(t.bounds.x-t.commentMargin-k.width,t.bounds.y+d),P.move(p);const w=P.findLinksInto();for(;w.next();){const N=w.value;N.fromSpot=B.MiddleLeft,N.toSpot=B.MiddleRight}}else{p.e(t.bounds.x+t.focus.x*2-t.commentMargin,t.bounds.y+d),P.move(p);const w=P.findLinksInto();for(;w.next();){const N=w.value;N.fromSpot=B.MiddleRight,N.toSpot=B.MiddleLeft}}else if(t.commentMargin>=0){p.e(t.bounds.x+t.focus.x*2+t.commentMargin,t.bounds.y+d),P.move(p);const w=P.findLinksInto();for(;w.next();){const N=w.value;N.fromSpot=B.MiddleRight,N.toSpot=B.MiddleLeft}}else{p.e(t.bounds.x+t.commentMargin-k.width,t.bounds.y+d),P.move(p);const w=P.findLinksInto();for(;w.next();){const N=w.value;N.fromSpot=B.MiddleLeft,N.toSpot=B.MiddleRight}}t.commentSpacing>=0?d+=k.height+t.commentSpacing:d+=t.commentSpacing-k.height}else{if(o>135&&!a||!l&&c)if(t.commentMargin>=0){p.e(t.bounds.x+d,t.bounds.y-t.commentMargin-k.height),P.move(p);const w=P.findLinksInto();for(;w.next();){const N=w.value;N.fromSpot=B.MiddleTop,N.toSpot=B.MiddleBottom}}else{p.e(t.bounds.x+d,t.bounds.y+t.focus.y*2-t.commentMargin),P.move(p);const w=P.findLinksInto();for(;w.next();){const N=w.value;N.fromSpot=B.MiddleBottom,N.toSpot=B.MiddleTop}}else if(t.commentMargin>=0){p.e(t.bounds.x+d,t.bounds.y+t.focus.y*2+t.commentMargin),P.move(p);const w=P.findLinksInto();for(;w.next();){const N=w.value;N.fromSpot=B.MiddleBottom,N.toSpot=B.MiddleTop}}else{p.e(t.bounds.x+d,t.bounds.y+t.commentMargin-k.height),P.move(p);const w=P.findLinksInto();for(;w.next();){const N=w.value;N.fromSpot=B.MiddleTop,N.toSpot=B.MiddleBottom}}t.commentSpacing>=0?d+=k.width+t.commentSpacing:d+=t.commentSpacing-k.width}}S.s(p);const y=d-t.commentSpacing-(h?i.height:i.width);if(this.hs===1){const x=t.destinationEdges;for(;x.next();){const P=x.value.link;P!==null&&!P.isAvoiding&&(P.fromEndSegmentLength=y>0?y:NaN)}}else{const x=t.sourceEdges;for(;x.next();){const P=x.value.link;P!==null&&!P.isAvoiding&&(P.toEndSegmentLength=y>0?y:NaN)}}}}DI(){if(this.layerStyle===62){const i=[];let s=this.network.vertexes.iterator;for(;s.next();){const n=s.value;let o=n.parent;o===null&&(o=n);const r=o.angle===0||o.angle===180;let a=i[n.level];a===void 0&&(a=0),i[n.level]=Math.max(a,r?n.width:n.height)}for(let n=0;n<i.length;n++)i[n]===void 0&&(i[n]=0);for(this.VN=i,s=this.network.vertexes.iterator;s.next();){const n=s.value;let o=n.parent;o===null&&(o=n),o.angle===0||o.angle===180?(o.angle===180&&(n.focusX+=i[n.level]-n.width),n.width=i[n.level]):(o.angle===270&&(n.focusY+=i[n.level]-n.height),n.height=i[n.level])}}else if(this.layerStyle===61){const i=this.network.vertexes.iterator;for(;i.next();){const s=i.value,n=s.angle===0||s.angle===180;let o=-1;for(let r=0;r<s.children.length;r++){const a=s.children[r];o=Math.max(o,n?a.width:a.height)}if(o>=0)for(let r=0;r<s.children.length;r++){const a=s.children[r];n?(s.angle===180&&(a.focusX+=o-a.width),a.width=o):(s.angle===270&&(a.focusY+=o-a.height),a.height=o)}}}const t=this.Fi.iterator;for(;t.next();){const i=t.value;i instanceof We&&this.layoutTree(i)}}layoutTree(t){if(t===null)return;const i=t.children,s=i.length;for(let n=0;n<s;n++){const o=i[n];this.layoutTree(o)}switch(t.compaction){case 30:this.wD(t);break;default:case 31:t.alignment===25?this.wD(t):this.II(t);break}}wD(t){if(t.childrenCount===0){let X=!1,V=0,G=21;t.parent!==null&&(V=t.parent.angle,G=t.parent.alignment,X=this.isBusAlignment(G));const $=this.XN(t);t.B.e(0,0),t.mt.e(t.width,t.height),t.parent!==null&&t.comments!==null&&((V===180||V===270)&&!X||$)?V===180&&!X||(V===90||V===270)&&$?t.ft.e(t.width-t.focus.x*2,0):t.ft.e(0,t.height-t.focus.y*2):t.ft.e(0,0);return}const i=this.orthoAngle(t),s=i===90||i===270;let n=0;const o=t.children,r=o.length;for(let X=0;X<r;X++){const V=o[X];n=Math.max(n,s?V.mt.width:V.mt.height)}const a=t.alignment,h=a===22,l=a===23,u=this.isBusAlignment(a),c=Math.max(0,t.breadthLimit),d=this.computeLayerSpacing(t),m=t.nodeSpacing,g=this.computeNodeIndent(t),p=h||l?0:g/2,y=t.rowSpacing;let x=0;(h||l)&&(x=Math.max(0,t.rowIndent));const P=t.width,k=t.height;let w=0,N=0,M=0,C=0,O=0,T=0,L=0,F=0,D=0,R=0;if(u&&!this.Jy(a)&&i>135&&o.reverse(),this.Jy(a))if(r>1)for(let X=0;X<r;X++){const V=o[X],G=V.mt;X%2===0&&X!==r-1?D=Math.max(D,(s?G.width:G.height)+this.computeBusNodeSpacing(V)-m):X%2!==0&&(R=Math.max(R,(s?G.width:G.height)+this.computeBusNodeSpacing(V)-m))}else r===1&&(D=s?o[0].mt.width:o[0].mt.height);if(u)switch(a){case 24:case 25:let X;i<135?X=this.xD(t,o,D,R,w,N):X=this.bD(t,o,D,R,w,N),D=X.x,w=X.width,N=X.height;break;case 26:for(let V=0;V<r;V++){const G=o[V],$=G.mt,pt=L===0?0:y;s?(G.B.e(n-$.width,O+pt),w=Math.max(w,$.width),N=Math.max(N,O+pt+$.height),O+=pt+$.height):(G.B.e(C+pt,n-$.height),w=Math.max(w,C+pt+$.width),N=Math.max(N,$.height),C+=pt+$.width),L++}break;case 27:for(let V=0;V<r;V++){const G=o[V],$=G.mt,pt=L===0?0:y;s?(G.B.e(m/2+t.focus.x,O+pt),w=Math.max(w,$.width),N=Math.max(N,O+pt+$.height),O+=pt+$.height):(G.B.e(C+pt,m/2+t.focus.y),w=Math.max(w,C+pt+$.width),N=Math.max(N,$.height),C+=pt+$.width),L++}break}else for(let X=0;X<r;X++){const V=o[X],G=V.mt;if(s){c>0&&L>0&&C+m+G.width>c&&(C<n&&this._a(t,a,n-C,0,F,X-1),T++,L=0,F=X,M=N,C=0,O=i>135?-N-y:N+y);const $=L===0?p:m;this.fk(V,0,O),V.B.e(C+$,O),w=Math.max(w,C+$+G.width),N=Math.max(N,M+(T===0?0:y)+G.height),C+=$+G.width}else{c>0&&L>0&&O+m+G.height>c&&(O<n&&this._a(t,a,0,n-O,F,X-1),T++,L=0,F=X,M=w,O=0,C=i>135?-w-y:w+y);const $=L===0?p:m;this.fk(V,C,0),V.B.e(C,O+$),N=Math.max(N,O+$+G.height),w=Math.max(w,M+(T===0?0:y)+G.width),O+=$+G.height}L++}T>0&&(s?(N+=Math.max(0,d),C<w&&this._a(t,a,w-C,0,F,r-1),x>0&&(l||this.tu(t,x,0,0,r-1),w+=x)):(w+=Math.max(0,d),O<N&&this._a(t,a,0,N-O,F,r-1),x>0&&(l||this.tu(t,0,x,0,r-1),N+=x)));let I=0,j=0;switch(a){case 20:s?I+=w/2-t.focus.x-g/2:j+=N/2-t.focus.y-g/2;break;default:case 21:if(T>0)s?I+=w/2-t.focus.x-g/2:j+=N/2-t.focus.y-g/2;else{const V=r;if(s){const G=o[0].B.x+o[0].ft.x,$=o[V-1].B.x+o[V-1].ft.x+o[V-1].focus.x*2;I+=G+($-G)/2-t.focus.x-g/2}else{const G=o[0].B.y+o[0].ft.y,$=o[V-1].B.y+o[V-1].ft.y+o[V-1].focus.y*2;j+=G+($-G)/2-t.focus.y-g/2}}break;case 22:s?(I-=g,w+=g):(j-=g,N+=g);break;case 23:s?(I+=w-t.width+g,w+=g):(j+=N-t.height+g,N+=g);break;case 24:case 25:s?r>1?I+=D+m/2-t.focus.x:I+=o[0].focus.x-t.focus.x+o[0].ft.x:r>1?j+=D+m/2-t.focus.y:j+=o[0].focus.y-t.focus.y+o[0].ft.y;break;case 26:s?I+=w+m/2-t.focus.x:j+=N+m/2-t.focus.y;break;case 27:break;case 28:const X=this.customAlignment(t,I,j,w,N);I=X[0],j=X[1],w=X[2],N=X[3];break}for(let X=0;X<r;X++){const V=o[X];s?V.B.e(V.B.x+V.ft.x-I,V.B.y+(i>135?(u?-N:-V.mt.height)+V.ft.y-d:k+d+V.ft.y)):V.B.e(V.B.x+(i>135?(u?-w:-V.mt.width)+V.ft.x-d:P+d+V.ft.x),V.B.y+V.ft.y-j)}s?(w=this.KN(t,w,I),I<0&&(I=0),i>135&&(j+=N+d),N=Math.max(Math.max(N,k),N+k+d)):(i>135&&(I+=w+d),w=Math.max(Math.max(w,P),w+P+d),N=this.YN(t,N,j),j<0&&(j=0)),t.ft.e(I,j),t.mt.e(w,N)}customAlignment(t,i,s,n,o){return[i,s,n,o]}xD(t,i,s,n,o,r){const a=i.length;if(a===0)return new z(s,0,o,r);if(a===1){const y=i[0];return o=y.mt.width,r=y.mt.height,new z(s,0,o,r)}const h=t.nodeSpacing,l=t.rowSpacing,u=this.orthoAngle(t)===90;let c=0,d=0,m=0;for(let y=0;y<a;y++){if(y%2!==0||a>1&&y===a-1)continue;const x=i[y],P=x.mt,k=c===0?0:l;if(u){const w=this.computeBusNodeSpacing(x)-h;x.B.e(s-(P.width+w),m+k),o=Math.max(o,P.width+w),r=Math.max(r,m+k+P.height),m+=k+P.height}else{const w=this.computeBusNodeSpacing(x)-h;x.B.e(d+k,s-(P.height+w)),r=Math.max(r,P.height+w),o=Math.max(o,d+k+P.width),d+=k+P.width}c++}c=0;const g=d,p=m;u?(d=s+h,m=0):(d=0,m=s+h);for(let y=0;y<a;y++){if(y%2===0)continue;const x=i[y],P=x.mt,k=c===0?0:l;if(u){const w=this.computeBusNodeSpacing(x)-h;x.B.e(d+w,m+k),o=Math.max(o,d+P.width+w),r=Math.max(r,m+k+P.height),m+=k+P.height}else{const w=this.computeBusNodeSpacing(x)-h;x.B.e(d+k,m+w),o=Math.max(o,d+k+P.width),r=Math.max(r,m+P.height+w),d+=k+P.width}c++}if(a>1&&a%2===1){const y=i[a-1],x=y.mt,P=this.computeBusLastRowSpacing(y,u?Math.max(Math.abs(p),Math.abs(m)):Math.max(Math.abs(g),Math.abs(d)));if(u){y.B.e(s+h/2-y.focus.x-y.ft.x,r+P);const k=s+h/2-y.focus.x-y.ft.x;o=Math.max(o,k+x.width),k<0&&(o-=k),r=Math.max(r,Math.max(p,m)+P+x.height),y.B.x<0&&(s=this.uk(t,y.B.x,!1,s,h))}else{y.B.e(o+P,s+h/2-y.focus.y-y.ft.y),o=Math.max(o,Math.max(g,d)+P+x.width);const k=s+h/2-y.focus.y-y.ft.y;r=Math.max(r,k+x.height),k<0&&(r-=k),y.B.y<0&&(s=this.uk(t,y.B.y,!0,s,h))}}return new z(s,0,o,r)}bD(t,i,s,n,o,r){const a=i.length;if(a===0)return new z(s,0,o,r);if(a===1){const y=i[0];return o=y.mt.width,r=y.mt.height,new z(s,0,o,r)}const h=t.nodeSpacing,l=t.rowSpacing,u=this.orthoAngle(t)===270;let c=0,d=0,m=0;for(let y=0;y<a;y++){if(y%2!==0||a>1&&y===a-1)continue;const x=i[y],P=x.mt,k=c===0?0:l;if(u){const w=this.computeBusNodeSpacing(x)-h;m-=k+P.height,x.B.e(s-(P.width+w),m),o=Math.max(o,P.width+w),r=Math.max(r,Math.abs(m))}else{const w=this.computeBusNodeSpacing(x)-h;d-=k+P.width,x.B.e(d,s-(P.height+w)),r=Math.max(r,P.height+w),o=Math.max(o,Math.abs(d))}c++}c=0;const g=d,p=m;u?(d=s+h,m=0):(d=0,m=s+h);for(let y=0;y<a;y++){if(y%2===0)continue;const x=i[y],P=x.mt,k=c===0?0:l;if(u){const w=this.computeBusNodeSpacing(x)-h;m-=k+P.height,x.B.e(d+w,m),o=Math.max(o,d+P.width+w),r=Math.max(r,Math.abs(m))}else{const w=this.computeBusNodeSpacing(x)-h;d-=k+P.width,x.B.e(d,m+w),r=Math.max(r,m+P.height+w),o=Math.max(o,Math.abs(d))}c++}if(a>1&&a%2===1){const y=i[a-1],x=y.mt,P=this.computeBusLastRowSpacing(y,u?Math.max(Math.abs(p),Math.abs(m)):Math.max(Math.abs(g),Math.abs(d)));if(u){y.B.e(s+h/2-y.focus.x-y.ft.x,-r-x.height-P);const k=s+h/2-y.focus.x-y.ft.x;o=Math.max(o,k+x.width),k<0&&(o-=k),r=Math.max(r,Math.abs(Math.min(p,m))+P+x.height),y.B.x<0&&(s=this.uk(t,y.B.x,!1,s,h))}else{y.B.e(-o-x.width-P,s+h/2-y.focus.y-y.ft.y),o=Math.max(o,Math.abs(Math.min(g,d))+P+x.width);const k=s+h/2-y.focus.y-y.ft.y;r=Math.max(r,k+x.height),k<0&&(r-=k),y.B.y<0&&(s=this.uk(t,y.B.y,!0,s,h))}}for(let y=0;y<a;y++){const x=i[y];u?x.B.e(x.B.x,x.B.y+r):x.B.e(x.B.x+o,x.B.y)}return new z(s,0,o,r)}computeBusNodeSpacing(t){return t.parent===null?0:t.parent.nodeSpacing}computeBusLastRowSpacing(t,i){return t.parent===null?0:t.parent.rowSpacing}uk(t,i,s,n,o){const r=t.children,a=r.length;for(let l=0;l<a;l++)s?r[l].B.e(r[l].B.x,r[l].B.y-i):r[l].B.e(r[l].B.x-i,r[l].B.y);const h=r[a-1];return Math.max(n,s?h.ft.y+h.focus.y-o/2:h.ft.x+h.focus.x-o/2)}KN(t,i,s){switch(t.alignment){case 21:case 20:let n=i;return s+t.width>n&&(n=s+t.width),s<0&&(n-=s),n;case 22:return t.width>i?t.width:i;case 23:return t.focus.x*2>i?t.width:i+t.width-t.focus.x*2;case 24:case 25:const o=Math.min(0,s),r=Math.max(i,s+t.width);return Math.max(t.width,r-o);case 26:return t.width-t.focus.x+t.nodeSpacing/2+i;case 27:return Math.max(t.width,t.focus.x+t.nodeSpacing/2+i);default:return i}}YN(t,i,s){switch(t.alignment){case 21:case 20:let n=i;return s+t.height>n&&(n=s+t.height),s<0&&(n-=s),n;case 22:return t.height>i?t.height:i;case 23:return t.focus.y*2>i?t.height:i+t.height-t.focus.y*2;case 24:case 25:const o=Math.min(0,s),r=Math.max(i,s+t.height);return Math.max(t.height,r-o);case 26:return t.height-t.focus.y+t.nodeSpacing/2+i;case 27:return Math.max(t.height,t.focus.y+t.nodeSpacing/2+i);default:return i}}GN(t,i,s){switch(t){case 20:i/=2,s/=2;break;case 21:i/=2,s/=2;break;case 22:i=0,s=0;break;case 23:break;default:b.o("Unhandled alignment value "+t.toString())}return new S(i,s)}_a(t,i,s,n,o,r){const a=this.GN(i,s,n);this.tu(t,a.x,a.y,o,r)}tu(t,i,s,n,o){if(i===0&&s===0)return;const r=t.children;for(let a=n;a<=o;a++){const h=r[a].B;h.x+=i,h.y+=s}}fk(t,i,s){const n=t.parent;switch(this.hs){case 1:{const o=t.sourceEdges;for(;o.next();){const r=o.value;r.fromVertex===n&&r.relativePoint.e(i,s)}break}case 2:{const o=t.destinationEdges;for(;o.next();){const r=o.value;r.toVertex===n&&r.relativePoint.e(i,s)}break}default:b.o("Unhandled path value "+this.hs.toString())}}II(t){if(t.childrenCount===0){const et=t.parent;let st=!1,Pt=0,wt=21;et!==null&&(Pt=et.angle,wt=et.alignment,st=this.isBusAlignment(wt));const _=this.XN(t);t.B.e(0,0),t.mt.e(t.width,t.height),t.parent!==null&&t.comments!==null&&((Pt===180||Pt===270)&&!st||_)?Pt===180&&!st||(Pt===90||Pt===270)&&_?t.ft.e(t.width-t.focus.x*2,0):t.ft.e(0,t.height-t.focus.y*2):t.ft.e(0,0),t.Fg=null,t.Rg=null;return}const i=this.orthoAngle(t),s=i===90||i===270;let n=0;const o=t.children,r=o.length;for(let et=0;et<r;et++){const st=o[et];n=Math.max(n,s?st.mt.width:st.mt.height)}const a=t.alignment,h=a===22,l=a===23,u=this.isBusAlignment(a),c=Math.max(0,t.breadthLimit),d=this.computeLayerSpacing(t),m=t.nodeSpacing,g=this.computeNodeIndent(t),p=t.rowSpacing;let y=0;(h||l)&&(y=Math.max(0,t.rowIndent));const x=t.width,P=t.height;let k=0,w=0,N=0,M=null,C=null,O=0,T=0,L=0,F=0,D=0,R=0,I=0,j=0,X=0;if(u&&!this.Jy(a)&&i>135&&o.reverse(),this.Jy(a))if(r>1)for(let et=0;et<r;et++)et%2===0&&et!==r-1?j=Math.max(j,s?o[et].mt.width:o[et].mt.height):et%2!==0&&(X=Math.max(X,s?o[et].mt.width:o[et].mt.height));else r===1&&(j=s?o[0].mt.width:o[0].mt.height);if(u){switch(a){case 24:let et;i<135?et=this.xD(t,o,j,X,k,w):et=this.bD(t,o,j,X,k,w),j=et.x,k=et.width,w=et.height;break;case 26:for(let st=0;st<r;st++){const Pt=o[st],wt=Pt.mt,_=R===0?0:p;s?(Pt.B.e(n-wt.width,F+_),k=Math.max(k,wt.width),w=Math.max(w,F+_+wt.height),F+=_+wt.height):(Pt.B.e(L+_,n-wt.height),k=Math.max(k,L+_+wt.width),w=Math.max(w,wt.height),L+=_+wt.width),R++}break;case 27:for(let st=0;st<r;st++){const Pt=o[st],wt=Pt.mt,_=R===0?0:p;s?(Pt.B.e(m/2+t.focus.x,F+_),k=Math.max(k,wt.width),w=Math.max(w,F+_+wt.height),F+=_+wt.height):(Pt.B.e(L+_,m/2+t.focus.y),k=Math.max(k,L+_+wt.width),w=Math.max(w,wt.height),L+=_+wt.width),R++}break}M=this.ae(2),C=this.ae(2),s?(M[0].e(0,0),M[1].e(0,w),C[0].e(k,0),C[1].e(k,w)):(M[0].e(0,0),M[1].e(k,0),C[0].e(0,w),C[1].e(k,w))}else for(let et=0;et<r;et++){const st=o[et],Pt=st.mt;if(s){c>0&&R>0&&L+m+Pt.width>c&&(L<n&&this._a(t,a,n-L,0,I,et-1),D++,R=0,I=et,N=w,L=0,F=i>135?-w-p:w+p),this.fk(st,0,F);let wt=0;if(R===0)M=st.Fg,C=st.Rg,O=Pt.width,T=Pt.height,(M===null||C===null||i!==this.orthoAngle(st))&&(M=this.ae(2),C=this.ae(2),M[0].e(0,0),M[1].e(0,T),C[0].e(O,0),C[1].e(O,T));else{const _=b.nt(),ft=this.kD(t,st,M,C,O,T,_);wt=ft.x,M=_[0],C=_[1],O=ft.width,T=ft.height,b.tt(_),L<Pt.width&&wt<0&&(this.tu(t,-wt,0,I,et-1),this.dk(M,-wt,0),this.dk(C,-wt,0),wt=0)}st.B.e(wt,F),k=Math.max(k,O),w=Math.max(w,N+(D===0?0:p)+Pt.height),L=O}else{c>0&&R>0&&F+m+Pt.height>c&&(F<n&&this._a(t,a,0,n-F,I,et-1),D++,R=0,I=et,N=k,F=0,L=i>135?-k-p:k+p),this.fk(st,L,0);let wt=0;if(R===0)M=st.Fg,C=st.Rg,O=Pt.width,T=Pt.height,(M===null||C===null||i!==this.orthoAngle(st))&&(M=this.ae(2),C=this.ae(2),M[0].e(0,0),M[1].e(O,0),C[0].e(0,T),C[1].e(O,T));else{const _=b.nt(),ft=this.kD(t,st,M,C,O,T,_);wt=ft.x,M=_[0],C=_[1],O=ft.width,T=ft.height,b.tt(_),F<Pt.height&&wt<0&&(this.tu(t,0,-wt,I,et-1),this.dk(M,0,-wt),this.dk(C,0,-wt),wt=0)}st.B.e(L,wt),w=Math.max(w,T),k=Math.max(k,N+(D===0?0:p)+Pt.width),F=T}R++}D>0&&(s?(w+=Math.max(0,d),L<k&&this._a(t,a,k-L,0,I,r-1),y>0&&(l||this.tu(t,y,0,0,r-1),k+=y)):(k+=Math.max(0,d),F<w&&this._a(t,a,0,w-F,I,r-1),y>0&&(l||this.tu(t,0,y,0,r-1),w+=y)));let V=0,G=0;switch(a){case 20:s?V+=k/2-t.focus.x-g/2:G+=w/2-t.focus.y-g/2;break;default:case 21:if(D>0)s?V+=k/2-t.focus.x-g/2:G+=w/2-t.focus.y-g/2;else{const st=r;if(s){const Pt=o[0].B.x+o[0].ft.x,wt=o[st-1].B.x+o[st-1].ft.x+o[st-1].focus.x*2;V+=Pt+(wt-Pt)/2-t.focus.x-g/2}else{const Pt=o[0].B.y+o[0].ft.y,wt=o[st-1].B.y+o[st-1].ft.y+o[st-1].focus.y*2;G+=Pt+(wt-Pt)/2-t.focus.y-g/2}}break;case 22:s?(V-=g,k+=g):(G-=g,w+=g);break;case 23:s?(V+=k-t.width+g,k+=g):(G+=w-t.height+g,w+=g);break;case 24:s?r>1?V+=j+m/2-t.focus.x:V+=o[0].focus.x-t.focus.x+o[0].ft.x:r>1?G+=j+m/2-t.focus.y:G+=o[0].focus.y-t.focus.y+o[0].ft.y;break;case 26:s?V+=k+m/2-t.focus.x:G+=w+m/2-t.focus.y;break;case 27:break;case 28:const et=this.customAlignment(t,V,G,k,w);V=et[0],G=et[1],k=et[2],w=et[3];break}for(let et=0;et<r;et++){const st=o[et];s?st.B.e(st.B.x+st.ft.x-V,st.B.y+(i>135?(u?-w:-st.mt.height)+st.ft.y-d:P+d+st.ft.y)):st.B.e(st.B.x+(i>135?(u?-k:-st.mt.width)+st.ft.x-d:x+d+st.ft.x),st.B.y+st.ft.y-G)}let $=0,pt=0;if(u)s?(k=this.KN(t,k,V),V<0&&(V=0),i>135&&(G+=w+d),w+=P+d,a===27&&($+=m/2+t.focus.x),pt+=P+d):(i>135&&(V+=k+d),k+=x+d,w=this.YN(t,w,G),G<0&&(G=0),a===27&&(pt+=m/2+t.focus.y),$+=x+d);else if(s){if(t.comments===null){if(x>k){const et=this.GN(a,x-k,0);$=et.x,pt=et.y,k=x,V=0}}else k=this.KN(t,k,V);V<0&&($-=V,V=0),i>135&&(G+=w+d),w=Math.max(Math.max(w,P),w+P+d),pt+=P+d}else{if(i>135&&(V+=k+d),k=Math.max(Math.max(k,x),k+x+d),t.comments===null){if(P>w){const et=this.GN(a,0,P-w);$=et.x,pt=et.y,w=P,G=0}}else w=this.YN(t,w,G);G<0&&(pt-=G,G=0),$+=x+d}let Q,it;if(D>0)Q=this.ae(4),it=this.ae(4),s?(Q[2].e(0,P+d),Q[3].e(Q[2].x,w),it[2].e(k,Q[2].y),it[3].e(it[2].x,Q[3].y)):(Q[2].e(x+d,0),Q[3].e(k,Q[2].y),it[2].e(Q[2].x,w),it[3].e(Q[3].x,it[2].y));else{Q=this.ae(M.length+2),it=this.ae(C.length+2);for(let et=0;et<M.length;et++){const st=M[et];Q[et+2].e(st.x+$,st.y+pt)}for(let et=0;et<C.length;et++){const st=C[et];it[et+2].e(st.x+$,st.y+pt)}}s?(Q[0].e(V,0),Q[1].e(Q[0].x,P),Q[2].y<Q[1].y&&(Q[2].x>Q[0].x?Q[2].a(Q[1]):Q[1].a(Q[2])),Q[3].y<Q[2].y&&(Q[3].x>Q[0].x?Q[3].a(Q[2]):Q[2].a(Q[3])),it[0].e(V+x,0),it[1].e(it[0].x,P),it[2].y<it[1].y&&(it[2].x<it[0].x?it[2].a(it[1]):it[1].a(it[2])),it[3].y<it[2].y&&(it[3].x<it[0].x?it[3].a(it[2]):it[2].a(it[3])),Q[2].y-=d/2,it[2].y-=d/2):(Q[0].e(0,G),Q[1].e(x,Q[0].y),Q[2].x<Q[1].x&&(Q[2].y>Q[0].y?Q[2].a(Q[1]):Q[1].a(Q[2])),Q[3].x<Q[2].x&&(Q[3].y>Q[0].y?Q[3].a(Q[2]):Q[2].a(Q[3])),it[0].e(0,G+P),it[1].e(x,it[0].y),it[2].x<it[1].x&&(it[2].y<it[0].y?it[2].a(it[1]):it[1].a(it[2])),it[3].x<it[2].x&&(it[3].y<it[0].y?it[3].a(it[2]):it[2].a(it[3])),Q[2].x-=d/2,it[2].x-=d/2),this.tn(M),this.tn(C),t.Fg=Q,t.Rg=it,t.ft.e(V,G),t.mt.e(k,w)}dk(t,i,s){for(let n=0;n<t.length;n++){const o=t[n];o.x+=i,o.y+=s}}kD(t,i,s,n,o,r,a){const h=this.orthoAngle(t),l=h===90||h===270,u=t.nodeSpacing,c=s,d=n,m=o,g=r;let p=i.Fg,y=i.Rg;const x=i.mt,P=l?Math.max(g,x.height):Math.max(m,x.width);if((p===null||h!==this.orthoAngle(i))&&(p=this.ae(2),y=this.ae(2),l?(p[0].e(0,0),p[1].e(0,x.height),y[0].e(x.width,0),y[1].e(y[0].x,p[1].y)):(p[0].e(0,0),p[1].e(x.width,0),y[0].e(0,x.height),y[1].e(p[1].x,y[0].y))),l){const k=m;let w=k-this.EI(d,p,k);return w+=u,s=this.BI(c,p,w),n=this.UI(d,y,w),o=Math.max(0,w)+x.width,r=P,this.tn(c),this.tn(p),this.tn(d),this.tn(y),a[0]=s,a[1]=n,new z(w,0,o,r)}else{const k=g;let w=k-this.VI(d,p,k);return w+=u,s=this.zI(c,p,w),n=this.XI(d,y,w),o=P,r=Math.max(0,w)+x.height,this.tn(c),this.tn(p),this.tn(d),this.tn(y),a[0]=s,a[1]=n,new z(w,0,o,r)}}zI(t,i,s){if(t===null||t.length<2||i===null||i.length<2)return null;const n=this.ae(t.length+i.length);let o=0,r=0,a=0;for(;r<i.length&&i[r].x<t[0].x;){const u=i[r++];n[a++].e(u.x,u.y+s)}for(;o<t.length;){const u=t[o++];n[a++].e(u.x,u.y)}const h=t[t.length-1].x;for(;r<i.length&&i[r].x<=h;)r++;for(;r<i.length&&i[r].x>h;){const u=i[r++];n[a++].e(u.x,u.y+s)}const l=this.ae(a);for(o=0;o<a;o++)l[o].a(n[o]);return this.tn(n),l}BI(t,i,s){if(t===null||t.length<2||i===null||i.length<2)return null;const n=this.ae(t.length+i.length);let o=0,r=0,a=0;for(;r<i.length&&i[r].y<t[0].y;){const u=i[r++];n[a++].e(u.x+s,u.y)}for(;o<t.length;){const u=t[o++];n[a++].e(u.x,u.y)}const h=t[t.length-1].y;for(;r<i.length&&i[r].y<=h;)r++;for(;r<i.length&&i[r].y>h;){const u=i[r++];n[a++].e(u.x+s,u.y)}const l=this.ae(a);for(o=0;o<a;o++)l[o].a(n[o]);return this.tn(n),l}XI(t,i,s){if(t===null||t.length<2||i===null||i.length<2)return null;const n=this.ae(t.length+i.length);let o=0,r=0,a=0;for(;o<t.length&&t[o].x<i[0].x;){const u=t[o++];n[a++].e(u.x,u.y)}for(;r<i.length;){const u=i[r++];n[a++].e(u.x,u.y+s)}const h=i[i.length-1].x;for(;o<t.length&&t[o].x<=h;)o++;for(;o<t.length&&t[o].x>h;){const u=t[o++];n[a++].e(u.x,u.y)}const l=this.ae(a);for(o=0;o<a;o++)l[o].a(n[o]);return this.tn(n),l}UI(t,i,s){if(t===null||t.length<2||i===null||i.length<2)return null;const n=this.ae(t.length+i.length);let o=0,r=0,a=0;for(;o<t.length&&t[o].y<i[0].y;){const u=t[o++];n[a++].e(u.x,u.y)}for(;r<i.length;){const u=i[r++];n[a++].e(u.x+s,u.y)}const h=i[i.length-1].y;for(;o<t.length&&t[o].y<=h;)o++;for(;o<t.length&&t[o].y>h;){const u=t[o++];n[a++].e(u.x,u.y)}const l=this.ae(a);for(o=0;o<a;o++)l[o].a(n[o]);return this.tn(n),l}VI(t,i,s){let n=9999999;if(t===null||t.length<2||i===null||i.length<2)return n;let o=0,r=0;for(;o<t.length&&r<i.length;){const a=t[o],h=i[r],l=h.x;let u=h.y;u+=s;let c=a;o+1<t.length&&(c=t[o+1]);let d=h,m=d.x,g=d.y;r+1<i.length&&(d=i[r+1],m=d.x,g=d.y,g+=s);let p=n;a.x===l?p=u-a.y:a.x>l&&a.x<m?p=u+(a.x-l)/(m-l)*(g-u)-a.y:l>a.x&&l<c.x&&(p=u-(a.y+(l-a.x)/(c.x-a.x)*(c.y-a.y))),p<n&&(n=p),c.x<=a.x?o++:m<=l?r++:(c.x<=m&&o++,m<=c.x&&r++)}return n}EI(t,i,s){let n=9999999;if(t===null||t.length<2||i===null||i.length<2)return n;let o=0,r=0;for(;o<t.length&&r<i.length;){const a=t[o],h=i[r];let l=h.x;const u=h.y;l+=s;let c=a;o+1<t.length&&(c=t[o+1]);let d=h,m=d.x,g=d.y;r+1<i.length&&(d=i[r+1],m=d.x,g=d.y,m+=s);let p=n;a.y===u?p=l-a.x:a.y>u&&a.y<g?p=l+(a.y-u)/(g-u)*(m-l)-a.x:u>a.y&&u<c.y&&(p=l-(a.x+(u-a.y)/(c.y-a.y)*(c.x-a.x))),p<n&&(n=p),c.y<=a.y?o++:g<=u?r++:(c.y<=g&&o++,g<=c.y&&r++)}return n}ae(t){const i=this.ck[t];if(i!==void 0){const n=i.pop();if(n!==void 0)return n}const s=[];for(let n=0;n<t;n++)s[n]=new S;return s}tn(t){const i=t.length;let s=this.ck[i];s===void 0&&(s=[],this.ck[i]=s),s.push(t)}arrangeTrees(){if(this.zi===52){const t=this.Fi.iterator;for(;t.next();){const i=t.value;if(!(i instanceof We))continue;const s=i.node;if(s===null)continue;const n=s.position;let o=n.x,r=n.y;isFinite(o)||(o=0),isFinite(r)||(r=0),this.jN(i,o,r)}}else{const t=[],i=this.Fi.iterator;for(;i.next();){const r=i.value;r instanceof We&&t.push(r)}switch(this.sorting){default:case 10:break;case 11:t.reverse();break;case 12:t.sort(this.comparer);break;case 13:t.sort(this.comparer),t.reverse();break}const s=this.arrangementOrigin;let n=s.x,o=s.y;for(let r=0;r<t.length;r++){const a=t[r];switch(this.jN(a,n+a.ft.x,o+a.ft.y),this.zi){case 50:o+=a.mt.height+this.ks.height;break;default:case 51:n+=a.mt.width+this.ks.width;break}}}}jN(t,i,s){if(t===null)return;t.x=i,t.y=s;const n=t.children,o=n.length;for(let r=0;r<o;r++){const a=n[r];this.jN(a,i+a.B.x,s+a.B.y)}}commitLayout(){this.zy(),this.commitNodes(),this.UN(),this.isRouting&&this.commitLinks()}commitNodes(){const t=this.network.vertexes.iterator;for(;t.next();)t.value.commit();for(t.reset();t.next();){const i=t.value;this.layoutComments(i)}}UN(){if(this.layerStyle!==62)return;const t=this.VN,i=[];let s=null;const n=this.network.vertexes.iterator;for(;n.next();){const l=n.value;s===null?s=l.bounds.copy():s.unionRect(l.bounds);let u=i[l.level];u===void 0?u=this.computeLayerSpacing(l):u=Math.max(u,this.computeLayerSpacing(l)),i[l.level]=u}for(let l=0;l<i.length;l++)i[l]===void 0&&(i[l]=0);let o;this.angle===90||this.angle===270?(s.inflate(this.nodeSpacing/2,this.layerSpacing),o=new S(-this.nodeSpacing/2,-this.layerSpacing/2)):(s.inflate(this.layerSpacing,this.nodeSpacing/2),o=new S(-this.layerSpacing/2,-this.nodeSpacing/2));const r=[],a=this.angle===90||this.angle===270?s.width:s.height;let h=0;if(this.angle===180||this.angle===270)for(let l=0;l<t.length;l++)h+=t[l]+i[l];for(let l=0;l<t.length;l++){const u=t[l]+i[l];this.angle===270?(h-=u,r.push(new z(0,h,a,u))):this.angle===90?(r.push(new z(0,h,a,u)),h+=u):this.angle===180?(h-=u,r.push(new z(h,0,u,a))):(r.push(new z(h,0,u,a)),h+=u)}this.commitLayers(r,o)}commitLayers(t,i){}commitLinks(){const t=this.network.edges.iterator;for(;t.next();)t.value.commit()}zy(){const t=this.Fi.iterator;for(;t.next();){const i=t.value;i instanceof We&&this.PD(i)}}PD(t){if(t===null)return;this.setPortSpots(t);const i=t.children,s=i.length;for(let n=0;n<s;n++){const o=i[n];this.PD(o)}}setPortSpots(t){const i=t.alignment;if(this.isBusAlignment(i))this.KI(t,i);else{const s=this.orthoAngle(t);if(this.hs===1){const n=t.destinationEdges;for(;n.next();){const o=n.value.link;if(o!==null){if(t.setsPortSpot)if(t.portSpot.isDefault())switch(s){case 0:o.fromSpot=B.MiddleRight;break;case 90:o.fromSpot=B.MiddleBottom;break;case 180:o.fromSpot=B.MiddleLeft;break;default:o.fromSpot=B.MiddleTop;break}else o.fromSpot=t.portSpot;if(t.setsChildPortSpot)if(t.childPortSpot.isDefault())switch(s){case 0:o.toSpot=B.MiddleLeft;break;case 90:o.toSpot=B.MiddleTop;break;case 180:o.toSpot=B.MiddleRight;break;default:o.toSpot=B.MiddleBottom;break}else o.toSpot=t.childPortSpot}}}else{const n=t.sourceEdges;for(;n.next();){const o=n.value.link;if(o!==null){if(t.setsPortSpot)if(t.portSpot.isDefault())switch(s){case 0:o.toSpot=B.MiddleRight;break;case 90:o.toSpot=B.MiddleBottom;break;case 180:o.toSpot=B.MiddleLeft;break;default:o.toSpot=B.MiddleTop;break}else o.toSpot=t.portSpot;if(t.setsChildPortSpot)if(t.childPortSpot.isDefault())switch(s){case 0:o.fromSpot=B.MiddleLeft;break;case 90:o.fromSpot=B.MiddleTop;break;case 180:o.fromSpot=B.MiddleRight;break;default:o.fromSpot=B.MiddleBottom;break}else o.fromSpot=t.childPortSpot}}}}}KI(t,i){const s=this.hs===1,n=this.orthoAngle(t);let o;switch(n){case 0:o=B.MiddleRight;break;case 90:o=B.MiddleBottom;break;case 180:o=B.MiddleLeft;break;default:o=B.MiddleTop;break}const r=t.children,a=r.length;switch(i){case 24:case 25:{for(let h=0;h<a;h++){const l=r[h],u=(s?l.sourceEdges:l.destinationEdges).first();if(u===null)continue;const c=u.link;if(c!==null){let d=n===90||n===270?B.MiddleLeft:B.MiddleTop;if(a===1||h===a-1&&a%2===1)switch(n){case 0:d=B.MiddleLeft;break;case 90:d=B.MiddleTop;break;case 180:d=B.MiddleRight;break;default:d=B.MiddleBottom;break}else h%2===0&&(d=n===90||n===270?B.MiddleRight:B.MiddleBottom);s?(t.setsPortSpot&&(c.fromSpot=o),t.setsChildPortSpot&&(c.toSpot=d)):(t.setsPortSpot&&(c.fromSpot=d),t.setsChildPortSpot&&(c.toSpot=o))}}break}case 26:{const h=n===90||n===270?B.MiddleRight:B.MiddleBottom,l=s?t.destinationEdges:t.sourceEdges;for(;l.next();){const u=l.value.link;u!==null&&(s?(t.setsPortSpot&&(u.fromSpot=o),t.setsChildPortSpot&&(u.toSpot=h)):(t.setsPortSpot&&(u.fromSpot=h),t.setsChildPortSpot&&(u.toSpot=o)))}break}case 27:{const h=n===90||n===270?B.MiddleLeft:B.MiddleTop,l=s?t.destinationEdges:t.sourceEdges;for(;l.next();){const u=l.value.link;u!==null&&(s?(t.setsPortSpot&&(u.fromSpot=o),t.setsChildPortSpot&&(u.toSpot=h)):(t.setsPortSpot&&(u.fromSpot=h),t.setsChildPortSpot&&(u.toSpot=o)))}break}}}orthoAngle(t){const i=t.angle;return i<=45?0:i<=135?90:i<=225?180:i<=315?270:0}computeLayerSpacing(t){const i=this.orthoAngle(t),s=i===90||i===270;let n=t.layerSpacing;if(t.layerSpacingParentOverlap>0){const o=Math.min(1,t.layerSpacingParentOverlap);n-=s?t.height*o:t.width*o}return n<(s?-t.height:-t.width)&&(n=s?-t.height:-t.width),n}computeNodeIndent(t){const i=this.orthoAngle(t),s=i===90||i===270;let n=t.nodeIndent;if(t.nodeIndentPastParent>0){const o=Math.min(1,t.nodeIndentPastParent);n+=s?t.width*o:t.height*o}return n=Math.max(0,n),n}get roots(){return this.Fi}set roots(t){this.Fi!==t&&(this.Fi=t,this.invalidateLayout())}get path(){return this.Ti}set path(t){this.Ti!==t&&(this.Ti=t,this.invalidateLayout())}get treeStyle(){return this._f}set treeStyle(t){this._f!==t&&(t===40||t===42||t===41||t===43)&&(this._f=t,this.invalidateLayout())}get layerStyle(){return this.Dg}set layerStyle(t){this.Dg!==t&&(t===60||t===61||t===62)&&(this.Dg=t,this.invalidateLayout())}get comments(){return this.Re}set comments(t){this.Re!==t&&(this.Re=t,this.invalidateLayout())}get arrangement(){return this.zi}set arrangement(t){this.zi!==t&&(t===50||t===51||t===52)&&(this.zi=t,this.invalidateLayout())}get arrangementSpacing(){return this.ks}set arrangementSpacing(t){this.ks.equals(t)||(this.ks.a(t),this.invalidateLayout())}get rootDefaults(){return this.V}set rootDefaults(t){this.V!==t&&(this.V=t,this.invalidateLayout())}get alternateDefaults(){return this.z}set alternateDefaults(t){this.z!==t&&(this.z=t,this.invalidateLayout())}get sorting(){return this.V.sorting}set sorting(t){this.V.sorting!==t&&(this.V.sorting=t,this.invalidateLayout())}get comparer(){return this.V.comparer}set comparer(t){this.V.comparer!==t&&(this.V.comparer=t,this.invalidateLayout())}get angle(){return this.V.angle}set angle(t){this.V.angle!==t&&(t===0||t===90||t===180||t===270?(this.V.angle=t,this.invalidateLayout()):b.o("TreeLayout.angle must be 0, 90, 180, or 270"))}get alignment(){return this.V.alignment}set alignment(t){this.V.alignment!==t&&(this.V.alignment=t,this.invalidateLayout())}get nodeIndent(){return this.V.nodeIndent}set nodeIndent(t){this.V.nodeIndent!==t&&t>=0&&(this.V.nodeIndent=t,this.invalidateLayout())}get nodeIndentPastParent(){return this.V.nodeIndentPastParent}set nodeIndentPastParent(t){this.V.nodeIndentPastParent!==t&&t>=0&&t<=1&&(this.V.nodeIndentPastParent=t,this.invalidateLayout())}get nodeSpacing(){return this.V.nodeSpacing}set nodeSpacing(t){this.V.nodeSpacing!==t&&(this.V.nodeSpacing=t,this.invalidateLayout())}get layerSpacing(){return this.V.layerSpacing}set layerSpacing(t){this.V.layerSpacing!==t&&(this.V.layerSpacing=t,this.invalidateLayout())}get layerSpacingParentOverlap(){return this.V.layerSpacingParentOverlap}set layerSpacingParentOverlap(t){this.V.layerSpacingParentOverlap!==t&&t>=0&&t<=1&&(this.V.layerSpacingParentOverlap=t,this.invalidateLayout())}get compaction(){return this.V.compaction}set compaction(t){this.V.compaction!==t&&(t===30||t===31)&&(this.V.compaction=t,this.invalidateLayout())}get breadthLimit(){return this.V.breadthLimit}set breadthLimit(t){this.V.breadthLimit!==t&&t>=0&&(this.V.breadthLimit=t,this.invalidateLayout())}get rowSpacing(){return this.V.rowSpacing}set rowSpacing(t){this.V.rowSpacing!==t&&(this.V.rowSpacing=t,this.invalidateLayout())}get rowIndent(){return this.V.rowIndent}set rowIndent(t){this.V.rowIndent!==t&&t>=0&&(this.V.rowIndent=t,this.invalidateLayout())}get commentSpacing(){return this.V.commentSpacing}set commentSpacing(t){this.V.commentSpacing!==t&&(this.V.commentSpacing=t,this.invalidateLayout())}get commentMargin(){return this.V.commentMargin}set commentMargin(t){this.V.commentMargin!==t&&(this.V.commentMargin=t,this.invalidateLayout())}get setsPortSpot(){return this.V.setsPortSpot}set setsPortSpot(t){this.V.setsPortSpot!==t&&(this.V.setsPortSpot=t,this.invalidateLayout())}get portSpot(){return this.V.portSpot}set portSpot(t){this.V.portSpot.equals(t)||(this.V.portSpot=t,this.invalidateLayout())}get setsChildPortSpot(){return this.V.setsChildPortSpot}set setsChildPortSpot(t){this.V.setsChildPortSpot!==t&&(this.V.setsChildPortSpot=t,this.invalidateLayout())}get childPortSpot(){return this.V.childPortSpot}set childPortSpot(t){this.V.childPortSpot.equals(t)||(this.V.childPortSpot=t,this.invalidateLayout())}get alternateSorting(){return this.z.sorting}set alternateSorting(t){this.z.sorting!==t&&(this.z.sorting=t,this.invalidateLayout())}get alternateComparer(){return this.z.comparer}set alternateComparer(t){this.z.comparer!==t&&(this.z.comparer=t,this.invalidateLayout())}get alternateAngle(){return this.z.angle}set alternateAngle(t){this.z.angle!==t&&(t===0||t===90||t===180||t===270)&&(this.z.angle=t,this.invalidateLayout())}get alternateAlignment(){return this.z.alignment}set alternateAlignment(t){this.z.alignment!==t&&(this.z.alignment=t,this.invalidateLayout())}get alternateNodeIndent(){return this.z.nodeIndent}set alternateNodeIndent(t){this.z.nodeIndent!==t&&t>=0&&(this.z.nodeIndent=t,this.invalidateLayout())}get alternateNodeIndentPastParent(){return this.z.nodeIndentPastParent}set alternateNodeIndentPastParent(t){this.z.nodeIndentPastParent!==t&&t>=0&&t<=1&&(this.z.nodeIndentPastParent=t,this.invalidateLayout())}get alternateNodeSpacing(){return this.z.nodeSpacing}set alternateNodeSpacing(t){this.z.nodeSpacing!==t&&(this.z.nodeSpacing=t,this.invalidateLayout())}get alternateLayerSpacing(){return this.z.layerSpacing}set alternateLayerSpacing(t){this.z.layerSpacing!==t&&(this.z.layerSpacing=t,this.invalidateLayout())}get alternateLayerSpacingParentOverlap(){return this.z.layerSpacingParentOverlap}set alternateLayerSpacingParentOverlap(t){this.z.layerSpacingParentOverlap!==t&&t>=0&&t<=1&&(this.z.layerSpacingParentOverlap=t,this.invalidateLayout())}get alternateCompaction(){return this.z.compaction}set alternateCompaction(t){this.z.compaction!==t&&(t===30||t===31)&&(this.z.compaction=t,this.invalidateLayout())}get alternateBreadthLimit(){return this.z.breadthLimit}set alternateBreadthLimit(t){this.z.breadthLimit!==t&&t>=0&&(this.z.breadthLimit=t,this.invalidateLayout())}get alternateRowSpacing(){return this.z.rowSpacing}set alternateRowSpacing(t){this.z.rowSpacing!==t&&(this.z.rowSpacing=t,this.invalidateLayout())}get alternateRowIndent(){return this.z.rowIndent}set alternateRowIndent(t){this.z.rowIndent!==t&&t>=0&&(this.z.rowIndent=t,this.invalidateLayout())}get alternateCommentSpacing(){return this.z.commentSpacing}set alternateCommentSpacing(t){this.z.commentSpacing!==t&&(this.z.commentSpacing=t,this.invalidateLayout())}get alternateCommentMargin(){return this.z.commentMargin}set alternateCommentMargin(t){this.z.commentMargin!==t&&(this.z.commentMargin=t,this.invalidateLayout())}get alternateSetsPortSpot(){return this.z.setsPortSpot}set alternateSetsPortSpot(t){this.z.setsPortSpot!==t&&(this.z.setsPortSpot=t,this.invalidateLayout())}get alternatePortSpot(){return this.z.portSpot}set alternatePortSpot(t){this.z.portSpot.equals(t)||(this.z.portSpot=t,this.invalidateLayout())}get alternateSetsChildPortSpot(){return this.z.setsChildPortSpot}set alternateSetsChildPortSpot(t){this.z.setsChildPortSpot!==t&&(this.z.setsChildPortSpot=t,this.invalidateLayout())}get alternateChildPortSpot(){return this.z.childPortSpot}set alternateChildPortSpot(t){this.z.childPortSpot.equals(t)||(this.z.childPortSpot=t,this.invalidateLayout())}}f(Wt,"PathDefault",0),f(Wt,"PathDestination",1),f(Wt,"PathSource",2),f(Wt,"SortingForwards",10),f(Wt,"SortingReverse",11),f(Wt,"SortingAscending",12),f(Wt,"SortingDescending",13),f(Wt,"AlignmentCenterSubtrees",20),f(Wt,"AlignmentCenterChildren",21),f(Wt,"AlignmentStart",22),f(Wt,"AlignmentEnd",23),f(Wt,"AlignmentBus",24),f(Wt,"AlignmentBusBranching",25),f(Wt,"AlignmentTopLeftBus",26),f(Wt,"AlignmentBottomRightBus",27),f(Wt,"CompactionNone",30),f(Wt,"CompactionBlock",31),f(Wt,"StyleLayered",40),f(Wt,"StyleLastParents",41),f(Wt,"StyleAlternating",42),f(Wt,"StyleRootOnly",43),f(Wt,"ArrangementVertical",50),f(Wt,"ArrangementHorizontal",51),f(Wt,"ArrangementFixedRoots",52),f(Wt,"LayerIndividual",60),f(Wt,"LayerSiblings",61),f(Wt,"LayerUniform",62);class sn extends Mi{constructor(e){super(e)}createVertex(){return new We(this)}createEdge(){return new Ln(this)}}class We extends Ni{constructor(t){super(t);f(this,"B");f(this,"mt");f(this,"ft");f(this,"gk");f(this,"mk");f(this,"pk");f(this,"yk");f(this,"wk");f(this,"xk");f(this,"bk");f(this,"Re");f(this,"Fg");f(this,"Rg");f(this,"pe");f(this,"ye");f(this,"Xt");f(this,"oi");f(this,"$y");f(this,"Zy");f(this,"Qy");f(this,"Ps");f(this,"_y");f(this,"tw");f(this,"iw");f(this,"ew");f(this,"sw");f(this,"nw");f(this,"ow");f(this,"rw");f(this,"lw");f(this,"hw");f(this,"aw");this.gk=!1,this.mk=null,this.pk=[],this.yk=0,this.wk=0,this.xk=0,this.bk=0,this.Re=null,this.B=new S(0,0),this.mt=new ut(0,0),this.ft=new S(0,0),this.Fg=null,this.Rg=null,this.pe=10,this.ye=Ni.standardComparer,this.Xt=0,this.oi=21,this.$y=0,this.Zy=0,this.Qy=20,this.Ps=50,this._y=0,this.tw=31,this.iw=0,this.ew=25,this.sw=10,this.nw=10,this.ow=20,this.rw=!0,this.lw=B.Default,this.hw=!0,this.aw=B.Default}copyInheritedPropertiesFrom(t){t!==null&&(this.pe=t.sorting,this.ye=t.comparer,this.Xt=t.angle,this.oi=t.alignment,this.$y=t.nodeIndent,this.Zy=t.nodeIndentPastParent,this.Qy=t.nodeSpacing,this.Ps=t.layerSpacing,this._y=t.layerSpacingParentOverlap,this.tw=t.compaction,this.iw=t.breadthLimit,this.ew=t.rowSpacing,this.sw=t.rowIndent,this.nw=t.commentSpacing,this.ow=t.commentMargin,this.rw=t.setsPortSpot,this.lw=t.portSpot,this.hw=t.setsChildPortSpot,this.aw=t.childPortSpot)}get initialized(){return this.gk}set initialized(t){this.gk!==t&&(this.gk=t)}get parent(){return this.mk}set parent(t){this.mk!==t&&(this.mk=t)}get children(){return this.pk}set children(t){if(this.pk!==t){if(t!==null){const i=t.length;for(let s=0;s<i;s++)t[s]}this.pk=t}}get level(){return this.yk}set level(t){this.yk!==t&&(this.yk=t)}get descendantCount(){return this.wk}set descendantCount(t){this.wk!==t&&(this.wk=t)}get maxChildrenCount(){return this.xk}set maxChildrenCount(t){this.xk!==t&&(this.xk=t)}get maxGenerationCount(){return this.bk}set maxGenerationCount(t){this.bk!==t&&(this.bk=t)}get comments(){return this.Re}set comments(t){if(this.Re!==t){if(t!==null){const i=t.length;for(let s=0;s<i;s++)t[s]}this.Re=t}}get sorting(){return this.pe}set sorting(t){this.pe!==t&&(this.pe=t)}get comparer(){return this.ye}set comparer(t){this.ye!==t&&(this.ye=t)}get angle(){return this.Xt}set angle(t){this.Xt!==t&&(this.Xt=t)}get alignment(){return this.oi}set alignment(t){this.oi!==t&&(this.oi=t)}get nodeIndent(){return this.$y}set nodeIndent(t){this.$y!==t&&(this.$y=t)}get nodeIndentPastParent(){return this.Zy}set nodeIndentPastParent(t){this.Zy!==t&&(this.Zy=t)}get nodeSpacing(){return this.Qy}set nodeSpacing(t){this.Qy!==t&&(this.Qy=t)}get layerSpacing(){return this.Ps}set layerSpacing(t){this.Ps!==t&&(this.Ps=t)}get layerSpacingParentOverlap(){return this._y}set layerSpacingParentOverlap(t){this._y!==t&&(this._y=t)}get compaction(){return this.tw}set compaction(t){this.tw!==t&&(this.tw=t)}get breadthLimit(){return this.iw}set breadthLimit(t){this.iw!==t&&(this.iw=t)}get rowSpacing(){return this.ew}set rowSpacing(t){this.ew!==t&&(this.ew=t)}get rowIndent(){return this.sw}set rowIndent(t){this.sw!==t&&(this.sw=t)}get commentSpacing(){return this.nw}set commentSpacing(t){this.nw!==t&&(this.nw=t)}get commentMargin(){return this.ow}set commentMargin(t){this.ow!==t&&(this.ow=t)}get setsPortSpot(){return this.rw}set setsPortSpot(t){this.rw!==t&&(this.rw=t)}get portSpot(){return this.lw}set portSpot(t){this.lw.equals(t)||(this.lw=t)}get setsChildPortSpot(){return this.hw}set setsChildPortSpot(t){this.hw!==t&&(this.hw=t)}get childPortSpot(){return this.aw}set childPortSpot(t){this.aw.equals(t)||(this.aw=t)}get childrenCount(){return this.children.length}get relativePosition(){return this.B}set relativePosition(t){this.B.set(t)}get subtreeSize(){return this.mt}set subtreeSize(t){this.mt.set(t)}get subtreeOffset(){return this.ft}set subtreeOffset(t){this.ft.set(t)}}class Ln extends qi{constructor(t){super(t);f(this,"kk");this.kk=new S(0,0)}commit(){const t=this.link;if(t===null||t.isAvoiding)return;const i=this.network.layout;let s=null,n=null;switch(i.hs){case 1:s=this.fromVertex,n=this.toVertex;break;case 2:s=this.toVertex,n=this.fromVertex;break;default:b.o("Unhandled path value "+i.hs.toString())}if(s===null||n===null)return;const o=this.kk;if(o.x===0&&o.y===0){this.YI(s,n);return}const r=s.bounds,a=i.orthoAngle(s),h=i.computeLayerSpacing(s),l=s.rowSpacing;t.updateRoute();const u=t.curve===9,c=t.isOrthogonal;let d=0,m,g;if(t.startRoute(),c||u){for(d=2;t.pointsCount>4;)t.removePoint(2);m=t.getPoint(1),g=t.getPoint(2)}else{for(d=1;t.pointsCount>3;)t.removePoint(1);m=t.getPoint(0),g=t.getPoint(t.pointsCount-1)}const p=t.getPoint(t.pointsCount-1);let y=0;a===0?(s.alignment===23?(y=r.bottom+o.y,o.y===0&&m.y>p.y+s.rowIndent&&(y=Math.min(y,Math.max(m.y,y-i.computeNodeIndent(s))))):s.alignment===22?(y=r.top+o.y,o.y===0&&m.y<p.y-s.rowIndent&&(y=Math.max(y,Math.min(m.y,y+i.computeNodeIndent(s))))):y=r.y+r.height/2+o.y,u?(t.insertPointAt(d,m.x,y),d++,t.insertPointAt(d,r.right+h,y),d++,t.insertPointAt(d,r.right+h+(o.x-l)/3,y),d++,t.insertPointAt(d,r.right+h+(o.x-l)*2/3,y),d++,t.insertPointAt(d,r.right+h+(o.x-l),y),d++,t.insertPointAt(d,g.x,y),d++):(c&&(t.insertPointAt(d,r.right+h/2,m.y),d++),t.insertPointAt(d,r.right+h/2,y),d++,t.insertPointAt(d,r.right+h+o.x-(c?l/2:l),y),d++,c&&(t.insertPointAt(d,t.getPoint(d-1).x,g.y),d++))):a===90?(s.alignment===23?(y=r.right+o.x,o.x===0&&m.x>p.x+s.rowIndent&&(y=Math.min(y,Math.max(m.x,y-i.computeNodeIndent(s))))):s.alignment===22?(y=r.left+o.x,o.x===0&&m.x<p.x-s.rowIndent&&(y=Math.max(y,Math.min(m.x,y+i.computeNodeIndent(s))))):y=r.x+r.width/2+o.x,u?(t.insertPointAt(d,y,m.y),d++,t.insertPointAt(d,y,r.bottom+h),d++,t.insertPointAt(d,y,r.bottom+h+(o.y-l)/3),d++,t.insertPointAt(d,y,r.bottom+h+(o.y-l)*2/3),d++,t.insertPointAt(d,y,r.bottom+h+(o.y-l)),d++,t.insertPointAt(d,y,g.y),d++):(c&&(t.insertPointAt(d,m.x,r.bottom+h/2),d++),t.insertPointAt(d,y,r.bottom+h/2),d++,t.insertPointAt(d,y,r.bottom+h+o.y-(c?l/2:l)),d++,c&&(t.insertPointAt(d,g.x,t.getPoint(d-1).y),d++))):a===180?(s.alignment===23?(y=r.bottom+o.y,o.y===0&&m.y>p.y+s.rowIndent&&(y=Math.min(y,Math.max(m.y,y-i.computeNodeIndent(s))))):s.alignment===22?(y=r.top+o.y,o.y===0&&m.y<p.y-s.rowIndent&&(y=Math.max(y,Math.min(m.y,y+i.computeNodeIndent(s))))):y=r.y+r.height/2+o.y,u?(t.insertPointAt(d,m.x,y),d++,t.insertPointAt(d,r.left-h,y),d++,t.insertPointAt(d,r.left-h+(o.x+l)/3,y),d++,t.insertPointAt(d,r.left-h+(o.x+l)*2/3,y),d++,t.insertPointAt(d,r.left-h+(o.x+l),y),d++,t.insertPointAt(d,g.x,y),d++):(c&&(t.insertPointAt(d,r.left-h/2,m.y),d++),t.insertPointAt(d,r.left-h/2,y),d++,t.insertPointAt(d,r.left-h+o.x+(c?l/2:l),y),d++,c&&(t.insertPointAt(d,t.getPoint(d-1).x,g.y),d++))):a===270?(s.alignment===23?(y=r.right+o.x,o.x===0&&m.x>p.x+s.rowIndent&&(y=Math.min(y,Math.max(m.x,y-i.computeNodeIndent(s))))):s.alignment===22?(y=r.left+o.x,o.x===0&&m.x<p.x-s.rowIndent&&(y=Math.max(y,Math.min(m.x,y+i.computeNodeIndent(s))))):y=r.x+r.width/2+o.x,u?(t.insertPointAt(d,y,m.y),d++,t.insertPointAt(d,y,r.top-h),d++,t.insertPointAt(d,y,r.top-h+(o.y+l)/3),d++,t.insertPointAt(d,y,r.top-h+(o.y+l)*2/3),d++,t.insertPointAt(d,y,r.top-h+(o.y+l)),d++,t.insertPointAt(d,y,g.y),d++):(c&&(t.insertPointAt(d,m.x,r.top-h/2),d++),t.insertPointAt(d,y,r.top-h/2),d++,t.insertPointAt(d,y,r.top-h+o.y+(c?l/2:l)),d++,c&&(t.insertPointAt(d,g.x,t.getPoint(d-1).y),d++))):b.o("Invalid angle "+a),t.commitRoute()}YI(t,i){const s=this.link,n=this.network.layout,o=n.orthoAngle(t),r=n.orthoAngle(i);if(o===r)return;const a=n.computeLayerSpacing(t),h=t.bounds,l=i.bounds;if(o===0&&l.left-h.right<a+1||o===90&&l.top-h.bottom<a+1||o===180&&h.left-l.right<a+1||o===270&&h.top-l.bottom<a+1)return;s.updateRoute();const u=s.curve===9,c=s.isOrthogonal,d=this.fromVertex,m=n.isBusAlignment(d.alignment);if(s.startRoute(),o===0){const g=h.right+a/2;if(u){if(s.pointsCount===4){const p=s.getPoint(3).y;s.setPointAt(1,g-20,s.getPoint(1).y),s.insertPointAt(2,g-20,p),s.insertPointAt(3,g,p),s.insertPointAt(4,g+20,p),s.setPointAt(5,s.getPoint(5).x,p)}}else c?m?s.setPointAt(3,s.getPoint(2).x,s.getPoint(4).y):s.pointsCount===6&&(s.setPointAt(2,g,s.getPoint(2).y),s.setPointAt(3,g,s.getPoint(3).y)):s.pointsCount===4?s.insertPointAt(2,g,s.getPoint(2).y):s.pointsCount===3?s.setPointAt(1,g,s.getPoint(2).y):s.pointsCount===2&&s.insertPointAt(1,g,s.getPoint(1).y)}else if(o===90){const g=h.bottom+a/2;if(u){if(s.pointsCount===4){const p=s.getPoint(3).x;s.setPointAt(1,s.getPoint(1).x,g-20),s.insertPointAt(2,p,g-20),s.insertPointAt(3,p,g),s.insertPointAt(4,p,g+20),s.setPointAt(5,p,s.getPoint(5).y)}}else c?m?s.setPointAt(3,s.getPoint(2).x,s.getPoint(4).y):s.pointsCount===6&&(s.setPointAt(2,s.getPoint(2).x,g),s.setPointAt(3,s.getPoint(3).x,g)):s.pointsCount===4?s.insertPointAt(2,s.getPoint(2).x,g):s.pointsCount===3?s.setPointAt(1,s.getPoint(2).x,g):s.pointsCount===2&&s.insertPointAt(1,s.getPoint(1).x,g)}else if(o===180){const g=h.left-a/2;if(u){if(s.pointsCount===4){const p=s.getPoint(3).y;s.setPointAt(1,g+20,s.getPoint(1).y),s.insertPointAt(2,g+20,p),s.insertPointAt(3,g,p),s.insertPointAt(4,g-20,p),s.setPointAt(5,s.getPoint(5).x,p)}}else c?m?s.setPointAt(3,s.getPoint(2).x,s.getPoint(4).y):s.pointsCount===6&&(s.setPointAt(2,g,s.getPoint(2).y),s.setPointAt(3,g,s.getPoint(3).y)):s.pointsCount===4?s.insertPointAt(2,g,s.getPoint(2).y):s.pointsCount===3?s.setPointAt(1,g,s.getPoint(2).y):s.pointsCount===2&&s.insertPointAt(1,g,s.getPoint(1).y)}else if(o===270){const g=h.top-a/2;if(u){if(s.pointsCount===4){const p=s.getPoint(3).x;s.setPointAt(1,s.getPoint(1).x,g+20),s.insertPointAt(2,p,g+20),s.insertPointAt(3,p,g),s.insertPointAt(4,p,g-20),s.setPointAt(5,p,s.getPoint(5).y)}}else c?m?s.setPointAt(3,s.getPoint(2).x,s.getPoint(4).y):s.pointsCount===6&&(s.setPointAt(2,s.getPoint(2).x,g),s.setPointAt(3,s.getPoint(3).x,g)):s.pointsCount===4?s.insertPointAt(2,s.getPoint(2).x,g):s.pointsCount===3?s.setPointAt(1,s.getPoint(2).x,g):s.pointsCount===2&&s.insertPointAt(1,s.getPoint(1).x,g)}s.commitRoute()}get fromVertex(){return this.We}set fromVertex(t){this.We!==t&&(this.We=t)}get toVertex(){return this.Je}set toVertex(t){this.Je!==t&&(this.Je=t)}get relativePoint(){return this.kk}set relativePoint(t){this.kk.set(t)}}class qe{constructor(){}}f(qe,"Light",{colors:{text:"#0a0a0a",comment:"#ca8a04",link:"#0a0a0a",group:"#a3a3a344",outline:"#a3a3a3",selection:"#0ea5e9",div:"#fff",gridMinor:"#e5e5e5",gridMajor:"#a3a3a3",overviewBox:"#c026d3",tempLink:"#2563eb",tempPort:"#c026d3",adornmentFill:"#0ea5e9",adornmentStroke:"#1e40af",dragSelect:"#c026d3"},fonts:{normal:"10pt sans-serif",bold:"bold 12pt sans-serif"},numbers:{group:1,selection:3},margins:{group:new Kt(5)},arrowheads:{toArrow:"Standard"}}),f(qe,"Dark",{colors:{text:"#f5f5f5",comment:"#facc15",link:"#f5f5f5",group:"#a3a3a388",outline:"#a3a3a3",selection:"#38bdf8",div:"#171717",gridMinor:"#262626",gridMajor:"#404040",overviewBox:"#e879f9",tempLink:"#60a5fa",tempPort:"#e879f9",adornmentFill:"#38bdf8",adornmentStroke:"#2563eb",dragSelect:"#e879f9"},fonts:{normal:"10pt sans-serif",bold:"bold 12pt sans-serif"},numbers:{group:1,selection:3},margins:{group:new Kt(5)},arrowheads:{toArrow:"Standard"}});const Zi=class Zi{constructor(e){f(this,"es",new Set);f(this,"iu",new St);f(this,"Pk","light");f(this,"Sk","light");f(this,"Mk",!1);f(this,"vg","light");f(this,"SD",e=>{const t=e.matches?"dark":"light";t!==this.vg&&(this.vg=t,this.Sk==="system"&&this.cw())});e&&Object.assign(this,e),e!=null&&e.themeMap||(this.iu.set("light",{colors:{...qe.Light.colors},fonts:{...qe.Light.fonts},numbers:{...qe.Light.numbers},margins:{...qe.Light.margins},arrowheads:{...qe.Light.arrowheads}}),this.iu.set("dark",{colors:{...qe.Dark.colors},fonts:{...qe.Dark.fonts},numbers:{...qe.Dark.numbers},margins:{...qe.Dark.margins},arrowheads:{...qe.Dark.arrowheads}})),Z.matchMedia&&(this.vg=Z.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}get themeMap(){return this.iu}set themeMap(e){this.iu!==e&&(this.iu=e,this.cw())}get defaultTheme(){return this.Pk}set defaultTheme(e){this.Pk!==e&&(b.i(e,"string",Zi,"defaultTheme"),this.Pk=e,this.cw())}get currentTheme(){return this.Sk}set currentTheme(e){this.Sk!==e&&(b.i(e,"string",Zi,"currentTheme"),this.Sk=e,this.cw())}get changesDivBackground(){return this.Mk}set changesDivBackground(e){if(this.Mk!==e&&(this.Mk=e,e))for(const t of this.es)t.setDivBackground(this.findValue("div","","fill")),t.v("ThemeChanged",this)}get preferredColorScheme(){return this.vg}addDiagram(e){return this.es.add(e),this.HN(e),this}removeDiagram(e){return this.es.delete(e),this.HN(e),this}VF(){var e;this.es.size===0&&Z.matchMedia&&((e=Z.matchMedia("(prefers-color-scheme: dark)"))==null||e.addEventListener("change",this.SD))}zF(){var e;this.es.size===0&&Z.matchMedia&&((e=Z.matchMedia("(prefers-color-scheme: dark)"))==null||e.removeEventListener("change",this.SD))}set(e,t){e===""&&(e=this.Pk),e==="system"&&(e=this.vg);let i=this.iu.get(e);return i?i=this.MD(i,t):i=t,this.iu.set(e,i),this.cw(),this}findValue(e,t,i){return this.getValue(this.findTheme(this.currentTheme),e,t,i)||this.getValue(this.findTheme(this.defaultTheme),e,t,i)}getValue(e,t,i,s){var a;if(!e)return;i==null&&(i="");let n=e;const o=h=>{if(n===void 0||h==="")return;if(typeof h=="number"||!(Array.isArray(h)||h.includes(".")))return n[h];const l=Array.isArray(h)?h:h.split(".");for(let u=0;u<l.length;u++){const c=l[u];if(c!==""&&(n=n[c],n===void 0))return}return n},r=()=>{if(!(i!==""&&(n=o(i),n===void 0)))return Array.isArray(n)&&typeof t=="number"?n=n[t%n.length]:n=o(t),n};if(n=r(),n===void 0&&typeof s=="string"&&s.length>0){let h=(a=e.targetPropertyMap)==null?void 0:a.get(s);if(h?n=e[h]:(h=Zi.GI.get(s),n=h?e[h]:e.colors),n=r(),n!==void 0)return n}return n}findTheme(e){return this.themeMap.get(e==="system"?this.vg:e)}HN(e){const t=e.skipsUndoManager;e.skipsUndoManager=!0,e.updateAllThemeBindings(),this.Mk&&e.setDivBackground(this.findValue("div","","fill")),e.skipsUndoManager=t,e.v("ThemeChanged",this)}cw(){for(const e of this.es)this.HN(e)}MD(e,t){for(const i in t)if(b.fw(t,i))try{t[i].constructor===Object?e[i]=this.MD(e[i]??{},t[i]):e[i]=t[i]}catch{delete e[i]}return e}};f(Zi,"GI",new Map([["background","colors"],["defaultColumnSeparatorStroke","colors"],["defaultRowSeparatorStroke","colors"],["shadowColor","colors"],["fill","colors"],["stroke","colors"],["font","fonts"],["angle","numbers"],["fromEndSegmentLength","numbers"],["fromShortLength","numbers"],["height","numbers"],["opacity","numbers"],["scale","numbers"],["toEndSegmentLength","numbers"],["toShortLength","numbers"],["width","numbers"],["defaultColumnSeparatorStrokeWidth","numbers"],["defaultRowSeparatorStrokeWidth","numbers"],["shadowBlur","numbers"],["corner","numbers"],["curviness","numbers"],["smoothness","numbers"],["parameter1","numbers"],["parameter2","numbers"],["strokeWidth","numbers"],["strokeDashOffset","numbers"],["maxLines","numbers"],["spacingAbove","numbers"],["spacingBelow","numbers"],["position","points"],["shadowOffset","points"],["desiredSize","sizes"],["maxSize","sizes"],["minSize","sizes"],["margin","margins"],["defaultSeparatorPadding","margins"],["padding","margins"],["alignment","spots"],["alignmentFocus","spots"],["fromSpot","spots"],["toSpot","spots"],["defaultAlignment","spots"],["spot1","spots"],["spot2","spots"],["verticalAlignment","spots"],["imageAlignment","spots"],["fromArrow","arrowheads"],["toArrow","arrowheads"]]));let us=Zi;class An{constructor(){f(this,"Mt");f(this,"p");f(this,"Oi");f(this,"ul");this.p=At.mm(),this.Mt="",this.Oi=!0,this.ul=!0}get name(){return this.Mt}set name(e){this.Mt=e}get isEnabled(){return this.Oi}set isEnabled(e){this.Oi=e}get isRealtime(){return this.ul}set isRealtime(e){this.ul=e}get diagram(){return this.p}set diagram(e){this.p!==e&&(this.p=e,e.bl=!0,e.requestUpdate())}invalidateRouter(){this.p!==null&&(this.p.bl=!0,this.p.requestUpdate())}canRoute(e){if(!this.isEnabled)return!1;const t=this.diagram;return!(t&&(!this.isRealtime&&t.pu||t.animationManager.isTicking))}routeLinks(e,t){}toString(){return this.name!==""?this.name+" Router":b.sn(this.constructor)}}class io extends An{constructor(e){super(),this.name="AvoidsNodes",e&&Object.assign(this,e)}canRoute(e){return(e instanceof At?e.Ym:e.diagram.Ym)?super.canRoute(e):!1}routeLinks(e,t){t=t instanceof At?null:t;const i=e.iterator,s=this.diagram.getPositions(!0,t,null);for(;i.next();){const n=i.value;if(!n.isAvoiding||t&&n.containingGroup!==t||n.toNode===null||n.fromNode===null||n.pointsCount<4)continue;n.startRoute();const o=n.pointsCount,r=n.getPoint(1),a=n.getPoint(o-2),h=n.fromNode.actualBounds.copy();h.inflate(dt.va,dt.va),h.unionPoint(n.getPoint(0));const l=n.toNode.actualBounds.copy();l.inflate(dt.va,dt.va),l.unionPoint(n.getPoint(o-1)),this.jI(n,h,l,s)&&this.HI(n,r,n.iN,a,n.eN,h,l,s),n.commitRoute()}}jI(e,t,i,s){const n=e.diagram,o=e.pointsCount;if(n===null||e.fromNode===e.toNode||e.layer.isTemporary||t.containsPoint(e.getPoint(o-1))&&!e.toNode.isMemberOf(e.fromNode)||i.containsPoint(e.getPoint(0))&&!e.fromNode.isMemberOf(e.toNode)||!e.isOrthogonal)return!1;if(e.segmentIndex===17)return!0;const r=e.getPoint(1),a=e.getPoint(o-2),h=e.getPoint(2);if(!s.isUnoccupied(Math.min(r.x,h.x),Math.min(r.y,h.y),Math.abs(r.x-h.x),Math.abs(r.y-h.y)))return!0;for(let u=2;u<o-3;u++){const c=e.getPoint(u),d=e.getPoint(u+1);if(!s.isUnoccupied(Math.min(c.x,d.x),Math.min(c.y,d.y),Math.abs(c.x-d.x),Math.abs(c.y-d.y)))return!0}const l=e.getPoint(o-3);return!s.isUnoccupied(Math.min(l.x,a.x),Math.min(l.y,a.y),Math.abs(l.x-a.x),Math.abs(l.y-a.y))}HI(e,t,i,s,n,o,r,a){const h=e.diagram,l=t,u=s;let c=null,d=null;if(h.isVirtualized){const p=a.bounds.copy(),y=e.getPoint(2),x=e.getPoint(e.pointsCount-3);p.inflate(-a.cellWidth,-a.cellHeight);const P=S.l();a.Ud(t.x,t.y)||(A.pl(p.x,p.y,p.x+p.width,p.y+p.height,t.x,t.y,y.x,y.y,P)?(c=t=P.copy(),i=P.directionPoint(y)):A.pl(p.x,p.y,p.x+p.width,p.y+p.height,y.x,y.y,x.x,x.y,P)?(c=t=P.copy(),i=P.directionPoint(x)):A.pl(p.x,p.y,p.x+p.width,p.y+p.height,x.x,x.y,s.x,s.y,P)&&(c=t=P.copy(),i=P.directionPoint(s))),a.Ud(s.x,s.y)||(A.pl(p.x,p.y,p.x+p.width,p.y+p.height,s.x,s.y,x.x,x.y,P)?(d=s=P.copy(),n=x.directionPoint(P)):A.pl(p.x,p.y,p.x+p.width,p.y+p.height,x.x,x.y,y.x,y.y,P)?(d=s=P.copy(),n=y.directionPoint(P)):A.pl(p.x,p.y,p.x+p.width,p.y+p.height,y.x,y.y,t.x,t.y,P)&&(d=s=P.copy(),n=t.directionPoint(P))),S.s(P)}const m=o.copy().unionRect(r);m.inflate(a.cellWidth*a.Gc,a.cellHeight*a.Gc),a.rT(t,i,s,n,m,!0);let g=a.fo(s.x,s.y);if(!a.by&&g>=xi.Bd&&(a.zL(),m.inflate(a.cellWidth*a.vM,a.cellHeight*a.OM),a.rT(t,i,s,n,m,!1),g=a.fo(s.x,s.y)),!a.by&&g<xi.Bd&&!a.aO(s.x,s.y)){e.points.removeRange(2,e.pointsCount-3),this.qN(e,a,s.x,s.y,n,!0);const p=0,y=90,x=180,P=270,k=e.getPoint(2);if(e.pointsCount<4)i===p||i===x?(k.x=t.x,k.y=s.y):(k.x=s.x,k.y=t.y),e.setPointAt(2,k.x,k.y),e.insertPointAt(3,k.x,k.y);else{const w=e.getPoint(3);if(i===p||i===x)if(A.u(k.x,w.x)){const N=i===p?Math.max(k.x,t.x):Math.min(k.x,t.x);e.setPointAt(2,N,t.y),e.setPointAt(3,N,w.y)}else A.u(k.y,w.y)?(Math.abs(t.y-k.y)<=a.cellHeight/2&&(e.setPointAt(2,k.x,t.y),e.setPointAt(3,w.x,t.y)),e.insertPointAt(2,k.x,t.y)):e.setPointAt(2,t.x,k.y);else if(i===y||i===P)if(A.u(k.y,w.y)){const N=i===y?Math.max(k.y,t.y):Math.min(k.y,t.y);e.setPointAt(2,t.x,N),e.setPointAt(3,w.x,N)}else A.u(k.x,w.x)?(Math.abs(t.x-k.x)<=a.cellWidth/2&&(e.setPointAt(2,t.x,k.y),e.setPointAt(3,t.x,w.y)),e.insertPointAt(2,t.x,k.y)):e.setPointAt(2,k.x,t.y)}if(c!==null){const w=e.getPoint(1),N=e.getPoint(2);w.x!==N.x&&w.y!==N.y?i===p||i===x?e.insertPointAt(2,w.x,N.y):e.insertPointAt(2,N.x,w.y):i===p||i===x?e.insertPointAt(2,l.x,c.y):e.insertPointAt(2,c.x,l.y)}d!==null&&(n===p||n===x?e.insertPointAt(e.pointsCount-2,u.x,d.y):e.insertPointAt(e.pointsCount-2,d.x,u.y))}}qN(e,t,i,s,n,o){const r=t.cellWidth,a=t.cellHeight;let h=t.fo(i,s),l=i,u=s,c=l,d=u;for(n===0?c+=r:n===90?d+=a:n===180?c-=r:d-=a,e.oN&&h>xi.Ba&&t.fo(c,d)!==h-1&&(t.fo(l-r,u)===h-1?(n=180,c=l-r,d=u):t.fo(l+r,u)===h-1?(n=0,c=l+r,d=u):t.fo(l,u-a)===h-1?(n=270,c=l,d=u-a):t.fo(l,u+a)===h-1&&(n=90,c=l,d=u+a));h>xi.Ba&&t.fo(c,d)===h-1;)l=c,u=d,n===0?c+=r:n===90?d+=a:n===180?c-=r:d-=a,h-=1;if(o?h>xi.Ba&&(n===180||n===0?l=Math.floor(l/r)*r+r/2:(n===90||n===270)&&(u=Math.floor(u/a)*a+a/2)):(l=Math.floor(l/r)*r+r/2,u=Math.floor(u/a)*a+a/2),h>xi.Ba){let m=n,g=l,p=u;if(n===0?(m=90,p+=a):n===90?(m=180,g-=r):n===180?(m=270,p-=a):n===270&&(m=0,g+=r),t.fo(g,p)===h-1)this.qN(e,t,g,p,m,!1);else{let y=l,x=u;n===0?(m=270,x-=a):n===90?(m=0,y+=r):n===180?(m=90,x+=a):n===270&&(m=180,y-=r),t.fo(y,x)===h-1&&this.qN(e,t,y,x,m,!1)}}e.insertPointAt(e.pointsCount-2,l,u)}}Ve.prototype.initializeStandardTools=function(){this.Jt("Action",new zt,this.mouseDownTools),this.Jt("Relinking",new H,this.mouseDownTools),this.Jt("LinkReshaping",new rt,this.mouseDownTools),this.Jt("Rotating",new xt,this.mouseDownTools),this.Jt("Resizing",new lt,this.mouseDownTools),this.Jt("Linking",new Ai,this.mouseMoveTools),this.Jt("Dragging",new di,this.mouseMoveTools),this.Jt("DragSelecting",new Re,this.mouseMoveTools),this.Jt("Panning",new Xi,this.mouseMoveTools),this.Jt("ContextMenu",new Di,this.mouseUpTools),this.Jt("TextEditing",new Fi,this.mouseUpTools),this.Jt("ClickCreating",new ae,this.mouseUpTools),this.Jt("ClickSelecting",new Ot,this.mouseUpTools)},At.gM("GraphLinksModel",_n),At.gM("TreeModel",to);const vs=Z.go,nn={get version(){return At.version},Group:at,List:J,Set:K,Map:St,Point:S,Size:ut,Rect:z,Margin:Kt,Spot:B,Geometry:Ft,PathFigure:_t,PathSegment:kt,InputEvent:ui,DiagramEvent:Ki,ChangedEvent:ci,Model:mt,GraphLinksModel:Wi,TreeModel:$i,Binding:bi,ThemeBinding:Hi,Transaction:pe,UndoManager:Li,CommandHandler:Ye,Tool:ke,DraggingTool:di,DraggingInfo:Oi,DraggingOptions:gs,LinkingBaseTool:ts,LinkingTool:Ai,RelinkingTool:H,LinkReshapingTool:rt,ResizingTool:lt,RotatingTool:xt,ClickSelectingTool:Ot,ActionTool:zt,ClickCreatingTool:ae,HTMLInfo:ti,ContextMenuTool:Di,DragSelectingTool:Re,PanningTool:Xi,TextEditingTool:Fi,ToolManager:Ve,Animation:ei,AnimationManager:yi,AnimationTrigger:os,Layer:Be,Diagram:At,Palette:En,Overview:ms,Brush:jt,GraphObject:he,Panel:ct,RowColumnDefinition:Te,Shape:bt,TextBlock:Qt,Picture:Ge,Part:Bt,Adornment:Mt,Node:nt,Link:dt,Placeholder:Ue,Layout:be,LayoutNetwork:Mi,LayoutVertex:Ni,LayoutEdge:qi,GridLayout:xs,PanelLayout:Rt,CircularLayout:Le,CircularNetwork:yn,CircularVertex:xn,CircularEdge:bn,ForceDirectedLayout:eo,ForceDirectedNetwork:vn,ForceDirectedVertex:wn,ForceDirectedEdge:kn,LayeredDigraphLayout:ne,LayeredDigraphNetwork:Nn,LayeredDigraphVertex:ls,LayeredDigraphEdge:Cn,TreeLayout:Wt,TreeNetwork:sn,TreeVertex:We,TreeEdge:Ln,Themes:qe,ThemeManager:us,Router:An,AnimationStyle:ns,AutoScale:Ss,CycleMode:rn,Flip:ln,TextFormat:fn,ImageStretch:Fs,LayoutConditions:gn,LinkAdjusting:Bs,Curve:Is,Routing:Es,Orientation:Ns,TextOverflow:dn,PortSpreading:mn,ScrollMode:an,CollapsePolicy:hn,Sizing:Ts,TriggerStart:on,Stretch:Ms,ViewboxStretch:cn,Wrap:As,BrushType:Bi,ColorSpace:un,GeometryStretch:ji,GeometryType:pi,SegmentType:_e,BindingMode:bs,ChangeType:Qi,CircularArrangement:Xs,CircularDirection:Ys,CircularNodeDiameterFormula:Us,CircularSorting:Gs,GridAlignment:zs,GridArrangement:js,GridSorting:Ks,LayeredDigraphAggressive:$s,LayeredDigraphAlign:Mn,LayeredDigraphCycleRemove:qs,LayeredDigraphInit:Ws,LayeredDigraphLayering:Hs,LayeredDigraphPack:Sn,TreeAlignment:Qs,TreeArrangement:en,TreeCompaction:_s,TreeLayerStyle:Tn,TreePath:Js,TreeSorting:Zs,TreeStyle:tn,GestureMode:_i,LinkingDirection:Xe,ReshapingBehavior:ht,TextEditingAccept:es,TextEditingStarting:is,TextEditingState:ss,WheelMode:fs};typeof vs=="object"&&vs.version&&b.ii("WARNING: a `go` object on the root object is already defined.  "+("Debug"in vs?"debug ":"")+"version: "+vs.version+", replaced with version: "+nn.version),At.prototype.go=nn,Z.go=nn})();const Gt=typeof global<"u"?global.go:self.go,q=typeof global<"u"?global.go:self.go;q.Group;q.List;q.Set;q.Map;q.Point;q.Size;q.Rect;q.Margin;q.Spot;q.Geometry;q.PathFigure;q.PathSegment;q.InputEvent;q.DiagramEvent;q.ChangedEvent;q.Model;q.GraphLinksModel;q.TreeModel;q.Binding;q.ThemeBinding;q.Transaction;q.UndoManager;q.CommandHandler;q.Tool;q.DraggingTool;q.DraggingInfo;q.DraggingOptions;q.LinkingBaseTool;q.LinkingTool;q.RelinkingTool;q.LinkReshapingTool;q.ResizingTool;q.RotatingTool;q.ClickSelectingTool;q.ActionTool;q.ClickCreatingTool;q.HTMLInfo;q.ContextMenuTool;q.DragSelectingTool;q.PanningTool;q.TextEditingTool;q.ToolManager;q.Animation;q.AnimationManager;q.AnimationTrigger;q.Layer;q.Diagram;q.Palette;q.Overview;q.Brush;q.GraphObject;q.Panel;q.RowColumnDefinition;q.Shape;q.TextBlock;q.Picture;q.Part;q.Adornment;q.Node;q.Link;q.Placeholder;q.Layout;q.LayoutNetwork;q.LayoutVertex;q.LayoutEdge;q.GridLayout;q.PanelLayout;q.CircularLayout;q.CircularNetwork;q.CircularVertex;q.CircularEdge;q.ForceDirectedLayout;q.ForceDirectedNetwork;q.ForceDirectedVertex;q.ForceDirectedEdge;q.LayeredDigraphLayout;q.LayeredDigraphNetwork;q.LayeredDigraphVertex;q.LayeredDigraphEdge;q.TreeLayout;q.TreeNetwork;q.TreeVertex;q.TreeEdge;q.Themes;q.ThemeManager;q.Router;q.version;q.AnimationStyle;q.AutoScale;q.Curve;q.CycleMode;q.Flip;q.ImageStretch;q.LayoutConditions;q.LinkAdjusting;q.Orientation;q.PortSpreading;q.Routing;q.ScrollMode;q.CollapsePolicy;q.Sizing;q.TriggerStart;q.Stretch;q.TextFormat;q.TextOverflow;q.ViewboxStretch;q.Wrap;q.BrushType;q.ColorSpace;q.GeometryStretch;q.GeometryType;q.SegmentType;q.BindingMode;q.ChangeType;q.CircularArrangement;q.CircularDirection;q.CircularNodeDiameterFormula;q.CircularSorting;q.GridAlignment;q.GridArrangement;q.GridSorting;q.LayeredDigraphAggressive;q.LayeredDigraphAlign;q.LayeredDigraphCycleRemove;q.LayeredDigraphInit;q.LayeredDigraphLayering;q.LayeredDigraphPack;q.TreeAlignment;q.TreeArrangement;q.TreeCompaction;q.TreeLayerStyle;q.TreePath;q.TreeSorting;q.TreeStyle;q.GestureMode;q.LinkingDirection;q.ReshapingBehavior;q.TextEditingAccept;q.TextEditingStarting;q.TextEditingState;q.WheelMode;const fo={class:"container"},go={id:"myButtonDiv",style:{height:"500px",width:"230px",border:"1px solid black","background-color":"#DAE4E4","margin-bottom":"10px"}},mo={style:{"justify-content":"center","align-items":"center",margin:"15px",height:"100vh"}},po={key:0,style:{"text-align":"center","font-family":"'Arial', sans-serif","font-size":"20px","font-weight":"600","letter-spacing":"1px",color:"#4a4a4a","text-shadow":"1px 1px 2px rgba(0, 0, 0, 0.1)"}},yo={key:2,style:{"text-align":"center","font-family":"'Arial', sans-serif","font-size":"20px","font-weight":"600","letter-spacing":"1px",color:"#4a4a4a","text-shadow":"1px 1px 2px rgba(0, 0, 0, 0.1)"}},xo={key:4,class:"animated-button"},bo={key:5,class:"animated-button"},vo={key:6,class:"animated-button"},wo={key:7,class:"animated-button"},ko={key:9,style:{"text-align":"center","font-family":"'Arial', sans-serif","font-size":"20px","font-weight":"600","letter-spacing":"1px",color:"#4a4a4a","text-shadow":"1px 1px 2px rgba(0, 0, 0, 0.1)"}},Po={__name:"IndexDiagram",props:{user:{type:Object},sala:{type:Object},array_node:{type:Object},array_links:{type:Object},array_links_intermedia:{type:Object},positions:{type:Object}},setup(Z){let b=Ie({});Ie([{to:"Beta",from:"Alpha",color:"blue"}]);let me=Ie(null),fe=Ie(null),Ht=Ie(null),Xt=Ie(!1),li=Ie(1),Fe=Ie(0),J=Ie([{key:li,color:"black",loc:"0 0"}]),zi=Ie([]),K=Ie({}),ki=Ie({}),mi=Ie({}),Ti=Ie(!1),Oe=Ie(0);const Me=Z;ro(()=>{ke(),St(),Array.isArray(Me.array_node)&&Me.array_node.length===0?console.log("El array está vacío"):(console.log("El array no está vacío"),Me.array_node.forEach((H,ht)=>{console.log(`Elemento ${ht}:`,H.key);const[rt,lt]=H.loc.split(",").map(xt=>xt.trim());console.log(rt),console.log(lt),console.log("lo que tiene el nod => ",H.loc),ji(H),_i(parseFloat(rt),parseFloat(lt),H.key)})),Array.isArray(Me.array_links)&&Me.array_links.length===0?console.log("El array está vacío"):(console.log("El array no está vacío"),Me.array_links.forEach((H,ht)=>{console.log(`Elemento ${ht}:`,H),A(H.fromText,H.toText,H.valueFrom,H.valueTo,H.type_relation)})),Array.isArray(Me.array_links_intermedia)&&Me.array_links_intermedia.length===0?console.log("El array está vacío"):Me.array_links_intermedia.forEach((H,ht)=>{z(H.fromA,H.fromB,H.to),console.log(" =============================> ",H)})});function St(){let H=null;console.log(" listen_sockets =>> ",Me.user.id,Me.user.code_sala_activate),Echo.private(`diagramComunication.${Me.user.code_sala_activate}`).listen("DiagramComunication",rt=>{var lt,xt,Ot,zt,ae,Re,Xi,ti,Ne,Di,es,is,ss,Fi,ns,yi;if(console.log("-------------- al escuchar sockets -------------------------",Me.user.id,rt.message.id),Me.user.id!==rt.message.id)switch(console.log(rt.message),(lt=rt.message.message)==null?void 0:lt.type){case"create_clase":ji((xt=rt.message.message)==null?void 0:xt.msj);break;case"move_node":let ei=(Ot=rt.message.message)==null?void 0:Ot.msj;console.log(" mover nodo = > ",ei),_i(ei.coordenadaX,ei.coordenadaY,ei.nodeKey);break;case"edit_class":H=(zt=rt.message.message)==null?void 0:zt.msj,console.log(" edit_class = > ",H),ht(H.key,H.type,H.data_text);break;case"create_link":H=(ae=rt.message.message)==null?void 0:ae.msj,console.log(" create_link = > ",H),A(H.fromText,H.toText,H.valueFrom,H.valueTo);break;case"modified_leter_link":H=(Re=rt.message.message)==null?void 0:Re.msj,console.log(" modified_leter_link = > ",H),Ve(H.fromText,H.toText,H.type,H.valueText);break;case"delete_link":H=(Xi=rt.message.message)==null?void 0:Xi.msj,console.log(" delete_link = > ",H),di(H.from,H.to);break;case"delete_class":H=(ti=rt.message.message)==null?void 0:ti.msj,console.log(" delete_class = > ",H),ts(H.key);break;case"generalizacion":H=(Ne=rt.message.message)==null?void 0:Ne.msj,Xe(H.from,H.to,rt.message.message.type);break;case"asociacion":H=(Di=rt.message.message)==null?void 0:Di.msj,Xe(H.from,H.to,rt.message.message.type);break;case"agregacion":H=(es=rt.message.message)==null?void 0:es.msj,Xe(H.from,H.to,rt.message.message.type);break;case"composicion":H=(is=rt.message.message)==null?void 0:is.msj,Xe(H.from,H.to,rt.message.message.type);break;case"dependencia":H=(ss=rt.message.message)==null?void 0:ss.msj,Xe(H.from,H.to,rt.message.message.type);break;case"create_clase_intermedia":H=(Fi=rt.message.message)==null?void 0:Fi.msj,z(H.fromA,H.fromB,H.to);break;case"simulation_click":H=(ns=rt.message.message)==null?void 0:ns.msj,S(H.key);break;case"simulation_desclick":H=(yi=rt.message.message)==null?void 0:yi.msj,ut(H.key);break}});function ht(rt,lt,xt){var Ot=b.findNodeForKey(rt);Ot!==null&&(lt=="text1"?b.model.setDataProperty(Ot.data,"text1",xt):lt=="text2"?b.model.setDataProperty(Ot.data,"text2",xt):b.model.setDataProperty(Ot.data,"text3",xt))}}function S(H){const ht=b.findNodeForKey(H);ht&&(b.select(ht),b.scrollToRect(ht.actualBounds))}function ut(H){var ht=b.findNodeForKey(H);ht!==null&&ht.isSelected&&(ht.isSelected=!1)}const z=(H,ht,rt)=>{console.log(" ingresa a crear relacion intermedia -------------------");const lt={from:H,to:rt,fromLabel:"*",toLabel:"",isOrthogonal:!0},xt={from:ht,to:rt,fromLabel:"*",toLabel:"",isOrthogonal:!0};console.log(lt,xt),b.model.addLinkData(lt),b.model.addLinkData(xt)},Kt=()=>{K.value={},ki.value={},mi.value={}},B=H=>{if(Fe.value=H,H==4){z(K.value.key,ki.value.key,mi.value.key);let ht={fromA:K.value.key,fromB:ki.value.key,to:mi.value.key};pe(Tt("create_clase_intermedia",ht)),Kt(),setTimeout(()=>{Fe.value=0},3e3)}},Tt=(H,ht)=>({type:H,msj:ht});function A(H,ht,rt,lt,xt=null){const Ot={from:H,to:ht,fromLabel:rt,toLabel:lt};if(b.model.addLinkData(Ot),console.log("//////////////////////////////////////////////////////////////////////"),console.log(xt),console.log("//////////////////////////////////////////////////////////////////////"),xt!=null)switch(xt){case 1:Xe(H,ht,"asociacion");break;case 2:Xe(H,ht,"generalizacion");break;case 3:Xe(H,ht,"agregacion");break;case 4:Xe(H,ht,"dependencia");break;case 5:Xe(H,ht,"composicion");break}}const pi=async()=>{try{let ht={key:await Li(),text1:"nombre tabla",text2:"+id : int",text3:"+methods()",color:"black",loc:"100 100"};pe(Tt("create_clase",ht)),Ft(ht)}catch(H){console.error("Error al agregar el nodo:",H)}},ji=H=>{li.value=H.key,Ft(H)},Ft=H=>{console.log("Agregar rectángulo",H),b.startTransaction("addNode"),b.model.addNodeData(H),b.commitTransaction("addNode")};function _t(H){b.startTransaction("toggleArrow"),me=H.findObject("TOARROW"),Ht=H,fe=H.findObject("LinkShape"),console.log("ingresa a toggleArrow ",me,H," - ",me.toArrow),Xt.value=!0,b.commitTransaction("toggleArrow")}const _e=H=>{pe(Tt(H,zi.value)),console.log(zi.value)},kt=()=>{console.log("Agregar rectángulo con flecha"),b.startTransaction("toggleArrow"),me.toArrow="Triangle",fe.strokeDashArray=[],me.fill="#DAE4E4",Ht.findObject("fromText").text="",Ht.findObject("toText").text="",b.commitTransaction("toggleArrow"),Xt.value=!1,_e("generalizacion")},ui=()=>{console.log("Agregar rectángulo sin flecha"),b.startTransaction("toggleArrow"),me.toArrow="",me.fill="#DAE4E4",fe.strokeDashArray=[],Ht.findObject("fromText").text="1",Ht.findObject("toText").text="*",b.commitTransaction("toggleArrow"),Xt.value=!1,_e("asociacion")},Ki=()=>{console.log("Agregar rectángulo con flecha"),b.startTransaction("toggleArrow"),me.toArrow="Diamond",me.fill="#DAE4E4",fe.strokeDashArray=[],Ht.findObject("fromText").text="",Ht.findObject("toText").text="",b.commitTransaction("toggleArrow"),Xt.value=!1,_e("agregacion")},Qi=()=>{console.log("Agregar rectángulo con flecha"),b.startTransaction("toggleArrow"),me.toArrow="Diamond",me.fill="black",fe.strokeDashArray=[],Ht.findObject("fromText").text="",Ht.findObject("toText").text="",b.commitTransaction("toggleArrow"),Xt.value=!1,_e("composicion")},ci=()=>{console.log("Agregar rectángulo sin flecha"),b.startTransaction("toggleArrow"),me.toArrow="OpenTriangle",fe.strokeDashArray=[6,3],Ht.findObject("fromText").text="",me.fill="#DAE4E4",Ht.findObject("toText").text="",b.commitTransaction("toggleArrow"),Xt.value=!1,_e("dependencia")},pe=H=>{axios.post(route("diagram_class.peticion_socket"),H).then(ht=>{}).catch(ht=>{console.error(ht)})},Li=async()=>{try{return(await axios.get(route("clase.get_id_key"))).data}catch(H){throw console.error("Error al obtener el ID:",H),H}};function ke(){fs()}function fs(){const H=Gt.GraphObject.make;b=H(Gt.Diagram,"myDiagramDiv",{"undoManager.isEnabled":!0}),b.nodeTemplate=H(Gt.Node,"Auto",{locationSpot:Gt.Spot.TopLeft,mouseEnter:(rt,lt)=>{Ti=!0,ht(lt.part.data.key),console.log("Mouse entra en el nodo:",lt.part.data.key,Ti,lt);let xt={is_clickeado:!0,key:lt.part.data.key};pe(Tt("simulation_click",xt))},mouseLeave:(rt,lt)=>{Ti=!1,console.log("Mouse sale del nodo:",lt.part.data.key,Ti,lt);let xt={is_clickeado:!1,key:lt.part.data.key};pe(Tt("simulation_desclick",xt))},click:(rt,lt)=>{const xt=lt.data;xt.key,xt.otherProperty,Fe.value>0&&(Fe.value==1?(K.value=xt,B(2),console.log(" informacion de nodo padre",K.value)):Fe.value==2?(ki.value=xt,B(3),console.log(" informacion del otro nodo padre",ki.value)):Fe.value==3&&(mi.value=xt,B(4),console.log(" informacion del nodo intermedio",mi.value)))}},H(Gt.Shape,"Rectangle",{fill:"lightblue",portId:"",cursor:"pointer",fromLinkable:!0,toLinkable:!0,fromLinkableDuplicates:!0,fromLinkableSelfNode:!0,toLinkableSelfNode:!0}),H(Gt.Panel,"Vertical",{margin:5},H(Gt.TextBlock,{margin:5,font:"bold 14px sans-serif",isMultiline:!1,editable:!0,textEdited:function(rt,lt,xt){console.log(" nombre clases => ",lt,rt.part.data.key,xt);var Ot=rt.part,zt=Ot.data.key;pe(Tt("edit_class",{key:zt,type:"text1",data_text:xt}))}},new Gt.Binding("text","text1")),H(Gt.TextBlock,{margin:5,isMultiline:!0,editable:!0,textEdited:function(rt,lt,xt){console.log("*atributos => ",lt,rt.part.data.key,xt);var Ot=rt.part,zt=Ot.data.key;pe(Tt("edit_class",{key:zt,type:"text2",data_text:xt}))}},new Gt.Binding("text","text2")),H(Gt.TextBlock,{margin:5,isMultiline:!0,editable:!0,textEdited:function(rt,lt,xt){console.log("*Metodos => **",lt,rt.part.data.key,xt);var Ot=rt.part,zt=Ot.data.key;pe(Tt("edit_class",{key:zt,type:"text3",data_text:xt}))}},new Gt.Binding("text","text3")))),b.linkTemplate=H(Gt.Link,{routing:Gt.Link.Normal,relinkableFrom:!0,relinkableTo:!0,corner:5,selectable:!0,selectionAdorned:!0,adjusting:Gt.Link.Stretch},{click:(rt,lt)=>{console.log("Clic en el enlace:",lt.part.data),_t(lt);const xt=lt.part.data;console.log("Enlace clickeado:");const Ot=lt.findObject("fromText").text,zt=lt.findObject("toText").text;let ae={from:xt.from,to:xt.to,fromText:Ot,toText:zt};zi.value=ae,console.log(" dato clieckeado => ",ae,zi.value)},doubleClick:(rt,lt)=>{console.log("Doble clic en el enlace:",lt.part.data)}},new Gt.Binding("routing","",function(rt){return rt.isOrthogonal?Gt.Link.Orthogonal:Gt.Link.Normal}),H(Gt.Shape,{name:"LinkShape",strokeWidth:2,stroke:"black"},new Gt.Binding("stroke","fromNode",rt=>rt&&rt.data.color||"black").ofObject()),H(Gt.Shape,{name:"TOARROW",toArrow:"",stroke:"black",fill:"#DAE4E4",scale:3},new Gt.Binding("stroke","fromNode",rt=>rt&&rt.data.color||"black").ofObject()),H(Gt.TextBlock,"1",{name:"fromText",segmentIndex:0,segmentFraction:.3,alignmentFocus:Gt.Spot.TopLeft,margin:new Gt.Margin(0,20),editable:!0,isMultiline:!1},new Gt.Binding("text","fromLabel")),H(Gt.TextBlock,"*",{name:"toText",segmentIndex:-1,segmentFraction:.3,alignmentFocus:Gt.Spot.BottomRight,margin:new Gt.Margin(0,20),editable:!0,isMultiline:!1},new Gt.Binding("text","toLabel"))),b.model=new Gt.GraphLinksModel(J,[]),b.addDiagramListener("SelectionMoved",function(rt){rt.subject.each(function(lt){if(lt instanceof Gt.Node){const xt=lt.data.name||"Sin nombre",Ot=lt.data.key,zt=lt.location;console.log("Nodo movido:",xt),console.log("Identificador del nodo (key):",Ot),console.log("Nueva posición del nodo:",zt.toString()),console.log("Nueva posición del nodo:",zt.x,zt.y);let ae={coordenadaX:zt.x,coordenadaY:zt.y,nodeKey:Ot};pe(Tt("move_node",ae))}})}),b.addDiagramListener("LinkDrawn",rt=>{const lt=rt.subject,xt=lt.fromNode,Ot=lt.toNode;if(lt.data.fromLabel,lt.data.toLabel,xt&&Ot){let zt={fromText:xt.data.key,toText:Ot.data.key,valueFrom:"1",valueTo:"*"};pe(Tt("create_link",zt))}}),b.addDiagramListener("LinkRelinked",rt=>{const lt=rt.subject,xt=lt.fromNode,Ot=lt.toNode,zt=lt.data.fromLabel,ae=lt.data.toLabel;xt&&Ot&&(console.log(`Se ha modificado el enlace. Nuevo enlace entre '${xt.data.key}' y '${Ot.data.key}'`),console.log(`Texto desde: ${zt}`),console.log(`Texto hasta: ${ae}`))}),b.addDiagramListener("SelectionDeleted",function(rt){var lt=rt.subject;lt.each(function(xt){if(xt instanceof Gt.Link)console.log("Enlace eliminado:",xt.data),pe(Tt("delete_link",xt.data));else if(xt instanceof Gt.Node){var Ot=b.links.filter(function(zt){return zt.to===xt.data.key});Ot.count>0?(console.log("Enlaces que apuntan al nodo eliminado:"),Ot.each(function(zt){console.log(zt.data)})):console.log("No hay enlaces que apunten al nodo eliminado."),pe(Tt("delete_class",xt.data))}})}),b.addDiagramListener("TextEdited",rt=>{const lt=rt.subject,xt=lt.text;if(!lt.part){console.error("No se pudo encontrar el part para este TextBlock.");return}const Ot=lt.part;if(!Ot.data){console.error("No se pudo acceder a los datos del enlace.");return}let zt="";lt.name==="fromText"?zt="fromText":lt.name==="toText"&&(zt="toText");const ae=Ot.data.from,Re=Ot.data.to;ae!=null&&Re!=null&&(console.log("--------------------editar letra de relacion-----------------------------"),console.log(`Texto nuevo: ${zt} => ${xt}`),console.log(`Relación desde el nodo: ${ae} hacia el nodo: ${Re}`),pe(Tt("modified_leter_link",{type:zt,fromText:ae,toText:Re,valueText:xt})))});function ht(rt){Ti.value&&(getPosition(rt),setTimeout(()=>{ht(rt)},30))}}const _i=(H,ht,rt)=>{console.log(" move nodo aaaa",H,ht,rt);const lt=b.findNodeForKey(rt);console.log(lt),lt&&(lt.location=new Gt.Point(H,ht),console.log(`Nodo movido a la nueva posición (${H}, ${ht}).`))};function Ve(H,ht,rt,lt){b.model.startTransaction("updateLinkText");for(var xt=b.model.linkDataArray,Ot=0;Ot<xt.length;Ot++){var zt=xt[Ot];if(zt.from===H&&zt.to===ht){rt==="toText"?b.model.setDataProperty(zt,"toLabel",lt):b.model.setDataProperty(zt,"fromLabel",lt),console.log(`Texto actualizado en el enlace desde ${H} hacia ${ht}: ${rt} = "${lt}"`);break}}b.model.commitTransaction("updateLinkText")}function di(H,ht){b.model.startTransaction("updateLinkText"),console.log("**************** removeLinkByNodes *********************",H,ht);var rt=b.findNodeForKey(H),lt=b.findNodeForKey(ht);let xt=rt==null?void 0:rt.data.key,Ot=lt==null?void 0:lt.data.key;xt||(xt=Oe.value),Ot||(Ot=Oe.value);for(var zt=b.model.linkDataArray,ae=0;ae<zt.length;ae++){var Re=zt[ae];if(console.log(Re.from,Re.to),Re.from===xt&&Re.to===Ot){b.model.removeLinkData(Re);break}}b.model.commitTransaction("updateLinkText")}function ts(H){b.model.startTransaction("updateLinkText"),Oe.value=H;const ht=b.model.nodeDataArray.find(rt=>rt.key===H);ht&&b.model.removeNodeData(ht),b.model.commitTransaction("updateLinkText")}function Xe(H,ht,rt){b.startTransaction("modifyLinkAttributes"),console.log("----------------- modificar las relaciones o links *********************************",H,ht,rt);const lt=b.findLinksByExample({from:H,to:ht}).first();if(lt){const xt=lt.findObject("TOARROW"),Ot=lt.findObject("LinkShape");switch(rt){case"generalizacion":xt.toArrow="Triangle",xt.fill="#DAE4E4",Ot.strokeDashArray=[],lt.findObject("fromText").text="",lt.findObject("toText").text="";break;case"asociacion":xt.toArrow="",xt.fill="#DAE4E4",Ot.strokeDashArray=[],lt.findObject("fromText").text="1",lt.findObject("toText").text="*";break;case"agregacion":xt.toArrow="Diamond",xt.fill="#DAE4E4",Ot.strokeDashArray=[],lt.findObject("fromText").text="",lt.findObject("toText").text="";break;case"composicion":xt.toArrow="Diamond",xt.fill="black",Ot.strokeDashArray=[],lt.findObject("fromText").text="",lt.findObject("toText").text="";break;case"dependencia":xt.toArrow="OpenTriangle",xt.fill="#DAE4E4",Ot.strokeDashArray=[6,3],lt.findObject("fromText").text="",lt.findObject("toText").text="";break}console.log("Atributos del enlace modificados:",lt.data)}else console.log("No se encontró el enlace entre:",H,"y",ht);b.commitTransaction("modifyLinkAttributes")}const Ai=()=>{Kt(),Fe.value=0};return(H,ht)=>(Se(),Pe(ao,null,[Dn(se(ho),{title:"diagrama de clases"}),Dn(oo,{show_navigation:!1,show_back:!0},{header:Fn(()=>ht[2]||(ht[2]=[lo(" Diagramador ")])),default:Fn(()=>[It("div",fo,[It("div",go,[It("div",mo,[se(Xt)?De("",!0):(Se(),Pe("span",po," Clases ")),se(Xt)?De("",!0):(Se(),Pe("button",{key:1,onClick:pi,class:"animated-button"},ht[3]||(ht[3]=[It("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-6"},[It("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m5.231 13.481L15 17.25m-4.5-15H5.625c-.621 0-1.125.504-1.125 1.125v16.5c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Zm3.75 11.625a2.625 2.625 0 1 1-5.25 0 2.625 2.625 0 0 1 5.25 0Z"})],-1),It("span",{class:"button-text"},"Clase",-1)]))),se(Xt)?De("",!0):(Se(),Pe("span",yo," tabla intermedia ")),!se(Xt)&&se(Fe)==0?(Se(),Pe("button",{key:3,onClick:ht[0]||(ht[0]=rt=>B(1)),class:"animated-button"},ht[4]||(ht[4]=[It("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-6"},[It("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21 12a2.25 2.25 0 0 0-2.25-2.25H15a3 3 0 1 1-6 0H5.25A2.25 2.25 0 0 0 3 12m18 0v6a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 18v-6m18 0V9M3 12V9m18 0a2.25 2.25 0 0 0-2.25-2.25H5.25A2.25 2.25 0 0 0 3 9m18 0V6a2.25 2.25 0 0 0-2.25-2.25H5.25A2.25 2.25 0 0 0 3 6v3"})],-1),It("span",{class:"button-text"},"relacionar",-1)]))):De("",!0),!se(Xt)&&se(Fe)==1?(Se(),Pe("button",xo,ht[5]||(ht[5]=[It("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-6"},[It("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21 12a2.25 2.25 0 0 0-2.25-2.25H15a3 3 0 1 1-6 0H5.25A2.25 2.25 0 0 0 3 12m18 0v6a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 18v-6m18 0V9M3 12V9m18 0a2.25 2.25 0 0 0-2.25-2.25H5.25A2.25 2.25 0 0 0 3 9m18 0V6a2.25 2.25 0 0 0-2.25-2.25H5.25A2.25 2.25 0 0 0 3 6v3"})],-1),It("span",{class:"button-text"},"Seleccione clase padre",-1)]))):De("",!0),!se(Xt)&&se(Fe)==2?(Se(),Pe("button",bo,ht[6]||(ht[6]=[It("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-6"},[It("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21 12a2.25 2.25 0 0 0-2.25-2.25H15a3 3 0 1 1-6 0H5.25A2.25 2.25 0 0 0 3 12m18 0v6a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 18v-6m18 0V9M3 12V9m18 0a2.25 2.25 0 0 0-2.25-2.25H5.25A2.25 2.25 0 0 0 3 9m18 0V6a2.25 2.25 0 0 0-2.25-2.25H5.25A2.25 2.25 0 0 0 3 6v3"})],-1),It("span",{class:"button-text"},"seleccione otra clase padre",-1)]))):De("",!0),!se(Xt)&&se(Fe)==3?(Se(),Pe("button",vo,ht[7]||(ht[7]=[It("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-6"},[It("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21 12a2.25 2.25 0 0 0-2.25-2.25H15a3 3 0 1 1-6 0H5.25A2.25 2.25 0 0 0 3 12m18 0v6a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 18v-6m18 0V9M3 12V9m18 0a2.25 2.25 0 0 0-2.25-2.25H5.25A2.25 2.25 0 0 0 3 9m18 0V6a2.25 2.25 0 0 0-2.25-2.25H5.25A2.25 2.25 0 0 0 3 6v3"})],-1),It("span",{class:"button-text"},"seleccione clase intermedia",-1)]))):De("",!0),!se(Xt)&&se(Fe)==4?(Se(),Pe("button",wo,ht[8]||(ht[8]=[It("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-6"},[It("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m4.5 12.75 6 6 9-13.5"})],-1),It("span",{class:"button-text"},"Realizado",-1)]))):De("",!0),!se(Xt)&&se(Fe)>0?(Se(),Pe("button",{key:8,class:"animated-button",onClick:Ai},ht[9]||(ht[9]=[It("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-6"},[It("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M18.364 18.364A9 9 0 0 0 5.636 5.636m12.728 12.728A9 9 0 0 1 5.636 5.636m12.728 12.728L5.636 5.636"})],-1),It("span",{class:"button-text"},"finalizar",-1)]))):De("",!0),se(Xt)?(Se(),Pe("span",ko," Relaciones ")):De("",!0),se(Xt)?(Se(),Pe("button",{key:10,onClick:kt,class:"animated-button"},ht[10]||(ht[10]=[It("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"size-6"},[It("path",{"fill-rule":"evenodd",d:"M20.03 3.97a.75.75 0 0 1 0 1.06L6.31 18.75h9.44a.75.75 0 0 1 0 1.5H4.5a.75.75 0 0 1-.75-.75V8.25a.75.75 0 0 1 1.5 0v9.44L18.97 3.97a.75.75 0 0 1 1.06 0Z","clip-rule":"evenodd"})],-1),It("span",{class:"button-text"},"generalizacion",-1)]))):De("",!0),se(Xt)?(Se(),Pe("button",{key:11,onClick:Ki,class:"animated-button"},ht[11]||(ht[11]=[It("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"size-6"},[It("path",{"fill-rule":"evenodd",d:"M20.03 3.97a.75.75 0 0 1 0 1.06L6.31 18.75h9.44a.75.75 0 0 1 0 1.5H4.5a.75.75 0 0 1-.75-.75V8.25a.75.75 0 0 1 1.5 0v9.44L18.97 3.97a.75.75 0 0 1 1.06 0Z","clip-rule":"evenodd"})],-1),It("span",{class:"button-text"},"agregacion",-1)]))):De("",!0),se(Xt)?(Se(),Pe("button",{key:12,onClick:Qi,class:"animated-button"},ht[12]||(ht[12]=[It("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"size-6"},[It("path",{"fill-rule":"evenodd",d:"M20.03 3.97a.75.75 0 0 1 0 1.06L6.31 18.75h9.44a.75.75 0 0 1 0 1.5H4.5a.75.75 0 0 1-.75-.75V8.25a.75.75 0 0 1 1.5 0v9.44L18.97 3.97a.75.75 0 0 1 1.06 0Z","clip-rule":"evenodd"})],-1),It("span",{class:"button-text"},"composicion",-1)]))):De("",!0),se(Xt)?(Se(),Pe("button",{key:13,onClick:ui,class:"animated-button"},ht[13]||(ht[13]=[It("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"size-6"},[It("path",{"fill-rule":"evenodd",d:"M20.03 3.97a.75.75 0 0 1 0 1.06L6.31 18.75h9.44a.75.75 0 0 1 0 1.5H4.5a.75.75 0 0 1-.75-.75V8.25a.75.75 0 0 1 1.5 0v9.44L18.97 3.97a.75.75 0 0 1 1.06 0Z","clip-rule":"evenodd"})],-1),It("span",{class:"button-text"},"Asociacion",-1)]))):De("",!0),se(Xt)?(Se(),Pe("button",{key:14,onClick:ci,class:"animated-button"},ht[14]||(ht[14]=[It("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"size-6"},[It("path",{"fill-rule":"evenodd",d:"M20.03 3.97a.75.75 0 0 1 0 1.06L6.31 18.75h9.44a.75.75 0 0 1 0 1.5H4.5a.75.75 0 0 1-.75-.75V8.25a.75.75 0 0 1 1.5 0v9.44L18.97 3.97a.75.75 0 0 1 1.06 0Z","clip-rule":"evenodd"})],-1),It("span",{class:"button-text"},"dependencia",-1)]))):De("",!0),se(Xt)?(Se(),Pe("button",{key:15,onClick:ht[1]||(ht[1]=rt=>uo(Xt)?Xt.value=!se(Xt):Xt=!se(Xt)),class:"animated-button"},ht[15]||(ht[15]=[It("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-6"},[It("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 15 3 9m0 0 6-6M3 9h12a6 6 0 0 1 0 12h-3"})],-1),It("span",{class:"button-text"},"Volver",-1)]))):De("",!0)])]),ht[16]||(ht[16]=It("div",{id:"myDiagramDiv",style:{height:"500px",width:"1600px",border:"1px solid black","background-color":"#DAE4E4"}},null,-1))])]),_:1})],64))}},To=co(Po,[["__scopeId","data-v-8029c6f4"]]);export{To as default};
